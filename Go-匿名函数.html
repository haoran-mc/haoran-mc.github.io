<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-02-09 Wed 23:47 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>匿名函数</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran">
<meta name="description" content="Copyright © 2022, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="content">
<h1 class="title">匿名函数</h1>
<p>
匿名函数是指不需要定义函数名的一种函数实现方式。1958年LISP首先采用匿名函数。<br>
</p>

<p>
在Go里面，函数可以像普通变量一样被传递或使用，Go语言支持随时在代码里定义匿名函数。<br>
</p>

<p>
匿名函数由一个不带函数名的函数声明和函数体组成。匿名函数的优越性在于可以直接使用函数内的变量，不必申明。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">package</span> main

<span style="color: #268bd2; font-weight: bold;">import</span> (
    <span style="color: #2aa198;">"fmt"</span>
    <span style="color: #2aa198;">"math"</span>
)

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #8787d7;">getSqrt</span> := <span style="color: #268bd2; font-weight: bold;">func</span>(<span style="color: #8787d7;">a</span> <span style="color: #df005f; font-weight: bold;">float64</span>) <span style="color: #df005f; font-weight: bold;">float64</span> {
        <span style="color: #268bd2; font-weight: bold;">return</span> math.<span style="color: #d75fd7; font-weight: bold;">Sqrt</span>(a)
    }
    fmt.<span style="color: #d75fd7; font-weight: bold;">Println</span>(<span style="color: #d75fd7; font-weight: bold;">getSqrt</span>(<span style="color: #d75fd7;">4</span>))
}
</pre>
</div>

<p>
输出结果：<br>
</p>

<pre class="example" id="org3b1b06a">
2
</pre>

<p>
上面先定义了一个名为getSqrt 的变量，初始化该变量时和之前的变量初始化有些不同，使用了func，func是定义函数的，可是这个函数和上面说的函数最大不同就是没有函数名，也就是匿名函数。这里将一个函数当做一个变量一样的操作。<br>
</p>

<p>
Golang匿名函数可赋值给变量，做为结构字段，或者在 channel 里传送。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">package</span> main

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">--- function variable ---</span>
    <span style="color: #8787d7;">fn</span> := <span style="color: #268bd2; font-weight: bold;">func</span>() { <span style="color: #268bd2;">println</span>(<span style="color: #2aa198;">"Hello, World!"</span>) }
    <span style="color: #d75fd7; font-weight: bold;">fn</span>()

    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">--- function collection ---</span>
    <span style="color: #8787d7;">fns</span> := [](<span style="color: #268bd2; font-weight: bold;">func</span>(<span style="color: #8787d7;">x</span> <span style="color: #df005f; font-weight: bold;">int</span>) <span style="color: #df005f; font-weight: bold;">int</span>){
        <span style="color: #268bd2; font-weight: bold;">func</span>(<span style="color: #8787d7;">x</span> <span style="color: #df005f; font-weight: bold;">int</span>) <span style="color: #df005f; font-weight: bold;">int</span> { <span style="color: #268bd2; font-weight: bold;">return</span> x + <span style="color: #d75fd7;">1</span> },
        <span style="color: #268bd2; font-weight: bold;">func</span>(<span style="color: #8787d7;">x</span> <span style="color: #df005f; font-weight: bold;">int</span>) <span style="color: #df005f; font-weight: bold;">int</span> { <span style="color: #268bd2; font-weight: bold;">return</span> x + <span style="color: #d75fd7;">2</span> },
    }
    <span style="color: #268bd2;">println</span>(fns[<span style="color: #d75fd7;">0</span>](<span style="color: #d75fd7;">100</span>))

    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">--- function as field ---</span>
    <span style="color: #8787d7;">d</span> := <span style="color: #268bd2; font-weight: bold;">struct</span> {
        fn <span style="color: #268bd2; font-weight: bold;">func</span>() <span style="color: #df005f; font-weight: bold;">string</span>
    }{
        <span style="color: #d75fd7;">fn</span>: <span style="color: #268bd2; font-weight: bold;">func</span>() <span style="color: #df005f; font-weight: bold;">string</span> { <span style="color: #268bd2; font-weight: bold;">return</span> <span style="color: #2aa198;">"Hello, World!"</span> },
    }
    <span style="color: #268bd2;">println</span>(d.<span style="color: #d75fd7; font-weight: bold;">fn</span>())

    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">--- channel of function ---</span>
    <span style="color: #8787d7;">fc</span> := <span style="color: #268bd2;">make</span>(<span style="color: #268bd2; font-weight: bold;">chan</span> <span style="color: #268bd2; font-weight: bold;">func</span>() <span style="color: #df005f; font-weight: bold;">string</span>, <span style="color: #d75fd7;">2</span>)
    fc &lt;- <span style="color: #268bd2; font-weight: bold;">func</span>() <span style="color: #df005f; font-weight: bold;">string</span> { <span style="color: #268bd2; font-weight: bold;">return</span> <span style="color: #2aa198;">"Hello, World!"</span> }
    <span style="color: #268bd2;">println</span>((&lt;-fc)())
}
</pre>
</div>

<p>
输出结果：<br>
</p>

<pre class="example" id="org3f3880c">
Hello, World!
101
Hello, World!
Hello, World!
</pre>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2022-02-09 23:02 Wed</p>
<p class="author">Author: L.M.haoran</p>
<p class="date">Created: 2022-02-09 Wed 23:47</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
