<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-11-22 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>容器数据卷</title>
<meta name="author" content="L.M.haoran" />
<meta name="description" content="Copyright © 2021, L.M.haoran, all rights reserved." />
<meta name="generator" content="Org Mode" />
<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
           <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
           <script type="module" src="static/js/main.js" defer></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">容器数据卷</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org126fc2b">什么是容器数据卷</a></li>
<li><a href="#org4ff5b7e">使用数据卷</a></li>
<li><a href="#org7c13496">MySQL 同步数据</a></li>
<li><a href="#org4d73b44">具名挂载和匿名挂载</a></li>
<li><a href="#orgefb65f7">初识 dockerfile</a></li>
<li><a href="#org7fe92b6">使用 dockerfile 构建 docker 镜像</a></li>
<li><a href="#orgc3fd9ee">数据卷容器</a></li>
<li><a href="#org5cbacee">数据库数据同步</a></li>
</ul>
</div>
</div>

<div id="outline-container-org126fc2b" class="outline-2">
<h2 id="org126fc2b">什么是容器数据卷</h2>
</div>
<div id="outline-container-org4ff5b7e" class="outline-2">
<h2 id="org4ff5b7e">使用数据卷</h2>
<div class="outline-text-2" id="text-org4ff5b7e">
<dl class="org-dl">
<dt>docker run -it -v /home/haoran/test_container_volume:/home centos /bin/bash</dt><dd>路径要写全，否则 docker 默认放在 docker 目录里<br></dd>
</dl>
</div>
</div>
<div id="outline-container-org7c13496" class="outline-2">
<h2 id="org7c13496">MySQL 同步数据</h2>
<div class="outline-text-2" id="text-org7c13496">
<ol class="org-ol">
<li>docker pull mysql:5.7<br></li>
<li>docker run -d -p 8090:3306 -v /home/haoran/haoran/mysql/conf:/etc/mysql/conf.d -v /home/haoran/haoran/mysql/data:/var/lib/mysql &#x2013;name mysql01 -e MYSQL_ROOT_PASSWORD=haoran232 mysql:5.7<br></li>
</ol>
</div>
</div>
<div id="outline-container-org4d73b44" class="outline-2">
<h2 id="org4d73b44">具名挂载和匿名挂载</h2>
<div class="outline-text-2" id="text-org4d73b44">
<ul class="org-ul">
<li>docker run -d -P &#x2013;name nginx01 -v /etc/nginx nginx<br></li>

<li>docker volume &#x2013;help<br></li>

<li id="docker volume ls">列出所有的卷<br></li>
</ul>

<p>
使用 <code>-v</code> 参数没有指定宿主机的映射路径，发现卷是以这种匿名的方式挂载的。<br>
</p>

<pre class="example" id="org5ee04a3">
local     0da8ef375346fc34cf1daf676bd7d16c5bda19a777de7a416f56f81bb0405b58
</pre>

<ul class="org-ul">
<li>docker run -d -P &#x2013;name nginx01 -v test_volume:/etc/nginx nginx<br></li>

<li>docker volume ls<br></li>
<li>docker volume inspect test_volume<br></li>
</ul>

<div class="org-src-container">
<pre class="src src-shell">-v &#23481;&#22120;&#20869;&#36335;&#24452;              <span style="color: #676E95;"># </span><span style="color: #676E95;">&#21311;&#21517;&#25346;&#36733;</span>
-v &#21367;&#21517;:&#23481;&#22120;&#20869;&#36335;&#24452;         <span style="color: #676E95;"># </span><span style="color: #676E95;">&#20855;&#21517;&#25346;&#36733;</span>
-v /&#23487;&#20027;&#26426;&#36335;&#24452;:&#23481;&#22120;&#20869;&#36335;&#24452;  <span style="color: #676E95;"># </span><span style="color: #676E95;">&#25351;&#23450;&#36335;&#24452;&#25346;&#36733;</span>
</pre>
</div>

<dl class="org-dl">
<dt>docker run -d -P &#x2013;name nginx01 -v test_volume:/etc/nginx:ro nginx</dt><dd>readonly，只能通过宿主机来改变，容器内无法操作。<br></dd>
<dt>docker run -d -P &#x2013;name nginx01 -v test_volume:/etc/nginx:rw nginx</dt><dd>readwrite，默认可读可写。<br></dd>
</dl>
</div>
</div>
<div id="outline-container-orgefb65f7" class="outline-2">
<h2 id="orgefb65f7">初识 dockerfile</h2>
<div class="outline-text-2" id="text-orgefb65f7">
<p>
Dockerfile 就是用来构建 docker 镜像的构建文件。<br>
</p>
</div>
</div>
<div id="outline-container-org7fe92b6" class="outline-2">
<h2 id="org7fe92b6">使用 dockerfile 构建 docker 镜像</h2>
<div class="outline-text-2" id="text-org7fe92b6">
<p>
构建镜像命令：<br>
</p>

<ul class="org-ul">
<li>docker build -f dockerfile01 -t nl-centos .<br></li>
</ul>

<pre class="example" id="org5a69b51">
FROM centos

VOLUME ["volume01", "volume02"]

CMD echo "---end---"
CMD /bin/bash
</pre>

<p>
这个 dockerfile 文件中说明了来源是 centos，会挂载两个目录。<br>
</p>

<ul class="org-ul">
<li>docker images：这里就能找到我们创建的 nl-centos 镜像了。<br></li>
</ul>
</div>
</div>
<div id="outline-container-orgc3fd9ee" class="outline-2">
<h2 id="orgc3fd9ee">数据卷容器</h2>
<div class="outline-text-2" id="text-orgc3fd9ee">
<ul class="org-ul">
<li>docker run -it &#x2013;name centos01 nl-centos：不指定 /bin/bash 也可以，没使用 -d 参数，所以使用 ctrl-p-Q 退出<br></li>
<li>docker run -it &#x2013;name centos02 &#x2013;volumes-from centos01 nl-centos<br></li>

<li>docker attach centos01<br></li>
<li>cd volume01<br></li>
<li><p>
touch centos01.txt<br>
</p>

<p>
这时候进入 centos02 会发现也有 centos01.txt 这个文件。<br>
</p></li>

<li>docker attach centos02<br></li>
<li>cd volume02<br></li>
<li><p>
touch centos02.txt<br>
</p>

<p>
这时候进入 centos01 会发现也有 centos02.txt 这个文件。<br>
</p></li>

<li><p>
docker run -it &#x2013;name centos03 &#x2013;volumes-from centos01 nl-centos<br>
</p>

<p>
创建一个新的容器，发现有上面两个容器创建的文件 centos01.txt 与 centos02.txt。而且现在在 centos03 中创建文件，在另两个容器中也能同步。<br>
</p></li>

<li>docker stop centos01<br></li>
<li><p>
docker rm centos01<br>
</p>

<p>
现在把 centos01 停止且删除！<br>
</p></li>

<li><p>
docker attach centos03<br>
</p>

<p>
发现数据还在！<br>
</p></li>
</ul>
</div>
</div>
<div id="outline-container-org5cbacee" class="outline-2">
<h2 id="org5cbacee">数据库数据同步</h2>
<div class="outline-text-2" id="text-org5cbacee">
<ul class="org-ul">
<li>docker run -d -p 8090:3306 -v /etc/mysql/conf.d -v /var/lib/mysql -e MYSQL_ROOT_PASSWORD=haoran232 &#x2013;name mysql01 mysql:5.7<br></li>
<li>docker run -d -p 8091:3306 -e MYSQL_ROOT_PASSWORD=haoran232 &#x2013;name mysql02 &#x2013;volumes-from mysql01 mysql:5.7<br></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2021-12-06 09:12 Mon</p>
<p class="author">Author: L.M.haoran</p>
<p class="date">Created: 2022-11-22</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
