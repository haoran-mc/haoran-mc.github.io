<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2023-01-23 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SHELL-小数类型</title>
<meta name="author" content="Haoran Liu" />
<meta name="description" content="Copyright © 2023, Haoran Liu, all rights reserved." />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="static/css/org.css"/>
</head>
<body>
<div id="content" class="content">
<h1 class="title">SHELL-小数类型</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org8a2f5d5">如何定义数字变量</a></li>
<li><a href="#org2e2f2d6">数值运算</a></li>
<li><a href="#org64c43e7">保留小数</a>
<ul>
<li><a href="#org7fb233b">bc</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org8a2f5d5" class="outline-2">
<h2 id="org8a2f5d5">如何定义数字变量</h2>
<div class="outline-text-2" id="text-org8a2f5d5">
<p>
默认情况下，shell 中每一个变量的值都是字符串，即使给一个变量赋值一个数字，它其实也是字符串，所以在进行数学计算时会出错。<br>
</p>

<p>
使用 <code>declare</code> 命令的 <code>-i</code> 选项可以将一个变量声明为整数类型，这样在进行数字计算时就不会作为字符串处理了。<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #686858;">#</span><span style="color: #686858;">!/bin/</span><span style="color: #87AFD7;">bash</span>
<span style="color: #87AFD7;">declare</span> -i a b
<span style="color: #faf4c6;">a</span>=10
<span style="color: #faf4c6;">b</span>=20

<span style="color: #87AFD7;">declare</span> -i res
<span style="color: #faf4c6;">res</span>=$<span style="color: #faf4c6;">a</span>+$<span style="color: #faf4c6;">b</span>
<span style="color: #87AFD7;">echo</span> $<span style="color: #faf4c6;">res</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e2f2d6" class="outline-2">
<h2 id="org2e2f2d6">数值运算</h2>
<div class="outline-text-2" id="text-org2e2f2d6">
<p>
shell 里面默认仅支持整数的数据。<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #87AFD7;">declare</span> -i <span style="color: #faf4c6;">total</span>=${<span style="color: #faf4c6;">firstnu</span>}*${<span style="color: #faf4c6;">secnu</span>}
<span style="color: #87AFD7;">let</span> <span style="color: #faf4c6;">t</span>=x+y
<span style="color: #faf4c6;">var</span>=$((${<span style="color: #faf4c6;">firstnu</span>}*${<span style="color: #faf4c6;">secnu</span>}))
<span style="color: #faf4c6;">x</span>=<span style="color: #719611; font-weight: bold;">`expr $x + 1`</span>
<span style="color: #faf4c6;">x</span>=$(expr $<span style="color: #faf4c6;">x</span> + 1)
</pre>
</div>

<p>
bash shell 为了保持跟 Boume shell 的兼容而包含了 <code>expr</code> 命令，但它同样提供了一种更简单的方法来执行数学表达式。<br>
</p>

<p>
使用美元符和方括号 <code>$[]</code> 将数学表达式围起来。<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #faf4c6;">var1</span> = $[1 + 5]
</pre>
</div>
</div>
</div>
<div id="outline-container-org64c43e7" class="outline-2">
<h2 id="org64c43e7">保留小数</h2>
<div class="outline-text-2" id="text-org64c43e7">
<p>
下面得到 num1 的命令是等价的，得到 num2 的命令是等价的，得到 num3 的命令是等价的。<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #faf4c6;">num0</span>=123
<span style="color: #faf4c6;">num1</span>=$(awk -v <span style="color: #faf4c6;">x</span>=$<span style="color: #faf4c6;">num0</span> <span style="color: #87875f;">'BEGIN{print sqrt(x)}'</span>)
<span style="color: #faf4c6;">num1</span>=$(<span style="color: #87AFD7;">echo</span> <span style="color: #87875f;">"$num0"</span> | awk <span style="color: #87875f;">'{print sqrt($1)}'</span>)
<span style="color: #faf4c6;">num1</span>=$(<span style="color: #87AFD7;">echo</span> | awk <span style="color: #87875f;">"{print sqrt($num0)}"</span>)

<span style="color: #faf4c6;">num2</span>=$(<span style="color: #87AFD7;">echo</span> <span style="color: #87875f;">"scale=6; sqrt($num0)"</span> | bc)
<span style="color: #faf4c6;">num2</span>=$(bc &lt;&lt;&lt; <span style="color: #87875f;">"scale=6; sqrt($num0)"</span>)

<span style="color: #faf4c6;">num3</span>=<span style="color: #719611; font-weight: bold;">`awk 'BEGIN{printf "%.2f\n", "$num1"/"$num2"}'`</span>
<span style="color: #faf4c6;">num3</span>=$(<span style="color: #87AFD7;">echo</span> <span style="color: #87875f;">"sclae=2; $num1/$num2"</span> | bc)
</pre>
</div>
</div>
<div id="outline-container-org7fb233b" class="outline-3">
<h3 id="org7fb233b">bc</h3>
<div class="outline-text-3" id="text-org7fb233b">
<p>
最常见的方案，使用内置的 bash 计算器。<br>
</p>

<p>
浮点运算是由内建变量 <code>scale</code> 控制的，使用它来控制输出的小数位数，默认值是 <code>0</code> 。<br>
</p>

<p>
使用例子见上面。<br>
</p>

<p>
更多的计算可以这样：<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #686858;">#</span><span style="color: #686858;">!/bin/</span><span style="color: #87AFD7;">bash</span>

<span style="color: #faf4c6;">var1</span>=10.46
<span style="color: #faf4c6;">var2</span>=43.67
<span style="color: #faf4c6;">var3</span>=33.2
<span style="color: #faf4c6;">var4</span>=71

<span style="color: #faf4c6;">var5</span>=$(bc &lt;&lt; EOF
<span style="color: #87875f;">scale = 4</span>
<span style="color: #87875f;">a1 = ($var1 * $var2)</span>
<span style="color: #87875f;">b1 = ($var3 * $var4)</span>
<span style="color: #87875f;">a1 + b1</span>
<span style="color: #87875f;">EOF</span>
)

<span style="color: #87AFD7;">echo</span> $<span style="color: #faf4c6;">var5</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2023-01-22 22:01 Sun</p>
<p class="author">Author: Haoran Liu</p>
<p class="date">Created: 2023-01-23</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
