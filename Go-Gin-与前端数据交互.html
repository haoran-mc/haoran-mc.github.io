<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2023-02-07 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>数据交互</title>
<meta name="author" content="L.M.haoran" />
<meta name="description" content="Copyright © 2021, L.M.haoran, all rights reserved." />
<meta name="generator" content="Org Mode" />
<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
           <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
           <script type="module" src="static/js/main.js" defer></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">数据交互</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org4a05bcc">返回 json</a>
<ul>
<li><a href="#org18f0d9a">使用 map</a></li>
<li><a href="#org7b4bbbf">使用 struct</a></li>
</ul>
</li>
<li><a href="#org85db7ed">获取数据</a>
<ul>
<li><a href="#orgee1437b">获取 params 中的参数</a></li>
<li><a href="#org5bfff56">获取 query 中的参数</a></li>
<li><a href="#orgfb4e356">获取 body 中的参数</a></li>
</ul>
</li>
<li><a href="#org44d5717">Gin 解析参数</a>
<ul>
<li><a href="#org37d1bce">BindJSON</a></li>
<li><a href="#org56e413d">ShouldBindJSON</a></li>
<li><a href="#org78bb0a5">ShouldBindWith</a></li>
<li><a href="#orgd57ee8b">如何选择使用</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org4a05bcc" class="outline-2">
<h2 id="org4a05bcc">返回 json</h2>
<div class="outline-text-2" id="text-org4a05bcc">
</div>
<div id="outline-container-org18f0d9a" class="outline-3">
<h3 id="org18f0d9a">使用 map</h3>
<div class="outline-text-3" id="text-org18f0d9a">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #fb4934;">func</span> <span style="color: #b8bb26;">main</span>() {
    <span style="color: #83a598;">r</span> := gin.<span style="color: #b8bb26;">Default</span>()

    r.<span style="color: #b8bb26;">GET</span>(<span style="color: #b8bb26;">"/map"</span>, <span style="color: #fb4934;">func</span>(<span style="color: #83a598;">c</span> *<span style="color: #fabd2f;">gin.Context</span>) {
        <span style="color: #928374;">/*</span>
<span style="color: #928374;">         * data := map[string]interface{} {</span>
<span style="color: #928374;">         *     "name": "&#23567;&#29579;&#23376;",</span>
<span style="color: #928374;">         *     "message": "hello",</span>
<span style="color: #928374;">         *     "age": 18,</span>
<span style="color: #928374;">         * }</span>
<span style="color: #928374;">         */</span>

        <span style="color: #928374;">// </span><span style="color: #928374;">&#26041;&#27861;1.5&#65306;&#20351;&#29992;gin.H&#65288;&#23601;&#26159;gin&#30340;&#20316;&#32773;&#24819;&#21040;&#22823;&#23478;&#32463;&#24120;&#29992; map[string]interface{} &#29305;&#24847;&#35774;&#35745;&#30340;&#24555;&#25463;&#31867;&#65289;</span>
        <span style="color: #83a598;">data</span> := <span style="color: #fabd2f;">gin.H</span>{<span style="color: #b8bb26;">"name"</span>: <span style="color: #b8bb26;">"&#23567;&#29579;&#23376;"</span>, <span style="color: #b8bb26;">"message"</span>: <span style="color: #b8bb26;">"hello"</span>, <span style="color: #b8bb26;">"age"</span>: 18}

        c.<span style="color: #b8bb26;">JSON</span>(http.StatusOK, data)
    })

    r.<span style="color: #b8bb26;">Run</span>(<span style="color: #b8bb26;">":8080"</span>)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org7b4bbbf" class="outline-3">
<h3 id="org7b4bbbf">使用 struct</h3>
<div class="outline-text-3" id="text-org7b4bbbf">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #fb4934;">func</span> <span style="color: #b8bb26;">main</span>() {
    <span style="color: #fb4934;">type</span> <span style="color: #fabd2f;">msg</span> <span style="color: #fb4934;">struct</span> {
        Name <span style="color: #fabd2f;">string</span>
        message <span style="color: #fabd2f;">string</span>         <span style="color: #928374;">// </span><span style="color: #928374;">&#23567;&#20889;&#30340;&#35270;&#20026;&#31169;&#26377;&#21464;&#37327;</span>
        Age <span style="color: #fabd2f;">int</span> <span style="color: #b8bb26;">`json:"name"`</span>  <span style="color: #928374;">// </span><span style="color: #928374;">&#22240;&#20026;&#21069;&#31471;&#21516;&#23398;&#20064;&#24815;&#20351;&#29992;&#23567;&#20889;&#21464;&#37327;&#65292;&#20026;&#20102;&#36801;&#23601;&#21069;&#31471;&#21516;&#23398;&#65292;&#36825;&#37324;&#20351;&#29992; tag</span>
    }

    <span style="color: #83a598;">r</span> := gin.<span style="color: #b8bb26;">Default</span>()

    r.<span style="color: #b8bb26;">GET</span>(<span style="color: #b8bb26;">"/struct"</span>, <span style="color: #fb4934;">func</span>(<span style="color: #83a598;">c</span> *<span style="color: #fabd2f;">gin.Context</span>) {
        <span style="color: #83a598;">data</span> := <span style="color: #fabd2f;">msg</span>{
            <span style="color: #d3869b;">Name</span>: <span style="color: #b8bb26;">"&#23567;&#29579;&#23376;"</span>,
            <span style="color: #d3869b;">message</span>: <span style="color: #b8bb26;">"Hello"</span>,
            <span style="color: #d3869b;">Age</span>: 18,
        }
        c.<span style="color: #b8bb26;">JSON</span>(http.StatusOK, data)   <span style="color: #928374;">// </span><span style="color: #928374;">json &#24207;&#21015;&#21270;</span>
    })
    r.<span style="color: #b8bb26;">Run</span>(<span style="color: #b8bb26;">":8080"</span>)
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org85db7ed" class="outline-2">
<h2 id="org85db7ed">获取数据</h2>
<div class="outline-text-2" id="text-org85db7ed">
<ul class="org-ul">
<li><a href="Wiki-前后端传参的几种方式.html">前后端传参的几种方式</a><br></li>
</ul>
</div>
<div id="outline-container-orgee1437b" class="outline-3">
<h3 id="orgee1437b">获取 params 中的参数</h3>
<div class="outline-text-3" id="text-orgee1437b">
<p>
常用于 GET 请求。<br>
</p>

<pre class="example" id="org448ee31">
http://127.0.0.1:8080/api/user/:username
http://127.0.0.1:8080/api/user/Tom
</pre>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #fb4934;">func</span> <span style="color: #b8bb26;">main</span>() {
    <span style="color: #83a598;">r</span> := gin.<span style="color: #b8bb26;">Default</span>()

    r.<span style="color: #b8bb26;">GET</span>(<span style="color: #b8bb26;">"/api/user/:username"</span>, <span style="color: #fb4934;">func</span> <span style="color: #b8bb26;">GetUser</span>(<span style="color: #83a598;">c</span> *<span style="color: #fabd2f;">gin.context</span>) {
        <span style="color: #928374;">// </span><span style="color: #928374;">&#38656;&#35201;&#25509;&#25910;&#30340;&#21442;&#25968;&#21517;</span>
        <span style="color: #83a598;">username</span> := c.<span style="color: #b8bb26;">Param</span>(<span style="color: #b8bb26;">"username"</span>)

        <span style="color: #928374;">// </span><span style="color: #928374;">...</span>
    })

    r.<span style="color: #b8bb26;">Run</span>(<span style="color: #b8bb26;">":8080"</span>)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org5bfff56" class="outline-3">
<h3 id="org5bfff56">获取 query 中的参数</h3>
<div class="outline-text-3" id="text-org5bfff56">
<p>
常用于 GET 请求。<br>
</p>

<pre class="example" id="org6c7497e">
http://127.0.0.1:8080/api/user
http://127.0.0.1:8080/api/user?name=Tom&amp;age=16
</pre>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #fb4934;">func</span> <span style="color: #b8bb26;">main</span>() {
    <span style="color: #83a598;">r</span> := gin.<span style="color: #b8bb26;">Default</span>()

    r.<span style="color: #b8bb26;">GET</span>(<span style="color: #b8bb26;">"/api/user"</span>, <span style="color: #fb4934;">func</span> <span style="color: #b8bb26;">GetUser</span>(<span style="color: #83a598;">c</span> *<span style="color: #fabd2f;">gin.context</span>) {
        <span style="color: #928374;">// </span><span style="color: #928374;">&#33719;&#21462;query&#20013;&#30340;&#21442;&#25968;</span>
        <span style="color: #83a598;">name</span> := c.<span style="color: #b8bb26;">Query</span>(<span style="color: #b8bb26;">"name"</span>)
        <span style="color: #83a598;">age</span> := c.<span style="color: #b8bb26;">Query</span>(<span style="color: #b8bb26;">"age"</span>)

        <span style="color: #928374;">// </span><span style="color: #928374;">name := c.DefaultQuery("query", "somebody")    // &#21462;&#19981;&#21040;&#23601;&#29992;&#40664;&#35748;&#20540;</span>
        <span style="color: #928374;">// </span><span style="color: #928374;">name, ok := c.GetQuery("query")   // &#21462;&#19981;&#21040;&#31532;&#20108;&#20010;&#21442;&#25968;&#23601;&#36820;&#22238;false</span>

        <span style="color: #928374;">// </span><span style="color: #928374;">...</span>
    })

    r.<span style="color: #b8bb26;">Run</span>(<span style="color: #b8bb26;">":8080"</span>)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfb4e356" class="outline-3">
<h3 id="orgfb4e356">获取 body 中的参数</h3>
<div class="outline-text-3" id="text-orgfb4e356">
<p>
常用于 POST 请求。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #fb4934;">func</span> <span style="color: #b8bb26;">main</span>() {
    <span style="color: #928374;">// </span><span style="color: #928374;">&#23450;&#20041; struct</span>
    <span style="color: #fb4934;">type</span> <span style="color: #fabd2f;">User</span> <span style="color: #fb4934;">struct</span> {
        Username <span style="color: #fabd2f;">string</span> <span style="color: #b8bb26;">`json:"username"`</span>
        Password <span style="color: #fabd2f;">string</span> <span style="color: #b8bb26;">`json:"password"`</span>
    }

    <span style="color: #83a598;">r</span> := gin.<span style="color: #b8bb26;">Default</span>()

    r.<span style="color: #b8bb26;">POST</span>(<span style="color: #b8bb26;">"/api/user"</span>, <span style="color: #fb4934;">func</span> <span style="color: #b8bb26;">PostTest</span>(<span style="color: #83a598;">c</span> *<span style="color: #fabd2f;">gin.Context</span>()) {
        <span style="color: #83a598;">json</span> := <span style="color: #b8bb26;">User</span>()

        c.<span style="color: #b8bb26;">BindJson</span>(&amp;json)

        <span style="color: #928374;">// </span><span style="color: #928374;">...</span>
    })

    r.<span style="color: #b8bb26;">Run</span>(<span style="color: #b8bb26;">":8080"</span>)
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org44d5717" class="outline-2">
<h2 id="org44d5717">Gin 解析参数</h2>
<div class="outline-text-2" id="text-org44d5717">
<p>
<code>BindJSON</code> 和 <code>ShouldBindJSON</code> ， <code>ShouldBindWith</code> 的区别：<br>
</p>
</div>
<div id="outline-container-org37d1bce" class="outline-3">
<h3 id="org37d1bce">BindJSON</h3>
<div class="outline-text-3" id="text-org37d1bce">
<p>
返回错误，并在 <code>header</code> 里面写 400 的状态码<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #928374;">// </span><span style="color: #928374;">BindJSON is a shortcut for c.MustBindWith(obj, binding.JSON).</span>
<span style="color: #fb4934;">func</span> (<span style="color: #83a598;">c</span> *<span style="color: #fabd2f;">Context</span>) <span style="color: #b8bb26;">BindJSON</span>(<span style="color: #83a598;">obj</span> <span style="color: #fb4934;">interface</span>{}) <span style="color: #fabd2f;">error</span> {
    <span style="color: #fb4934;">return</span> c.<span style="color: #b8bb26;">MustBindWith</span>(obj, binding.JSON)
}
<span style="color: #928374;">// </span><span style="color: #928374;">MustBindWith binds the passed struct pointer using the specified binding engine.</span>
<span style="color: #928374;">// </span><span style="color: #928374;">It will abort the request with HTTP 400 if any error ocurrs.</span>
<span style="color: #928374;">// </span><span style="color: #928374;">See the binding package.</span>
<span style="color: #fb4934;">func</span> (<span style="color: #83a598;">c</span> *<span style="color: #fabd2f;">Context</span>) <span style="color: #b8bb26;">MustBindWith</span>(<span style="color: #83a598;">obj</span> <span style="color: #fb4934;">interface</span>{}, <span style="color: #83a598;">b</span> <span style="color: #fabd2f;">binding.Binding</span>) (<span style="color: #83a598;">err</span> <span style="color: #fabd2f;">error</span>) {
    <span style="color: #fb4934;">if</span> err = c.<span style="color: #b8bb26;">ShouldBindWith</span>(obj, b); err != <span style="color: #d3869b;">nil</span> {
        c.<span style="color: #b8bb26;">AbortWithError</span>(http.StatusBadRequest, err).<span style="color: #b8bb26;">SetType</span>(ErrorTypeBind)
    }

    <span style="color: #fb4934;">return</span>
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org56e413d" class="outline-3">
<h3 id="org56e413d">ShouldBindJSON</h3>
<div class="outline-text-3" id="text-org56e413d">
<p>
只会返回错误信息，不会往 <code>header</code> 里面写 400 的错误状态码<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #928374;">// </span><span style="color: #928374;">ShouldBindJSON is a shortcut for c.ShouldBindWith(obj, binding.JSON).</span>
<span style="color: #fb4934;">func</span> (<span style="color: #83a598;">c</span> *<span style="color: #fabd2f;">Context</span>) <span style="color: #b8bb26;">ShouldBindJSON</span>(<span style="color: #83a598;">obj</span> <span style="color: #fb4934;">interface</span>{}) <span style="color: #fabd2f;">error</span> {
    <span style="color: #fb4934;">return</span> c.<span style="color: #b8bb26;">ShouldBindWith</span>(obj, binding.JSON)
}
<span style="color: #928374;">// </span><span style="color: #928374;">ShouldBindWith binds the passed struct pointer using the specified binding engine.</span>
<span style="color: #928374;">// </span><span style="color: #928374;">See the binding package.</span>
<span style="color: #fb4934;">func</span> (<span style="color: #83a598;">c</span> *<span style="color: #fabd2f;">Context</span>) <span style="color: #b8bb26;">ShouldBindWith</span>(<span style="color: #83a598;">obj</span> <span style="color: #fb4934;">interface</span>{}, <span style="color: #83a598;">b</span> <span style="color: #fabd2f;">binding.Binding</span>) <span style="color: #fabd2f;">error</span> {
    <span style="color: #fb4934;">return</span> b.<span style="color: #b8bb26;">Bind</span>(c.Request, obj)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org78bb0a5" class="outline-3">
<h3 id="org78bb0a5">ShouldBindWith</h3>
<div class="outline-text-3" id="text-org78bb0a5">
<p>
根据 b 的类型去绑定 json，query，去绑定<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #fb4934;">func</span> (<span style="color: #83a598;">c</span> *<span style="color: #fabd2f;">Context</span>) <span style="color: #b8bb26;">ShouldBindWith</span>(<span style="color: #83a598;">obj</span> <span style="color: #fb4934;">interface</span>{}, <span style="color: #83a598;">b</span> <span style="color: #fabd2f;">binding.Binding</span>) <span style="color: #fabd2f;">error</span> {
    <span style="color: #fb4934;">return</span> b.<span style="color: #b8bb26;">Bind</span>(c.Request, obj)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd57ee8b" class="outline-3">
<h3 id="orgd57ee8b">如何选择使用</h3>
<div class="outline-text-3" id="text-orgd57ee8b">
<p>
gin 提供了灵活的 bind 解析参数的方法供你选择。<br>
</p>

<blockquote>
<p>
Shouldxxx 和 bindxxx 区别就是 bindxxx 会在 head 中添加 400 的返回信息，而 Shouldxxx 不会。<br>
</p>
</blockquote>

<ul class="org-ul">
<li><p>
解析错误会在 <code>header</code> 中写一个 400 的状态码<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #928374;">// </span><span style="color: #928374;">&#20869;&#37096;&#26681;&#25454; Content-Type &#21435;&#35299;&#26512;</span>
c.<span style="color: #b8bb26;">Bind</span>(obj <span style="color: #fb4934;">interface</span>{})

<span style="color: #928374;">// </span><span style="color: #928374;">&#20869;&#37096;&#26367;&#20320;&#20256;&#36882;&#20102;&#19968;&#20010; binding.JSON&#65292;&#23545;&#35937;&#21435;&#35299;&#26512;</span>
c.<span style="color: #b8bb26;">BindJSON</span>(obj <span style="color: #fb4934;">interface</span>{})

<span style="color: #928374;">// </span><span style="color: #928374;">&#35299;&#26512;&#21738;&#19968;&#31181;&#32465;&#23450;&#30340;&#31867;&#22411;&#65292;&#26681;&#25454;&#20320;&#30340;&#36873;&#25321;</span>
c.<span style="color: #b8bb26;">BindWith</span>(obj <span style="color: #fb4934;">interface</span>{}, b <span style="color: #fabd2f;">binding.Binding</span>)
</pre>
</div></li>

<li><p>
解析错误直接返回，至于要给客户端返回什么错误状态码有你决定<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #928374;">// </span><span style="color: #928374;">&#20869;&#37096;&#26681;&#25454; Content-Type &#21435;&#35299;&#26512;</span>
c.<span style="color: #b8bb26;">ShouldBind</span>(obj <span style="color: #fb4934;">interface</span>{})

<span style="color: #928374;">// </span><span style="color: #928374;">&#20869;&#37096;&#26367;&#20320;&#20256;&#36882;&#20102;&#19968;&#20010; binding.JSON&#65292;&#23545;&#35937;&#21435;&#35299;&#26512;</span>
c.<span style="color: #b8bb26;">ShouldBindJSON</span>(obj <span style="color: #fb4934;">interface</span>{})

<span style="color: #928374;">// </span><span style="color: #928374;">&#35299;&#26512;&#21738;&#19968;&#31181;&#32465;&#23450;&#30340;&#31867;&#22411;&#65292;&#26681;&#25454;&#20320;&#30340;&#36873;&#25321;</span>
c.<span style="color: #b8bb26;">ShouldBindWith</span>(obj <span style="color: #fb4934;">interface</span>{}, b <span style="color: #fabd2f;">binding.Binding</span>)
</pre>
</div></li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2021-12-14 17:12 Tue</p>
<p class="author">Author: L.M.haoran</p>
<p class="date">Created: 2023-02-07</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
