<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-01-26 Wed 14:38 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>数据交互</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran">
<meta name="description" content="Copyright © 2021, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="content">
<h1 class="title">数据交互</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org3c65637">返回 json</a>
<ul>
<li><a href="#orga46a060">使用 map</a></li>
<li><a href="#org53d7875">使用 struct</a></li>
</ul>
</li>
<li><a href="#orgf3ef9e8">获取数据</a>
<ul>
<li><a href="#orgcf081f6">获取 params 中的参数</a></li>
<li><a href="#orgcc2e71c">获取 query 中的参数</a></li>
<li><a href="#orge538936">获取 body 中的参数</a></li>
</ul>
</li>
<li><a href="#org9967c36">Gin 解析参数</a>
<ul>
<li><a href="#org7308ea8">BindJSON</a></li>
<li><a href="#org7f545a4">ShouldBindJSON()</a></li>
<li><a href="#org86c4b0e">ShouldBindWith</a></li>
<li><a href="#org7dc12de">如何选择使用</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org3c65637" class="outline-2">
<h2 id="org3c65637">返回 json</h2>
<div class="outline-text-2" id="text-org3c65637">
</div>
<div id="outline-container-orga46a060" class="outline-3">
<h3 id="orga46a060">使用 map</h3>
<div class="outline-text-3" id="text-orga46a060">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #8787d7;">r</span> := gin.<span style="color: #d75fd7; font-weight: bold;">Default</span>()

    r.<span style="color: #d75fd7; font-weight: bold;">GET</span>(<span style="color: #2aa198;">"/map"</span>, <span style="color: #268bd2; font-weight: bold;">func</span>(<span style="color: #8787d7;">c</span> *<span style="color: #df005f; font-weight: bold;">gin.Context</span>) {
        <span style="color: #008787; background-color: #262626;">/*</span>
<span style="color: #008787; background-color: #262626;">         * data := map[string]interface{} {</span>
<span style="color: #008787; background-color: #262626;">         *     "name": "&#23567;&#29579;&#23376;",</span>
<span style="color: #008787; background-color: #262626;">         *     "message": "hello",</span>
<span style="color: #008787; background-color: #262626;">         *     "age": 18,</span>
<span style="color: #008787; background-color: #262626;">         * }</span>
<span style="color: #008787; background-color: #262626;">         */</span>

        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#26041;&#27861;1.5&#65306;&#20351;&#29992;gin.H&#65288;&#23601;&#26159;gin&#30340;&#20316;&#32773;&#24819;&#21040;&#22823;&#23478;&#32463;&#24120;&#29992; map[string]interface{} &#29305;&#24847;&#35774;&#35745;&#30340;&#24555;&#25463;&#31867;&#65289;</span>
        <span style="color: #8787d7;">data</span> := <span style="color: #df005f; font-weight: bold;">gin.H</span>{<span style="color: #2aa198;">"name"</span>: <span style="color: #2aa198;">"&#23567;&#29579;&#23376;"</span>, <span style="color: #2aa198;">"message"</span>: <span style="color: #2aa198;">"hello"</span>, <span style="color: #2aa198;">"age"</span>: <span style="color: #d75fd7;">18</span>}

        c.<span style="color: #d75fd7; font-weight: bold;">JSON</span>(http.StatusOK, data)
    })

    r.<span style="color: #d75fd7; font-weight: bold;">Run</span>(<span style="color: #2aa198;">":8080"</span>)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org53d7875" class="outline-3">
<h3 id="org53d7875">使用 struct</h3>
<div class="outline-text-3" id="text-org53d7875">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">msg</span> <span style="color: #268bd2; font-weight: bold;">struct</span> {
        Name <span style="color: #df005f; font-weight: bold;">string</span>
        message <span style="color: #df005f; font-weight: bold;">string</span>         <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#23567;&#20889;&#30340;&#19981;&#21487;&#20197;&#21734;</span>
        Age <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #2aa198;">`json:"name"`</span>  <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#22914;&#26524;&#21069;&#31471;&#19968;&#23450;&#38656;&#35201;&#23567;&#20889;&#30340;&#65292;&#20351;&#29992;tag</span>
    }

    <span style="color: #8787d7;">r</span> := gin.<span style="color: #d75fd7; font-weight: bold;">Default</span>()

    r.<span style="color: #d75fd7; font-weight: bold;">GET</span>(<span style="color: #2aa198;">"/struct"</span>, <span style="color: #268bd2; font-weight: bold;">func</span>(<span style="color: #8787d7;">c</span> *<span style="color: #df005f; font-weight: bold;">gin.Context</span>) {
        <span style="color: #8787d7;">data</span> := msg {
            <span style="color: #d75fd7;">Name</span>: <span style="color: #2aa198;">"&#23567;&#29579;&#23376;"</span>,
                <span style="color: #d75fd7;">message</span>: <span style="color: #2aa198;">"Hello"</span>,
                <span style="color: #d75fd7;">Age</span>: <span style="color: #d75fd7;">18</span>,
            }
        c.<span style="color: #d75fd7; font-weight: bold;">JSON</span>(http.StatusOK, data)   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">json &#24207;&#21015;&#21270;</span>
    })
    r.<span style="color: #d75fd7; font-weight: bold;">Run</span>(<span style="color: #2aa198;">":8080"</span>)
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf3ef9e8" class="outline-2">
<h2 id="orgf3ef9e8">获取数据</h2>
<div class="outline-text-2" id="text-orgf3ef9e8">
</div>
<div id="outline-container-orgcf081f6" class="outline-3">
<h3 id="orgcf081f6">获取 params 中的参数</h3>
<div class="outline-text-3" id="text-orgcf081f6">
<p>
常用于 GET 请求。<br>
</p>

<pre class="example" id="orgc0d17f8">
http://127.0.0.1:8080/api/user/:username
http://127.0.0.1:8080/api/user/Tom
</pre>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #8787d7;">r</span> := gin.<span style="color: #d75fd7; font-weight: bold;">Default</span>()

    r.<span style="color: #d75fd7; font-weight: bold;">GET</span>(<span style="color: #2aa198;">"/api/user/:username"</span>, <span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">GetUser</span>(<span style="color: #8787d7;">c</span> *<span style="color: #df005f; font-weight: bold;">gin.context</span>) {
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#38656;&#35201;&#25509;&#25910;&#30340;&#21442;&#25968;&#21517;</span>
        <span style="color: #8787d7;">username</span> := c.<span style="color: #d75fd7; font-weight: bold;">Param</span>(<span style="color: #2aa198;">"username"</span>)

        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">...</span>
    })

    r.<span style="color: #d75fd7; font-weight: bold;">Run</span>(<span style="color: #2aa198;">":8080"</span>)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcc2e71c" class="outline-3">
<h3 id="orgcc2e71c">获取 query 中的参数</h3>
<div class="outline-text-3" id="text-orgcc2e71c">
<p>
常用于 GET 请求。<br>
</p>

<pre class="example" id="org23f6435">
http://127.0.0.1:8080/api/user
http://127.0.0.1:8080/api/user?name=Tom&amp;age=16
</pre>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #8787d7;">r</span> := gin.<span style="color: #d75fd7; font-weight: bold;">Default</span>()

    r.<span style="color: #d75fd7; font-weight: bold;">GET</span>(<span style="color: #2aa198;">"/api/user"</span>, <span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">GetUser</span>(<span style="color: #8787d7;">c</span> *<span style="color: #df005f; font-weight: bold;">gin.context</span>) {
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#33719;&#21462;query&#20013;&#30340;&#21442;&#25968;</span>
        <span style="color: #8787d7;">name</span> := c.<span style="color: #d75fd7; font-weight: bold;">Query</span>(<span style="color: #2aa198;">"name"</span>)
        <span style="color: #8787d7;">age</span> := c.<span style="color: #d75fd7; font-weight: bold;">Query</span>(<span style="color: #2aa198;">"age"</span>)

        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">name := c.DefaultQuery("query", "somebody")    // &#21462;&#19981;&#21040;&#23601;&#29992;&#40664;&#35748;&#20540;</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">name, ok := c.GetQuery("query")   // &#21462;&#19981;&#21040;&#31532;&#20108;&#20010;&#21442;&#25968;&#23601;&#36820;&#22238;false</span>

        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">...</span>
    })

    r.<span style="color: #d75fd7; font-weight: bold;">Run</span>(<span style="color: #2aa198;">":8080"</span>)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orge538936" class="outline-3">
<h3 id="orge538936">获取 body 中的参数</h3>
<div class="outline-text-3" id="text-orge538936">
<p>
常用于 POST 请求。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#23450;&#20041; struct</span>
    <span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">User</span> <span style="color: #268bd2; font-weight: bold;">struct</span> {
        Username <span style="color: #df005f; font-weight: bold;">string</span> <span style="color: #2aa198;">`json:"username"`</span>
        Password <span style="color: #df005f; font-weight: bold;">string</span> <span style="color: #2aa198;">`json:"password"`</span>
    }

    <span style="color: #8787d7;">r</span> := gin.<span style="color: #d75fd7; font-weight: bold;">Default</span>()

    r.<span style="color: #d75fd7; font-weight: bold;">POST</span>(<span style="color: #2aa198;">"/api/user"</span>, <span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">PostTest</span>(<span style="color: #8787d7;">c</span> *<span style="color: #df005f; font-weight: bold;">gin.Context</span>()) {
        <span style="color: #8787d7;">json</span> := <span style="color: #d75fd7; font-weight: bold;">User</span>()

        c.<span style="color: #d75fd7; font-weight: bold;">BindJson</span>(&amp;json)

        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">...</span>
    })

    r.<span style="color: #d75fd7; font-weight: bold;">Run</span>(<span style="color: #2aa198;">":8080"</span>)
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9967c36" class="outline-2">
<h2 id="org9967c36">Gin 解析参数</h2>
<div class="outline-text-2" id="text-org9967c36">
<p>
BindJSON 和 ShouldBindJSON，ShouldBindWith 的区别：<br>
</p>
</div>
<div id="outline-container-org7308ea8" class="outline-3">
<h3 id="org7308ea8">BindJSON</h3>
<div class="outline-text-3" id="text-org7308ea8">
<ul class="org-ul">
<li>返回错误，并在header里面写400的状态码<br></li>
</ul>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">BindJSON is a shortcut for c.MustBindWith(obj, binding.JSON).</span>
<span style="color: #268bd2; font-weight: bold;">func</span> (<span style="color: #8787d7;">c</span> *<span style="color: #df005f; font-weight: bold;">Context</span>) <span style="color: #d75fd7; font-weight: bold;">BindJSON</span>(<span style="color: #8787d7;">obj</span> <span style="color: #268bd2; font-weight: bold;">interface</span>{}) <span style="color: #df005f; font-weight: bold;">error</span> {
    <span style="color: #268bd2; font-weight: bold;">return</span> c.<span style="color: #d75fd7; font-weight: bold;">MustBindWith</span>(obj, binding.JSON)
}
<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">MustBindWith binds the passed struct pointer using the specified binding engine.</span>
<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">It will abort the request with HTTP 400 if any error ocurrs.</span>
<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">See the binding package.</span>
<span style="color: #268bd2; font-weight: bold;">func</span> (<span style="color: #8787d7;">c</span> *<span style="color: #df005f; font-weight: bold;">Context</span>) <span style="color: #d75fd7; font-weight: bold;">MustBindWith</span>(<span style="color: #8787d7;">obj</span> <span style="color: #268bd2; font-weight: bold;">interface</span>{}, <span style="color: #8787d7;">b</span> <span style="color: #df005f; font-weight: bold;">binding.Binding</span>) (<span style="color: #8787d7;">err</span> <span style="color: #df005f; font-weight: bold;">error</span>) {
    <span style="color: #268bd2; font-weight: bold;">if</span> err = c.<span style="color: #d75fd7; font-weight: bold;">ShouldBindWith</span>(obj, b); err != <span style="color: #d75fd7;">nil</span> {
        c.<span style="color: #d75fd7; font-weight: bold;">AbortWithError</span>(http.StatusBadRequest, err).<span style="color: #d75fd7; font-weight: bold;">SetType</span>(ErrorTypeBind)
    }

    <span style="color: #268bd2; font-weight: bold;">return</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7f545a4" class="outline-3">
<h3 id="org7f545a4">ShouldBindJSON()</h3>
<div class="outline-text-3" id="text-org7f545a4">
<ul class="org-ul">
<li>只会返回错误信息，不会往header里面写400的错误状态码<br></li>
</ul>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">ShouldBindJSON is a shortcut for c.ShouldBindWith(obj, binding.JSON).</span>
<span style="color: #268bd2; font-weight: bold;">func</span> (<span style="color: #8787d7;">c</span> *<span style="color: #df005f; font-weight: bold;">Context</span>) <span style="color: #d75fd7; font-weight: bold;">ShouldBindJSON</span>(<span style="color: #8787d7;">obj</span> <span style="color: #268bd2; font-weight: bold;">interface</span>{}) <span style="color: #df005f; font-weight: bold;">error</span> {
    <span style="color: #268bd2; font-weight: bold;">return</span> c.<span style="color: #d75fd7; font-weight: bold;">ShouldBindWith</span>(obj, binding.JSON)
}
<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">ShouldBindWith binds the passed struct pointer using the specified binding engine.</span>
<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">See the binding package.</span>
<span style="color: #268bd2; font-weight: bold;">func</span> (<span style="color: #8787d7;">c</span> *<span style="color: #df005f; font-weight: bold;">Context</span>) <span style="color: #d75fd7; font-weight: bold;">ShouldBindWith</span>(<span style="color: #8787d7;">obj</span> <span style="color: #268bd2; font-weight: bold;">interface</span>{}, <span style="color: #8787d7;">b</span> <span style="color: #df005f; font-weight: bold;">binding.Binding</span>) <span style="color: #df005f; font-weight: bold;">error</span> {
    <span style="color: #268bd2; font-weight: bold;">return</span> b.<span style="color: #d75fd7; font-weight: bold;">Bind</span>(c.Request, obj)
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org86c4b0e" class="outline-3">
<h3 id="org86c4b0e">ShouldBindWith</h3>
<div class="outline-text-3" id="text-org86c4b0e">
<ul class="org-ul">
<li>根据b的类型去绑定json，query，去绑定<br></li>
</ul>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> (<span style="color: #8787d7;">c</span> *<span style="color: #df005f; font-weight: bold;">Context</span>) <span style="color: #d75fd7; font-weight: bold;">ShouldBindWith</span>(<span style="color: #8787d7;">obj</span> <span style="color: #268bd2; font-weight: bold;">interface</span>{}, <span style="color: #8787d7;">b</span> <span style="color: #df005f; font-weight: bold;">binding.Binding</span>) <span style="color: #df005f; font-weight: bold;">error</span> {
    <span style="color: #268bd2; font-weight: bold;">return</span> b.<span style="color: #d75fd7; font-weight: bold;">Bind</span>(c.Request, obj)
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7dc12de" class="outline-3">
<h3 id="org7dc12de">如何选择使用</h3>
<div class="outline-text-3" id="text-org7dc12de">
<p>
gin提供了灵活的bind解析参数的方法供你选择。<br>
</p>

<blockquote>
<p>
Shouldxxx和bindxxx区别就是bindxxx会在head中添加400的返回信息，而Shouldxxx不会。<br>
</p>
</blockquote>

<ul class="org-ul">
<li><p>
解析错误回在header中写一个400的状态码<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#20869;&#37096;&#26681;&#25454;Content-Type&#21435;&#35299;&#26512;</span>
c.<span style="color: #d75fd7; font-weight: bold;">Bind</span>(obj <span style="color: #268bd2; font-weight: bold;">interface</span>{})

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#20869;&#37096;&#26367;&#20320;&#20256;&#36882;&#20102;&#19968;&#20010;binding.JSON&#65292;&#23545;&#35937;&#21435;&#35299;&#26512;</span>
c.<span style="color: #d75fd7; font-weight: bold;">BindJSON</span>(obj <span style="color: #268bd2; font-weight: bold;">interface</span>{})

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#35299;&#26512;&#21738;&#19968;&#31181;&#32465;&#23450;&#30340;&#31867;&#22411;&#65292;&#26681;&#25454;&#20320;&#30340;&#36873;&#25321;</span>
c.<span style="color: #d75fd7; font-weight: bold;">BindWith</span>(obj <span style="color: #268bd2; font-weight: bold;">interface</span>{}, b <span style="color: #df005f; font-weight: bold;">binding.Binding</span>)
</pre>
</div></li>

<li><p>
解析错误直接返回，至于要给客户端返回什么错误状态码有你决定<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#20869;&#37096;&#26681;&#25454;Content-Type&#21435;&#35299;&#26512;</span>
c.<span style="color: #d75fd7; font-weight: bold;">ShouldBind</span>(obj <span style="color: #268bd2; font-weight: bold;">interface</span>{})

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#20869;&#37096;&#26367;&#20320;&#20256;&#36882;&#20102;&#19968;&#20010;binding.JSON&#65292;&#23545;&#35937;&#21435;&#35299;&#26512;</span>
c.<span style="color: #d75fd7; font-weight: bold;">ShouldBindJSON</span>(obj <span style="color: #268bd2; font-weight: bold;">interface</span>{})

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#35299;&#26512;&#21738;&#19968;&#31181;&#32465;&#23450;&#30340;&#31867;&#22411;&#65292;&#26681;&#25454;&#20320;&#30340;&#36873;&#25321;</span>
c.<span style="color: #d75fd7; font-weight: bold;">ShouldBindWith</span>(obj <span style="color: #268bd2; font-weight: bold;">interface</span>{}, b <span style="color: #df005f; font-weight: bold;">binding.Binding</span>)
</pre>
</div></li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2021-12-14 17:12 Tue</p>
<p class="author">Author: L.M.haoran</p>
<p class="date">Created: 2022-01-26 Wed 14:38</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
