<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2021-09-30 四 22:41 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>&lrm;</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran">
<meta name="description" content="Copyright © 2021, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org04c6820">向量</a>
<ul>
<li><a href="#org31a5fb7">字面值</a></li>
<li><a href="#orgeaec37e">向量的创建与使用</a></li>
<li><a href="#org4e3f67e">向量函数</a></li>
</ul>
</li>
<li><a href="#org8d7f97a">结构体</a>
<ul>
<li><a href="#orgfd18c83">大体功能</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org04c6820" class="outline-2">
<h2 id="org04c6820">向量</h2>
<div class="outline-text-2" id="text-org04c6820">
</div>
<div id="outline-container-org31a5fb7" class="outline-3">
<h3 id="org31a5fb7">字面值</h3>
<div class="outline-text-3" id="text-org31a5fb7">
<p>
向量可以说是一个非常好用的类型 ，是一种元素按整数来索引的对象，异源的数据结构，在占用空间上比同样元素的列表要少，在外观上：列表示为： (1 2 3 4)
VECTOR表示为： #(1 2 3 4)
</p>

<p>
向量通过闭合的#(和)表示，例如#(1 2 3)。作为字面值时，它们应该被引用，例如：
</p>
<div class="org-src-container">
<pre class="src src-scheme">'#(1 2 3)             ;;整数向量
'#(a 0 #\a)           ;;由符号、整数和字符构成的向量
</pre>
</div>
</div>
</div>
<div id="outline-container-orgeaec37e" class="outline-3">
<h3 id="orgeaec37e">向量的创建与使用</h3>
<div class="outline-text-3" id="text-orgeaec37e">
<div class="org-src-container">
<pre class="src src-scheme">(define v (vector 1 2 3 4 5))
(define v ‘#(1 2 3 4 5))
(vector-ref v 0) ;;求第n个变量的值
(vector-length v) ;;求vector的长度
(vector-set! v 2 "abc") ;;设定vector第n个元素的值
(define x (make-vector 5 6)) ;;创建向量表
</pre>
</div>
</div>
</div>
<div id="outline-container-org4e3f67e" class="outline-3">
<h3 id="org4e3f67e">向量函数</h3>
<div class="outline-text-3" id="text-org4e3f67e">
<p>
下面的函数都是R5RS规定的函数：
</p>
<ul class="org-ul">
<li>(vector? obj) 如果obj是一个向量则返回#t</li>
<li>(make-vector k) 放回一个有k个元素的向量</li>
<li>(make-vector k fill) 如果指定了第二个参数fill，那么所有的元素都会被初始化为fill</li>
<li>(vector obj …) 返回由参数列表构成的向量</li>
<li>(vector-length vector) 返回向量vector的长度</li>
<li>(vector-ref vector k) 返回向量vector的索引为k的元素(译注：和C语言类似，向量从0开始索引)</li>
<li>(vector-set! vector k obj) 将向量vector的索引为k的元素修改为obj</li>
<li>(vector-&gt;list vector) 将vector转换为表</li>
<li>(list-&gt;vector list) 将list转换为向量</li>
<li>(vector-fill! vector fill) 将向量vector的所有元素设置为fill</li>
</ul>

<p>
例：一个对向量中元素求和的函数
</p>
<div class="org-src-container">
<pre class="src src-scheme">(define (vector-add v1 v2)
	(let ((lenv1 (vector-length v1))
				(lenv2 (vector-length v2)))
		(if (= lenv1 lenv2)
				(let ((v (make-vector lenv1)))
					(let loop ((i 0))
						(if (= i lenv1)
								v
								(begin
									(vector-set! v i (+ (vector-ref v1 i) (vector-ref v2 i)))
									(loop (1+ i))))))
				(error "different dimensions."))))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org8d7f97a" class="outline-2">
<h2 id="org8d7f97a">结构体</h2>
<div class="outline-text-2" id="text-org8d7f97a">
</div>
<div id="outline-container-orgfd18c83" class="outline-3">
<h3 id="orgfd18c83">大体功能</h3>
<div class="outline-text-3" id="text-orgfd18c83">
<p>
虽然R5RS中没有定义结构体，但是在很多Scheme实现中，都实现了类似于Common Lisp中的结构体。这些结构体本质上来说都是向量。每一个槽都通过使用一个宏来命名。结构体通过不同的属性清楚地表示数据。定义结构体的宏自动为结构体创建读取（accessor）函数和设置（setter）函数。你可以通过“程序”来写程序，这被认为是Lisp/Scheme最好之处之一
</p>

<p>
### MIT-Scheme中的结构体在MIT-Scheme中，结构体通过函数define-structure来定义
</p>

<p>
例：书籍都有下列属性：标题作者出版商出版年份
ISBN号因此结构体book就可以像下面这样定义：
`(define-structure book title authors publisher year isbn)`
</p>

<p>
下面演示了如何注册《大教堂与市集（The Cathedral and Bazaar）》
</p>

<div class="org-src-container">
<pre class="src src-scheme">(define bazaar
	(make-book
	 "The Cathedral and the Bazaar"
	 "Eric S. Raymond"
	 "O'Reilly"
	 1999
	 0596001088))
</pre>
</div>
<p>
然而，这样做多多少少有点不便，因为属性与值的关联并不清楚。参量keyword-constructor可以用于解决这个问题。下面的代码就是使用这个参量的重写版，这个版本中，属性与值的关联就非常清楚了。更进一步来说，制定这个参量后，参数的顺序就不重要了
</p>

<p>
参量copier可用于为结构体创建一个拷贝（copier）函数
</p>
<div class="org-src-container">
<pre class="src src-scheme">(define-structure (book keyword-constructor copier)
	title authors publisher year isbn)

(define bazaar
	(make-book
	 'title "The Cathedral and the Bazaar"
	 'authors "Eric S. Raymond"
	 'publisher "O'Reilly"
	 'year 1999
	 'isbn 0596001088))
</pre>
</div>

<p>
一个名字形如[结构体名称]?的函数用于检查某对象是否为特定结构体例如，可使用函数book?来检查bazaar是否为book结构体的一个实例
</p>
<div class="org-src-container">
<pre class="src src-scheme">(book? bazaar)
																				;Value: #t
</pre>
</div>

<p>
一个名字形如copy-[结构体名称]的函数用于拷贝结构体例如，下面的代码演示了将bazaar拷贝到cathedral
(define cathedral (copy-book bazaar))
</p>

<p>
一个名字形如[结构体名称]-[属性名称]的函数用于读取结构体某属性的值例如，下面的代码演示了如何读取bazaar的title属性
(book-title bazaar)
;Value 18: "The Cathedral and the Bazaar"
</p>

<p>
一个名字形如set-[结构体名称]-[属性名称]!用于将某属性设定为特定值例如，下面的代码演示了如何将bazaar的year字段更新到2001（《大教堂与市集》2001年再版）
(set-book-year! bazaar 2001)
;Unspecified return value
</p>

<p>
(book-year bazaar)
;Value: 2001
请参阅MIT/GNU Scheme Reference: 2.10 Structure Definitions以获得关于结构体的跟多信息
</p>
</div>
</div>
</div>
</div>
</body>
</html>
