<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2023-01-10 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>openFile的第三个参数</title>
<meta name="author" content="Haoran Liu" />
<meta name="description" content="Copyright © 2023, Haoran Liu, all rights reserved." />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="static/css/org.css"/>
</head>
<body>
<div id="content" class="content">
<h1 class="title">openFile的第三个参数</h1>
<p>
<code>os.OpenFile</code> 函数时 <code>os.Create</code> 函数和 <code>os.Open</code> 函数的底层支持，它最灵活。这个函数有 3 个函数：<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #ffa759;">func</span> <span style="color: #ffd580;">OpenFile</span>(<span style="color: #cbccc6;">name</span> <span style="color: #ffe6b3;">string</span>, <span style="color: #cbccc6;">flag</span> <span style="color: #ffe6b3;">int</span>, <span style="color: #cbccc6;">perm</span> <span style="color: #ffe6b3;">FileMode</span>) (*<span style="color: #ffe6b3;">File</span>, <span style="color: #ffe6b3;">error</span>) {
    testlog.<span style="color: #ffd580;">Open</span>(name)
    <span style="color: #ffa759;">return</span> <span style="color: #ffd580;">openFileNolog</span>(name, flag, perm)
}
</pre>
</div>

<p>
<code>name</code> 参数是文件的路径； <code>flag</code> 参数，是需要施加在文件描述符上的模式，叫操作模式， <code>Open</code> 函数是只读的就是因为在 <code>Open</code> 函数里调用 <code>OpenFile</code> 的时候指定了该参数：<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #ffa759;">func</span> <span style="color: #ffd580;">Open</span>(<span style="color: #cbccc6;">name</span> <span style="color: #ffe6b3;">string</span>) (*<span style="color: #ffe6b3;">File</span>, <span style="color: #ffe6b3;">error</span>) {
    <span style="color: #ffa759;">return</span> <span style="color: #ffd580;">OpenFile</span>(name, O_RDONLY, 0)
}
</pre>
</div>

<p>
<code>perm</code> 参数，也是模式，叫权限模式。类型是 <code>os.FileMode</code> ，此类型是一个基于 <code>uint32</code> 类型的再定义类型：<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #ffa759;">type</span> <span style="color: #ffe6b3;">FileMode</span> <span style="color: #ffe6b3;">uint32</span>
</pre>
</div>

<p>
这里的两个模式：<br>
</p>

<ul class="org-ul">
<li>flag：操作模式，限定了操作文件方式<br></li>
<li>perm：权限模式，控制文件的访问权限<br></li>
</ul>

<p>
关于操作模式和访问权限的更多细节，在后面继续讲。<br>
</p>

<p>
打开文件并写入内容的操作示例：<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #ffa759;">package</span> main

<span style="color: #ffa759;">import</span> (
    <span style="color: #bae67e;">"fmt"</span>
    <span style="color: #bae67e;">"os"</span>
    <span style="color: #bae67e;">"path/filepath"</span>
)

<span style="color: #ffa759;">func</span> <span style="color: #ffd580;">main</span>() {
    <span style="color: #cbccc6;">fileName</span> := <span style="color: #bae67e;">"test.txt"</span>
    <span style="color: #cbccc6;">dir</span>, <span style="color: #cbccc6;">_</span> := os.<span style="color: #ffd580;">Getwd</span>()
    <span style="color: #cbccc6;">dirPath</span> := filepath.<span style="color: #ffd580;">Join</span>(dir, fileName)
    <span style="color: #484f5b;">// </span><span style="color: #484f5b;">O_WRONLY&#65306;&#21482;&#20889;&#27169;&#24335;&#12290;O_CREATE&#65306;&#25991;&#20214;&#19981;&#23384;&#22312;&#23601;&#21019;&#24314;&#12290;O_TRUNC&#65306;&#25171;&#24320;&#24182;&#28165;&#31354;&#25991;&#20214;</span>
    <span style="color: #cbccc6;">file</span>, <span style="color: #cbccc6;">err</span> := os.<span style="color: #ffd580;">OpenFile</span>(dirPath, os.O_WRONLY|os.O_CREATE|os.O_TRUNC, 0666)
    <span style="color: #ffa759;">if</span> err != <span style="color: #d4bfff;">nil</span> {
        fmt.<span style="color: #ffd580;">Fprintf</span>(os.Stderr, <span style="color: #bae67e;">"ERROR: %v\n"</span>, err)
        <span style="color: #ffa759;">return</span>
    }
    <span style="color: #cbccc6;">n</span>, <span style="color: #cbccc6;">err</span> := file.<span style="color: #ffd580;">WriteString</span>(<span style="color: #bae67e;">"&#20889;&#20837;&#25805;&#20316;"</span>)
    <span style="color: #ffa759;">if</span> err != <span style="color: #d4bfff;">nil</span> {
        fmt.<span style="color: #ffd580;">Fprintf</span>(os.Stderr, <span style="color: #bae67e;">"ERROR: %v\n"</span>, err)
    } <span style="color: #ffa759;">else</span> {
        fmt.<span style="color: #ffd580;">Println</span>(<span style="color: #bae67e;">"&#20889;&#20837;&#23383;&#33410;&#25968;&#65288;bytes&#65289;:"</span>, n)
    }
}
</pre>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2023-01-10 12:01 Tue</p>
<p class="author">Author: Haoran Liu</p>
<p class="date">Created: 2023-01-10</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
