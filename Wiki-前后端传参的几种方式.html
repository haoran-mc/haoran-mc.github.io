<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2023-02-07 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WIKI-前后端传参的几种方式</title>
<meta name="author" content="L.M.haoran" />
<meta name="description" content="Copyright © 2022, L.M.haoran, all rights reserved." />
<meta name="generator" content="Org Mode" />
<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
           <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
           <script type="module" src="static/js/main.js" defer></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">WIKI-前后端传参的几种方式</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org39e86fb">前端向后端传参的方式</a>
<ul>
<li><a href="#org4cd27e8">1、请求参数路径传递</a></li>
</ul>
</li>
<li><a href="#org6b71f19">go、net/http</a></li>
<li><a href="#org93bb13e">go、gin</a>
<ul>
<li><a href="#org19684a5">获取 querystring 参数</a></li>
<li><a href="#org6213999">获取 path 参数</a></li>
<li><a href="#org9ccbab2">获取 form 参数（POST）</a></li>
<li><a href="#org361778a">获取 json 参数（POST）</a></li>
<li><a href="#org6fa20bd">参数绑定</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org39e86fb" class="outline-2">
<h2 id="org39e86fb">前端向后端传参的方式</h2>
<div class="outline-text-2" id="text-org39e86fb">
</div>
<div id="outline-container-org4cd27e8" class="outline-3">
<h3 id="org4cd27e8">1、请求参数路径传递</h3>
<div class="outline-text-3" id="text-org4cd27e8">
<p>
常见于 GET 请求，该种数据采用明文进行数据传输，故其一般用于获取一些无关重要的用户信息，该方式有两种参数传递形式：<br>
</p>

<p>
（1）URL 路径传参<br>
</p>
<pre class="example" id="org50abb1f">
http://127.0.0.1:8080/user?name=Tom&amp;age=16
</pre>

<p>
（2）URL 路径参数<br>
</p>
<pre class="example" id="orgafdaa78">
http://127.0.0.1:8080/user/Tom/16
</pre>
</div>
</div>
</div>
<div id="outline-container-org6b71f19" class="outline-2">
<h2 id="org6b71f19">go、net/http</h2>
</div>
<div id="outline-container-org93bb13e" class="outline-2">
<h2 id="org93bb13e">go、gin</h2>
<div class="outline-text-2" id="text-org93bb13e">
</div>
<div id="outline-container-org19684a5" class="outline-3">
<h3 id="org19684a5">获取 querystring 参数</h3>
<div class="outline-text-3" id="text-org19684a5">
<p>
<i>querysting</i> 指的是 URL 中 <code>?</code> 后面携带的参数，例如： <code>http://127.0.0.1/user/search?username=haoran&amp;major=math</code> ，获取请求的 <code>querystring</code> 参数的方法如下：<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #928374;">// </span><span style="color: #928374;">&#26681;&#25454;&#22995;&#21517;&#19982;&#19987;&#19994;&#26597;&#25214;&#23398;&#21495;</span>
<span style="color: #fb4934;">func</span> <span style="color: #b8bb26;">main</span>() {
    <span style="color: #83a598;">r</span> := gin.<span style="color: #b8bb26;">Default</span>()
    r.<span style="color: #b8bb26;">GET</span>(<span style="color: #b8bb26;">"/user/search"</span>, <span style="color: #fb4934;">func</span>(<span style="color: #83a598;">c</span> *<span style="color: #fabd2f;">gin.Context</span>) {
        <span style="color: #83a598;">username</span> := c.<span style="color: #b8bb26;">Query</span>(<span style="color: #b8bb26;">"username"</span>)
        <span style="color: #928374;">// </span><span style="color: #928374;">username := c.DefaultQuery("username", "haoran")</span>
        <span style="color: #83a598;">major</span> := c.<span style="color: #b8bb26;">Query</span>(<span style="color: #b8bb26;">"major"</span>)
        <span style="color: #fb4934;">var</span> <span style="color: #83a598;">stuid</span> <span style="color: #fabd2f;">string</span>
        <span style="color: #928374;">// </span><span style="color: #928374;">stuid = ......   // &#26597;&#25214;&#23398;&#21495;&#30340; orm &#35821;&#21477;</span>
        c.<span style="color: #b8bb26;">JSON</span>(http.StatusOK, <span style="color: #fabd2f;">gin.H</span>{
            <span style="color: #b8bb26;">"message"</span>: <span style="color: #b8bb26;">"ok"</span>,
            <span style="color: #b8bb26;">"stuid"</span>: stuid,
        })
    })
    r.<span style="color: #b8bb26;">Run</span>(<span style="color: #b8bb26;">":8080"</span>)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org6213999" class="outline-3">
<h3 id="org6213999">获取 path 参数</h3>
<div class="outline-text-3" id="text-org6213999">
<p>
请求的参数通过 URL 路径传参，例如： <code>http://127.0.0.1/user/search/haoran/math</code> ，获取请求 URL 路径中的参数的方式如下：<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #fb4934;">func</span> <span style="color: #b8bb26;">main</span>() {
    <span style="color: #83a598;">r</span> := gin.<span style="color: #b8bb26;">Default</span>()
    r.<span style="color: #b8bb26;">GET</span>(<span style="color: #b8bb26;">"/user/search/:username/:major"</span>, <span style="color: #fb4934;">func</span>(<span style="color: #83a598;">c</span> *<span style="color: #fabd2f;">gin.Context</span>) {
        <span style="color: #83a598;">username</span> := c.<span style="color: #b8bb26;">Param</span>(<span style="color: #b8bb26;">"username"</span>)
        <span style="color: #83a598;">major</span> := c.<span style="color: #b8bb26;">Param</span>(<span style="color: #b8bb26;">"major"</span>)
        <span style="color: #fb4934;">var</span> <span style="color: #83a598;">stuid</span> <span style="color: #fabd2f;">string</span>
        <span style="color: #928374;">// </span><span style="color: #928374;">stuid = ......   // &#26597;&#25214;&#23398;&#21495;&#30340; orm &#35821;&#21477;</span>
        c.<span style="color: #b8bb26;">JSON</span>(http.StatusOK, <span style="color: #fabd2f;">gin.H</span>{
            <span style="color: #b8bb26;">"message"</span>: <span style="color: #b8bb26;">"ok"</span>,
            <span style="color: #b8bb26;">"stuid"</span>: stuid,
        })
    })
    r.<span style="color: #b8bb26;">Run</span>(<span style="color: #b8bb26;">":8080"</span>)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org9ccbab2" class="outline-3">
<h3 id="org9ccbab2">获取 form 参数（POST）</h3>
<div class="outline-text-3" id="text-org9ccbab2">
<p>
当前端请求的数据通过 form 表单提交时，例如向 <code>http://127.0.0.1/user/search</code> 发送一个 POST 请求，获取请求数据的方式如下：<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #fb4934;">func</span> <span style="color: #b8bb26;">main</span>() {
    <span style="color: #83a598;">r</span> := gin.<span style="color: #b8bb26;">Default</span>()
    r.<span style="color: #b8bb26;">POST</span>(<span style="color: #b8bb26;">"user/search"</span>, <span style="color: #fb4934;">func</span>(<span style="color: #83a598;">c</span> *<span style="color: #fabd2f;">gin.Context</span>) {
        <span style="color: #928374;">// </span><span style="color: #928374;">DefaultPostForm &#21462;&#19981;&#21040;&#20540;&#26102;&#20250;&#36820;&#22238;&#25351;&#23450;&#30340;&#40664;&#35748;&#20540;</span>
        <span style="color: #928374;">// </span><span style="color: #928374;">username := c.DefaultPostForm("username", "haoran")</span>
        <span style="color: #83a598;">username</span> := c.<span style="color: #b8bb26;">PostForm</span>(<span style="color: #b8bb26;">"username"</span>)
        <span style="color: #83a598;">major</span> := c.<span style="color: #b8bb26;">PostForm</span>(<span style="color: #b8bb26;">"major"</span>)
        <span style="color: #fb4934;">var</span> <span style="color: #83a598;">stuid</span> <span style="color: #fabd2f;">string</span>
        <span style="color: #928374;">// </span><span style="color: #928374;">stuid = ......   // &#26597;&#25214;&#23398;&#21495;&#30340; orm &#35821;&#21477;</span>
        c.<span style="color: #b8bb26;">JSON</span>(http.StatusOK, <span style="color: #fabd2f;">gin.H</span>{
            <span style="color: #b8bb26;">"message"</span>: <span style="color: #b8bb26;">"ok"</span>,
            <span style="color: #b8bb26;">"stuid"</span>: stuid,
        })
    })
    r.<span style="color: #b8bb26;">Run</span>(<span style="color: #b8bb26;">":8080"</span>)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org361778a" class="outline-3">
<h3 id="org361778a">获取 json 参数（POST）</h3>
<div class="outline-text-3" id="text-org361778a">
<p>
当前端请求的数据通过 JSON 提交时，例如向 <code>http://127.0.0.1/json</code> 发送一个 POST 请求，则获取请求参数的方式如下：<br>
</p>

<div class="org-src-container">
<pre class="src src-go">r.<span style="color: #b8bb26;">POST</span>(<span style="color: #b8bb26;">"/json"</span>, <span style="color: #fb4934;">func</span>(<span style="color: #83a598;">c</span> *<span style="color: #fabd2f;">gin.Context</span>) {
    <span style="color: #928374;">// </span><span style="color: #928374;">&#27880;&#24847;&#65306;&#19979;&#38754;&#20026;&#20102;&#20030;&#20363;&#23376;&#26041;&#20415;&#65292;&#26242;&#26102;&#24573;&#30053;&#20102;&#38169;&#35823;&#22788;&#29702;</span>
    <span style="color: #83a598;">b</span>, <span style="color: #83a598;">_</span> := c.<span style="color: #b8bb26;">GetRawData</span>()  <span style="color: #928374;">// </span><span style="color: #928374;">&#20174; c.Request.Body &#35835;&#21462;&#35831;&#27714;&#25968;&#25454;</span>
    <span style="color: #928374;">// </span><span style="color: #928374;">&#23450;&#20041; map &#25110;&#32467;&#26500;&#20307;</span>
    <span style="color: #fb4934;">var</span> <span style="color: #83a598;">m</span> <span style="color: #fb4934;">map</span>[<span style="color: #fabd2f;">string</span>]<span style="color: #fb4934;">interface</span>{}
    <span style="color: #928374;">// </span><span style="color: #928374;">&#21453;&#24207;&#21015;&#21270;</span>
    _ = json.<span style="color: #b8bb26;">Unmarshal</span>(b, &amp;m)

    c.<span style="color: #b8bb26;">JSON</span>(http.StatusOK, m)
})
</pre>
</div>
</div>
</div>
<div id="outline-container-org6fa20bd" class="outline-3">
<h3 id="org6fa20bd">参数绑定</h3>
<div class="outline-text-3" id="text-org6fa20bd">
<p>
为了能够更方便的获取请求相关参数，提高开发效率，我们可以基于请求的 <code>Content-Type</code> 识别请求数据类型并利用反射机制自动提取请求中 <code>QueryString</code> 、 <code>form</code> 表单、 <code>JSON</code> 、 <code>XML</code> 等参数到结构体中。 下面的示例代码演示了 <code>.ShouldBind()</code> 强大的功能，它能够基于请求自动提取 <code>JSON</code> 、 <code>form</code> 表单和 <code>QueryString</code> 类型的数据，并把值绑定到指定的结构体对象。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #928374;">// </span><span style="color: #928374;">Binding from JSON</span>
<span style="color: #fb4934;">type</span> <span style="color: #fabd2f;">Login</span> <span style="color: #fb4934;">struct</span> {
    User     <span style="color: #fabd2f;">string</span> <span style="color: #b8bb26;">`form:"user" json:"user" binding:"required"`</span>
    Password <span style="color: #fabd2f;">string</span> <span style="color: #b8bb26;">`form:"password" json:"password" binding:"required"`</span>
}

<span style="color: #fb4934;">func</span> <span style="color: #b8bb26;">main</span>() {
    <span style="color: #83a598;">router</span> := gin.<span style="color: #b8bb26;">Default</span>()

    <span style="color: #928374;">// </span><span style="color: #928374;">&#32465;&#23450;JSON&#30340;&#31034;&#20363; ({"user": "q1mi", "password": "123456"})</span>
    router.<span style="color: #b8bb26;">POST</span>(<span style="color: #b8bb26;">"/loginJSON"</span>, <span style="color: #fb4934;">func</span>(<span style="color: #83a598;">c</span> *<span style="color: #fabd2f;">gin.Context</span>) {
        <span style="color: #fb4934;">var</span> <span style="color: #83a598;">login</span> <span style="color: #fabd2f;">Login</span>

        <span style="color: #fb4934;">if</span> <span style="color: #83a598;">err</span> := c.<span style="color: #b8bb26;">ShouldBind</span>(&amp;login); err == <span style="color: #d3869b;">nil</span> {
            fmt.<span style="color: #b8bb26;">Printf</span>(<span style="color: #b8bb26;">"login info:%#v\n"</span>, login)
            c.<span style="color: #b8bb26;">JSON</span>(http.StatusOK, <span style="color: #fabd2f;">gin.H</span>{
                <span style="color: #b8bb26;">"user"</span>:     login.User,
                <span style="color: #b8bb26;">"password"</span>: login.Password,
            })
        } <span style="color: #fb4934;">else</span> {
            c.<span style="color: #b8bb26;">JSON</span>(http.StatusBadRequest, <span style="color: #fabd2f;">gin.H</span>{<span style="color: #b8bb26;">"error"</span>: err.<span style="color: #b8bb26;">Error</span>()})
        }
    })

    <span style="color: #928374;">// </span><span style="color: #928374;">&#32465;&#23450;form&#34920;&#21333;&#31034;&#20363; (user=q1mi&amp;password=123456)</span>
    router.<span style="color: #b8bb26;">POST</span>(<span style="color: #b8bb26;">"/loginForm"</span>, <span style="color: #fb4934;">func</span>(<span style="color: #83a598;">c</span> *<span style="color: #fabd2f;">gin.Context</span>) {
        <span style="color: #fb4934;">var</span> <span style="color: #83a598;">login</span> <span style="color: #fabd2f;">Login</span>
        <span style="color: #928374;">// </span><span style="color: #928374;">ShouldBind()&#20250;&#26681;&#25454;&#35831;&#27714;&#30340;Content-Type&#33258;&#34892;&#36873;&#25321;&#32465;&#23450;&#22120;</span>
        <span style="color: #fb4934;">if</span> <span style="color: #83a598;">err</span> := c.<span style="color: #b8bb26;">ShouldBind</span>(&amp;login); err == <span style="color: #d3869b;">nil</span> {
            c.<span style="color: #b8bb26;">JSON</span>(http.StatusOK, <span style="color: #fabd2f;">gin.H</span>{
                <span style="color: #b8bb26;">"user"</span>:     login.User,
                <span style="color: #b8bb26;">"password"</span>: login.Password,
            })
        } <span style="color: #fb4934;">else</span> {
            c.<span style="color: #b8bb26;">JSON</span>(http.StatusBadRequest, <span style="color: #fabd2f;">gin.H</span>{<span style="color: #b8bb26;">"error"</span>: err.<span style="color: #b8bb26;">Error</span>()})
        }
    })

    <span style="color: #928374;">// </span><span style="color: #928374;">&#32465;&#23450;QueryString&#31034;&#20363; (/loginQuery?user=q1mi&amp;password=123456)</span>
    router.<span style="color: #b8bb26;">GET</span>(<span style="color: #b8bb26;">"/loginForm"</span>, <span style="color: #fb4934;">func</span>(<span style="color: #83a598;">c</span> *<span style="color: #fabd2f;">gin.Context</span>) {
        <span style="color: #fb4934;">var</span> <span style="color: #83a598;">login</span> <span style="color: #fabd2f;">Login</span>
        <span style="color: #928374;">// </span><span style="color: #928374;">ShouldBind()&#20250;&#26681;&#25454;&#35831;&#27714;&#30340;Content-Type&#33258;&#34892;&#36873;&#25321;&#32465;&#23450;&#22120;</span>
        <span style="color: #fb4934;">if</span> <span style="color: #83a598;">err</span> := c.<span style="color: #b8bb26;">ShouldBind</span>(&amp;login); err == <span style="color: #d3869b;">nil</span> {
            c.<span style="color: #b8bb26;">JSON</span>(http.StatusOK, <span style="color: #fabd2f;">gin.H</span>{
                <span style="color: #b8bb26;">"user"</span>:     login.User,
                <span style="color: #b8bb26;">"password"</span>: login.Password,
            })
        } <span style="color: #fb4934;">else</span> {
            c.<span style="color: #b8bb26;">JSON</span>(http.StatusBadRequest, <span style="color: #fabd2f;">gin.H</span>{<span style="color: #b8bb26;">"error"</span>: err.<span style="color: #b8bb26;">Error</span>()})
        }
    })

    <span style="color: #928374;">// </span><span style="color: #928374;">Listen and serve on 0.0.0.0:8080</span>
    router.<span style="color: #b8bb26;">Run</span>(<span style="color: #b8bb26;">":8080"</span>)
}
</pre>
</div>

<p>
<code>ShouldBind</code> 会按照下面的顺序解析请求中的数据完成绑定：<br>
</p>

<ul class="org-ul">
<li>如果是 GET 请求，只使用 Form 绑定引擎（query）。<br></li>
<li>如果是 POST 请求，首先检查 content-type 是否为 JSON 或 XML，然后再使用 Form（form-data）。<br></li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: L.M.haoran</p>
<p class="date">Created: 2023-02-07</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
