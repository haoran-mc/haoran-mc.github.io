<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2021-10-05 二 21:04 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>GO-结构体定义</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran">
<meta name="description" content="Copyright © 2021, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="content">
<h1 class="title">GO-结构体定义</h1>
<p>
结构体定义的一般方式如下：<br>
</p>
<div class="org-src-container">
<pre class="src src-go"><span style="color: #BD93F9;">type</span> <span style="color: #AFAFAF;">identifier</span> <span style="color: #BD93F9;">struct</span> {
    field1 <span style="color: #AFAFAF;">type1</span>
    field2 <span style="color: #AFAFAF;">type2</span>
    <span style="color: #7c7c7c; font-style: italic;">// </span><span style="color: #7c7c7c; font-style: italic;">...</span>
}
</pre>
</div>
<p>
type T struct {a, b int} 也是合法的语法，它更适用于简单的结构体。<br>
</p>

<p>
结构体里的字段都有 名字，像 field1、field2 等，如果字段在代码中从来也不会被用到，那么可以命名它为 _。<br>
</p>

<p>
结构体的字段可以是任何类型，甚至是结构体本身（参考第 10.5 节），也可以是函数或者接口（参考第 11 章）。可以声明结构体类型的一个变量，然后像下面这样给它的字段赋值：<br>
</p>
<div class="org-src-container">
<pre class="src src-go"><span style="color: #BD93F9;">var</span> <span style="color: #AFAFAF;">s</span> <span style="color: #AFAFAF;">T</span>
s.a = <span style="color: #009F9F;">5</span>
s.b = <span style="color: #009F9F;">8</span>
</pre>
</div>

<p>
使用 new 函数给一个新的结构体变量分配内存，它返回指向已分配内存的指针：var t *T = new(T)，如果需要可以把这条语句放在不同的行（比如定义是包范围的，但是分配却没有必要在开始就做）。<br>
</p>
<div class="org-src-container">
<pre class="src src-go"><span style="color: #BD93F9;">var</span> <span style="color: #AFAFAF;">t</span> *<span style="color: #AFAFAF;">T</span>
t = <span style="color: #AFAFAF;">new</span>(<span style="color: #AFAFAF;">T</span>)
</pre>
</div>

<p>
写这条语句的惯用方法是：t := new(T)，变量 t 是一个指向 T 的指针，此时结构体字段的值是它们所属类型的零值。<br>
</p>

<p>
声明 var t T 也会给 t 分配内存，并零值化内存，但是这个时候 t 是类型 T。在这两种方式中，t 通常被称做类型 T 的一个实例（instance）或对象（object）。<br>
</p>

<p>
Go 中的类型转换遵循严格的规则。当为结构体定义了一个 alias 类型时，此结构体类型和它的 alias 类型都有相同的底层类型，它们可以如示例 10.3 那样互相转换，同时需要注意其中非法赋值或转换引起的编译错误。<br>
</p>
<div class="org-src-container">
<pre class="src src-go"><span style="color: #BD93F9;">package</span> main
<span style="color: #BD93F9;">import</span> <span style="color: #FC9F4E;">"fmt"</span>

<span style="color: #BD93F9;">type</span> <span style="color: #AFAFAF;">number</span> <span style="color: #BD93F9;">struct</span> {
    f <span style="color: #AFAFAF;">float32</span>
}

<span style="color: #BD93F9;">type</span> <span style="color: #AFAFAF;">nr</span> <span style="color: #AFAFAF;">number</span>   <span style="color: #7c7c7c; font-style: italic;">// </span><span style="color: #7c7c7c; font-style: italic;">alias type</span>

<span style="color: #BD93F9;">func</span> <span style="color: #AFAFAF;">main</span>() {
    <span style="color: #AFAFAF;">a</span> := <span style="color: #AFAFAF;">number</span>{<span style="color: #009F9F;">5</span>.<span style="color: #009F9F;">0</span>}
    <span style="color: #AFAFAF;">b</span> := <span style="color: #AFAFAF;">nr</span>{<span style="color: #009F9F;">5</span>.<span style="color: #009F9F;">0</span>}
    <span style="color: #7c7c7c; font-style: italic;">// </span><span style="color: #7c7c7c; font-style: italic;">var i float32 = b   // compile-error: cannot use b (type nr) as type float32 in assignment</span>
    <span style="color: #7c7c7c; font-style: italic;">// </span><span style="color: #7c7c7c; font-style: italic;">var i = float32(b)  // compile-error: cannot convert b (type nr) to type float32</span>
    <span style="color: #7c7c7c; font-style: italic;">// </span><span style="color: #7c7c7c; font-style: italic;">var c number = b    // compile-error: cannot use b (type nr) as type number in assignment</span>
    <span style="color: #7c7c7c; font-style: italic;">// </span><span style="color: #7c7c7c; font-style: italic;">needs a conversion:</span>
    <span style="color: #BD93F9;">var</span> <span style="color: #AFAFAF;">c</span> = <span style="color: #AFAFAF;">number</span>(b)
    fmt.<span style="color: #AFAFAF;">Println</span>(a, b, c)
}
</pre>
</div>
</div>
</body>
</html>
