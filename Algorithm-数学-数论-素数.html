<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2021-10-11 Mon 00:03 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>素数</title>
<meta name="generator" content="Org mode">
<meta name="author" content="haoran">
<meta name="description" content="Copyright © 2021, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">素数</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org90f734e">判断一个数是否为素数</a>
<ul>
<li><a href="#org18d37bd">朴素求解</a></li>
<li><a href="#org5bb42fb">埃氏筛法</a></li>
<li><a href="#org75b87e2">欧拉筛法</a>
<ul>
<li><a href="#org718926e">e.g. 求 [1, 15] 的素数 (n = 15) ：</a></li>
</ul>
</li>
<li><a href="#org5c4d393">FAQ</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org90f734e" class="outline-2">
<h2 id="org90f734e">判断一个数是否为素数</h2>
<div class="outline-text-2" id="text-org90f734e">
<blockquote>
<p>
素数也称质数，是指在大于1的自然数中，除了1和它本身以外不再有其他因数的自然数。<br>
</p>
</blockquote>
</div>
<div id="outline-container-org18d37bd" class="outline-3">
<h3 id="org18d37bd">朴素求解</h3>
<div class="outline-text-3" id="text-org18d37bd">
<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #AFAFAF;">bool</span> <span style="color: #AFAFAF;">is_prime</span>(<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">n</span>) {
    <span style="color: #BD93F9;">if</span> (n &lt; <span style="color: #009F9F;">2</span>)
        <span style="color: #BD93F9;">return</span> <span style="color: #009F9F;">false</span>;
    <span style="color: #BD93F9;">for</span> (<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">i</span> = <span style="color: #009F9F;">2</span>; i &lt; n; ++i)
        <span style="color: #BD93F9;">if</span> (n % i == <span style="color: #009F9F;">0</span>)
            <span style="color: #BD93F9;">return</span> <span style="color: #009F9F;">false</span>;
    <span style="color: #BD93F9;">return</span> <span style="color: #009F9F;">true</span>;
}
</pre>
</div>

<p>
因为如果 \(i\) 是 \(n\) 的一个因子，就必然存在一个 \(m\) 满足 \(m = n / i\) 且 \(m < n\) ，如果 \(i = m\) ，则 \(i = m = \sqrt{n}\) ；如果 \(i \neq m\) ，则必然有 \(i, m\) 其中一个大于 \(\sqrt{n}\) ，一个小于 \(\sqrt{n}\) 。所以我们只需要根据 \([2, \sqrt{n}]\) 这个区间是否有 \(n\) 的因子就能判断 \(n\) 是否为质数。<br>
</p>

<p>
注意：如果使用 \(i <= sqrt(n)\) 作为结束条件，反复调用 \(sqrt\) 这个函数会拖慢程序运行；如果使用 \(i * i <= n\) 作为判断条件，可能会因为 \(n\) 接近 int 型变量上届溢出，比如 \(n = 2147483647\)，当 \(i = 46340\) 时，\(i * i = 2147395600 < n\)，循环继续，\(i = 46341\) 时，\(i * i = 2147488281\) 造成溢出；所以推荐判断结束条件为 \(i <= n / i\).<br>
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #AFAFAF;">bool</span> <span style="color: #AFAFAF;">is_prime</span>(<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">n</span>) {
    <span style="color: #BD93F9;">if</span> (n &lt; <span style="color: #009F9F;">2</span>)
        <span style="color: #BD93F9;">return</span> <span style="color: #009F9F;">false</span>;
    <span style="color: #BD93F9;">for</span> (<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">i</span> = <span style="color: #009F9F;">2</span>; i &lt;= n / i; ++i)
        <span style="color: #BD93F9;">if</span> (n % i == <span style="color: #009F9F;">0</span>)
            <span style="color: #BD93F9;">return</span> <span style="color: #009F9F;">false</span>;
    <span style="color: #BD93F9;">return</span> <span style="color: #009F9F;">true</span>;
}
</pre>
</div>

<p>
如果题目需要求出很多个数的素数，仍然使用时间复杂度为 \({O(\sqrt{n}}\) 的朴素方法会超时，这时我们可以预先获得素数表，求出 \([1, n]\) 内的所有素数，对题目中输入的数进行判断时可以 \(O(1)\) 时间内判断是否为素数。<br>
</p>
</div>
</div>

<div id="outline-container-org5bb42fb" class="outline-3">
<h3 id="org5bb42fb">埃氏筛法</h3>
<div class="outline-text-3" id="text-org5bb42fb">
<p>
埃氏筛法，算法从小到大枚举所有的数，对于每一个素数，筛去它所有倍数，筛了一遍后剩下的就是素数，算法复杂度 \(O(nloglogn)\)<br>
</p>

<p>
求 \([1, 15]\) 的素数：<br>
</p>

<ul class="org-ul">
<li>预先需要知道 \(2\) 是一个素数，\(prime[1] = 2\)， 筛去它的所有倍数\(2, 4, 6, 8, 10, 12, 14\)<br></li>
<li>\(i = 3\)，\(3\) 未筛去，\(3\) 是素数，\(prime[2] = 3\)，筛去它的所有倍数\(6, 9, 12, 15\)<br></li>
<li>\(i = 4\)，\(4\) 已筛去，\(4\) 不是素数<br></li>
<li>\(i = 5\)，\(5\) 未筛去，\(5\) 是素数，\(prime[3] = 5\)，筛去它的所有倍数\(10, 15\)<br></li>
<li>\(i = 6\)，\(6\) 已筛去，\(6\) 不是素数<br></li>
<li>\(i = 7\)，\(7\) 未筛去，\(7\) 是素数，\(prime[4] = 7\)，筛去它的所有倍数 \(14\)<br></li>
<li>\(i = 8\)，\(8\) 已筛去，\(8\) 不是素数<br></li>
<li>\(i = 9\)，\(9\) 已筛去，\(9\) 不是素数<br></li>
<li>\(i = 10\)，\(10\) 已筛去，\(10\)不是素数<br></li>
<li>\(i = 11\)，\(11\) 未筛去，\(11\)是素数，\(prime[5] = 11\)， 在 \([1, 15]\) 中没有 \(11\) 的倍数<br></li>
<li>\(i = 12\)，\(12\) 已筛去，\(12\)不是素数<br></li>
<li>\(i = 13\)，\(13\) 未筛去，\(13\)是素数，\(prime[6] = 13\)， 在 \([1, 15]\) 中没有 \(13\) 的倍数<br></li>
<li>\(i = 14\)，\(14\) 已筛去，\(14\)不是素数<br></li>
<li>\(i = 15\)，\(15\) 已筛去，\(15\)不是素数<br></li>
<li>得到 \([1, 15]\) 内的所有素数\(2, 3, 5, 7, 11, 13\)<br></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #009F9F;">#include</span> <span style="color: #FC9F4E;">&lt;cstdio&gt;</span>
<span style="color: #BD93F9;">const</span> <span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">maxn</span> = <span style="color: #009F9F;">1e6</span>;
<span style="color: #7c7c7c; font-style: italic;">//</span><span style="color: #7c7c7c; font-style: italic;">&#23384;&#20648;1 ~ 1e6&#20869;&#30340;&#25152;&#26377;&#32032;&#25968;</span>
<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">primes</span>[maxn], <span style="color: #AFAFAF;">cnt</span>;
<span style="color: #7c7c7c; font-style: italic;">//</span><span style="color: #7c7c7c; font-style: italic;">&#23545;1 ~ 1e6&#20869;&#30340;&#25968;&#26631;&#35760;&#65292;&#26410;&#34987;&#31579;&#25481;&#30340;&#32032;&#25968;&#26631;&#35760;&#20026;false</span>
<span style="color: #AFAFAF;">bool</span> <span style="color: #AFAFAF;">sifter</span>[maxn];

<span style="color: #AFAFAF;">void</span> <span style="color: #AFAFAF;">get_primes</span>(<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">n</span>) {
    <span style="color: #BD93F9;">for</span> (<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">i</span> = <span style="color: #009F9F;">2</span>; i &lt;= n; ++i)
        <span style="color: #BD93F9;">if</span> (sifter[i] == <span style="color: #009F9F;">false</span>) {
            primes[cnt++] = i;
            <span style="color: #BD93F9;">for</span> (<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">j</span> = i + i; j &lt;= n; j += i)
                sifter[j] = <span style="color: #009F9F;">true</span>;
        }
}

<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">main</span>() {
    <span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">n</span>; scanf(<span style="color: #FC9F4E;">"%d"</span>, &amp;n);
    get_primes(n);
    printf(<span style="color: #FC9F4E;">"%d\n"</span>, cnt);
    <span style="color: #BD93F9;">return</span> <span style="color: #009F9F;">0</span>;
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org75b87e2" class="outline-3">
<h3 id="org75b87e2">欧拉筛法</h3>
<div class="outline-text-3" id="text-org75b87e2">
<p>
在上面埃氏筛法中可以看到 \(12\) 被筛去两次；将范围扩大到 \([1, 100]\) ，\(100\) 会分别被 \(2, 4, 5, 10, 20, 25, 50\) 筛去；当范围更大时，重复筛去的次数变多，这不是我们想要的。<br>
</p>

<p>
欧拉筛法就避免了这一情况，每个非素数仅被筛去一次，欧拉筛法复杂度 \(O(n)\)。<br>
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #009F9F;">#include</span> <span style="color: #FC9F4E;">&lt;cstdio&gt;</span>
<span style="color: #BD93F9;">const</span> <span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">maxn</span> = <span style="color: #009F9F;">1e6</span>;
<span style="color: #7c7c7c; font-style: italic;">//</span><span style="color: #7c7c7c; font-style: italic;">&#23384;&#20648;1 ~ n&#20869;&#30340;&#25152;&#26377;&#32032;&#25968;</span>
<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">primes</span>[maxn], <span style="color: #AFAFAF;">cnt</span>;
<span style="color: #7c7c7c; font-style: italic;">//</span><span style="color: #7c7c7c; font-style: italic;">&#26368;&#32456;&#20026;false&#30340;&#25968;&#26159;&#32032;&#25968;</span>
<span style="color: #AFAFAF;">bool</span> <span style="color: #AFAFAF;">sifter</span>[maxn];

<span style="color: #AFAFAF;">void</span> <span style="color: #AFAFAF;">get_primes</span>(<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">n</span>) {
    <span style="color: #7c7c7c; font-style: italic;">//</span><span style="color: #7c7c7c; font-style: italic;">&#20174;2&#24320;&#22987;&#65292;&#21028;&#26029;i&#26159;&#21542;&#20026;&#32032;&#25968;</span>
    <span style="color: #BD93F9;">for</span> (<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">i</span> = <span style="color: #009F9F;">2</span>; i &lt;= n; ++i) {
        <span style="color: #BD93F9;">if</span> (sifter[i] == <span style="color: #009F9F;">false</span>)
            primes[cnt++] = i;

        <span style="color: #BD93F9;">for</span> (<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">j</span> = <span style="color: #009F9F;">0</span>; primes[j] &lt;= n / i; ++j) {
            <span style="color: #7c7c7c; font-style: italic;">// </span><span style="color: #7c7c7c; font-style: italic;">&#27599;&#19968;&#20010;&#20493;&#25968;&#26631;&#35760;&#20026;&#19981;&#26159;&#32032;&#25968;</span>
            sifter[primes[j] * i] = <span style="color: #009F9F;">true</span>;

            <span style="color: #7c7c7c; font-style: italic;">// </span><span style="color: #7c7c7c; font-style: italic;">primes[j]&#20026;i&#30340;&#26368;&#23567;&#32032;&#22240;&#23376;&#65292;&#20998;&#26512;&#19979;&#19968;&#20010;i</span>
            <span style="color: #BD93F9;">if</span> (i % primes[j] == <span style="color: #009F9F;">0</span>)
                <span style="color: #BD93F9;">break</span>;
        }
    }
}

<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">main</span>() {
    <span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">n</span>; scanf(<span style="color: #FC9F4E;">"%d"</span>, &amp;n);
    get_primes(n);
    printf(<span style="color: #FC9F4E;">"%d\n"</span>, cnt);
    <span style="color: #BD93F9;">return</span> <span style="color: #009F9F;">0</span>;
}
</pre>
</div>
</div>
<div id="outline-container-org718926e" class="outline-4">
<h4 id="org718926e">e.g. 求 [1, 15] 的素数 (n = 15) ：</h4>
<div class="outline-text-4" id="text-org718926e">
<ul class="org-ul">
<li>\(i = 2\), 未筛去, \(prime[0] = 2\)<br>
<ul class="org-ul">
<li>\(j = 0\), \(primes[j] <= n / i\), \(i * prime[0] = 2 * 2 = 4\), \(4\)被筛去, \(i \% prime[j] == 2 \% 2 == 0, break\)<br></li>
</ul></li>
<li>\(i = 3\), 未筛去, \(prime[1] = 3\) <br>
<ul class="org-ul">
<li>\(j = 0\), \(primes[j] <= n / i\), \(i * prime[j] = 3 * 2 = 6\), \(6\)被筛去, \(i \% prime[j] == 3 \% 2 == 1\),<br></li>
<li>\(j = 1\), \(primes[j] <= n / i\), \(i * prime[j] = 3 * 3 = 9\), \(9\)被筛去, \(i \% prime[j] == 3 \% 3 == 0, break\)<br></li>
</ul></li>
<li>\(i = 4\), 已筛去<br>
<ul class="org-ul">
<li>\(j = 0\), \(primes[j] <= n / i\), \(i * prime[j] = 4 * 2 = 8\), \(8\)被筛去, \(i \% prime[j] == 4 \% 2 == 0, break\)<br></li>
</ul></li>
<li>\(i = 5\), 未筛去, \(prime[2] = 5\)<br>
<ul class="org-ul">
<li>\(j = 0\), \(primes[j] <= n / i\), \(i * prime[j] = 5 * 2 = 10\), \(10\)被筛去, \(i \% prime[j] == 5 \% 2 == 1\),<br></li>
<li>\(j = 1\), \(primes[j] <= n / i\), \(i * prime[j] = 5 * 3 = 15\), \(15\)被筛去, \(i \% prime[j] == 5 \% 3 == 2\),<br></li>
<li>\(j = 2\), \(primes[j] > n / i, break\)<br></li>
</ul></li>
<li>\(i = 6\), 已筛去<br>
<ul class="org-ul">
<li>\(j = 0, primes[j] <= n / i\), \(i * prime[j] = 6 * 2 = 12\), \(12\)被筛去, \(i \% prime[j] == 6 \% 2 == 0, break\)<br></li>
</ul></li>
<li>\(i = 7\), 未筛去, \(prime[3] = 7\)<br>
<ul class="org-ul">
<li>\(j = 0, primes[j] <= n / i\), \(i * prime[j] = 7 * 2 = 14\), \(14\)被筛去, \(i \% prime[j] == 7 \% 2 == 1\),<br></li>
<li>\(j = 1, primes[j] > n / i, break\)<br></li>
</ul></li>
<li>\(i = 8\), 已筛去<br>
<ul class="org-ul">
<li>\(j = 0, primes[j] > n / i, break\)<br></li>
</ul></li>
<li>\(i = 9\), 已筛去<br>
<ul class="org-ul">
<li>\(j = 0, primes[j] > n / i, break\)<br></li>
</ul></li>
<li>\(i = 10\), 已筛去<br>
<ul class="org-ul">
<li>\(j = 0, primes[j] > n / i, break\)<br></li>
</ul></li>
<li>\(i = 11\), 未筛去, prime[5] = 11,<br>
<ul class="org-ul">
<li>\(j = 0, primes[j] > n / i, break\)<br></li>
</ul></li>
<li>\(i = 12\), 已筛去<br>
<ul class="org-ul">
<li>\(j = 0, primes[j] > n / i, break\)<br></li>
</ul></li>
<li>\(i = 13\), 未筛去, prime[6] = 13,<br>
<ul class="org-ul">
<li>\(j = 0, primes[j] > n / i, break\)<br></li>
</ul></li>
<li>\(i = 14\), 已筛去<br>
<ul class="org-ul">
<li>\(j = 0, primes[j] > n / i, break\)<br></li>
</ul></li>
<li>\(i = 15\), 已筛去<br>
<ul class="org-ul">
<li>\(j = 0, primes[j] > n / i, break\)<br></li>
</ul></li>
</ul>

<p>
筛出的素数：先后被筛去的数是4, 6, 9, 8, 10, 15, 12, 14；分别只筛去一次，剩下素数2, 3, 5, 7, 11, 13<br>
</p>
</div>
</div>
</div>
<div id="outline-container-org5c4d393" class="outline-3">
<h3 id="org5c4d393">FAQ</h3>
<div class="outline-text-3" id="text-org5c4d393">
<p>
这里为什么 \(i \% prime[j] == 0\) ，就要 \(break\) 呢？<br>
</p>

<p>
如果不 \(break\) ，\(4 * 3 = 12\) 就要被筛去，实际上 \(12\) 会在 \(i = 6\) ，\(prime[j] = prime[1] = 2\) ，\(6 * 2 = 12\) 被筛去。<br>
</p>

<p>
\(2\) 是 \(12\) 的最小素因子，比如 \(100\) 的最小素因子是 \(2\) ，所以 \(100\) 会在 \(50 * 2\) 时筛选掉，避免重复筛选。<br>
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: haoran</p>
<p class="date">Created: 2021-10-11 Mon 00:03</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
