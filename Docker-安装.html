<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2021-11-30 Tue 22:56 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DOCKER-安装</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran &lt;haoran.mc@outlook.com&gt;">
<meta name="description" content="Copyright © 2021, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="content">
<h1 class="title">DOCKER-安装</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org77cbead">Docker的基本组成</a>
<ul>
<li><a href="#org8c41aee">Docker的架构图</a></li>
<li><a href="#orgba831b0">镜像(image)</a></li>
<li><a href="#org42c1823">容器(container)</a></li>
<li><a href="#org4d7be03">仓库(repository)</a></li>
<li><a href="#org5205ac1">小结</a></li>
</ul>
</li>
<li><a href="#org0ffe9cf">环境说明</a>
<ul>
<li><a href="#orgfc8e137">查看自己的内核</a></li>
<li><a href="#orge4cceac">查看版本信息</a></li>
</ul>
</li>
<li><a href="#org6aefde5">安装步骤</a></li>
<li><a href="#org61ba046">阿里云镜像加速</a>
<ul>
<li><a href="#org97d3582">测试 HelloWorld</a></li>
</ul>
</li>
<li><a href="#org10108a0">底层原理</a>
<ul>
<li><a href="#org6701609">Docker是怎么工作的</a></li>
<li><a href="#org5e7e8af">为什么Docker比较VM快</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org77cbead" class="outline-2">
<h2 id="org77cbead">Docker的基本组成</h2>
<div class="outline-text-2" id="text-org77cbead">
</div>
<div id="outline-container-org8c41aee" class="outline-3">
<h3 id="org8c41aee">Docker的架构图</h3>
</div>
<div id="outline-container-orgba831b0" class="outline-3">
<h3 id="orgba831b0">镜像(image)</h3>
<div class="outline-text-3" id="text-orgba831b0">
<p>
Docker 镜像(Image)就是一个只读的模板。镜像可以用来创建 Docker 容器，一个镜像可以创建很多容器。就好似Java中的类和对象，类就是镜像，容器就是对象。<br>
</p>
</div>
</div>
<div id="outline-container-org42c1823" class="outline-3">
<h3 id="org42c1823">容器(container)</h3>
<div class="outline-text-3" id="text-org42c1823">
<p>
Docker 利用容器(Container)独立运行的一个或一组应用。容器是用镜像创建的运行实例。<br>
它可以被启动、开始、停止、删除。每个容器都是相互隔离的，保证安全的平台。<br>
可以把容器看做是一个简易版的Linux环境(包括root用户权限、进程空间、用户空间和网络空间等)和运行在其中的应用程序<br>
容器的定义和镜像几乎一模一样，也是一堆层的统一视角，唯一区别在于容器的最上面那一层是可读可写的<br>
</p>
</div>
</div>
<div id="outline-container-org4d7be03" class="outline-3">
<h3 id="org4d7be03">仓库(repository)</h3>
<div class="outline-text-3" id="text-org4d7be03">
<p>
仓库(Repository)是集中存放镜像文件的场所<br>
仓库(Repository)和仓库注册服务器(Registry)是有区别的。仓库注册服务器上往往存放着多个仓库,每个仓库中又包含了多个镜像,每个镜像有不同的标签(tag)<br>
仓库分为公开仓库(Public)和私有仓库(Private)两种形式<br>
最大的公开仓库是 Docker Hub(<a href="https://hub.docker.com/">https://hub.docker.com/</a>)，存放了数量庞大的镜像供用户下载。<br>
国内的公开仓库包括阿里云 、网易云等<br>
</p>
</div>
</div>
<div id="outline-container-org5205ac1" class="outline-3">
<h3 id="org5205ac1">小结</h3>
<div class="outline-text-3" id="text-org5205ac1">
<p>
需要正确的理解仓储/镜像/容器这几个概念 :<br>
</p>
<ul class="org-ul">
<li>Docker 本身是一个容器运行载体或称之为管理引擎。我们把应用程序和配置依赖打包好形成一个可交付的运行环境，这个打包好的运行环境就似乎image镜像文件。只有通过这个镜像文件才能生成Docker容器。image文件可以看作是容器的模板。Docker根据image文件生成容器的实例。同一个 image 文件,可以生成多个同时运行的容器实例<br></li>
<li>image 文件生成的容器实例,本身也是一个文件,称为镜像文件<br></li>
<li>一个容器运行一种服务,当我们需要的时候,就可以通过docker客户端创建一个对应的运行实例,也就是我们的容器<br></li>
<li>至于仓库,就是放了一堆镜像的地方,我们可以把镜像发布到仓库中,需要的时候从仓库中拉下来就可以了。<br></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org0ffe9cf" class="outline-2">
<h2 id="org0ffe9cf">环境说明</h2>
<div class="outline-text-2" id="text-org0ffe9cf">
<p>
我们使用的是 CentOS 7 (64-bit)<br>
目前,CentOS 仅发行版本中的内核支持 Docker。<br>
Docker 运行在 CentOS 7 上,要求系统为64位、系统内核版本为 3.10 以上。<br>
</p>
</div>
<div id="outline-container-orgfc8e137" class="outline-3">
<h3 id="orgfc8e137">查看自己的内核</h3>
<div class="outline-text-3" id="text-orgfc8e137">
<p>
uname -r 命令用于打印当前系统相关信息(内核版本号、硬件架构、主机名称和操作系统类型等)<br>
$ uname -r<br>
3.10.0-1062.12.1.el7.x86_64<br>
</p>
</div>
</div>
<div id="outline-container-orge4cceac" class="outline-3">
<h3 id="orge4cceac">查看版本信息</h3>
<div class="outline-text-3" id="text-orge4cceac">
<p>
$ cat /etc/os-release<br>
</p>

<p>
NAME="CentOS Linux"<br>
VERSION="7 (Core)"<br>
ID="centos"<br>
ID_LIKE="rhel fedora"<br>
VERSION_ID="7"<br>
PRETTY_NAME="CentOS Linux 7 (Core)"<br>
ANSI_COLOR="0;31"<br>
CPE_NAME="cpe:/o:centos:centos:7"<br>
HOME_URL="<a href="https://www.centos.org/">https://www.centos.org/</a>"<br>
BUG_REPORT_URL="<a href="https://bugs.centos.org/">https://bugs.centos.org/</a>"<br>
</p>

<p>
CENTOS_MANTISBT_PROJECT="CentOS-7"<br>
CENTOS_MANTISBT_PROJECT_VERSION="7"<br>
REDHAT_SUPPORT_PRODUCT="centos"<br>
REDHAT_SUPPORT_PRODUCT_VERSION="7"<br>
</p>
</div>
</div>
</div>
<div id="outline-container-org6aefde5" class="outline-2">
<h2 id="org6aefde5">安装步骤</h2>
<div class="outline-text-2" id="text-org6aefde5">
<ol class="org-ol">
<li>官网安装参考手册:<a href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a><br></li>
<li>确定你是CentOS7及以上版本,我们已经做过了<br></li>
<li>yum安装gcc相关环境(需要确保 虚拟机可以上外网)<br>
yum -y install gcc<br>
yum -y install gcc-c++<br></li>

<li>卸载旧版本<br>
yum remove docker \<br>
docker-client \<br>
docker-client-latest \<br>
docker-common \<br>
docker-latest \<br>
docker-latest-logrotate \<br>
docker-logrotate \<br>
docker-engine<br></li>

<li>安装需要的软件包<br>
yum install -y yum-utils<br></li>

<li><p>
设置镜像仓库<br>
</p>

<p>
yum-config-manager &#x2013;add-repo <a href="https://download.docker.com/linux/centos/docker-ce.repo">https://download.docker.com/linux/centos/docker-ce.repo</a><br>
## 报错<br>
[Errno 14] curl#35 - TCP connection reset by peer<br>
[Errno 12] curl#35 - Timeout<br>
</p>

<p>
yum-config-manager &#x2013;add-repo <a href="http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo">http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</a><br>
</p>

<p>
TMD网上那群SB一直说在/etc/docker/daemon.json中配置docker源，配尼玛呢，日尼玛一篇博客抄来抄去，他妈的有点自己的东西行吗<br>
在centos7中/etc/yum.repos.d/目录下有docker源的配置文件<br>
</p></li>

<li>更新yum软件包索引<br>
yum makecache fast<br></li>

<li>安装Docker CE<br>
yum install docker-ce docker-ce-cli containerd.io<br></li>

<li><p>
启动Docker<br>
systemctl start docker<br>
这里我遇到问题，是因为/etc/docker/daemon.json，没有配置好<br>
如果没有这个文件夹或这个文件，那么需要手动创建<br>
</p>
<div class="org-src-container">
<pre class="src src-json">{
    <span style="color: #BD93F9;">"registry-mirrors"</span> : [
        <span style="color: #FC9F4E;">"https://mirror.ccs.tencentyun.com"</span>,
        <span style="color: #FC9F4E;">"http://registry.docker-cn.com"</span>,
        <span style="color: #FC9F4E;">"http://docker.mirrors.ustc.edu.cn"</span>,
        "http://hub-mirror.c.<span style="color: #009F9F;">163</span>.com"
    ],
    <span style="color: #BD93F9;">"insecure-registries"</span> : [
        <span style="color: #FC9F4E;">"registry.docker-cn.com"</span>,
        <span style="color: #FC9F4E;">"docker.mirrors.ustc.edu.cn"</span>
    ],
    <span style="color: #BD93F9;">"debug"</span> : <span style="color: #009F9F;">true</span>,
    <span style="color: #BD93F9;">"experimental"</span> : <span style="color: #009F9F;">true</span>
}
</pre>
</div></li>

<li>测试命令<br>
docker version<br>
docker run hello-world<br>
docker images<br></li>

<li>卸载<br>
systemctl stop docker<br>
yum -y remove docker-ce docker-ce-cli containerd.io<br>
rm -rf /var/lib/docker<br></li>
</ol>
</div>
</div>
<div id="outline-container-org61ba046" class="outline-2">
<h2 id="org61ba046">阿里云镜像加速</h2>
<div class="outline-text-2" id="text-org61ba046">
<ol class="org-ol">
<li>介绍:<a href="https://www.aliyun.com/product/acr">https://www.aliyun.com/product/acr</a><br></li>
<li>注册一个属于自己的阿里云账户(可复用淘宝账号)<br></li>
<li>进入管理控制台设置密码,开通<br></li>
<li>查看镜像加速器自己的<br></li>
<li><p>
配置镜像加速<br>
</p>

<p>
上面说了，配置daemon.json文件<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json &lt;&lt;-<span style="color: #FC9F4E;">'EOF'</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">  "registry-mirrors": ["https://qiyb9988.mirror.aliyuncs.com"]</span>
<span style="color: #ffa54f;">}</span>
<span style="color: #ffa54f;">EOF</span>
sudo systemctl daemon-reload
sudo systemctl restart docker
</pre>
</div></li>
</ol>
</div>
<div id="outline-container-org97d3582" class="outline-3">
<h3 id="org97d3582">测试 HelloWorld</h3>
<div class="outline-text-3" id="text-org97d3582">
<ol class="org-ol">
<li>启动hello-world<br>
docker run hello-world<br></li>

<li>run干了什么?<br></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org10108a0" class="outline-2">
<h2 id="org10108a0">底层原理</h2>
<div class="outline-text-2" id="text-org10108a0">
</div>
<div id="outline-container-org6701609" class="outline-3">
<h3 id="org6701609">Docker是怎么工作的</h3>
<div class="outline-text-3" id="text-org6701609">
<p>
Docker是一个Client-Server结构的系统,Docker守护进程运行在主机上, 然后通过Socket连接从客户端访问,守护进程从客户端接受命令并管理运行在主机上的容器。 容器,是一个运行时环境,就是我们前面说到的集装箱。<br>
</p>
</div>
</div>
<div id="outline-container-org5e7e8af" class="outline-3">
<h3 id="org5e7e8af">为什么Docker比较VM快</h3>
<div class="outline-text-3" id="text-org5e7e8af">
<ol class="org-ol">
<li>docker有着比虚拟机更少的抽象层。由于docker不需要Hypervisor实现硬件资源虚拟化,运行在docker容器上的程序直接使用的都是实际物理机的硬件资源。因此在CPU、内存利用率上docker将会在效率上有明显优势。<br></li>

<li>docker利用的是宿主机的内核,而不需要Guest OS。因此,当新建一个容器时,docker不需要和虚拟机一样重新加载一个操作系统内核。仍而避免引寻、加载操作系统内核返个比较费时费资源的过程,当新建一个虚拟机时,虚拟机软件需要加载Guest OS,返个新建过程是分钟级别的。而docker由于直接利用宿主机的操作系统,则省略了返个过程,因此新建一个docker容器只需要几秒钟。<br></li>
</ol>
</div>
</div>
</div>
</div>
</body>
</html>
