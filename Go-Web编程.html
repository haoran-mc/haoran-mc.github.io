<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-12-07 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GO-WEB编程</title>
<meta name="author" content="Haoran Liu" />
<meta name="description" content="Copyright © 2022, Haoran Liu, all rights reserved." />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="static/css/org.css"/>
</head>
<body>
<div id="content" class="content">
<h1 class="title">GO-WEB编程</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgd7af501">http 模块介绍</a></li>
<li><a href="#org2e2b493">web 服务器处理 GET, POST 请求</a>
<ul>
<li><a href="#org5d19bfe">GET</a></li>
<li><a href="#orgb68a05b">POST</a></li>
</ul>
</li>
<li><a href="#orgaa0d768">ResponseWriter 返回不同格式的数据</a></li>
<li><a href="#org5dab97f">完整代码</a></li>
<li><a href="#org7653149">template 用法详解</a></li>
</ul>
</div>
</div>
<p>
使用 go 语言自带的 net/http 包进行 web 开发。<br>
</p>

<div id="outline-container-orgd7af501" class="outline-2">
<h2 id="orgd7af501">http 模块介绍</h2>
<div class="outline-text-2" id="text-orgd7af501">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #D83441;">package</span> main

<span style="color: #D83441;">import</span> (
    <span style="color: #79D836;">"net/http"</span>
)

<span style="color: #D83441;">func</span> <span style="color: #D8B941;">main</span>() {
    http.<span style="color: #D8B941;">HandleFunc</span>(<span style="color: #79D836;">"/"</span>, <span style="color: #D83441;">func</span>(<span style="color: #86e7d7;">writer</span> <span style="color: #3679D8;">http.ResponseWriter</span>, <span style="color: #86e7d7;">request</span> *<span style="color: #3679D8;">http.Request</span>) {
        writer.<span style="color: #D8B941;">Write</span>([]<span style="color: #D8B941;">byte</span>(<span style="color: #79D836;">"hello world"</span>))
    })

    http.<span style="color: #D8B941;">ListenAndServe</span>(<span style="color: #79D836;">":8080"</span>, <span style="color: #8041D8;">nil</span>)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org2e2b493" class="outline-2">
<h2 id="org2e2b493">web 服务器处理 GET, POST 请求</h2>
<div class="outline-text-2" id="text-org2e2b493">
</div>
<div id="outline-container-org5d19bfe" class="outline-3">
<h3 id="org5d19bfe">GET</h3>
<div class="outline-text-3" id="text-org5d19bfe">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #D83441;">package</span> main

<span style="color: #D83441;">import</span> (
    <span style="color: #79D836;">"io"</span>
    <span style="color: #79D836;">"net/http"</span>
)

<span style="color: #D83441;">func</span> <span style="color: #D8B941;">main</span>() {
    <span style="color: #767676; font-style: italic;">// </span><span style="color: #767676; font-style: italic;">127.0.0.1:8080/login?user=""&amp;&amp;pass=""</span>
    http.<span style="color: #D8B941;">HandleFunc</span>(<span style="color: #79D836;">"/login"</span>, <span style="color: #D83441;">func</span>(<span style="color: #86e7d7;">writer</span> <span style="color: #3679D8;">http.ResponseWriter</span>, <span style="color: #86e7d7;">request</span> *<span style="color: #3679D8;">http.Request</span>) {
        <span style="color: #86e7d7;">query</span> := request.URL.<span style="color: #D8B941;">Query</span>()
        io.<span style="color: #D8B941;">WriteString</span>(writer, <span style="color: #79D836;">"user: "</span>+query.<span style="color: #D8B941;">Get</span>(<span style="color: #79D836;">"user"</span>)+<span style="color: #79D836;">" pass: "</span>+query.<span style="color: #D8B941;">Get</span>(<span style="color: #79D836;">"pass"</span>))
    })

    http.<span style="color: #D8B941;">ListenAndServe</span>(<span style="color: #79D836;">":8080"</span>, <span style="color: #8041D8;">nil</span>)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb68a05b" class="outline-3">
<h3 id="orgb68a05b">POST</h3>
<div class="outline-text-3" id="text-orgb68a05b">
<ul class="org-ul">
<li><p>
请求体<br>
</p>
<div class="org-src-container">
<pre class="src src-go"><span style="color: #D83441;">package</span> main

<span style="color: #D83441;">import</span> (
    <span style="color: #79D836;">"encoding/json"</span>
    <span style="color: #79D836;">"io"</span>
    <span style="color: #79D836;">"net/http"</span>
)

<span style="color: #D83441;">func</span> <span style="color: #D8B941;">main</span>() {
    <span style="color: #767676; font-style: italic;">// </span><span style="color: #767676; font-style: italic;">&#28155;&#21152;&#29992;&#25143; POST entype JSON</span>
    http.<span style="color: #D8B941;">HandleFunc</span>(<span style="color: #79D836;">"/add/user"</span>, <span style="color: #D83441;">func</span>(<span style="color: #86e7d7;">writer</span> <span style="color: #3679D8;">http.ResponseWriter</span>, <span style="color: #86e7d7;">request</span> *<span style="color: #3679D8;">http.Request</span>) {
        <span style="color: #D83441;">var</span> <span style="color: #86e7d7;">params</span> <span style="color: #D83441;">map</span>[<span style="color: #3679D8;">string</span>]<span style="color: #3679D8;">string</span>
        <span style="color: #86e7d7;">decoder</span> := json.<span style="color: #D8B941;">NewDecoder</span>(request.Body)
        decoder.<span style="color: #D8B941;">Decode</span>(&amp;params)
        io.<span style="color: #D8B941;">WriteString</span>(writer, <span style="color: #79D836;">"post json: "</span>+params[<span style="color: #79D836;">"name"</span>])
    })

    http.<span style="color: #D8B941;">ListenAndServe</span>(<span style="color: #79D836;">":8080"</span>, <span style="color: #8041D8;">nil</span>)
}
</pre>
</div></li>
<li><p>
表单<br>
</p>
<div class="org-src-container">
<pre class="src src-go"><span style="color: #D83441;">package</span> main

<span style="color: #D83441;">import</span> (
    <span style="color: #79D836;">"encoding/json"</span>
    <span style="color: #79D836;">"io"</span>
    <span style="color: #79D836;">"net/http"</span>
)

<span style="color: #D83441;">func</span> <span style="color: #D8B941;">main</span>() {
    <span style="color: #767676; font-style: italic;">// </span><span style="color: #767676; font-style: italic;">&#28155;&#21152;&#20070;&#26412; POST data form-encoded</span>
    http.<span style="color: #D8B941;">HandleFunc</span>(<span style="color: #79D836;">"/add/book"</span>, <span style="color: #D83441;">func</span>(<span style="color: #86e7d7;">writer</span> <span style="color: #3679D8;">http.ResponseWriter</span>, <span style="color: #86e7d7;">request</span> *<span style="color: #3679D8;">http.Request</span>) {
        request.<span style="color: #D8B941;">ParseForm</span>()
        io.<span style="color: #D8B941;">WriteString</span>(writer, <span style="color: #79D836;">"form: "</span>+request.Form.<span style="color: #D8B941;">Get</span>(<span style="color: #79D836;">"name"</span>))
    })

    http.<span style="color: #D8B941;">ListenAndServe</span>(<span style="color: #79D836;">":8080"</span>, <span style="color: #8041D8;">nil</span>)
}
</pre>
</div></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgaa0d768" class="outline-2">
<h2 id="orgaa0d768">ResponseWriter 返回不同格式的数据</h2>
<div class="outline-text-2" id="text-orgaa0d768">
<p>
默认返回的数据格式是字符串 <code>writer.Write([]byte("hello world"))</code> 。<br>
</p>

<p>
设置 http 头，使用 <code>json</code> 格式的数据返回：<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #767676; font-style: italic;">// </span><span style="color: #767676; font-style: italic;">&#19981;&#21516;&#26684;&#24335;&#25968;&#25454;&#36820;&#22238;</span>
http.<span style="color: #D8B941;">HandleFunc</span>(<span style="color: #79D836;">"/author"</span>, <span style="color: #D83441;">func</span>(<span style="color: #86e7d7;">writer</span> <span style="color: #3679D8;">http.ResponseWriter</span>, <span style="color: #86e7d7;">request</span> *<span style="color: #3679D8;">http.Request</span>) {
    writer.<span style="color: #D8B941;">Header</span>().<span style="color: #D8B941;">Set</span>(<span style="color: #79D836;">"Content-Type"</span>, <span style="color: #79D836;">"application/json"</span>)
    writer.<span style="color: #D8B941;">Header</span>().<span style="color: #D8B941;">Set</span>(<span style="color: #79D836;">"haoran"</span>, <span style="color: #79D836;">"Author"</span>) <span style="color: #767676; font-style: italic;">// </span><span style="color: #767676; font-style: italic;">&#36824;&#21487;&#20197;&#21152;&#20854;&#20182;&#30340;&#22836;</span>
    io.<span style="color: #D8B941;">WriteString</span>(writer, <span style="color: #79D836;">"{\"name\": \"haoran\"}"</span>)
})
</pre>
</div>

<p>
将结构体解析为 <code>json</code> ：<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #D83441;">type</span> <span style="color: #3679D8;">user</span> <span style="color: #D83441;">struct</span> {
    Name <span style="color: #3679D8;">string</span>
    Love <span style="color: #3679D8;">string</span>
}

<span style="color: #767676; font-style: italic;">// </span><span style="color: #767676; font-style: italic;">&#19981;&#21516;&#26684;&#24335;&#25968;&#25454;&#36820;&#22238;</span>
http.<span style="color: #D8B941;">HandleFunc</span>(<span style="color: #79D836;">"/"</span>, <span style="color: #D83441;">func</span>(<span style="color: #86e7d7;">writer</span> <span style="color: #3679D8;">http.ResponseWriter</span>, <span style="color: #86e7d7;">request</span> *<span style="color: #3679D8;">http.Request</span>) {
    writer.<span style="color: #D8B941;">Header</span>().<span style="color: #D8B941;">Set</span>(<span style="color: #79D836;">"Content-Type"</span>, <span style="color: #79D836;">"application/json"</span>)
    writer.<span style="color: #D8B941;">Header</span>().<span style="color: #D8B941;">Set</span>(<span style="color: #79D836;">"haoran"</span>, <span style="color: #79D836;">"Author"</span>) <span style="color: #767676; font-style: italic;">// </span><span style="color: #767676; font-style: italic;">&#36824;&#21487;&#20197;&#21152;&#20854;&#20182;&#30340;&#22836;</span>

    <span style="color: #86e7d7;">u1</span> := <span style="color: #3679D8;">user</span>{<span style="color: #8041D8;">Name</span>: <span style="color: #79D836;">"haoran"</span>, <span style="color: #8041D8;">Love</span>: <span style="color: #79D836;">"read"</span>}
    json.<span style="color: #D8B941;">NewEncoder</span>(writer).<span style="color: #D8B941;">Encode</span>(u1) <span style="color: #767676; font-style: italic;">// </span><span style="color: #767676; font-style: italic;">struct -&gt; json</span>
})
</pre>
</div>
</div>
</div>
<div id="outline-container-org5dab97f" class="outline-2">
<h2 id="org5dab97f">完整代码</h2>
<div class="outline-text-2" id="text-org5dab97f">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #D83441;">package</span> main

<span style="color: #D83441;">import</span> (
    <span style="color: #79D836;">"encoding/json"</span>
    <span style="color: #79D836;">"io"</span>
    <span style="color: #79D836;">"net/http"</span>
)

<span style="color: #D83441;">func</span> <span style="color: #D8B941;">main</span>() {
    <span style="color: #767676; font-style: italic;">// </span><span style="color: #767676; font-style: italic;">127.0.0.1:8080/login?user=""&amp;&amp;pass=""</span>
    http.<span style="color: #D8B941;">HandleFunc</span>(<span style="color: #79D836;">"/login"</span>, <span style="color: #D83441;">func</span>(<span style="color: #86e7d7;">writer</span> <span style="color: #3679D8;">http.ResponseWriter</span>, <span style="color: #86e7d7;">request</span> *<span style="color: #3679D8;">http.Request</span>) {
        <span style="color: #86e7d7;">query</span> := request.URL.<span style="color: #D8B941;">Query</span>()
        io.<span style="color: #D8B941;">WriteString</span>(writer, <span style="color: #79D836;">"user: "</span>+query.<span style="color: #D8B941;">Get</span>(<span style="color: #79D836;">"user"</span>)+<span style="color: #79D836;">" pass: "</span>+query.<span style="color: #D8B941;">Get</span>(<span style="color: #79D836;">"pass"</span>))
    })

    <span style="color: #767676; font-style: italic;">// </span><span style="color: #767676; font-style: italic;">&#28155;&#21152;&#29992;&#25143; POST entype JSON</span>
    http.<span style="color: #D8B941;">HandleFunc</span>(<span style="color: #79D836;">"/add/user"</span>, <span style="color: #D83441;">func</span>(<span style="color: #86e7d7;">writer</span> <span style="color: #3679D8;">http.ResponseWriter</span>, <span style="color: #86e7d7;">request</span> *<span style="color: #3679D8;">http.Request</span>) {
        <span style="color: #D83441;">var</span> <span style="color: #86e7d7;">params</span> <span style="color: #D83441;">map</span>[<span style="color: #3679D8;">string</span>]<span style="color: #3679D8;">string</span>
        <span style="color: #86e7d7;">decoder</span> := json.<span style="color: #D8B941;">NewDecoder</span>(request.Body)
        decoder.<span style="color: #D8B941;">Decode</span>(&amp;params)
        io.<span style="color: #D8B941;">WriteString</span>(writer, <span style="color: #79D836;">"post json: "</span>+params[<span style="color: #79D836;">"name"</span>])
    })

    <span style="color: #767676; font-style: italic;">// </span><span style="color: #767676; font-style: italic;">&#28155;&#21152;&#20070;&#26412; POST data form-encoded</span>
    http.<span style="color: #D8B941;">HandleFunc</span>(<span style="color: #79D836;">"/add/book"</span>, <span style="color: #D83441;">func</span>(<span style="color: #86e7d7;">writer</span> <span style="color: #3679D8;">http.ResponseWriter</span>, <span style="color: #86e7d7;">request</span> *<span style="color: #3679D8;">http.Request</span>) {
        request.<span style="color: #D8B941;">ParseForm</span>()
        io.<span style="color: #D8B941;">WriteString</span>(writer, <span style="color: #79D836;">"form: "</span>+request.Form.<span style="color: #D8B941;">Get</span>(<span style="color: #79D836;">"name"</span>))
    })

    <span style="color: #767676; font-style: italic;">// </span><span style="color: #767676; font-style: italic;">&#19981;&#21516;&#26684;&#24335;&#25968;&#25454;&#36820;&#22238;</span>
    http.<span style="color: #D8B941;">HandleFunc</span>(<span style="color: #79D836;">"/author"</span>, <span style="color: #D83441;">func</span>(<span style="color: #86e7d7;">writer</span> <span style="color: #3679D8;">http.ResponseWriter</span>, <span style="color: #86e7d7;">request</span> *<span style="color: #3679D8;">http.Request</span>) {
        writer.<span style="color: #D8B941;">Header</span>().<span style="color: #D8B941;">Set</span>(<span style="color: #79D836;">"Content-Type"</span>, <span style="color: #79D836;">"application/json"</span>)
        writer.<span style="color: #D8B941;">Header</span>().<span style="color: #D8B941;">Set</span>(<span style="color: #79D836;">"haoran"</span>, <span style="color: #79D836;">"Author"</span>) <span style="color: #767676; font-style: italic;">// </span><span style="color: #767676; font-style: italic;">&#36824;&#21487;&#20197;&#21152;&#20854;&#20182;&#30340;&#22836;</span>
        io.<span style="color: #D8B941;">WriteString</span>(writer, <span style="color: #79D836;">"{\"name\": \"haoran\"}"</span>)
    })

    <span style="color: #D83441;">type</span> <span style="color: #3679D8;">user</span> <span style="color: #D83441;">struct</span> {
        Name <span style="color: #3679D8;">string</span>
        Love <span style="color: #3679D8;">string</span>
    }

    <span style="color: #767676; font-style: italic;">// </span><span style="color: #767676; font-style: italic;">&#19981;&#21516;&#26684;&#24335;&#25968;&#25454;&#36820;&#22238;</span>
    http.<span style="color: #D8B941;">HandleFunc</span>(<span style="color: #79D836;">"/"</span>, <span style="color: #D83441;">func</span>(<span style="color: #86e7d7;">writer</span> <span style="color: #3679D8;">http.ResponseWriter</span>, <span style="color: #86e7d7;">request</span> *<span style="color: #3679D8;">http.Request</span>) {
        writer.<span style="color: #D8B941;">Header</span>().<span style="color: #D8B941;">Set</span>(<span style="color: #79D836;">"Content-Type"</span>, <span style="color: #79D836;">"application/json"</span>)
        writer.<span style="color: #D8B941;">Header</span>().<span style="color: #D8B941;">Set</span>(<span style="color: #79D836;">"haoran"</span>, <span style="color: #79D836;">"Author"</span>) <span style="color: #767676; font-style: italic;">// </span><span style="color: #767676; font-style: italic;">&#36824;&#21487;&#20197;&#21152;&#20854;&#20182;&#30340;&#22836;</span>

        <span style="color: #86e7d7;">u1</span> := <span style="color: #3679D8;">user</span>{<span style="color: #8041D8;">Name</span>: <span style="color: #79D836;">"haoran"</span>, <span style="color: #8041D8;">Love</span>: <span style="color: #79D836;">"read"</span>}
        json.<span style="color: #D8B941;">NewEncoder</span>(writer).<span style="color: #D8B941;">Encode</span>(u1) <span style="color: #767676; font-style: italic;">// </span><span style="color: #767676; font-style: italic;">struct -&gt; json</span>
    })

    http.<span style="color: #D8B941;">ListenAndServe</span>(<span style="color: #79D836;">":8080"</span>, <span style="color: #8041D8;">nil</span>)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org7653149" class="outline-2">
<h2 id="org7653149">template 用法详解</h2>
<div class="outline-text-2" id="text-org7653149">
<ul class="org-ul">
<li><a href="Go-模板（template）.html">Go-模板（template）.html</a><br></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2022-12-07 00:12 Wed</p>
<p class="author">Author: Haoran Liu</p>
<p class="date">Created: 2022-12-07</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
