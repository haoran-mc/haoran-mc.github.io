<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-05-09 Mon 16:23 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TCP如何最大利用带宽</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran">
<meta name="description" content="Copyright © 2022, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="static/MathJax/cdn.bootcdn.net/ajax/libs/mathjax/3.1.2/es5/tex-mml-chtml.min.js"></script>
</head>
<body>
<div id="content">
<h1 class="title">TCP如何最大利用带宽</h1>
<p>
TCP 速率受到三个因素影响<br>
</p>

<ul class="org-ul">
<li>窗口：即滑动窗口大小，见 TCP 如何实现流量控制？<br></li>
<li>带宽：这里带宽是指单位时间内从发送端到接收端所能通过的"最高数据率"，是一种 <b>硬件限制</b> 。TCP 发送端和接收端的数据传输数不可能超过两点间的带宽限制。发送端和接收端之间带宽取所通过线路的带宽最小值（如通过互联网连接）。<br></li>
<li>RTT：即 Round Trip Time，表示从发送端到接收端的一去一回需要的时间，TCP在数据传输过程中会对 RTT 进行采样（即对发送的数据包及其 ACK 的时间差进行测量，并根据测量值更新 RTT 值），TCP 根据得到的 RTT 值更新 RTO 值，即 Retransmission TimeOut，就是 <b>重传间隔</b> ，发送端对每个发出的数据包进行计时，如果在 RTO 时间内没有收到所发出的数据包的对应 ACK，则任务数据包丢失，将重传数据。一般 RTO 值都比采样得到的 RTT 值要大。<br></li>
</ul>

<blockquote>
<p>
带宽时延乘积：<br>
带宽时延乘积 = 带宽 * RTT，实际上等于发送端到接收端单向通道的数据容积的两倍，这里单向通道的数据容积可以这样来理解，单向通道看成是一条单行道马路，带宽就是马路的车道数，路上跑的汽车就是数据（不过这里所有汽车的速率都是一样的，且不会有人想超车，大家齐头并进），那么单向通道的数据容积就是这条单行道上摆满车，一共可以摆多少辆。带宽就是马路的车道数，带宽数乘以单向通道的数据容积就是路面上所能容纳的全部数据量。当路面上已经摆满的时候，就不能再往里面放了。<br>
</p>
</blockquote>

<p>
设滑动窗口大小为 \(W\)，发送端和接收端的带宽为 \(B\)，RTT 为 \(T_r\)<br>
</p>

<p>
前面已经说过了，TCP 发送数据时受滑动窗口的限制，当 TCP 将滑动窗口中的数据都发出后，在收到第一个 ACK 之前，滑动窗口大小是 0，不能再发送数据了，必须等待 ACK 包使滑动窗口移动。那么在理想情况下，ACK 包应该在什么时候到达呢？显然，就是在数据发出后的 RTT 时间后，ACK 包到达。这也就是说，现在在不考虑丢包和拥塞情况下，TCP 在一个 RTT 时间内能发出的最大数据量为 \(W\)，所以不考虑带宽限制下，TCP 能一个时刻能达到的最大速度是 \(V = \frac{W}{T_r}\)。<br>
</p>

<p>
现在再考虑带宽限制，前面说过当马路上摆满车的时候，就无法再往里放车了，同理，TCP 发送端在 \(\frac{T_R}{2}\) 时间内，能往通道上放的最大数据量为 \(\frac{V \times T_r}{2}\)，通过带宽时延乘积得到的容积限制为 \(\frac{B \times T_r}{2}\)。当 \(\frac{B \times T_r}{2} \geq \frac{V \times T_r}{2}\) 时，单向通道容积不构成瓶颈，速率的限制主要来源于窗口大小限制。而当 \(\frac{V \times T_r}{2} \geq \frac{B \times T_r}{2}\) 时，则就受到容积限制，即此时速率限制来源于带宽限制。<br>
</p>

<p>
因此，TCP 的最大速率为 \(V = \min(\frac{W}{T_r}, B)\)<br>
</p>

<p>
在我们平时生活中使用的宽带网络，ADSL 等环境下，因为带宽都比较小，从而 \(B \times T_r\) 也比较小，再加上网络情况比较复杂，拥塞情况比较常见，所以这些网络环境下，TCP 速率的主要限制因素在于带宽，丢包率等。长肥管道一般不太常见，多见于一些单位使用的专线网络，在这些网络中速率的主要限制因素就是窗口大小了，这也是传统 TCP 在这些网络环境中不能充分利用带宽的原因所在（因为传统 TCP 的窗口大小是用 2 字节表示的，所以最大只有 65535（不考虑窗口扩大选项）），除了专线网络外，随着网络硬件技术的发展，万兆交换机的出现，局域网中也可能会出现带宽时延乘积较大的情况。<br>
</p>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2022-03-04 14:03 Fri</p>
<p class="author">Author: L.M.haoran</p>
<p class="date">Created: 2022-05-09 Mon 16:23</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
