<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-08-30 二 15:27 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>自定义GIT</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran &lt;haoran.mc@outlook.com&gt;">
<meta name="description" content="Copyright © 2021, L.M.haoran, all rights reserved."
>
<link rel="stylesheet" href="static/css/org.css" type="text/css"  />
      <script type="module" src="static/js/main.js" defer></script>
      <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="content">
<h1 class="title">自定义GIT</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgdf65e7b">自定义Git</a></li>
<li><a href="#org15a55b1">忽略特殊文件</a></li>
<li><a href="#org2937590">配置</a>
<ul>
<li><a href="#org6738943">配置别名</a></li>
<li><a href="#org2276aa0">配置文件</a></li>
</ul>
</li>
<li><a href="#org7c336ae">搭建Git服务器</a>
<ul>
<li><a href="#org5c9173c">管理公钥</a></li>
<li><a href="#org5d42279">管理权限</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgdf65e7b" class="outline-2">
<h2 id="orgdf65e7b">自定义Git</h2>
<div class="outline-text-2" id="text-orgdf65e7b">
<ul class="org-ul">
<li>git config &#x2013;global user.name "Your Name"<br></li>
<li>git config &#x2013;global user.email "email@example.com"<br></li>
<li>git config &#x2013;global color.ui true<br></li>
<li>git config &#x2013;global core.editor "vim"<br></li>
</ul>
</div>
</div>
<div id="outline-container-org15a55b1" class="outline-2">
<h2 id="org15a55b1">忽略特殊文件</h2>
<div class="outline-text-2" id="text-org15a55b1">
<dl class="org-dl">
<dt>git add -f app.class</dt><dd>强制将 app.class 文件添加到 Git<br></dd>
<dt>git check-ignore -v app.class</dt><dd>查看哪个规则阻止了 app.class 添加到 Git<br></dd>
</dl>
</div>
</div>
<div id="outline-container-org2937590" class="outline-2">
<h2 id="org2937590">配置</h2>
<div class="outline-text-2" id="text-org2937590">
</div>
<div id="outline-container-org6738943" class="outline-3">
<h3 id="org6738943">配置别名</h3>
<div class="outline-text-3" id="text-org6738943">
<dl class="org-dl">
<dt>git config &#x2013;global alias.st status</dt><dd>配置别名，git status = git st<br></dd>
<dt>git config &#x2013;global alias.unstage 'reset HEAD'</dt><dd>把暂存区的修改撤销，重新放回工作区<br></dd>
<dt>git config &#x2013;global alias.last 'log -1'</dt><dd>显示最后一次提交信息<br></dd>
<dt>git config &#x2013;global alias.lg "log &#x2013;color &#x2013;graph &#x2013;pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset' &#x2013;abbrev-commit"</dt><dd>有够丧心病狂<br></dd>
</dl>
</div>
</div>
<div id="outline-container-org2276aa0" class="outline-3">
<h3 id="org2276aa0">配置文件</h3>
<div class="outline-text-3" id="text-org2276aa0">
<p>
配置Git的时候，加上&#x2013;global是针对当前用户起作用的，如果不加，那只针对当前的仓库起作用。<br>
配置文件放哪了？每个仓库的Git配置文件都放在.git/config文件中<br>
</p>

<p>
而当前用户的Git配置文件放在用户主目录下的一个隐藏文件.gitconfig中：<br>
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">信息</th>
<th scope="col" class="org-left">信息</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">user.name=haoran</td>
<td class="org-left">用户名</td>
</tr>

<tr>
<td class="org-left">core.ignorecase=false</td>
<td class="org-left">不许忽略文件名大小写</td>
</tr>

<tr>
<td class="org-left">core.autocrlf=input</td>
<td class="org-left">换行模式为input，即提交时转换为LF，检出时不转换</td>
</tr>

<tr>
<td class="org-left">core.filemode=false</td>
<td class="org-left">不检查文件权限</td>
</tr>

<tr>
<td class="org-left">core.safecrlf=true</td>
<td class="org-left">拒绝提交包含混合换行符的文件</td>
</tr>

<tr>
<td class="org-left">core.editor=vim</td>
<td class="org-left">编辑方式</td>
</tr>

<tr>
<td class="org-left">core.bare=false</td>
<td class="org-left">默认不创建裸仓库</td>
</tr>

<tr>
<td class="org-left">core.logallrefupdates=true</td>
<td class="org-left">log 所有 ref 的更新</td>
</tr>

<tr>
<td class="org-left">core.precomposeunicode=true</td>
<td class="org-left">Mac专用选项，开启以便文件名兼容其他系统</td>
</tr>

<tr>
<td class="org-left">push.default=simple</td>
<td class="org-left">只推送本地当前分支，且与上游分支名字一致</td>
</tr>

<tr>
<td class="org-left">pull.rebase=true</td>
<td class="org-left">强制开启 rebase 模式</td>
</tr>

<tr>
<td class="org-left">credential.helper store</td>
<td class="org-left">记住密码</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>core.repositoryformatversion=0 -&#x2014; Internal variable identifying the repository format and layout version |<br></li>
<li>alias.lg=log &#x2013;color &#x2013;graph &#x2013;pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset' &#x2013;abbrev-commit<br></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org7c336ae" class="outline-2">
<h2 id="org7c336ae">搭建Git服务器</h2>
<div class="outline-text-2" id="text-org7c336ae">
<ol class="org-ol">
<li>安装 git<br></li>
<li>创建一个 git 用户,用来运行 git 服务<br>
sudo adduser git<br></li>
<li>创建证书登录<br>
收集所有需要登录的用户的公钥，就是他们自己的id_rsa.pub文件，把所有公钥导入到/home/git/.ssh/authorized_keys文件里，一行一个。<br></li>
<li><p>
初始化 Git 仓库<br>
先选定一个目录作为Git仓库，假定是/srv/sample.git，在/srv目录下输入命令：<br>
sudo git init &#x2013;bare sample.git<br>
</p>

<p>
Git就会创建一个裸仓库，裸仓库没有工作区，因为服务器上的Git仓库纯粹是为了共享，所以不让用户直接登录到服务器上去改工作区，并且服务器上的Git仓库通常都以.git结尾。然后，把owner改为git：<br>
sudo chown -R git:git sample.git<br>
</p></li>
<li>禁用 shell 登录<br>
出于安全考虑，第二步创建的git用户不允许登录shell，这可以通过编辑/etc/passwd文件完成。找到类似下面的一行：<br>
git:x:1001:1001:,,,:/home/git:/bin/bash<br>
改为：<br>
git:x:1001:1001:,,,:/home/git:/usr/bin/git-shell<br>
这样，git用户可以正常通过ssh使用git，但无法登录shell，因为我们为git用户指定的git-shell每次一登录就自动退出。<br></li>
<li>克隆远程仓库<br>
现在，可以通过git clone命令克隆远程仓库了，在各自的电脑上运行：<br>
git clone git@server:/srv/sample.git<br></li>
</ol>
</div>
<div id="outline-container-org5c9173c" class="outline-3">
<h3 id="org5c9173c">管理公钥</h3>
<div class="outline-text-3" id="text-org5c9173c">
<p>
如果团队很小，把每个人的公钥收集起来放到服务器的/home/git/.ssh/authorized_keys文件里就是可行的。如果团队有几百号人，就没法这么玩了，这时，可以用Gitosis来管理公钥。<br>
这里我们不介绍怎么玩Gitosis了，几百号人的团队基本都在500强了，相信找个高水平的Linux管理员问题不大。<br>
</p>
</div>
</div>
<div id="outline-container-org5d42279" class="outline-3">
<h3 id="org5d42279">管理权限</h3>
<div class="outline-text-3" id="text-org5d42279">
<p>
有很多不但视源代码如生命，而且视员工为窃贼的公司，会在版本控制系统里设置一套完善的权限控制，每个人是否有读写权限会精确到每个分支甚至每个目录下。因为Git是为Linux源代码托管而开发的，所以Git也继承了开源社区的精神，不支持权限控制。不过，因为Git支持钩子（hook），所以，可以在服务器端编写一系列脚本来控制提交等操作，达到权限控制的目的。Gitolite就是这个工具。<br>
</p>
</div>
</div>
</div>
</div>
</body>
</html>
