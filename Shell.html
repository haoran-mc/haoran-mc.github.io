<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-06-23 Thu 12:46 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SHELL</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran">
<meta name="description" content="Copyright © 2022, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="content">
<h1 class="title">SHELL</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org185af61">什么是 shell 脚本</a></li>
<li><a href="#orgcbf4626">脚本执行</a></li>
<li><a href="#orgca75b52">注释</a></li>
<li><a href="#orgda63126">printf 语句</a></li>
<li><a href="#org63afc15">变量（variable）</a>
<ul>
<li><a href="#org78f8862">默认变量类型：字符串</a></li>
<li><a href="#org2a2472b">使用变量</a></li>
<li><a href="#org7e7f2e1">重定义变量</a></li>
<li><a href="#orga2084fb">只读变量</a></li>
<li><a href="#org70010a3">更多的字符串操作</a>
<ul>
<li><a href="#org0a79c01">字符串拼接</a></li>
<li><a href="#org74f7d14">字符串长度</a></li>
<li><a href="#orgd8c2c2d">提取子字符串</a></li>
<li><a href="#org42d99fb">查找子字符串</a></li>
</ul>
</li>
<li><a href="#orged49f4c">数字类型</a>
<ul>
<li><a href="#org06e4c05">如何定义数字变量</a></li>
<li><a href="#orgd2f5f7b">数值运算</a></li>
<li><a href="#org5445103">保留小数</a></li>
</ul>
</li>
<li><a href="#org7c1eb8c">数组（array）</a>
<ul>
<li><a href="#org05344e9">定义数组</a></li>
<li><a href="#orgc90823b">读取数组</a></li>
<li><a href="#org5dc0f1a">关于数组的操作</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgc7db769">判断式</a>
<ul>
<li><a href="#org28144ad">利用 test 命令的测试功能</a></li>
<li><a href="#org13a8b01">利用判断符号 []</a></li>
<li><a href="#org321bb82">shell 脚本的默认变量（$0、$1&#x2026;）</a></li>
</ul>
</li>
<li><a href="#org7a26658">程序控制结构</a>
<ul>
<li><a href="#org58fe230">条件判断</a></li>
<li><a href="#orgc1abc18">循环（loop）</a></li>
<li><a href="#orgaf8254e">函数（function）</a></li>
</ul>
</li>
<li><a href="#org0ba0d62">shell 脚本的跟踪与调试</a></li>
<li><a href="#org209a3cf">建立 shell 脚本的良好编写习惯</a></li>
<li><a href="#org1cab6f2">用户输入</a>
<ul>
<li><a href="#orga34a633">读取来自键盘输入的变量</a></li>
<li><a href="#orgebc615c">脚本文件携带参数</a></li>
<li><a href="#orgf3cbc81">输入数字数组</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org185af61" class="outline-2">
<h2 id="org185af61">什么是 shell 脚本</h2>
<div class="outline-text-2" id="text-org185af61">
<p>
先来看个例子：<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #008787; background-color: #262626;">#</span><span style="color: #008787; background-color: #262626;">!/bin/</span><span style="color: #268bd2; font-weight: bold;">sh</span>
<span style="color: #268bd2;">cd</span> ~
mkdir shell_tut
<span style="color: #268bd2;">cd</span> shell_tut

<span style="color: #268bd2; font-weight: bold;">for</span> ((<span style="color: #8787d7;">i</span>=0; i&lt;10; i++)); <span style="color: #268bd2; font-weight: bold;">do</span>
    touch test_$<span style="color: #8787d7;">i</span>.txt
<span style="color: #268bd2; font-weight: bold;">done</span>
</pre>
</div>

<ul class="org-ul">
<li>第1行：指定脚本解释器，这里是用 <code>/bin/sh</code> 做解释器的<br></li>
<li>第2行：切换到当前用户的 home 目录<br></li>
<li>第3行：创建一个目录 shell_tut<br></li>
<li>第4行：切换到 shell_tut 目录<br></li>
<li>第5行：循环条件，一共循环 10 次<br></li>
<li>第6行：创建一个 test_0…9.txt 文件<br></li>
<li>第7行：循环体结束<br></li>
</ul>

<p>
mkdir, touch 都是系统自带的程序，一般在 /bin 或者 /usr/bin 目录下。for, do, done 是 sh 脚本语言的关键字。<br>
</p>
</div>
</div>
<div id="outline-container-orgcbf4626" class="outline-2">
<h2 id="orgcbf4626">脚本执行</h2>
<div class="outline-text-2" id="text-orgcbf4626">
<ul class="org-ul">
<li><p>
利用直接执行的方式来执行脚本<br>
</p>

<p>
当使用直接命令执行（不论是绝对路径、相对路径还是 ${PATH} 内），或是利用 bash（或sh）来执行脚本时，该脚本都会使用一个新的 bash 环境来执行脚本内的命令。也就是说，使用这种执行方式时，其实脚本是在子进程的 bash 内执行的。 <span class="underline">当子进程完成后，在子进程内的各项变量或操作将会结束而不会传回父进程中。</span><br>
</p>

<div class="org-src-container">
<pre class="src src-bash">$ echo ${<span style="color: #8787d7;">firstname</span>} ${<span style="color: #8787d7;">lastname</span>}   <span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#27809;&#26377;&#36755;&#20986;&#65292;&#36825;&#20004;&#20010;&#21464;&#37327;&#19981;&#23384;&#22312;</span>
$ sh showname.sh
Please input your first name: Haoran
Please input your last name: Liu
Your full name is: Haoran Liu

$ echo ${<span style="color: #8787d7;">firstname</span>} ${<span style="color: #8787d7;">lastname</span>}   <span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#21516;&#26679;&#27809;&#26377;&#36755;&#20986;</span>
</pre>
</div></li>

<li><p>
利用 source 来执行脚本：在父进程中执行<br>
</p>

<div class="org-src-container">
<pre class="src src-bash">$ source showname.sh
Please input your first name: Haoran
Please input your last name: Liu
Your full name is: Haoran Liu

$ echo ${<span style="color: #8787d7;">firstname</span>} ${<span style="color: #8787d7;">lastname</span>}   <span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#21516;&#26679;&#27809;&#26377;&#36755;&#20986;</span>
Haoran Liu
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-orgca75b52" class="outline-2">
<h2 id="orgca75b52">注释</h2>
<div class="outline-text-2" id="text-orgca75b52">
<p>
以 <code>#</code> 开头的行就是注释，会被解释器忽略，只能每一行加一个 <code>#</code> 号。<br>
</p>

<p>
多行注释可以使用以下格式：<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">:&lt;&lt;EOF
<span style="color: #2aa198;">&#27880;&#37322;&#20869;&#23481;...</span>
<span style="color: #2aa198;">&#27880;&#37322;&#20869;&#23481;...</span>
<span style="color: #2aa198;">&#27880;&#37322;&#20869;&#23481;...</span>
<span style="color: #2aa198;">EOF</span>
</pre>
</div>

<p>
EOF 也可以使用其他符号:<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">:&lt;&lt;<span style="color: #2aa198;">'</span>
<span style="color: #2aa198;">&#27880;&#37322;&#20869;&#23481;...</span>
<span style="color: #2aa198;">&#27880;&#37322;&#20869;&#23481;...</span>
<span style="color: #2aa198;">&#27880;&#37322;&#20869;&#23481;...</span>
<span style="color: #2aa198;">'</span>

<span style="color: #2aa198;">:&lt;&lt;!</span>
<span style="color: #2aa198;">&#27880;&#37322;&#20869;&#23481;...</span>
<span style="color: #2aa198;">&#27880;&#37322;&#20869;&#23481;...</span>
<span style="color: #2aa198;">&#27880;&#37322;&#20869;&#23481;...</span>
<span style="color: #2aa198;">!</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgda63126" class="outline-2">
<h2 id="orgda63126">printf 语句</h2>
<div class="outline-text-2" id="text-orgda63126">
<p>
目前版本的 bash 都提供 printf 命令，X/Open 规范建议用它来代替 echo 命令以产生格式化的输出。<br>
</p>

<pre class="example">
printf "format string" parameter1 parameter2 ...
</pre>
</div>
</div>
<div id="outline-container-org63afc15" class="outline-2">
<h2 id="org63afc15">变量（variable）<a id="orgfd33b9c"></a></h2>
<div class="outline-text-2" id="text-org63afc15">
</div>
<div id="outline-container-org78f8862" class="outline-3">
<h3 id="org78f8862">默认变量类型：字符串</h3>
<div class="outline-text-3" id="text-org78f8862">
<p>
字符串是 shell 编程中默认的变量类型，也是最常用的数据类型，字符串的表示可以用单引号，也可以用双引号，也可以不用引号。<br>
</p>

<p>
变量的设置规则：<br>
</p>

<ul class="org-ul">
<li>变量与变量内容以一个等号 "=" 来链接，如： <code>your_name=Alice</code> ，定义变量时，变量名不加美元符号（$）<br></li>
<li><p>
等号两边不能直接接空白字符，如下所示为错误：<br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #8787d7;">your_name</span> = Alice
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#25110;</span>
<span style="color: #8787d7;">your_name</span>=Alice Bob
</pre>
</div></li>
<li>变量名称只能是英文字母与数字，但是开头字符不能是数字， <b>错误的变量名</b> ： <code>1your_name=Alice</code><br></li>
<li>变量内容若有空白字符可使用双引号 <code>"</code> 或单引号 <code>'</code> 将变量内容结合起来，但<br>
<ul class="org-ul">
<li><p>
双引号内的特殊字符如 <code>$</code> 等，可以保有原本的特性，如下所示：<br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #8787d7;">var</span>=<span style="color: #2aa198;">"lang is $LANG"</span>
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#21017; echo $var &#21487;&#24471; lang is zh_TW.UTF-8</span>
</pre>
</div></li>
<li><p>
单引号内的特殊字符则仅为一般字符（纯文本），如下所示：<br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #8787d7;">var</span>=<span style="color: #2aa198;">'lang is $LANG'</span>
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#21017; echo $var &#21487;&#24471; lang is $LANG</span>
</pre>
</div></li>
<li>可用跳脱字符 <code>\</code> 将特殊符号（如 [Enter], $, \, 空白字符, '等）变成一般字符，如： <code>your_name=Alice\ Bob</code><br></li>
</ul></li>
<li><p>
在一串指令的执行中，还需要借由其他额外的指令所提供的信息时，可以使用反单引号 <code>`</code> 或 <code>$</code><br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #268bd2;">cd</span> /lib/modules/<span style="color: #d75fd7;">`uname -r`</span>/kernel
<span style="color: #268bd2;">cd</span> /lib/modules/$(uname -r)/kernel
</pre>
</div>

<p>
<span class="underline">建议记住 <code>$()</code> 这种形式的，和数学中加减乘除的括号相似。</span><br>
</p></li>
<li>若该变量为扩增变量内容时，则可用 "$变量名称" 或 ${变量} 累加内容，如： <code>PATH="$PATH":/home/bin</code> 或 <code>PATH=${PATH}:/home/bin</code><br></li>
<li><p>
若该变量需要在其他子程序执行，则需要以 export 来使变量变成环境变量： <code>export PATH</code><br>
</p>

<div class="org-src-container">
<pre class="src src-bash">$ <span style="color: #8787d7;">your_name</span>=<span style="color: #2aa198;">"Alice"</span>
$ bash              <span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&lt;== &#36827;&#20837;&#23376;&#31243;&#24207;</span>
$ echo $<span style="color: #8787d7;">your_name</span>   <span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&lt;== &#22312;&#23376;&#31243;&#24207;&#19979;&#36755;&#20986;&#29238;&#31243;&#24207;&#23450;&#20041;&#30340;&#21464;&#37327;&#65292;&#27809;&#26377;&#36755;&#20986;</span>
$ exit              <span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&lt;== &#36864;&#20986;&#23376;&#31243;&#24207;</span>
$ export your_name  <span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&lt;== &#23558;&#21464;&#37327;&#21464;&#25104;&#29615;&#22659;&#21464;&#37327;</span>
$ bash  
$ echo $<span style="color: #8787d7;">your_name</span>   <span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&lt;== &#36825;&#27425;&#21487;&#20197;&#25104;&#21151;&#36755;&#20986;&#29238;&#31243;&#24207;&#23450;&#20041;&#30340;&#21464;&#37327;</span>
Alice
$ exit
</pre>
</div>

<p>
在目前的 shell 中启用一个新的 shell，新的 shell 就是子进程。<br>
</p>

<p>
在一般的情况下， <span class="underline">子进程仅会继承父进程的环境变量，子进程不会继承父进程的自定义变量</span> ，所以父进程的自定义变量是无法在子进程内使用的，通过 export 将变量变成环境变量后，就能够在子进程下使用。<br>
</p></li>

<li>通常大写字符为系统默认变量，自行设置变量可以使用小写字符，方便判断（纯粹依照使用者兴趣与嗜好）；<br></li>
<li>取消变量的方法为使用 <code>unset</code> ：【unset 变量名称】例如取消 your_name 的设置： <code>unset your_name</code><br></li>
</ul>

<p>
单引号与双引号的最大不同在于双引号仍然可以保有变量的内容，但单引号内仅能是一般字符，而不会有特殊符号。<br>
</p>
</div>
</div>
<div id="outline-container-org2a2472b" class="outline-3">
<h3 id="org2a2472b">使用变量</h3>
<div class="outline-text-3" id="text-org2a2472b">
<p>
使用一个定义过的变量，只要在变量名前面加美元符号即可，如：<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #8787d7;">your_name</span>=<span style="color: #2aa198;">"haoran"</span>
<span style="color: #268bd2;">echo</span> $<span style="color: #8787d7;">your_name</span>
<span style="color: #268bd2;">echo</span> ${<span style="color: #8787d7;">your_name</span>}
</pre>
</div>

<p>
变量名外面的花括号是可选的，加不加都行，加花括号是为了帮助解释器识别变量的边界，比如下面这种情况：<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #268bd2; font-weight: bold;">for</span> skill<span style="color: #268bd2; font-weight: bold;"> in</span> Ada Coffe Action Java; <span style="color: #268bd2; font-weight: bold;">do</span>
  <span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"I am good at ${skill}Script"</span>
<span style="color: #268bd2; font-weight: bold;">done</span>
</pre>
</div>

<p>
如果不给 <code>skill</code> 变量加花括号，写成 <code>echo "I am good at $skillScript"</code> ，解释器就会把 <code>$skillScript</code> 当成一个变量（其值为空），代码执行结果就不是我们期望的样子了。<br>
</p>

<p>
推荐给所有变量加上花括号，这是个好的编程习惯。IntelliJ IDEA 编写 shell script 时，IDE 就会提示加花括号。<br>
</p>
</div>
</div>
<div id="outline-container-org7e7f2e1" class="outline-3">
<h3 id="org7e7f2e1">重定义变量</h3>
<div class="outline-text-3" id="text-org7e7f2e1">
<p>
已定义的变量，可以被重新定义，如：<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #8787d7;">your_name</span>=<span style="color: #2aa198;">"Alice"</span>
<span style="color: #268bd2;">echo</span> $<span style="color: #8787d7;">your_name</span>

<span style="color: #8787d7;">your_name</span>=<span style="color: #2aa198;">"Bob"</span>
<span style="color: #268bd2;">echo</span> $<span style="color: #8787d7;">your_name</span>
</pre>
</div>

<p>
这样写是合法的，但注意，第二次赋值的时候不能写 <code>$your_name="alibaba"</code> ，使用变量的时候才加美元符。<br>
</p>
</div>
</div>
<div id="outline-container-orga2084fb" class="outline-3">
<h3 id="orga2084fb">只读变量</h3>
<div class="outline-text-3" id="text-orga2084fb">
<p>
使用 readonly 命令可以将变量定义为只读变量，只读变量的值不能被改变。<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #008787; background-color: #262626;">#</span><span style="color: #008787; background-color: #262626;">!/bin/</span><span style="color: #268bd2; font-weight: bold;">bash</span>
<span style="color: #8787d7;">your_name</span>=Tom
<span style="color: #268bd2;">readonly</span> your_name
</pre>
</div>
</div>
</div>
<div id="outline-container-org70010a3" class="outline-3">
<h3 id="org70010a3">更多的字符串操作</h3>
<div class="outline-text-3" id="text-org70010a3">
</div>
<div id="outline-container-org0a79c01" class="outline-4">
<h4 id="org0a79c01">字符串拼接</h4>
<div class="outline-text-4" id="text-org0a79c01">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #8787d7;">your_name</span>=<span style="color: #2aa198;">"Alice"</span>
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#20351;&#29992;&#21452;&#24341;&#21495;&#25340;&#25509;</span>
<span style="color: #8787d7;">greeting_0</span>=<span style="color: #2aa198;">"hello, "</span>$<span style="color: #8787d7;">your_name</span><span style="color: #2aa198;">" !"</span>
<span style="color: #8787d7;">greeting_1</span>=<span style="color: #2aa198;">"hello, ${your_name} !"</span>
<span style="color: #268bd2;">echo</span> $<span style="color: #8787d7;">greeting_0</span>  $<span style="color: #8787d7;">greeting_1</span>

<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#20351;&#29992;&#21333;&#24341;&#21495;&#25340;&#25509;</span>
<span style="color: #8787d7;">greeting_2</span>=<span style="color: #2aa198;">'hello, '</span>$<span style="color: #8787d7;">your_name</span><span style="color: #2aa198;">' !'</span>
<span style="color: #8787d7;">greeting_3</span>=<span style="color: #2aa198;">'hello, ${your_name} !'</span>
<span style="color: #268bd2;">echo</span> $<span style="color: #8787d7;">greeting_2</span>  $<span style="color: #8787d7;">greeting_3</span>
</pre>
</div>

<p>
输出结果为：<br>
</p>

<pre class="example">
hello, Alice ! hello, Alice !
hello, Alice ! hello, ${your_name} !
</pre>
</div>
</div>
<div id="outline-container-org74f7d14" class="outline-4">
<h4 id="org74f7d14">字符串长度</h4>
<div class="outline-text-4" id="text-org74f7d14">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #8787d7;">string</span>=<span style="color: #2aa198;">"abcd"</span>
<span style="color: #268bd2;">echo</span> ${#<span style="color: #8787d7;">string</span>}   <span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#36755;&#20986; 4</span>
</pre>
</div>

<p>
变量为数组时， <code>${#string}</code> 等价于 <code>${#string[0]}</code> ：<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #8787d7;">string</span>=<span style="color: #2aa198;">"abcd"</span>
<span style="color: #268bd2;">echo</span> ${#<span style="color: #8787d7;">string</span>[0]}   <span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#36755;&#20986; 4</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd8c2c2d" class="outline-4">
<h4 id="orgd8c2c2d">提取子字符串</h4>
<div class="outline-text-4" id="text-orgd8c2c2d">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #8787d7;">string</span>=<span style="color: #2aa198;">"I love you! And I will marry you!"</span>
<span style="color: #268bd2;">echo</span> ${<span style="color: #8787d7;">string</span>:2:5}   <span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#36755;&#20986; love</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org42d99fb" class="outline-4">
<h4 id="org42d99fb">查找子字符串</h4>
<div class="outline-text-4" id="text-org42d99fb">
<p>
查找字符 i 或 o 的位置（哪个字母先出现就计算哪个）<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #8787d7;">string</span>=<span style="color: #2aa198;">"Talk is cheap, show me the code."</span>
<span style="color: #268bd2;">echo</span> <span style="color: #d75fd7;">`expr index "$string" io`</span>   <span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#36755;&#20986; 5</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orged49f4c" class="outline-3">
<h3 id="orged49f4c">数字类型</h3>
<div class="outline-text-3" id="text-orged49f4c">
</div>
<div id="outline-container-org06e4c05" class="outline-4">
<h4 id="org06e4c05">如何定义数字变量</h4>
<div class="outline-text-4" id="text-org06e4c05">
<p>
默认情况下，shell 中每一个变量的值都是字符串，即使给一个变量赋值一个数字，它其实也是字符串，所以在进行数学计算时会出错。<br>
</p>

<p>
使用 declare 命令的 -i 选项可以将一个变量声明为整数类型，这样在进行数字计算时就不会作为字符串处理了。<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #008787; background-color: #262626;">#</span><span style="color: #008787; background-color: #262626;">!/bin/</span><span style="color: #268bd2; font-weight: bold;">bash</span>
<span style="color: #268bd2;">declare</span> -i a b
<span style="color: #8787d7;">a</span>=10
<span style="color: #8787d7;">b</span>=20

<span style="color: #268bd2;">declare</span> -i res
<span style="color: #8787d7;">res</span>=$<span style="color: #8787d7;">a</span>+$<span style="color: #8787d7;">b</span>
<span style="color: #268bd2;">echo</span> $<span style="color: #8787d7;">res</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd2f5f7b" class="outline-4">
<h4 id="orgd2f5f7b">数值运算</h4>
<div class="outline-text-4" id="text-orgd2f5f7b">
<p>
shell 里面默认仅支持整数的数据。<br>
</p>
<ul class="org-ul">
<li>declare 命令<br>
<ul class="org-ul">
<li><code>declare -i total=${firstnu}*${secnu}</code><br></li>
</ul></li>
<li>let 命令<br>
<ul class="org-ul">
<li><code>let t=x+y</code><br></li>
</ul></li>
<li>shell 扩展 $((expression))<br>
<ul class="org-ul">
<li><code>var=$((${firstnu}*${secnu}))</code><br></li>
</ul></li>
<li>expr 命令<br>
<ul class="org-ul">
<li><code>x=`expr $x + 1`</code><br></li>
<li><code>x=$(expr $x + 1)</code><br></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org5445103" class="outline-4">
<h4 id="org5445103">保留小数</h4>
<div class="outline-text-4" id="text-org5445103">
<p>
下面得到 num1 的命令是等价的，得到 num2 的命令是等价的，得到 num3 的命令是等价的。<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #8787d7;">num0</span>=123
<span style="color: #8787d7;">num1</span>=$(awk -v <span style="color: #8787d7;">x</span>=$<span style="color: #8787d7;">num0</span> <span style="color: #2aa198;">'BEGIN{print sqrt(x)}'</span>)
<span style="color: #8787d7;">num1</span>=$(<span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"$num0"</span> | awk <span style="color: #2aa198;">'{print sqrt($1)}'</span>)
<span style="color: #8787d7;">num1</span>=$(<span style="color: #268bd2;">echo</span> | awk <span style="color: #2aa198;">"{print sqrt($num0)}"</span>)
<span style="color: #8787d7;">num2</span>=$(bc &lt;&lt;&lt; <span style="color: #2aa198;">"scale=6; sqrt($num0)"</span>)
<span style="color: #8787d7;">num2</span>=$(<span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"scale=6; sqrt($num0)"</span> | bc)

<span style="color: #8787d7;">num3</span>=<span style="color: #d75fd7;">`awk 'BEGIN{printf "%.2f\n", "$num1"/"$num2"}'`</span>
<span style="color: #8787d7;">num3</span>=$(<span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"sclae=2; $num1/$num2"</span> | bc)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org7c1eb8c" class="outline-3">
<h3 id="org7c1eb8c">数组（array）</h3>
<div class="outline-text-3" id="text-org7c1eb8c">
<p>
bash 支持一维数组（不支持多维数组），并且没有限定数组大小。<br>
</p>
</div>
<div id="outline-container-org05344e9" class="outline-4">
<h4 id="org05344e9">定义数组</h4>
<div class="outline-text-4" id="text-org05344e9">
<ul class="org-ul">
<li><p>
array=(value1 value2 value3)<br>
在 shell 中，用括号来表示数组，数组元素用"空格"符号分割开。定义数组的一般形式为：<br>
</p>

<pre class="example">
数组名=(值1 值2 ... 值n)
</pre>

<p>
例如：<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #8787d7;">array_name</span>=(value0 value1 value2 value3)
</pre>
</div>

<p>
或者<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #8787d7;">array_name</span>=(
value0
value1
value2
value3
)
</pre>
</div></li>
<li><p>
array[key]=value<br>
还可以单独定义数组的各个分量：<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #8787d7;">array_name</span>[0]=value0
<span style="color: #8787d7;">array_name</span>[1]=value1
<span style="color: #8787d7;">array_name</span>[n]=valuen
</pre>
</div>

<p>
可以不使用连续的下标，而且下标的范围没有限制。<br>
</p></li>
<li><p>
array=([1]=one [2]=tow [3]=three)<br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #8787d7;">array</span>=([1]=one [2]=two [3]=three)
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-orgc90823b" class="outline-4">
<h4 id="orgc90823b">读取数组</h4>
<div class="outline-text-4" id="text-orgc90823b">
<p>
读取数组元素值的一般格式是：<br>
</p>

<pre class="example">
${数组名[下标]}
</pre>

<p>
例如：<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #8787d7;">valuen</span>=${<span style="color: #8787d7;">array_name</span>[n]}
</pre>
</div>

<p>
使用 <code>@</code> 符号可以获取数组中的所有元素，例如：<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #268bd2;">echo</span> ${<span style="color: #8787d7;">array_name</span>[@]}
</pre>
</div>
</div>
</div>
<div id="outline-container-org5dc0f1a" class="outline-4">
<h4 id="org5dc0f1a">关于数组的操作</h4>
<div class="outline-text-4" id="text-org5dc0f1a">
<ul class="org-ul">
<li>数组的删除<br></li>
<li><p>
获取数组的长度<br>
获取数组长度的方法与获取字符串长度的方法相同，例如：<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#21462;&#24471;&#25968;&#32452;&#20803;&#32032;&#30340;&#20010;&#25968;</span>
<span style="color: #8787d7;">length</span>=${#<span style="color: #8787d7;">array_name</span>[@]}
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#25110;&#32773;</span>
<span style="color: #8787d7;">length</span>=${#<span style="color: #8787d7;">array_name</span>[*]}
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#21462;&#24471;&#25968;&#32452;&#21333;&#20010;&#20803;&#32032;&#30340;&#38271;&#24230;</span>
<span style="color: #8787d7;">lengthn</span>=${#<span style="color: #8787d7;">array_name</span>[n]}
</pre>
</div></li>
<li>子串的提取<br></li>
<li>子串删除<br></li>
<li>子串替换<br></li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc7db769" class="outline-2">
<h2 id="orgc7db769">判断式</h2>
<div class="outline-text-2" id="text-orgc7db769">
</div>
<div id="outline-container-org28144ad" class="outline-3">
<h3 id="org28144ad">利用 test 命令的测试功能</h3>
<div class="outline-text-3" id="text-org28144ad">
<p>
当要检测系统上面某些文件或是相关的属性时，利用 test 这个命令。<br>
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#26816;&#26597; /haoran &#26159;&#21542;&#23384;&#22312;</span>
test -e /haoran
</pre>
</div>

<p>
执行结果并不会显示任何信息，但最后我们可以通过 <code>$?</code> 或 <code>&amp;&amp;</code> 及 <code>||</code> 来展示整个结果：<br>
</p>

<div class="org-src-container">
<pre class="src src-bash">test -e /haoran &amp;&amp; <span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"exist"</span> || <span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"not exist"</span>
</pre>
</div>

<ol class="org-ol">
<li><p>
关于某个文件名的“文件类型”判断，如 test -e filename 表示存在否<br>
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">-e</td>
<td class="org-left">该“文件名”是否存在？（常用）</td>
</tr>

<tr>
<td class="org-left">-f</td>
<td class="org-left">该“文件名”是否存在且为文件（file）？（常用）</td>
</tr>

<tr>
<td class="org-left">-d</td>
<td class="org-left">该“文件名”是否存在且为目录（directory）？（常用）</td>
</tr>

<tr>
<td class="org-left">-b</td>
<td class="org-left">该“文件名”是否存在且为一个 block device 设备？</td>
</tr>

<tr>
<td class="org-left">-c</td>
<td class="org-left">该“文件名”是否存在且为一个 character device 设备？</td>
</tr>

<tr>
<td class="org-left">-S</td>
<td class="org-left">该“文件名”是否存在且为一个 Socket 文件？</td>
</tr>

<tr>
<td class="org-left">-p</td>
<td class="org-left">该“文件名”是否存在且为一个 FIFO （pipe） 文件？</td>
</tr>

<tr>
<td class="org-left">-L</td>
<td class="org-left">该“文件名”是否存在且为一个链接文件？</td>
</tr>
</tbody>
</table></li>

<li><p>
关于文件的权限侦测，如 test -r filename 表示可读否 （但 root权限常有例外）<br>
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">-r</td>
<td class="org-left">侦测该文件名是否存在且具有“可读”的权限？</td>
</tr>

<tr>
<td class="org-left">-w</td>
<td class="org-left">侦测该文件名是否存在且具有“可写”的权限？</td>
</tr>

<tr>
<td class="org-left">-x</td>
<td class="org-left">侦测该文件名是否存在且具有“可执行”的权限？</td>
</tr>

<tr>
<td class="org-left">-u</td>
<td class="org-left">侦测该文件名是否存在且具有“SUID”的属性？</td>
</tr>

<tr>
<td class="org-left">-g</td>
<td class="org-left">侦测该文件名是否存在且具有“SGID”的属性？</td>
</tr>

<tr>
<td class="org-left">-k</td>
<td class="org-left">侦测该文件名是否存在且具有“Sticky bit”的属性？</td>
</tr>

<tr>
<td class="org-left">-s</td>
<td class="org-left">侦测该文件名是否存在且为“非空白文件”？</td>
</tr>
</tbody>
</table></li>

<li><p>
两个文件之间的比较，如：test file1 -nt file2<br>
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">-nt</td>
<td class="org-left">（newer than）判断 file1 是否比 file2 新</td>
</tr>

<tr>
<td class="org-left">-ot</td>
<td class="org-left">（older than）判断 file1 是否比 file2 旧</td>
</tr>

<tr>
<td class="org-left">-ef</td>
<td class="org-left">判断 file1 与 file2 是否为同一文件，可用在判断 hard link 的判定上。 主要意义在判定，两个文件是否均指向同一个 inode</td>
</tr>
</tbody>
</table></li>

<li><p>
关于两个整数之间的判定，例如 test n1 -eq n2<br>
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">-eq</td>
<td class="org-left">两数值相等（equal）</td>
</tr>

<tr>
<td class="org-left">-ne</td>
<td class="org-left">两数值不等（not equal）</td>
</tr>

<tr>
<td class="org-left">-gt</td>
<td class="org-left">n1 大于 n2（greater than）</td>
</tr>

<tr>
<td class="org-left">-lt</td>
<td class="org-left">n1 小于 n2（less than）</td>
</tr>

<tr>
<td class="org-left">-ge</td>
<td class="org-left">n1 大于等于 n2（greater than or equal）</td>
</tr>

<tr>
<td class="org-left">-le</td>
<td class="org-left">n1 小于等于 n2（less than or equal）</td>
</tr>
</tbody>
</table></li>

<li><p>
判定字串的数据<br>
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">test -z string</td>
<td class="org-left">判定字串是否为 0 ？若 string 为空字串，则为 true</td>
</tr>

<tr>
<td class="org-left">test -n string</td>
<td class="org-left">判定字串是否非为 0 ？若 string 为空字串，则为 false。 -n 亦可省略</td>
</tr>

<tr>
<td class="org-left">test str1 == str2</td>
<td class="org-left">判定 str1 是否等于 str2 ，若相等，则回传 true</td>
</tr>

<tr>
<td class="org-left">test str1 != str2</td>
<td class="org-left">判定 str1 是否不等于 str2 ，若相等，则回传 false</td>
</tr>
</tbody>
</table></li>

<li><p>
多重条件判定，例如： test -r filename -a -x filename<br>
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">-a</td>
<td class="org-left">（and）两状况同时成立！例如 test -r file -a -x file，则 file 同时具有 r 与 x 权限时，才回传 true。</td>
</tr>

<tr>
<td class="org-left">-o</td>
<td class="org-left">（or）两状况任何一个成立！例如 test -r file -o -x file，则 file 具有 r 或 x 权限时，就可回传 true。</td>
</tr>

<tr>
<td class="org-left">!</td>
<td class="org-left">反相状态，如 test ! -x file ，当 file 不具有 x 时，回传 true</td>
</tr>
</tbody>
</table></li>
</ol>
</div>
</div>
<div id="outline-container-org13a8b01" class="outline-3">
<h3 id="org13a8b01">利用判断符号 []</h3>
<div class="outline-text-3" id="text-org13a8b01">
<p>
除了使用 test 之外，还可以利用判断符号 <code>[]</code> 来进行数据的判断，举例来说，如果要知道 <code>${HOME}</code> 这个变量是否为空：<br>
</p>

<div class="org-src-container">
<pre class="src src-bash">$ [ -z <span style="color: #2aa198;">"${HOME}"</span> ]; <span style="color: #268bd2;">echo</span> $<span style="color: #8787d7;">?</span>
$ [ <span style="color: #2aa198;">"${HOME}"</span> == <span style="color: #2aa198;">"${MAIL}"</span> ]
</pre>
</div>

<p>
<span class="underline">中括号内的两端需要空格</span> ，上面的判断式使用了 <code>==</code> ，其实在 bash 中，一个等号与两等号的结果是一样的，不过我们通常使用一个等号表示赋值，两个等号表示逻辑判断，其他还需要注意的有：<br>
</p>

<ul class="org-ul">
<li>在中括号内的变量，最好都以双引号括起来；<br></li>
<li>在中括号内的常数，最好都以单或双引号括起来；<br></li>
</ul>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#23601;&#27604;&#22914;&#19979;&#38754;&#36825;&#20010;&#20363;&#23376;&#65292;&#22914;&#26524; [] &#37324;&#30340;&#21464;&#37327;&#19981;&#25324;&#36215;&#26469;&#30340;&#35805;</span>
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#21028;&#26029;&#24335;&#23601;&#21464;&#25104;&#20102; [ Haoran Liu == "haoran" ]</span>
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#32780;&#25105;&#20204;&#24819;&#35201;&#30340;&#24212;&#35813;&#26159; [ "Haoran Liu" == "haoran" ]</span>
$ <span style="color: #8787d7;">name</span>=<span style="color: #2aa198;">"Haoran Liu"</span>
$ [ ${<span style="color: #8787d7;">name</span>} == <span style="color: #2aa198;">"haoran"</span> ]
bash: [: too many arguments
</pre>
</div>
</div>
</div>
<div id="outline-container-org321bb82" class="outline-3">
<h3 id="org321bb82">shell 脚本的默认变量（$0、$1&#x2026;）<a id="org6d2f994"></a></h3>
<div class="outline-text-3" id="text-org321bb82">
<div class="org-src-container">
<pre class="src src-bash">/path/to/scriptname opt1 opt2 opt3 opt4
$<span style="color: #8787d7;">0</span>                  $<span style="color: #8787d7;">1</span>   $<span style="color: #8787d7;">2</span>   $<span style="color: #8787d7;">3</span>   $<span style="color: #8787d7;">4</span>
</pre>
</div>

<dl class="org-dl">
<dt>$0</dt><dd>执行脚本的文件名；<br></dd>
<dt>$1</dt><dd>执行命令后接的第一个参数；<br></dd>
<dt>$2</dt><dd>执行命令后接的第二个参数；<br></dd>
<dt>$3</dt><dd>执行命令后接的第三个参数；<br></dd>
<dt>$4</dt><dd>执行命令后接的第四个参数；<br></dd>
<dt>$#</dt><dd>参数个数，这里是四个参数；<br></dd>
<dt>$@</dt><dd>代表【"$1" "$2" "$3" "$4"】之意，每个变量是独立的；<br></dd>
<dt>$*</dt><dd>代表【"$1c$2c$3c$4"】之意，其中 c 为分隔字符，默认为空格，所以本例代表【"$1 $2 $3 $4"】；<br></dd>
</dl>

<p>
这个 $@ 和 $* 还是不同的，不过，一般情况下可以直接记忆 $@。<br>
</p>

<ul class="org-ul">
<li>shift: 造成参数变量号码偏移，可以理解为每次删除前面一个参数；<br></li>
</ul>

<pre class="example">
# 假设有六个参数 [ one two three four five six ]
shift   # [ one two three four five six ]
shift   # [ two three four five six ]
shift   # [ three four five six ]
shift   # [ four five six ]
shift   # [ five six ]
</pre>
</div>
</div>
</div>
<div id="outline-container-org7a26658" class="outline-2">
<h2 id="org7a26658">程序控制结构</h2>
<div class="outline-text-2" id="text-org7a26658">
</div>
<div id="outline-container-org58fe230" class="outline-3">
<h3 id="org58fe230">条件判断</h3>
<div class="outline-text-3" id="text-org58fe230">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #268bd2;">read</span> -p <span style="color: #2aa198;">"Please input (Y/N): "</span> yn

<span style="color: #268bd2; font-weight: bold;">if</span> [ <span style="color: #2aa198;">"${yn}"</span> == <span style="color: #2aa198;">"Y"</span> ] || [ <span style="color: #2aa198;">"${yn}"</span> == <span style="color: #2aa198;">"y"</span> ]; <span style="color: #268bd2; font-weight: bold;">then</span>
    <span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"OK continue"</span>
<span style="color: #268bd2; font-weight: bold;">elif</span> [ <span style="color: #2aa198;">"${yn}"</span> == <span style="color: #2aa198;">"N"</span> ] || [ <span style="color: #2aa198;">"${yn}"</span> == <span style="color: #2aa198;">"n"</span> ]; <span style="color: #268bd2; font-weight: bold;">then</span>
    <span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"Oh interrupt"</span>
<span style="color: #268bd2; font-weight: bold;">else</span>
    <span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"I don't know what your choice is"</span>
<span style="color: #268bd2; font-weight: bold;">fi</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #268bd2;">read</span> -p <span style="color: #2aa198;">"Input your choice: "</span> choice

<span style="color: #268bd2; font-weight: bold;">case</span> ${<span style="color: #8787d7;">choice</span>} <span style="color: #268bd2; font-weight: bold;">in</span>
    <span style="color: #2aa198;">"one"</span>)
        <span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"Your choice is ONE"</span>
        ;;      <span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&lt;== &#27599;&#20010;&#31867;&#21035;&#32467;&#23614;&#20351;&#29992;&#20004;&#20010;&#36830;&#32493;&#30340;&#20998;&#21495;&#26469;&#22788;&#29702;</span>
    <span style="color: #2aa198;">"two"</span>)
        <span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"Your choice is TWO"</span>
        ;;
    <span style="color: #2aa198;">"three"</span>)
        <span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"Your choice is THREE"</span>
        ;;
    *)         <span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&lt;== &#26368;&#21518;&#19968;&#20010;&#21464;&#37327;&#20869;&#23481;&#20351;&#29992; * &#26469;&#20195;&#34920;&#25152;&#26377;&#20854;&#20182;&#20540;</span>
        <span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"Usage ${0} {one|two|three}"</span>
        ;;
<span style="color: #268bd2; font-weight: bold;">esac</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc1abc18" class="outline-3">
<h3 id="orgc1abc18">循环（loop）</h3>
<div class="outline-text-3" id="text-orgc1abc18">
<dl class="org-dl">
<dt>break</dt><dd>跳出循环<br></dd>
<dt>continue</dt><dd>在循环中，使程序跳到 done 后再次判断循环条件是否满足<br></dd>
<dt>exit</dt><dd>结束脚本运行<br></dd>
</dl>

<table>


<colgroup>
<col  class="org-right">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">退出码</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left">成功退出</td>
</tr>

<tr>
<td class="org-right">126</td>
<td class="org-left">文件不可执行</td>
</tr>

<tr>
<td class="org-right">127</td>
<td class="org-left">命令未找到</td>
</tr>

<tr>
<td class="org-right">128及以上</td>
<td class="org-left">出现一个信号</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #008787; background-color: #262626;">#</span><span style="color: #008787; background-color: #262626;">!/bin/</span><span style="color: #268bd2; font-weight: bold;">bash</span>
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#24403; ${yn} != yes &#19988; ${yn} != YES&#65292;&#37027;&#20040;&#32487;&#32493;&#24490;&#29615;</span>
<span style="color: #268bd2; font-weight: bold;">while</span> [ <span style="color: #2aa198;">"${yn}"</span> != <span style="color: #2aa198;">"yes"</span> -a <span style="color: #2aa198;">"{yn}"</span> != <span style="color: #2aa198;">"YES"</span> ]
<span style="color: #268bd2; font-weight: bold;">do</span>
    <span style="color: #268bd2;">read</span> -p <span style="color: #2aa198;">"Please input yes/YES to stop this program: "</span> yn
<span style="color: #268bd2; font-weight: bold;">done</span>
<span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"OK! you input the correct answer."</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #008787; background-color: #262626;">#</span><span style="color: #008787; background-color: #262626;">!/bin/</span><span style="color: #268bd2; font-weight: bold;">bash</span>
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#30452;&#21040; ${yn} == yes &#25110; ${yn} == YES&#65292;&#37027;&#20040;&#20572;&#27490;&#24490;&#29615;</span>
<span style="color: #268bd2; font-weight: bold;">until</span> [ <span style="color: #2aa198;">"${yn}"</span> == <span style="color: #2aa198;">"yes"</span> -o <span style="color: #2aa198;">"${yn}"</span> == <span style="color: #2aa198;">"YES"</span> ]
<span style="color: #268bd2; font-weight: bold;">do</span>
    <span style="color: #268bd2;">read</span> -p <span style="color: #2aa198;">"Please input yes/YES to stop this program: "</span> yn
<span style="color: #268bd2; font-weight: bold;">done</span>
<span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"OK! you input the correct answer."</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #008787; background-color: #262626;">#</span><span style="color: #008787; background-color: #262626;">!/bin/</span><span style="color: #268bd2; font-weight: bold;">bash</span>
<span style="color: #268bd2; font-weight: bold;">for</span> animal<span style="color: #268bd2; font-weight: bold;"> in</span> dog cat elephant
<span style="color: #268bd2; font-weight: bold;">do</span>
    <span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"There are ${animal}s..."</span>
<span style="color: #268bd2; font-weight: bold;">done</span>

<span style="color: #268bd2; font-weight: bold;">for</span> username<span style="color: #268bd2; font-weight: bold;"> in</span> ${<span style="color: #8787d7;">users</span>}
<span style="color: #268bd2; font-weight: bold;">do</span>
    id ${<span style="color: #8787d7;">username</span>}
<span style="color: #268bd2; font-weight: bold;">done</span>

<span style="color: #268bd2; font-weight: bold;">for</span> i<span style="color: #268bd2; font-weight: bold;"> in</span> ${<span style="color: #8787d7;">seq</span> 1 100}
<span style="color: #268bd2; font-weight: bold;">do</span>
    <span style="color: #268bd2;">echo</span> ${<span style="color: #8787d7;">i</span>}
<span style="color: #268bd2; font-weight: bold;">done</span>

<span style="color: #268bd2; font-weight: bold;">for</span> i<span style="color: #268bd2; font-weight: bold;"> in</span> {1...100}
<span style="color: #268bd2; font-weight: bold;">do</span>
    <span style="color: #268bd2;">echo</span> ${<span style="color: #8787d7;">i</span>}
<span style="color: #268bd2; font-weight: bold;">done</span>

<span style="color: #268bd2; font-weight: bold;">for</span> (( <span style="color: #8787d7;">i</span>=1; i&lt;=100; <span style="color: #8787d7;">i</span>=i+1 ))
<span style="color: #268bd2; font-weight: bold;">do</span>
    <span style="color: #268bd2;">echo</span> ${<span style="color: #8787d7;">i</span>}
<span style="color: #268bd2; font-weight: bold;">done</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgaf8254e" class="outline-3">
<h3 id="orgaf8254e">函数（function）</h3>
<div class="outline-text-3" id="text-orgaf8254e">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #008787; background-color: #262626;">#</span><span style="color: #008787; background-color: #262626;">!/bin/</span><span style="color: #268bd2; font-weight: bold;">bash</span>

<span style="color: #268bd2; font-weight: bold;">function</span> <span style="color: #d75fd7; font-weight: bold;">printit</span>() {
    <span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"Your choice is ${1}"</span> <span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#36825;&#20010; $1 &#24517;&#39035;&#35201;&#21442;&#32771;&#19979;&#38754;&#25351;&#20196;&#30340;&#19979;&#36798;</span>
}

<span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"This program will print your selection !"</span>

<span style="color: #268bd2; font-weight: bold;">case</span> ${<span style="color: #8787d7;">1</span>} <span style="color: #268bd2; font-weight: bold;">in</span>
    <span style="color: #2aa198;">"one"</span>)
        <span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#35831;&#27880;&#24847;&#65292; printit &#25351;&#20196;&#21518;&#38754;&#36824;&#26377;&#25509;&#21442;&#25968;&#65281;</span>
        printit 1
        ;;
    <span style="color: #2aa198;">"two"</span>)
        printit 2
        ;;
    <span style="color: #2aa198;">"three"</span>)
        printit 3
        ;;
    *)
        <span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"Usage ${0} {one|two|three}"</span>
        ;;
<span style="color: #268bd2; font-weight: bold;">esac</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org0ba0d62" class="outline-2">
<h2 id="org0ba0d62">shell 脚本的跟踪与调试</h2>
<div class="outline-text-2" id="text-org0ba0d62">
<pre class="example">
sh [-nvx] scripts.sh

-n: 不用执行脚本，仅查询语法的问题；
-v: 在执行脚本前，先将脚本文件的内容输出到屏幕上；
-x: 将使用到的脚本内容显示在屏幕上；
</pre>
</div>
</div>
<div id="outline-container-org209a3cf" class="outline-2">
<h2 id="org209a3cf">建立 shell 脚本的良好编写习惯</h2>
<div class="outline-text-2" id="text-org209a3cf">
<ul class="org-ul">
<li>script 的功能；<br></li>
<li>script 的版本信息；<br></li>
<li>script 的作者与联络方式；<br></li>
<li>script 的版权宣告方式；<br></li>
<li>script 的 History （历史纪录）；<br></li>
<li>script 内较特殊的指令，使用“绝对路径”的方式来下达；<br></li>
<li>script 运行时需要的环境变量预先宣告与设置；<br></li>
</ul>
</div>
</div>
<div id="outline-container-org1cab6f2" class="outline-2">
<h2 id="org1cab6f2">用户输入</h2>
<div class="outline-text-2" id="text-org1cab6f2">
</div>
<div id="outline-container-orga34a633" class="outline-3">
<h3 id="orga34a633">读取来自键盘输入的变量</h3>
<div class="outline-text-3" id="text-orga34a633">
<p>
<a href="Linux-bash.html#orgba454ff">键盘读取变量：read</a><br>
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #268bd2;">read</span> -p <span style="color: #2aa198;">"&#35831;&#36755;&#20837;&#20320;&#30340;&#21517;&#23383;&#65306;"</span> your_name
<span style="color: #268bd2;">echo</span> $<span style="color: #8787d7;">your_name</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgebc615c" class="outline-3">
<h3 id="orgebc615c">脚本文件携带参数</h3>
<div class="outline-text-3" id="text-orgebc615c">
<p>
<a href="#org6d2f994">shell脚本的默认变量（$0、$1&#x2026;）</a><br>
</p>
</div>
</div>
<div id="outline-container-orgf3cbc81" class="outline-3">
<h3 id="orgf3cbc81">输入数字数组</h3>
<div class="outline-text-3" id="text-orgf3cbc81">
<p>
假定让你输入多个数，以回车结束输入，然后计算输入数的平均值，怎么办？<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #008787; background-color: #262626;">#</span><span style="color: #008787; background-color: #262626;">!/bin/</span><span style="color: #268bd2; font-weight: bold;">bash</span>
<span style="color: #268bd2;">declare</span> -ai num

<span style="color: #268bd2;">read</span> -p <span style="color: #2aa198;">"Please input some numbers: "</span> -a num

<span style="color: #268bd2;">declare</span> -i <span style="color: #8787d7;">len</span>=${#<span style="color: #8787d7;">num</span>[*]}
<span style="color: #268bd2;">declare</span> -i <span style="color: #8787d7;">sum</span>=0

<span style="color: #268bd2; font-weight: bold;">for</span> (( <span style="color: #8787d7;">i</span>=1; i&lt;$<span style="color: #8787d7;">len</span>; i++ ))
<span style="color: #268bd2; font-weight: bold;">do</span>
    <span style="color: #268bd2;">let</span> <span style="color: #8787d7;">sum</span>=sum+num[i]
<span style="color: #268bd2; font-weight: bold;">done</span>

<span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"$sum, $len"</span>
<span style="color: #268bd2;">echo</span> <span style="color: #2aa198;">"scale=2; $sum/$len"</span> | bc
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: L.M.haoran</p>
<p class="date">Created: 2022-06-23 Thu 12:46</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
