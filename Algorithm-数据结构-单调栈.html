<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2021-10-13 Wed 22:39 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>单调栈</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran &lt;haoran.mc@outlook.com&gt;">
<meta name="description" content="Copyright © 2021, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">单调栈</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org17247fc">内容</a></li>
<li><a href="#orgac91f4c">Largest Rectangle in a Histogram</a>
<ul>
<li><a href="#org8e4f69f">使用单调栈解决这题的操作</a></li>
<li><a href="#orgc9929fe">AC代码：</a></li>
</ul>
</li>
<li><a href="#orgb877c6f">最大子矩阵问题</a>
<ul>
<li><a href="#orge6a0d8d">AC代码：</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org17247fc" class="outline-2">
<h2 id="org17247fc">内容</h2>
<div class="outline-text-2" id="text-org17247fc">
<p>
单调栈是一个栈中元素单调的栈结构。<br>
</p>
</div>
</div>

<div id="outline-container-orgac91f4c" class="outline-2">
<h2 id="orgac91f4c">Largest Rectangle in a Histogram</h2>
<div class="outline-text-2" id="text-orgac91f4c">
<p>
这是一道经典的单调栈问题，题目要求在一个直方图中找出一个最大的矩形，<a href="https://www.luogu.com.cn/problem/SP1805">题目链接</a>。<br>
</p>

<img src="./images/直方图1.png" alt="直方图中的最大矩形样例" />

<p>
本题的思路是，得到每个直方图中的矩形向左向右能够达到的最远位置。例如样例中的第三块矩形不能向左移动，因为第二块矩形的高度只有 \(1\)；向右能够达到的最远位置是第四块，因为第五块的高度也是 \(1\)，所以我们知道完全包含第三块矩形的最大矩形是阴影部分。<br>
</p>

<p>
只要依次判断包含各矩形的最大矩形的大小，就能找到整个直方图中的最大矩形。所以这题就变成了在给出的 \(n\) 个数 \(2, 1, 4, 5, 1, 3, 3\) 中，依次找到每个数左右两边第一个小于自己的位置，单调栈能够做到这件事。<br>
</p>
</div>
<div id="outline-container-org8e4f69f" class="outline-3">
<h3 id="org8e4f69f">使用单调栈解决这题的操作</h3>
<div class="outline-text-3" id="text-org8e4f69f">
<ul class="org-ul">
<li>初始时栈中放入高度为 \(0\) 的矩形，用于边界处理<br></li>
<li>依次将每个输入的数加入到单调栈中<br></li>
<li>如果栈顶元素小于即将加入栈中的元素，直接插入<br></li>
<li>如果栈顶元素大于即将加入栈中的元素，依次弹出这些大于即将加入栈中的元素<br></li>
<li>弹出后添加一个有宽度性质的元素，所以需要一个存储宽度的数组，存储每个矩形的宽度<br></li>
</ul>

<blockquote>
<p>
根据木桶原理，桶中水的高度取决于木桶最短的那块木板的长度。<br>
</p>
</blockquote>

<p>
我们来看样例中的第一个高度为 \(2\) 矩形，会发现，对于后面的矩形来说，它能贡献的最大高度是 \(1\) 。因为后面凡是大于 \(1\) 的数向左的第一个小于自己的数一定不会是 \(2\) ，而是它后面的数 \(1\)。<br>
</p>

<img src="./images/直方图2.png" />

<p>
所以上图中弹出第一块之后，插入的不是第二块，而是一个高度是 \(1\) ，宽度是 \(2\) 的矩形。<br>
</p>

<img src="./images/直方图3.png" />

<p>
同理，在插入第 \(5\) 个数 \(1\) 时，弹出所有元素，添加一个高度为 \(1\)，宽度为 \(5\) 的矩形。<br>
</p>

<ul class="org-ul">
<li>计算包含每个矩形的最大矩形的步骤是在弹出的过程中完成的<br></li>
</ul>

<p>
在弹出每个元素时，一定是遇到了第一个右边一个比自己小的元素，而根据单调栈的性质，每个元素前面的元素一定是小于自己的元素，所以我们就找到了每个元素左右两边第一个比自己小的元素。<br>
</p>
</div>
</div>
<div id="outline-container-orgc9929fe" class="outline-3">
<h3 id="orgc9929fe">AC代码：</h3>
<div class="outline-text-3" id="text-orgc9929fe">
<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #009F9F;">#include</span> <span style="color: #FC9F4E;">&lt;cstdio&gt;</span>
<span style="color: #009F9F;">#include</span> <span style="color: #FC9F4E;">&lt;cstring&gt;</span>
<span style="color: #009F9F;">#include</span> <span style="color: #FC9F4E;">&lt;cmath&gt;</span>
<span style="color: #009F9F;">#include</span> <span style="color: #FC9F4E;">&lt;algorithm&gt;</span>
<span style="color: #BD93F9;">typedef</span> <span style="color: #AFAFAF;">long</span> <span style="color: #AFAFAF;">long</span> <span style="color: #AFAFAF;">ll</span>;
<span style="color: #BD93F9;">using</span> <span style="color: #BD93F9;">namespace</span> <span style="color: #009F9F;">std</span>;
<span style="color: #BD93F9;">const</span> <span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">maxn</span> = <span style="color: #009F9F;">1e5</span> + <span style="color: #009F9F;">5</span>;
<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">n</span>, <span style="color: #AFAFAF;">tt</span>;
<span style="color: #AFAFAF;">ll</span> <span style="color: #AFAFAF;">res</span>;
<span style="color: #7c7c7c; font-style: italic;">// </span><span style="color: #7c7c7c; font-style: italic;">&#30452;&#26041;&#20307;&#20013;&#30697;&#24418;&#30340;&#39640;&#24230;&#65292;&#30452;&#26041;&#20307;&#20013;&#30697;&#24418;&#30340;&#23485;&#24230;</span>
<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">a</span>[maxn], <span style="color: #AFAFAF;">width</span>[maxn];
<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">stk</span>[maxn];

<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">main</span>() {
    <span style="color: #BD93F9;">while</span>(scanf(<span style="color: #FC9F4E;">"%d"</span>, &amp;n) &amp;&amp; n) {
        res = <span style="color: #009F9F;">0</span>; tt = <span style="color: #009F9F;">0</span>;

        <span style="color: #BD93F9;">for</span> (<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">i</span> = <span style="color: #009F9F;">1</span>; i &lt;= n; i++)
            scanf(<span style="color: #FC9F4E;">"%d"</span>, &amp;a[i]);
        a[n+<span style="color: #009F9F;">1</span>] = <span style="color: #009F9F;">0</span>;   <span style="color: #7c7c7c; font-style: italic;">// </span><span style="color: #7c7c7c; font-style: italic;">&#26368;&#21518;&#23558;&#25152;&#26377;&#30340;&#37117;pop&#20986;&#26469;</span>

        <span style="color: #BD93F9;">for</span> (<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">i</span> = <span style="color: #009F9F;">1</span>; i &lt;= n+<span style="color: #009F9F;">1</span>; i++) {
            <span style="color: #BD93F9;">if</span> (a[i] &gt; stk[tt]) {
                stk[++tt] = a[i];
                width[tt] = <span style="color: #009F9F;">1</span>;
            }
            <span style="color: #BD93F9;">else</span> {   <span style="color: #7c7c7c; font-style: italic;">// </span><span style="color: #7c7c7c; font-style: italic;">&#24377;&#20986;&#26632;&#39030;</span>
                <span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">cnt</span> = <span style="color: #009F9F;">0</span>;
                <span style="color: #BD93F9;">while</span> (stk[tt] &gt; a[i]) {
                    cnt += width[tt];
                    res = max(res, (<span style="color: #AFAFAF;">ll</span>)cnt * stk[tt]);
                    tt--;
                }
                stk[++tt] = a[i];
                width[tt] = cnt + <span style="color: #009F9F;">1</span>;
            }

        }
        printf(<span style="color: #FC9F4E;">"%lld\n"</span>, res);
    }
    <span style="color: #BD93F9;">return</span> <span style="color: #009F9F;">0</span>;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb877c6f" class="outline-2">
<h2 id="orgb877c6f">最大子矩阵问题</h2>
<div class="outline-text-2" id="text-orgb877c6f">
<p>
最大矩子阵可以用单调栈解决，这里有道最大子矩阵的题目 <a href="https://www.luogu.com.cn/problem/P4147">玉蟾宫</a> ，题目要求找到全是 <code>'F'</code> 的最大子矩阵。<br>
</p>

<p>
非常简单，新建一个二维数组 \(pos\)，每个位置对应输入的图的位置。如果图中这个位置为 <code>'R'</code> \(pos\)中存 \(0\) ；如果这个位置为 <code>'F'</code> ，这个位置存储当前位置与同一列前几行 <code>'F'</code> 的个数，直到遇到一个 <code>'R'</code> 。<br>
</p>

<p>
这样我们就得到了 \(n\) 行直方图，对每一行进行上面的单调栈操作，得到最大子矩形。下图就是是第四行的"直方图"。<br>
</p>

<img src="./images/玉蟾宫.png" />
</div>

<div id="outline-container-orge6a0d8d" class="outline-3">
<h3 id="orge6a0d8d">AC代码：</h3>
<div class="outline-text-3" id="text-orge6a0d8d">
<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #009F9F;">#include</span> <span style="color: #FC9F4E;">&lt;cstdio&gt;</span>
<span style="color: #009F9F;">#include</span> <span style="color: #FC9F4E;">&lt;algorithm&gt;</span>
<span style="color: #BD93F9;">using</span> <span style="color: #009F9F;">std</span>::<span style="color: #AFAFAF;">max</span>;
<span style="color: #BD93F9;">const</span> <span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">maxn</span> = <span style="color: #009F9F;">1e3</span> + <span style="color: #009F9F;">5</span>;
<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">n</span>, <span style="color: #AFAFAF;">m</span>;

<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">stk</span>[maxn];
<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">pos</span>[maxn][maxn];
<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">res</span>;

<span style="color: #AFAFAF;">void</span> <span style="color: #AFAFAF;">Monotonous</span>(<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">i</span>) {
    <span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">tt</span> = <span style="color: #009F9F;">0</span>;
    <span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">width</span>[maxn];
    <span style="color: #BD93F9;">for</span> (<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">j</span> = <span style="color: #009F9F;">0</span>; j &lt;= m; ++j) {
        <span style="color: #BD93F9;">if</span> (pos[i][j] &gt;= stk[tt]) {
            stk[++tt] = pos[i][j];
            width[tt] = <span style="color: #009F9F;">1</span>;
        }
        <span style="color: #BD93F9;">else</span> {
            <span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">cnt</span> = <span style="color: #009F9F;">0</span>;
            <span style="color: #BD93F9;">while</span> (tt &amp;&amp; stk[tt] &gt; pos[i][j]) {
                cnt += width[tt];
                res = max(res, cnt * stk[tt]);
                tt--;
            }
            stk[++tt] = pos[i][j];
            width[tt] = cnt + <span style="color: #009F9F;">1</span>;
        }
    }
}

<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">main</span>() {
    scanf(<span style="color: #FC9F4E;">"%d %d"</span>, &amp;n, &amp;m);
    <span style="color: #BD93F9;">for</span> (<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">i</span> = <span style="color: #009F9F;">0</span>; i &lt; n; ++i) {
        <span style="color: #BD93F9;">for</span> (<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">j</span> = <span style="color: #009F9F;">0</span>; j &lt; m; ++j) {
            <span style="color: #AFAFAF;">char</span> <span style="color: #AFAFAF;">ch</span> = <span style="color: #FC9F4E;">' '</span>;
            <span style="color: #BD93F9;">while</span> (ch == <span style="color: #FC9F4E;">' '</span> || ch == <span style="color: #FC9F4E;">'\n'</span>)
                scanf(<span style="color: #FC9F4E;">"%c"</span>, &amp;ch);

            <span style="color: #BD93F9;">if</span> (ch == <span style="color: #FC9F4E;">'F'</span> &amp;&amp; i)
                pos[i][j] = pos[i-<span style="color: #009F9F;">1</span>][j] + <span style="color: #009F9F;">1</span>;
            <span style="color: #BD93F9;">else</span> <span style="color: #BD93F9;">if</span> (ch == <span style="color: #FC9F4E;">'F'</span>)
                pos[i][j] = <span style="color: #009F9F;">1</span>;
        }
        pos[i][m] = <span style="color: #009F9F;">0</span>;  <span style="color: #7c7c7c; font-style: italic;">// </span><span style="color: #7c7c7c; font-style: italic;">&#21333;&#35843;&#26632;&#35201;&#26368;&#21518;&#37117;pop&#20986;&#26469;</span>
    }

    <span style="color: #009F9F; font-style: italic;">/**</span>
<span style="color: #009F9F; font-style: italic;">     * &#23545;&#20110;&#26368;&#21518;&#19968;&#34892;&#65292;&#19981;&#23601;&#26159;&#36825;&#26679;&#19968;&#20010;&#30452;&#26041;&#22270;&#21527;</span>
<span style="color: #009F9F; font-style: italic;">     *</span>
<span style="color: #009F9F; font-style: italic;">     *             __ __ __</span>
<span style="color: #009F9F; font-style: italic;">     *            |  |  |  |</span>
<span style="color: #009F9F; font-style: italic;">     *            |  |  |  |</span>
<span style="color: #009F9F; font-style: italic;">     *    __ __ __|  |  |  |</span>
<span style="color: #009F9F; font-style: italic;">     *   |  |  |  |  |  |  |</span>
<span style="color: #009F9F; font-style: italic;">     *   |__|__|__|__|__|__|</span>
<span style="color: #009F9F; font-style: italic;">     */</span>
    <span style="color: #BD93F9;">for</span> (<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">i</span> = <span style="color: #009F9F;">0</span>; i &lt; n; ++i)
        Monotonous(i);
    printf(<span style="color: #FC9F4E;">"%d\n"</span>, res * <span style="color: #009F9F;">3</span>);
    <span style="color: #BD93F9;">return</span> <span style="color: #009F9F;">0</span>;
}
</pre>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
