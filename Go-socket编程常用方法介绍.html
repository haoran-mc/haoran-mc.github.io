<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-06-24 Fri 15:32 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>socket编程系列</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran">
<meta name="description" content="Copyright © 2022, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="content">
<h1 class="title">socket编程系列</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org57d3647">type TCPAddr</a>
<ul>
<li><a href="#orgcf5e77d">func ResolveTCPAddr</a></li>
</ul>
</li>
<li><a href="#orgf5791e7">type Listener</a></li>
</ul>
</div>
</div>

<div id="outline-container-org57d3647" class="outline-2">
<h2 id="org57d3647">type TCPAddr</h2>
<div class="outline-text-2" id="text-org57d3647">
<p>
TCPAddr 是一个包含 IP 和 port 的 <code>struct</code> ，其定义在 tcpsock.go 文件中。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">TCPAddr</span> <span style="color: #268bd2; font-weight: bold;">struct</span> {
        IP   <span style="color: #df005f; font-weight: bold;">IP</span>
        Port <span style="color: #df005f; font-weight: bold;">int</span>
        Zone <span style="color: #df005f; font-weight: bold;">string</span> <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">IPv6&#33539;&#22260;&#23547;&#22336;&#22495;</span>
}
</pre>
</div>

<p>
常用的方法有：<br>
</p>
</div>
<div id="outline-container-orgcf5e77d" class="outline-3">
<h3 id="orgcf5e77d">func ResolveTCPAddr</h3>
<div class="outline-text-3" id="text-orgcf5e77d">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">ResolveTCPAddr</span>(<span style="color: #8787d7;">net</span>, <span style="color: #8787d7;">addr</span> <span style="color: #df005f; font-weight: bold;">string</span>) (*<span style="color: #df005f; font-weight: bold;">TCPAddr</span>, <span style="color: #df005f; font-weight: bold;">error</span>)
</pre>
</div>

<p>
通过输入 net 和 addr 来创建一个 TCPAddr。<br>
</p>

<ul class="org-ul">
<li><code>net</code> 为 <code>tcp</code> 、 <code>tcp4</code> 、 <code>tcp6</code> 的一种，默认是 <code>tcp</code> ；<br></li>
<li><code>addr</code> 是类似 "google.com:80" 或者 "127.0.0.1:80" 的字符串；<br></li>
</ul>

<p>
码源：<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">ResolveTCPAddr</span>(<span style="color: #8787d7;">net</span>, <span style="color: #8787d7;">addr</span> <span style="color: #df005f; font-weight: bold;">string</span>) (*<span style="color: #df005f; font-weight: bold;">TCPAddr</span>, <span style="color: #df005f; font-weight: bold;">error</span>) {
    <span style="color: #268bd2; font-weight: bold;">switch</span> net {
    <span style="color: #268bd2; font-weight: bold;">case</span> <span style="color: #2aa198;">"tcp"</span>, <span style="color: #2aa198;">"tcp4"</span>, <span style="color: #2aa198;">"tcp6"</span>:
    <span style="color: #268bd2; font-weight: bold;">case</span> <span style="color: #2aa198;">""</span>: <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">a hint wildcard for Go 1.0 undocumented behavior</span>
        net = <span style="color: #2aa198;">"tcp"</span>
    <span style="color: #268bd2; font-weight: bold;">default</span>:
        <span style="color: #268bd2; font-weight: bold;">return</span> <span style="color: #d75fd7;">nil</span>, <span style="color: #d75fd7; font-weight: bold;">UnknownNetworkError</span>(net)
    }
    <span style="color: #8787d7;">a</span>, <span style="color: #8787d7;">err</span> := <span style="color: #d75fd7; font-weight: bold;">resolveInternetAddr</span>(net, addr, noDeadline)
    <span style="color: #268bd2; font-weight: bold;">if</span> err != <span style="color: #d75fd7;">nil</span> {
        <span style="color: #268bd2; font-weight: bold;">return</span> <span style="color: #d75fd7;">nil</span>, err
    }
    <span style="color: #268bd2; font-weight: bold;">return</span> a.<span style="color: #d75fd7; font-weight: bold;">toAddr</span>().(*<span style="color: #df005f; font-weight: bold;">TCPAddr</span>), <span style="color: #d75fd7;">nil</span>
} 
</pre>
</div>

<p>
如何使用 <code>ResolveTCPAddr</code> ：<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">package</span> main

<span style="color: #268bd2; font-weight: bold;">import</span> (
    <span style="color: #2aa198;">"fmt"</span>
    <span style="color: #2aa198;">"net"</span>
)

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #8787d7;">addr</span> := <span style="color: #2aa198;">"www.baidu.com:80"</span>
    <span style="color: #8787d7;">tcpaddr</span>, <span style="color: #8787d7;">_</span> := net.<span style="color: #d75fd7; font-weight: bold;">ResolveTCPAddr</span>(<span style="color: #2aa198;">"tcp"</span>, addr) <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#19982;&#30334;&#24230;&#24314;&#31435; TCP &#36830;&#25509;</span>

    fmt.<span style="color: #d75fd7; font-weight: bold;">Println</span>(<span style="color: #2aa198;">"tcpaddr: "</span>, tcpaddr) <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#36825;&#20010;&#24314;&#31435;&#30340;&#36830;&#25509;&#26159;&#20160;&#20040;&#65311;</span>

    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#21487;&#20197;&#36890;&#36807; tcpaddr &#25343;&#21040; ip:port</span>
    fmt.<span style="color: #d75fd7; font-weight: bold;">Println</span>(<span style="color: #2aa198;">"IP: "</span>, tcpaddr.IP.<span style="color: #d75fd7; font-weight: bold;">String</span>())
    fmt.<span style="color: #d75fd7; font-weight: bold;">Println</span>(<span style="color: #2aa198;">"Port: "</span>, tcpaddr.Port)

    <span style="color: #008787; background-color: #262626;">/*</span>
<span style="color: #008787; background-color: #262626;">        fmt.Printf("typeof(addr): %T\n", addr)</span>
<span style="color: #008787; background-color: #262626;">        fmt.Printf("typeof(tcpaddr): %T\n", tcpaddr)</span>
<span style="color: #008787; background-color: #262626;">        fmt.Println("sizeof(addr): ", unsafe.Sizeof(addr))</span>
<span style="color: #008787; background-color: #262626;">        fmt.Println("sizeof(tcpaddr): ", unsafe.Sizeof(tcpaddr))</span>
<span style="color: #008787; background-color: #262626;">        fmt.Println("len(addr): ", len(addr))</span>
<span style="color: #008787; background-color: #262626;">        fmt.Println("len(tcpaddr): ", len(tcpaddr.String()))</span>
<span style="color: #008787; background-color: #262626;">    */</span>
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf5791e7" class="outline-2">
<h2 id="orgf5791e7">type Listener</h2>
<div class="outline-text-2" id="text-orgf5791e7">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">Listener</span> <span style="color: #268bd2; font-weight: bold;">interface</span> {
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">Addr&#36820;&#22238;&#35813;&#25509;&#21475;&#30340;&#32593;&#32476;&#22320;&#22336;</span>
    <span style="color: #d75fd7; font-weight: bold;">Addr</span>() <span style="color: #df005f; font-weight: bold;">Addr</span>
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">Accept&#31561;&#24453;&#24182;&#36820;&#22238;&#19979;&#19968;&#20010;&#36830;&#25509;&#21040;&#35813;&#25509;&#21475;&#30340;&#36830;&#25509;</span>
    <span style="color: #d75fd7; font-weight: bold;">Accept</span>() (<span style="color: #8787d7;">c</span> <span style="color: #df005f; font-weight: bold;">Conn</span>, <span style="color: #8787d7;">err</span> <span style="color: #df005f; font-weight: bold;">error</span>)
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">Close&#20851;&#38381;&#35813;&#25509;&#21475;&#65292;&#24182;&#20351;&#20219;&#20309;&#38459;&#22622;&#30340;Accept&#25805;&#20316;&#37117;&#20250;&#19981;&#20877;&#38459;&#22622;&#24182;&#36820;&#22238;&#38169;&#35823;&#12290;</span>
    <span style="color: #d75fd7; font-weight: bold;">Close</span>() <span style="color: #df005f; font-weight: bold;">error</span>
}
</pre>
</div>

<p>
TCPListener 是一个 TCP 网络监听器，通常在服务端监听客户端发来的请求。其类型定义在 tcpsock.go 文件中。其本质是个网络文件描述符，与 TCPConn 类型一样。<br>
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: L.M.haoran</p>
<p class="date">Created: 2022-06-24 Fri 15:32</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
