<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-12-06 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CLICKHOUSE-下载、安装、运行</title>
<meta name="author" content="Haoran Liu" />
<meta name="description" content="Copyright © 2022, Haoran Liu, all rights reserved." />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="static/css/org.css"/>
</head>
<body>
<div id="content" class="content">
<h1 class="title">CLICKHOUSE-下载、安装、运行</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgab6f36a">什么是 ClickHouse</a></li>
<li><a href="#orgef2283c">下载、安装、运行</a></li>
<li><a href="#orgbe44d0e">导入数据</a></li>
<li><a href="#org4e1f11d">连接 ClickHouse Server</a></li>
<li><a href="#orgdadfb82">在 Docker 中运行 ClickHouse</a></li>
<li><a href="#org59bd049">使用 Datagrip 连接 clickhouse</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgab6f36a" class="outline-2">
<h2 id="orgab6f36a">什么是 ClickHouse</h2>
</div>
<div id="outline-container-orgef2283c" class="outline-2">
<h2 id="orgef2283c">下载、安装、运行</h2>
<div class="outline-text-2" id="text-orgef2283c">
<ol class="org-ol">
<li><p>
下载官方编译好的 ClickHouse<br>
</p>
<div class="org-src-container">
<pre class="src src-bash">$ curl -O <span style="color: #79D836;">'https://builds.clickhouse.tech/master/macos/clickhouse'</span> &amp;&amp; chmod a+x ./clickhouse
</pre>
</div></li>

<li><p>
下载 server 配置文件<br>
</p>
<div class="org-src-container">
<pre class="src src-bash">$ curl -O https://github.com/ClickHouse/ClickHouse/raw/master/programs/server/config.xml
</pre>
</div></li>

<li><p>
下载 users 配置文件<br>
</p>
<div class="org-src-container">
<pre class="src src-bash">$ curl -O https://github.com/ClickHouse/ClickHouse/raw/master/programs/server/users.xml
</pre>
</div></li>

<li><p>
运行 server<br>
</p>
<div class="org-src-container">
<pre class="src src-bash">$ sudo ./clickhouse server
</pre>
</div></li>

<li><p>
运行客户端<br>
</p>
<div class="org-src-container">
<pre class="src src-bash">$ ./clickhouse client --version
ClickHouse client version 21.3.1.6016 (official build).
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-orgbe44d0e" class="outline-2">
<h2 id="orgbe44d0e">导入数据</h2>
<div class="outline-text-2" id="text-orgbe44d0e">
<ol class="org-ol">
<li><p>
建表<br>
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #D83441;">CREATE</span>  <span style="color: #D83441;">table</span> <span style="color: #D8B941;">sales</span>  (
`Region` text <span style="color: #D83441;">NULL</span>,
`Country` text <span style="color: #D83441;">NULL</span>,
`Item <span style="color: #D83441;">Type</span>` text <span style="color: #D83441;">NULL</span>,
`Sales Channel` text <span style="color: #D83441;">NULL</span>,
`<span style="color: #D83441;">Order</span> Priority` text <span style="color: #D83441;">NULL</span>,
`<span style="color: #D83441;">Order</span> <span style="color: #3679D8;">Date</span>` DateTime <span style="color: #D83441;">NULL</span>,
`<span style="color: #D83441;">Order</span> ID` Int8 <span style="color: #D83441;">NULL</span>,
`Ship <span style="color: #3679D8;">Date</span>` DateTime <span style="color: #D83441;">NULL</span>,
`Units Sold` Int8 <span style="color: #D83441;">NULL</span>,
`Unit Price` <span style="color: #3679D8;">FLOAT</span> <span style="color: #D83441;">NULL</span>,
`Unit Cost` <span style="color: #3679D8;">FLOAT</span> <span style="color: #D83441;">NULL</span>,
`Total Revenue` <span style="color: #3679D8;">FLOAT</span> <span style="color: #D83441;">NULL</span>,
`Total Cost` <span style="color: #3679D8;">FLOAT</span> <span style="color: #D83441;">NULL</span>,
`Total Profit` <span style="color: #3679D8;">FLOAT</span> <span style="color: #D83441;">NULL</span>
) ENGINE = Log
</pre>
</div></li>

<li><p>
导入数据<br>
</p>
<div class="org-src-container">
<pre class="src src-bash">gzcat /data/sales_5m.csv.gz  <span style="color: #79D836;">\</span>
  |/opt/clickhouse/clickhouse  client -d default  --format_csv_delimiter=<span style="color: #79D836;">","</span> <span style="color: #79D836;">\</span>
  --date_time_input_format=best_effort<span style="color: #79D836;">\</span>
  -q <span style="color: #79D836;">'INSERT into sales FORMAT CSVWithNames'</span>
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-org4e1f11d" class="outline-2">
<h2 id="org4e1f11d">连接 ClickHouse Server</h2>
<div class="outline-text-2" id="text-org4e1f11d">
<ol class="org-ol">
<li><p>
直接执行语句，然后退出<br>
</p>
<div class="org-src-container">
<pre class="src src-bash">$ ./clickhouse client -d default <span style="color: #79D836;">\</span>
  -q <span style="color: #79D836;">'select Region,Country,count(1) as cnt from sales group by Region,Country'</span>
</pre>
</div></li>

<li><p>
交互模式<br>
</p>
<div class="org-src-container">
<pre class="src src-bash">$ ./clickhouse client -d default
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-orgdadfb82" class="outline-2">
<h2 id="orgdadfb82">在 Docker 中运行 ClickHouse</h2>
<div class="outline-text-2" id="text-orgdadfb82">
<div class="org-src-container">
<pre class="src src-bash">$ docker run -d --name clickhouse-server -p 8123:8123 -p 9000:9000 <span style="color: #79D836;">\</span>
  --ulimit <span style="color: #86e7d7;">nofile</span>=262144:262144 yandex/clickhouse-server
</pre>
</div>

<p>
更多设置，参考 Docker Hub 上的指南。<br>
</p>
</div>
</div>
<div id="outline-container-org59bd049" class="outline-2">
<h2 id="org59bd049">使用 Datagrip 连接 clickhouse</h2>
<div class="outline-text-2" id="text-org59bd049">
<ul class="org-ul">
<li>Host: 127.0.0.1<br></li>
<li>Port: 8123<br></li>
<li>User: default<br></li>
<li>Password: 空<br></li>
<li>Database: default<br></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2022-12-06 01:12 Tue</p>
<p class="author">Author: Haoran Liu</p>
<p class="date">Created: 2022-12-06</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
