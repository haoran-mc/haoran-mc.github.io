<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2021-10-05 二 14:41 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>EDITOR-EMACS-自定义函数</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran &lt;haoran.mc@outlook.com&gt;">
<meta name="description" content="Copyright © 2021, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="content">
<h1 class="title">EDITOR-EMACS-自定义函数</h1>
<ul class="org-ul">
<li>"after" macro definition after宏可以指定加载某些插件后自动运行一段特定的代码<br></li>
</ul>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #BD93F9;">if</span> (fboundp 'with-eval-after-load)
    (<span style="color: #BD93F9;">defmacro</span> <span style="color: #AFAFAF;">after</span> (feature <span style="color: #AFAFAF;">&amp;rest</span><span style="color: #7c7c7c; font-style: italic;">; </span><span style="color: #7c7c7c; font-style: italic;">body)</span>
                             <span style="color: #FC9F4E;">"After FEATURE is loaded, evaluate BODY."</span>
                             (<span style="color: #BD93F9;">declare</span> (indent defun))
                             `(<span style="color: #BD93F9;">with-eval-after-load</span> ,feature ,@body))
      (<span style="color: #BD93F9;">defmacro</span> <span style="color: #AFAFAF;">after</span> (feature <span style="color: #AFAFAF;">&amp;rest</span><span style="color: #7c7c7c; font-style: italic;">; </span><span style="color: #7c7c7c; font-style: italic;">body)</span>
                               <span style="color: #FC9F4E;">"After FEATURE is loaded, evaluate BODY."</span>
                               (<span style="color: #BD93F9;">declare</span> (indent defun))
                               `(eval-after-load ,feature
                                  '(<span style="color: #BD93F9;">progn</span> ,@body))))))
</pre>
</div>

<ul class="org-ul">
<li>得到字体宽度<br></li>
</ul>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #BD93F9;">defun</span> <span style="color: #AFAFAF;">default-font-width</span> () 
  <span style="color: #009F9F; font-style: italic;">"Return the width in pixels of a character in the current</span>
<span style="color: #009F9F; font-style: italic;">window's default font.  More precisely, this returns the</span>
<span style="color: #009F9F; font-style: italic;">width of the letter &#8216;m&#8217;.  If the font is mono-spaced, this</span>
<span style="color: #009F9F; font-style: italic;">will also be the width of all other printable characters."</span>
  (<span style="color: #BD93F9;">let</span> ((window (selected-window))
  (<span style="color: #BD93F9;">let</span> ((window (selected-window))
  (<span style="color: #BD93F9;">let</span> ((window (selected-window))
  (<span style="color: #BD93F9;">let</span> ((window (selected-window))
        (remapping face-remapping-alist))
    (<span style="color: #BD93F9;">with-temp-buffer</span>
      (make-local-variable 'face-remapping-alist)
      (<span style="color: #BD93F9;">setq</span> face-remapping-alist remapping)
      (set-window-buffer window (current-buffer))
      (insert <span style="color: #FC9F4E;">"m"</span>)
      (aref (aref (font-get-glyphs (font-at <span style="color: #009F9F;">1</span>) <span style="color: #009F9F;">1</span> <span style="color: #009F9F;">2</span>) <span style="color: #009F9F;">0</span>) <span style="color: #009F9F;">4</span>))))

</pre>
</div>

<ul class="org-ul">
<li>给指定文件添加模式<br></li>
</ul>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #7c7c7c; font-style: italic;">;;</span><span style="color: #7c7c7c; font-style: italic;">&#31616;&#26131;&#30340;&#65292;&#21482;&#33021;&#20026;&#25351;&#23450;&#30340;&#25991;&#20214;&#22788;&#29702;&#20026;&#21482;&#35835;</span>
(<span style="color: #BD93F9;">define-derived-mode</span> <span style="color: #AFAFAF;">org-read-only-mode</span> org-mode <span style="color: #FC9F4E;">"Org + read-only"</span>
  <span style="color: #009F9F; font-style: italic;">"Major mode for readonly org file."</span>
  (read-only-mode <span style="color: #009F9F;">1</span>))
(add-to-list 'auto-mode-alist '(<span style="color: #FC9F4E;">"\\FILE.org\\'"</span> . org-read-only-mode))

<span style="color: #7c7c7c; font-style: italic;">;;</span><span style="color: #7c7c7c; font-style: italic;">&#32479;&#19968;&#22788;&#29702;&#65292;&#35774;&#32622;&#20102;&#19968;&#20010;&#38057;&#23376;</span>
(<span style="color: #BD93F9;">defvar</span> <span style="color: #AFAFAF;">read-only-file-list</span>
  (list (expand-file-name <span style="color: #FC9F4E;">"~/test.org"</span>)))
(<span style="color: #BD93F9;">defun</span> <span style="color: #AFAFAF;">enable-read-only-fn</span> ()
  (<span style="color: #BD93F9;">when</span> (member (expand-file-name (buffer-file-name)) read-only-file-list)
    (read-only-mode <span style="color: #009F9F;">1</span>)))
(add-hook 'find-file-hook #'enable-read-only-fn)
</pre>
</div>

<ul class="org-ul">
<li>更改C++代码缩进<br></li>
</ul>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #BD93F9;">defun</span> <span style="color: #AFAFAF;">sl-toggle-tab-width-setting</span> ()
  <span style="color: #009F9F; font-style: italic;">"Toggle setting tab widths between 4 and 8."</span>
  (<span style="color: #BD93F9;">interactive</span>)
  (<span style="color: #BD93F9;">setq-local</span> tab-width (<span style="color: #BD93F9;">case</span> tab-width (<span style="color: #009F9F;">2</span> <span style="color: #009F9F;">4</span>) (<span style="color: #009F9F;">4</span> <span style="color: #009F9F;">8</span>) (<span style="color: #009F9F;">8</span> <span style="color: #009F9F;">2</span>)))
  (<span style="color: #BD93F9;">setq-local</span> c-basic-offset tab-width)
  (redraw-display)
  (message <span style="color: #FC9F4E;">"tab-width is %s now"</span> tab-width))
</pre>
</div>

<ul class="org-ul">
<li>C++注释<br></li>
</ul>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(eval-after-load 'hideshow
  '(<span style="color: #BD93F9;">progn</span>
     (<span style="color: #BD93F9;">declare-function</span> 'hs-already-hidden-p <span style="color: #FC9F4E;">"hideshow"</span>)
     (<span style="color: #BD93F9;">declare-function</span> 'hs-show-all <span style="color: #FC9F4E;">"hideshow"</span>)
     (<span style="color: #BD93F9;">declare-function</span> 'hs-hide-all <span style="color: #FC9F4E;">"hideshow"</span>)
     (<span style="color: #BD93F9;">defun</span> <span style="color: #AFAFAF;">sl-toggle-hideshow-all</span> ()
       <span style="color: #009F9F; font-style: italic;">"Toggle hideshow all."</span>
       (<span style="color: #BD93F9;">interactive</span>)
       (<span style="color: #BD93F9;">hs-life-goes-on</span>
        (<span style="color: #BD93F9;">if</span> (hs-already-hidden-p)
            (hs-show-all)
          (hs-hide-all))))

     (define-key-after
       hs-minor-mode-menu
       [\(SL\)Toggle\ Show/Hide\ all]
       '(menu-item <span style="color: #FC9F4E;">"(SL)Toggle Show/Hide all..."</span> sl-toggle-hideshow-all
                   <span style="color: #AFAFAF;">:help</span> <span style="color: #FC9F4E;">"Toggle Show/Hide all in current buffer.."</span>)
       'Toggle\ Hiding)

     (define-key hs-minor-mode-map (kbd <span style="color: #FC9F4E;">"C-M-;"</span>) 'sl-toggle-hideshow-all)
     (define-key hs-minor-mode-map (kbd <span style="color: #FC9F4E;">"C-l ;"</span>) 'hs-toggle-hiding)))
</pre>
</div>

<ul class="org-ul">
<li>C++设置<br></li>
</ul>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'c-mode-common-hook
          (<span style="color: #BD93F9;">lambda</span> ()
            <span style="color: #7c7c7c; font-style: italic;">;; </span><span style="color: #7c7c7c; font-style: italic;">c/c++ common settings</span>
            (<span style="color: #BD93F9;">declare-function</span> c-toggle-hungry-state <span style="color: #FC9F4E;">"cc-cmds"</span>)
            (c-toggle-hungry-state <span style="color: #009F9F;">1</span>)
            <span style="color: #7c7c7c; font-style: italic;">;; </span><span style="color: #7c7c7c; font-style: italic;">(c-toggle-auto-hungry-state 1) ; hungry-delete and auto-newline</span>
            <span style="color: #7c7c7c; font-style: italic;">;; </span><span style="color: #7c7c7c; font-style: italic;">(c-set-offset 'case-label '+) ; indent the case</span>

            <span style="color: #7c7c7c; font-style: italic;">;; </span><span style="color: #7c7c7c; font-style: italic;">for c++11 as default</span>
            (<span style="color: #BD93F9;">when</span> (eq major-mode 'c++-mode)
              (<span style="color: #BD93F9;">when</span> (boundp 'company-clang-arguments)
                (<span style="color: #BD93F9;">setq-local</span> company-clang-arguments (add-to-list 'company-clang-arguments <span style="color: #FC9F4E;">"--std=c++11"</span>))))
            ))
</pre>
</div>
</div>
</body>
</html>
