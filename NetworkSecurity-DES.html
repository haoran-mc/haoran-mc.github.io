<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-06-10 Fri 22:11 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DES</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran">
<meta name="description" content="Copyright © 2022, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="static/MathJax/MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<div id="content">
<h1 class="title">DES</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org450fc80">什么是 DES</a></li>
<li><a href="#org6fb3d99">DES 整体流程</a></li>
<li><a href="#org32f0553">DES 算法实现过程</a>
<ul>
<li><a href="#orgefb34a4">将不足 64 位的明文扩展到 64 位</a></li>
<li><a href="#orgb42aee4">IP 置换</a></li>
<li><a href="#org713bec5">16 轮迭代</a>
<ul>
<li><a href="#org57e7771">0. 密钥生成</a></li>
<li><a href="#orge204a70">1. E 扩展置换</a></li>
<li><a href="#org0be7f62">2. 密钥异或</a></li>
<li><a href="#orgfe4dc28">3. S 盒压缩处理</a></li>
<li><a href="#orge12a306">4. P 置换</a></li>
</ul>
</li>
<li><a href="#org392f08b">IP 逆置换</a></li>
</ul>
</li>
<li><a href="#org34f3869">具体实现过程，代码部分</a></li>
</ul>
</div>
</div>

<div id="outline-container-org450fc80" class="outline-2">
<h2 id="org450fc80">什么是 DES</h2>
<div class="outline-text-2" id="text-org450fc80">
<p>
DES 算法为密码体制中的对称密码体制，又被称为美国数据加密标准，是 1972 年美国 IBM 公司研制的对称密码体制加密算法。 明文按 64 位进行分组，密钥长 64 位，密钥事实上是 56 位参与 DES 运算（第 8、16、24、32、40、48、56、64 位是校验位， 使得每个密钥都有奇数个 1）分组后的明文组和 56 位的密钥按位替代或交换的方法形成密文组的加密方法。<br>
</p>
</div>
</div>
<div id="outline-container-org6fb3d99" class="outline-2">
<h2 id="org6fb3d99">DES 整体流程</h2>
<div class="outline-text-2" id="text-org6fb3d99">
<p>
DES 算法流程图：<br>
</p>

<div class="div-center">
	<img src="./images/DES算法流程图.webp" />
</div>

<p>
总结为下面几个步骤：<br>
</p>

<div class="div-center">
	<img src="./images/DES算法总体流程.png" width="80%" />
</div>

<ol class="org-ol">
<li>首先将明文填充到 64 位<br></li>
<li>进行初始置换（IP置换）<br></li>
<li>进行 16 轮迭代<br>
<ol class="org-ol">
<li>生成密钥，密钥的有效数据位数是 56 bits，另有 8 个校验位，所以共有 64 bits<br></li>
<li>将 64 bits 的数据分为左右 32 bits 的数据<br></li>
<li>E 扩展置换，将右 32 bits 的数据扩展为 48 bits（因为要和 48 bits 的密钥进行运算）<br></li>
<li>将扩展后 48 bits 的右部分数据和 48 bits 的密钥进行异或运算<br></li>
<li>S 盒压缩处理，将运算后 48 bits 的右数据压缩回 32 bits<br></li>
<li>P 盒置换<br></li>
</ol></li>
<li>进行最终置换（IP逆置换）<br></li>
</ol>
</div>
</div>
<div id="outline-container-org32f0553" class="outline-2">
<h2 id="org32f0553">DES 算法实现过程</h2>
<div class="outline-text-2" id="text-org32f0553">
</div>
<div id="outline-container-orgefb34a4" class="outline-3">
<h3 id="orgefb34a4">将不足 64 位的明文扩展到 64 位</h3>
</div>
<div id="outline-container-orgb42aee4" class="outline-3">
<h3 id="orgb42aee4">IP 置换</h3>
<div class="outline-text-3" id="text-orgb42aee4">
<p>
初始置换规则如下：<br>
</p>

<pre class="example">
58,50,42,34,26,18,10,2,
60,52,44,36,28,20,12,4,
62,54,46,38,30,22,14,6,
64,56,48,40,32,24,16,8,
57,49,41,33,25,17, 9,1,
59,51,43,35,27,19,11,3,
61,53,45,37,29,21,13,5,
63,55,47,39,31,23,15,7,
</pre>

<p>
这里的数字表示的是原数据的位置，按照表格来看，64 位明文的第 58 位将会被置换到第 1 位；第 50 位将会被置换到第 2 位；第 42 位将会被置换到第 3 位&#x2026;&#x2026;；最后一位是原来的第 7 位。<br>
</p>

<div class="div-center">
	<img src="./images/DES算法-初始置换示例.png" />
</div>

<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">IP table</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">IP</span>[64] = {
    58, 50, 42, 34, 26, 18, 10, 2,
    60, 52, 44, 36, 28, 20, 12, 4,
    62, 54, 46, 38, 30, 22, 14, 6,
    64, 56, 48, 40, 32, 24, 16, 8,
    57, 49, 41, 33, 25, 17, 9, 1,
    59, 51, 43, 35, 27, 19, 11, 3,
    61, 53, 45, 37, 29, 21, 13, 5,
    63, 55, 47, 39, 31, 23, 15, 7};

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#23558; x &#20108;&#36827;&#21046;&#34920;&#31034;&#30340;&#31532; i &#20301;&#26356;&#25913;&#20026; y &#20108;&#36827;&#21046;&#34920;&#31034;&#30340;&#31532; j &#20301;</span>
<span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7; font-weight: bold;">exbit</span>(<span style="color: #df005f; font-weight: bold;">ll</span> &amp;<span style="color: #8787d7;">x</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span>, <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">y</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">j</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">len</span>) {
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">1. &#23558; x &#30340;&#31532; i &#20301;&#36171;&#20540; 0</span>
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">2. &#33719;&#21462; y &#30340; &#31532; j &#20301;&#19982; x &#30340;&#31532; i &#20301;&#36827;&#34892; | &#25805;&#20316;</span>
    i = len - 1 - i;
    j = len - 1 - j;
    x &amp;= ~(1LL &lt;&lt; i);
    x |= ((y &gt;&gt; j) &amp; 1) &lt;&lt; i;
}

<span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">initial permutation</span><span style="color: #008787; background-color: #262626;">*/</span>
<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#21442;&#25968;&#26159;&#26126;&#25991;&#65292;&#19968;&#20010; 64 &#20301;&#30340;&#38271;&#25972;&#22411;&#21464;&#37327;</span>
<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #d75fd7; font-weight: bold;">initial_permutation</span>(<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">plain</span>) {
    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">ipm</span> = 0;
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 64; i ++ ) {
        exbit(ipm, i, plain, IP[i] - 1, 64);
    }
    <span style="color: #268bd2; font-weight: bold;">return</span> ipm;
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org713bec5" class="outline-3">
<h3 id="org713bec5">16 轮迭代</h3>
<div class="outline-text-3" id="text-org713bec5">
<p>
经过初始置换后，进行 16 轮完全相同的运算，在运算过程总数据与密钥结合。函数 \(f\) 的输出经过一个异或运算，和左半部分结合形成新的右半部分，原来的右半部分成为新的左半部分。每轮迭代的过程可以表示如下：<br>
</p>

<ul class="org-ul">
<li>\(L_n = R_{n-1}\)<br></li>
<li>\(R_n = L_{n-1} \oplus f(R_{n-1}, k_{n-1})\)<br></li>
</ul>

<p>
\(k_n\) 是向第 \(n\) 层输入的 48 位密钥，\(f\) 的返回值是一个 32 位数。<br>
</p>
</div>
<div id="outline-container-org57e7771" class="outline-4">
<h4 id="org57e7771">0. 密钥生成</h4>
<div class="outline-text-4" id="text-org57e7771">
<p>
DES 算法由 64 位秘钥产生 16 轮的 48 位子秘钥。在每一轮的迭代过程中，使用不同的子秘钥。<br>
</p>

<p>
（1）把密钥的奇偶校验位忽略不参与计算（即每个字节的第 8 位），将 64 位密钥降至 56 位，然后选择 PC-1 置换规则将这 56 位分成两块 C0（28位）和 D0（28位）；<br>
（2）将 C0 和 D0 进行循环左移变化（每轮循环左移的位数由轮数决定），变换后生成 C1 和 D1，然后 C1 和 D1 合并，并通过 PC-2 置换规则生成子密钥 K1（48位）；<br>
（3）C1 和 D1 再次经过循环左移变换，生成 C2 和 D2，然后 C2 和 D2 合并，通过 选择 PC-2 置换规则生成密钥 K2（48位）；<br>
（4）以此类推，得到 K16（48位）。但是最后一轮的左右两部分不交换，而是直接合并在一起 R16 L16，作为逆置换的输入块。其中循环左移的位数一共是循环左移 16 次，其中第一次、第二次、第九次、第十六次是循环左移一位，其他都是左移两位；<br>
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">PC1 compress permutation</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">PC1</span>[56] = {
    57, 49, 41, 33, 25, 17, 9,
    1, 58, 50, 42, 34, 26, 18,
    10, 2, 59, 51, 43, 35, 27,
    19, 11, 3, 60, 52, 44, 36,
    63, 55, 47, 39, 31, 23, 15,
    7, 62, 54, 46, 38, 30, 22,
    14, 6, 61, 53, 45, 37, 29,
    21, 13, 5, 28, 20, 12, 4};

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">key shift</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">keyoffset</span>[16] = {
    1, 1, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 1};

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">PC2 compress permutation</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">PC2</span>[48] = {
    14, 17, 11, 24, 1, 5,
    3, 88, 15, 6, 21, 10,
    23, 19, 12, 4, 26, 8,
    16, 7, 27, 20, 13, 2,
    41, 52, 31, 37, 47, 55,
    30, 40, 51, 45, 33, 48,
    44, 49, 39, 56, 34, 53,
    46, 42, 50, 36, 29, 32};

<span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7; font-weight: bold;">leftRotate</span>(<span style="color: #df005f; font-weight: bold;">ll</span> &amp;<span style="color: #8787d7;">x</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">off</span>) {
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#38236;&#20687;</span>
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; off; i ++ ) {
        x &lt;&lt;= 1;
        <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">s</span> = (x &gt;&gt; 28) &amp; 1;
        x &amp;= ~(1LL &lt;&lt; 28);
        x |= s;
    }
}

<span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7; font-weight: bold;">keygen</span>(<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">subkey</span>[], <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">key</span>) {
    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">tmp_key</span> = 0;   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#32463; PC1 &#32622;&#25442;&#24471;&#21040;&#30340;&#23376;&#23494;&#38053;</span>

    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">PC1 &#33293;&#24323;&#26657;&#39564;&#20301;</span>
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 56; i ++ ) {
        exbit(tmp_key, i, key, PC1[i] - 1, 56);
    }

    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">l</span> = tmp_key &gt;&gt; 28;         <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">left  C0</span>
    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">r</span> = tmp_key - (l &lt;&lt; 28);   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">right D0</span>

    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">key shift</span>
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 16; i ++ ) {
        leftRotate(l, keyoffset[i]);
        leftRotate(r, keyoffset[i]);

        tmp_key = (l &lt;&lt; 28) | r;

        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">PC2</span>
        <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">tmp_subkey</span> = 0;
        <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 48; i ++ ) {
            exbit(tmp_subkey, i, tmp_key, PC2[i] - 1, 48);
        }
        subkey[i] = tmp_subkey;
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orge204a70" class="outline-4">
<h4 id="orge204a70">1. E 扩展置换</h4>
<div class="outline-text-4" id="text-orge204a70">
<p>
通过扩展置换 E，将数据的右半部分 \(R_n\) 从 32 位扩展到 48 位。<br>
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">extension table</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">ext</span>[48] = {
    32, 1, 2, 3, 4, 5,
    4, 5, 6, 7, 8, 9,
    8, 9, 10, 11, 12, 13,
    12, 13, 14, 15, 16, 17,
    16, 17, 18, 19, 20, 21,
    20, 21, 22, 23, 24, 25,
    24, 25, 26, 27, 28, 29,
    28, 29, 30, 31, 32, 1};

<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #d75fd7; font-weight: bold;">Expand</span>(<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">r</span>) {
    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">t</span>;
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 48; i ++ ) {
        exbit(t, i, r, ext[i] - 1, 48);
    }
    <span style="color: #268bd2; font-weight: bold;">return</span> t;
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org0be7f62" class="outline-4">
<h4 id="org0be7f62">2. 密钥异或</h4>
<div class="outline-text-4" id="text-org0be7f62">
<p>
将扩展后的右半部分数据与密钥异或。<br>
</p>

<div class="org-src-container">
<pre class="src src-cpp">r = r ^ subkey;   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">xor</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfe4dc28" class="outline-4">
<h4 id="orgfe4dc28">3. S 盒压缩处理</h4>
<div class="outline-text-4" id="text-orgfe4dc28">
<p>
\(R_n\) 扩展置换后与子密钥 \(K_n\) 异或以后的结果作为输入块进行 S 盒压缩处理，将 48 位数据压缩成 32 位数据。<br>
</p>

<p>
我们将长为 48 位的右半部分数据分成 8 块，如下：<br>
</p>

<div class="div-center">
	<img src="./images/DES算法-将r分成8块.png" width="620px" />
</div>

<p>
将每块分别使用 S 盒压缩，压缩方法如下（对第 8 块数据使用 S8 盒压缩）：<br>
</p>

<div class="div-center">
	<img src="./images/DES算法-使用S盒压缩.png" width="620px" />
</div>

<p>
下面是各 S 盒：<br>
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">s_box</span>[8][4][16] = {
    {<span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">S1</span><span style="color: #008787; background-color: #262626;">*/</span>
        {14, 4, 13, 1, 2, 15, 11, 8, 3, 10, 6, 12, 5, 9, 0, 7},
        {0, 15, 7, 4, 14, 2, 13, 1, 10, 6, 12, 11, 9, 5, 3, 8},
        {4, 1, 14, 8, 13, 6, 2, 11, 15, 12, 9, 7, 3, 10, 5, 0},
        {15, 12, 8, 2, 4, 9, 1, 7, 5, 11, 3, 14, 10, 0, 6, 13}},
    {<span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">S2</span><span style="color: #008787; background-color: #262626;">*/</span>
        {15, 1, 8, 14, 6, 11, 3, 4, 9, 7, 2, 13, 12, 0, 5, 10},
        {3, 13, 4, 7, 15, 2, 8, 14, 12, 0, 1, 10, 6, 9, 11, 5},
        {0, 14, 7, 11, 10, 4, 13, 1, 5, 8, 12, 6, 9, 3, 2, 15},
        {13, 8, 10, 1, 3, 15, 4, 2, 11, 6, 7, 12, 0, 5, 14, 9}},
    {<span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">S3</span><span style="color: #008787; background-color: #262626;">*/</span>
        {10, 0, 9, 14, 6, 3, 15, 5, 1, 13, 12, 7, 11, 4, 2, 8},
        {13, 7, 0, 9, 3, 4, 6, 10, 2, 8, 5, 14, 12, 11, 15, 1},
        {13, 6, 4, 9, 8, 15, 3, 0, 11, 1, 2, 12, 5, 10, 14, 7},
        {1, 10, 13, 0, 6, 9, 8, 7, 4, 15, 14, 3, 11, 5, 2, 12}},
    {<span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">S4</span><span style="color: #008787; background-color: #262626;">*/</span>
        {7, 13, 14, 3, 0, 6, 9, 10, 1, 2, 8, 5, 11, 12, 4, 15},
        {13, 8, 11, 5, 6, 15, 0, 3, 4, 7, 2, 12, 1, 10, 14, 9},
        {10, 6, 9, 0, 12, 11, 7, 13, 15, 1, 3, 14, 5, 2, 8, 4},
        {3, 15, 0, 6, 10, 1, 13, 8, 9, 4, 5, 11, 12, 7, 2, 14}},
    {<span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">S5</span><span style="color: #008787; background-color: #262626;">*/</span>
        {2, 12, 4, 1, 7, 10, 11, 6, 8, 5, 3, 15, 13, 0, 14, 9},
        {14, 11, 2, 12, 4, 7, 13, 1, 5, 0, 15, 10, 3, 9, 8, 6},
        {4, 2, 1, 11, 10, 13, 7, 8, 15, 9, 12, 5, 6, 3, 0, 14},
        {11, 8, 12, 7, 1, 14, 2, 13, 6, 15, 0, 9, 10, 4, 5, 3}},
    {<span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">S6</span><span style="color: #008787; background-color: #262626;">*/</span>
        {12, 1, 10, 15, 9, 2, 6, 8, 0, 13, 3, 4, 14, 7, 5, 11},
        {10, 15, 4, 2, 7, 12, 9, 5, 6, 1, 13, 14, 0, 11, 3, 8},
        {9, 14, 15, 5, 2, 8, 12, 3, 7, 0, 4, 10, 1, 13, 11, 6},
        {4, 3, 2, 12, 9, 5, 15, 10, 11, 14, 1, 7, 6, 0, 8, 13}},
    {<span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">S7</span><span style="color: #008787; background-color: #262626;">*/</span>
        {4, 11, 2, 14, 15, 0, 8, 13, 3, 12, 9, 7, 5, 10, 6, 1},
        {13, 0, 11, 7, 4, 9, 1, 10, 14, 3, 5, 12, 2, 15, 8, 6},
        {1, 4, 11, 13, 12, 3, 7, 14, 10, 15, 6, 8, 0, 5, 9, 2},
        {6, 11, 13, 8, 1, 4, 10, 7, 9, 5, 0, 15, 14, 2, 3, 12}},
    {<span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">S8</span><span style="color: #008787; background-color: #262626;">*/</span>
        {13, 2, 8, 4, 6, 15, 11, 1, 10, 9, 3, 14, 5, 0, 12, 7},
        {1, 15, 13, 8, 10, 3, 7, 4, 12, 5, 6, 11, 0, 14, 9, 2},
        {7, 11, 4, 1, 9, 12, 14, 2, 0, 6, 10, 13, 15, 3, 5, 8},
        {2, 1, 14, 7, 4, 10, 8, 13, 15, 12, 9, 0, 3, 5, 6, 11}}}; 
</pre>
</div>

<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #d75fd7; font-weight: bold;">S</span>(<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">r</span>) {
    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">t</span>[8] = {0}, <span style="color: #8787d7;">s</span>[8] = {0};
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#25226; r &#20998;&#25104; 8 &#20221;&#65292;&#27599;&#20221; 6 bits</span>
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 8; i ++ ) {
        s[i] = r - (r &gt;&gt; 6 &lt;&lt; 6);
        r &gt;&gt;= 6;

        <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">row</span> = (s[i] &gt;&gt; 5 &lt;&lt; 1) | (s[i] &amp; 1);
        <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">col</span> = (s[i] &amp; (~(1LL &lt;&lt; 6))) &gt;&gt; 1;
        t[i] = s_box[i][row][col];
    }
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 7; i &gt;= 0; i -- ) {
        r = (r &lt;&lt; 4) + t[i];
    }
    <span style="color: #268bd2; font-weight: bold;">return</span> r;
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orge12a306" class="outline-4">
<h4 id="orge12a306">4. P 置换</h4>
<div class="outline-text-4" id="text-orge12a306">
<p>
和初始置换一样，相当于打乱顺序。<br>
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #d75fd7; font-weight: bold;">P</span>(<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">r</span>) {
    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">t</span>;
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 32; i ++ ) {
        exbit(t, i, r, p_box[i] - 1, 32);
    }
    <span style="color: #268bd2; font-weight: bold;">return</span> t;
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org392f08b" class="outline-3">
<h3 id="org392f08b">IP 逆置换</h3>
<div class="outline-text-3" id="text-org392f08b">
<p>
和初始置换的操作一样。<br>
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">final permutation</span><span style="color: #008787; background-color: #262626;">*/</span>
<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #d75fd7; font-weight: bold;">final_permutation</span>(<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">itm</span>) {
    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">cipher</span>;
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 64; i ++ ) {
        exbit(cipher, i, itm, IP_reverse[i] - 1, 64);
    }
    <span style="color: #268bd2; font-weight: bold;">return</span> cipher;
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org34f3869" class="outline-2">
<h2 id="org34f3869">具体实现过程，代码部分</h2>
<div class="outline-text-2" id="text-org34f3869">
<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #d75fd7;">#include</span> <span style="color: #2aa198;">&lt;cstdio&gt;</span>
<span style="color: #d75fd7;">#include</span> <span style="color: #2aa198;">&lt;cstdlib&gt;</span>
<span style="color: #d75fd7;">#include</span> <span style="color: #2aa198;">&lt;cstring&gt;</span>
<span style="color: #268bd2; font-weight: bold;">typedef</span> <span style="color: #df005f; font-weight: bold;">long</span> <span style="color: #df005f; font-weight: bold;">long</span> <span style="color: #df005f; font-weight: bold;">ll</span>;

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">IP table</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">IP</span>[64] = {
    58, 50, 42, 34, 26, 18, 10, 2,
    60, 52, 44, 36, 28, 20, 12, 4,
    62, 54, 46, 38, 30, 22, 14, 6,
    64, 56, 48, 40, 32, 24, 16, 8,
    57, 49, 41, 33, 25, 17, 9, 1,
    59, 51, 43, 35, 27, 19, 11, 3,
    61, 53, 45, 37, 29, 21, 13, 5,
    63, 55, 47, 39, 31, 23, 15, 7};

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">IP reverse</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">IP_reverse</span>[64] = {
    40, 8, 48, 16, 56, 24, 64, 32,
    39, 7, 47, 15, 55, 23, 63, 31,
    38, 6, 46, 14, 54, 22, 62, 30,
    37, 5, 45, 13, 53, 21, 61, 29,
    36, 4, 44, 12, 52, 20, 60, 28,
    35, 3, 43, 11, 51, 19, 59, 27,
    34, 2, 42, 10, 50, 18, 58, 26,
    33, 1, 41, 9, 49, 17, 57, 25};

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">extension table</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">ext</span>[48] = {
    32, 1, 2, 3, 4, 5,
    4, 5, 6, 7, 8, 9,
    8, 9, 10, 11, 12, 13,
    12, 13, 14, 15, 16, 17,
    16, 17, 18, 19, 20, 21,
    20, 21, 22, 23, 24, 25,
    24, 25, 26, 27, 28, 29,
    28, 29, 30, 31, 32, 1};

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">PC1 compress permutation</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">PC1</span>[56] = {
    57, 49, 41, 33, 25, 17, 9,
    1, 58, 50, 42, 34, 26, 18,
    10, 2, 59, 51, 43, 35, 27,
    19, 11, 3, 60, 52, 44, 36,
    63, 55, 47, 39, 31, 23, 15,
    7, 62, 54, 46, 38, 30, 22,
    14, 6, 61, 53, 45, 37, 29,
    21, 13, 5, 28, 20, 12, 4};

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">key shift</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">keyoffset</span>[16] = {
    1, 1, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 1};

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">PC2 compress permutation</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">PC2</span>[48] = {
    14, 17, 11, 24, 1, 5,
    3, 88, 15, 6, 21, 10,
    23, 19, 12, 4, 26, 8,
    16, 7, 27, 20, 13, 2,
    41, 52, 31, 37, 47, 55,
    30, 40, 51, 45, 33, 48,
    44, 49, 39, 56, 34, 53,
    46, 42, 50, 36, 29, 32};

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">8 s-boxes</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">s_box</span>[8][4][16] = {
    {<span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">S1</span><span style="color: #008787; background-color: #262626;">*/</span>
        {14, 4, 13, 1, 2, 15, 11, 8, 3, 10, 6, 12, 5, 9, 0, 7},
        {0, 15, 7, 4, 14, 2, 13, 1, 10, 6, 12, 11, 9, 5, 3, 8},
        {4, 1, 14, 8, 13, 6, 2, 11, 15, 12, 9, 7, 3, 10, 5, 0},
        {15, 12, 8, 2, 4, 9, 1, 7, 5, 11, 3, 14, 10, 0, 6, 13}},
    {<span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">S2</span><span style="color: #008787; background-color: #262626;">*/</span>
        {15, 1, 8, 14, 6, 11, 3, 4, 9, 7, 2, 13, 12, 0, 5, 10},
        {3, 13, 4, 7, 15, 2, 8, 14, 12, 0, 1, 10, 6, 9, 11, 5},
        {0, 14, 7, 11, 10, 4, 13, 1, 5, 8, 12, 6, 9, 3, 2, 15},
        {13, 8, 10, 1, 3, 15, 4, 2, 11, 6, 7, 12, 0, 5, 14, 9}},
    {<span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">S3</span><span style="color: #008787; background-color: #262626;">*/</span>
        {10, 0, 9, 14, 6, 3, 15, 5, 1, 13, 12, 7, 11, 4, 2, 8},
        {13, 7, 0, 9, 3, 4, 6, 10, 2, 8, 5, 14, 12, 11, 15, 1},
        {13, 6, 4, 9, 8, 15, 3, 0, 11, 1, 2, 12, 5, 10, 14, 7},
        {1, 10, 13, 0, 6, 9, 8, 7, 4, 15, 14, 3, 11, 5, 2, 12}},
    {<span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">S4</span><span style="color: #008787; background-color: #262626;">*/</span>
        {7, 13, 14, 3, 0, 6, 9, 10, 1, 2, 8, 5, 11, 12, 4, 15},
        {13, 8, 11, 5, 6, 15, 0, 3, 4, 7, 2, 12, 1, 10, 14, 9},
        {10, 6, 9, 0, 12, 11, 7, 13, 15, 1, 3, 14, 5, 2, 8, 4},
        {3, 15, 0, 6, 10, 1, 13, 8, 9, 4, 5, 11, 12, 7, 2, 14}},
    {<span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">S5</span><span style="color: #008787; background-color: #262626;">*/</span>
        {2, 12, 4, 1, 7, 10, 11, 6, 8, 5, 3, 15, 13, 0, 14, 9},
        {14, 11, 2, 12, 4, 7, 13, 1, 5, 0, 15, 10, 3, 9, 8, 6},
        {4, 2, 1, 11, 10, 13, 7, 8, 15, 9, 12, 5, 6, 3, 0, 14},
        {11, 8, 12, 7, 1, 14, 2, 13, 6, 15, 0, 9, 10, 4, 5, 3}},
    {<span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">S6</span><span style="color: #008787; background-color: #262626;">*/</span>
        {12, 1, 10, 15, 9, 2, 6, 8, 0, 13, 3, 4, 14, 7, 5, 11},
        {10, 15, 4, 2, 7, 12, 9, 5, 6, 1, 13, 14, 0, 11, 3, 8},
        {9, 14, 15, 5, 2, 8, 12, 3, 7, 0, 4, 10, 1, 13, 11, 6},
        {4, 3, 2, 12, 9, 5, 15, 10, 11, 14, 1, 7, 6, 0, 8, 13}},
    {<span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">S7</span><span style="color: #008787; background-color: #262626;">*/</span>
        {4, 11, 2, 14, 15, 0, 8, 13, 3, 12, 9, 7, 5, 10, 6, 1},
        {13, 0, 11, 7, 4, 9, 1, 10, 14, 3, 5, 12, 2, 15, 8, 6},
        {1, 4, 11, 13, 12, 3, 7, 14, 10, 15, 6, 8, 0, 5, 9, 2},
        {6, 11, 13, 8, 1, 4, 10, 7, 9, 5, 0, 15, 14, 2, 3, 12}},
    {<span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">S8</span><span style="color: #008787; background-color: #262626;">*/</span>
        {13, 2, 8, 4, 6, 15, 11, 1, 10, 9, 3, 14, 5, 0, 12, 7},
        {1, 15, 13, 8, 10, 3, 7, 4, 12, 5, 6, 11, 0, 14, 9, 2},
        {7, 11, 4, 1, 9, 12, 14, 2, 0, 6, 10, 13, 15, 3, 5, 8},
        {2, 1, 14, 7, 4, 10, 8, 13, 15, 12, 9, 0, 3, 5, 6, 11}}};

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">p_box</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">p_box</span>[32] = {
    16, 7, 20, 21, 29, 12, 28, 17,
    1, 15, 23, 26, 5, 18, 31, 10,
    2, 8, 24, 14, 32, 27, 3, 9,
    19, 13, 30, 6, 22, 11, 4, 25};



<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">0x635C3BB517813826</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">cleartext</span>[64] = {
    0, 1, 1, 0, 0, 0, 1, 1,
    0, 1, 0, 1, 1, 1, 0, 0,
    0, 0, 1, 1, 1, 0, 1, 1,
    1, 0, 1, 1, 0, 1, 0, 1,
    0, 0, 0, 1, 0, 1, 1, 1,
    1, 0, 0, 0, 0, 0, 0, 1,
    0, 0, 1, 1, 1, 0, 0, 0,
    0, 0, 1, 0, 0, 1, 1, 0,};

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">0xcafababedeadbeaf</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">key</span>[64] = {
    1, 1, 0, 0, 1, 0, 1, 0,
    1, 1, 1, 1, 1, 0, 1, 0,
    1, 0, 1, 1, 1, 0, 1, 0,
    1, 0, 1, 1, 1, 1, 1, 0,
    1, 1, 0, 1, 1, 1, 1, 0,
    1, 0, 1, 0, 1, 1, 0, 1,
    1, 0, 1, 1, 1, 1, 1, 0,
    1, 0, 1, 0, 1, 1, 1, 1,};

<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #d75fd7; font-weight: bold;">reverse</span>(<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">x</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">len</span>) {
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; len / 2; i ++ ) {
        <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">l</span> = len - 1 - i;
        <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">r</span> = i;

        <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">l_val</span> = (x &gt;&gt; l) &amp; 1;
        <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">r_val</span> = (x &gt;&gt; r) &amp; 1;

        x &amp;= ~(1LL &lt;&lt; l);
        x &amp;= ~(1LL &lt;&lt; r);

        x |= r_val &lt;&lt; l;
        x |= l_val &lt;&lt; r;
    }
    <span style="color: #268bd2; font-weight: bold;">return</span> x;
}

<span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7; font-weight: bold;">output_binary</span>(<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">x</span>) {
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">x = reverse(x, 64);</span>
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 64; i ++ ) {
        <span style="color: #268bd2; font-weight: bold;">if</span> ((i + 1) % 8 == 0)
            printf(<span style="color: #2aa198;">"%lld\n"</span>, (x &gt;&gt; i) &amp; 1);
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">printf("(%d):%lld\n", i, (x &gt;&gt; i) &amp; 1);</span>
        <span style="color: #268bd2; font-weight: bold;">else</span>
            printf(<span style="color: #2aa198;">"%lld "</span>, (x &gt;&gt; i) &amp; 1);
    }
    puts(<span style="color: #2aa198;">""</span>);
}

<span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7; font-weight: bold;">output_hex</span>(<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">x</span>) {
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">x = reverse(x, 64);</span>
    printf(<span style="color: #2aa198;">"0x"</span>);
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 16; i ++ ) {
        <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">t</span> = reverse(x - (x &gt;&gt; 4 &lt;&lt; 4), 4);
        x &gt;&gt;= 4;
        <span style="color: #268bd2; font-weight: bold;">if</span> (t &lt; 10)
            printf(<span style="color: #2aa198;">"%d"</span>, (<span style="color: #df005f; font-weight: bold;">int</span>)t);
        <span style="color: #268bd2; font-weight: bold;">else</span>
            printf(<span style="color: #2aa198;">"%c"</span>, (<span style="color: #df005f; font-weight: bold;">int</span>)t - 10 + <span style="color: #2aa198;">'a'</span>);
    }
    puts(<span style="color: #2aa198;">"\n"</span>);
}

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#23558; x &#20108;&#36827;&#21046;&#34920;&#31034;&#30340;&#31532; i &#20301;&#26356;&#25913;&#20026; y &#20108;&#36827;&#21046;&#34920;&#31034;&#30340;&#31532; j &#20301;</span>
<span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7; font-weight: bold;">exbit</span>(<span style="color: #df005f; font-weight: bold;">ll</span> &amp;<span style="color: #8787d7;">x</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span>, <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">y</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">j</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">len</span>) {
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">1. &#23558; x &#30340;&#31532; i &#20301;&#36171;&#20540; 0</span>
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">2. &#33719;&#21462; y &#30340; &#31532; j &#20301;&#19982; x &#30340;&#31532; i &#20301;&#36827;&#34892; | &#25805;&#20316;</span>
    i = len - 1 - i;
    j = len - 1 - j;
    x &amp;= ~(1LL &lt;&lt; i);
    x |= ((y &gt;&gt; j) &amp; 1) &lt;&lt; i;
}

<span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">initial permutation</span><span style="color: #008787; background-color: #262626;">*/</span>
<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #d75fd7; font-weight: bold;">initial_permutation</span>(<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">plain</span>) {
    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">ipm</span> = 0;
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 64; i ++ ) {
        exbit(ipm, i, plain, IP[i] - 1, 64);
    }
    <span style="color: #268bd2; font-weight: bold;">return</span> ipm;
}

<span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7; font-weight: bold;">leftRotate</span>(<span style="color: #df005f; font-weight: bold;">ll</span> &amp;<span style="color: #8787d7;">x</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">off</span>) {
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#38236;&#20687;</span>
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; off; i ++ ) {
        x &lt;&lt;= 1;
        <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">s</span> = (x &gt;&gt; 28) &amp; 1;
        x &amp;= ~(1LL &lt;&lt; 28);
        x |= s;
    }
}

<span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7; font-weight: bold;">keygen</span>(<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">subkey</span>[], <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">key</span>) {
    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">tmp_key</span> = 0;   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#32463; PC1 &#32622;&#25442;&#24471;&#21040;&#30340;&#23376;&#23494;&#38053;</span>

    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">PC1 &#33293;&#24323;&#26657;&#39564;&#20301;</span>
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 56; i ++ ) {
        exbit(tmp_key, i, key, PC1[i] - 1, 56);
    }

    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">l</span> = tmp_key &gt;&gt; 28;         <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">left  C0</span>
    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">r</span> = tmp_key - (l &lt;&lt; 28);   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">right D0</span>

    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">key shift</span>
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 16; i ++ ) {
        leftRotate(l, keyoffset[i]);
        leftRotate(r, keyoffset[i]);

        tmp_key = (l &lt;&lt; 28) | r;

        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">PC2</span>
        <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">tmp_subkey</span> = 0;
        <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 48; i ++ ) {
            exbit(tmp_subkey, i, tmp_key, PC2[i] - 1, 48);
        }
        subkey[i] = tmp_subkey;
    }
}

<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #d75fd7; font-weight: bold;">Expand</span>(<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">r</span>) {
    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">t</span>;
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 48; i ++ ) {
        exbit(t, i, r, ext[i] - 1, 48);
    }
    <span style="color: #268bd2; font-weight: bold;">return</span> t;
}

<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #d75fd7; font-weight: bold;">S</span>(<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">r</span>) {
    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">t</span>[8] = {0}, <span style="color: #8787d7;">s</span>[8] = {0};
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#25226; r &#20998;&#25104; 8 &#20221;&#65292;&#27599;&#20221; 6 bits</span>
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 8; i ++ ) {
        s[i] = r - (r &gt;&gt; 6 &lt;&lt; 6);
        r &gt;&gt;= 6;

        <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">row</span> = (s[i] &gt;&gt; 5 &lt;&lt; 1) | (s[i] &amp; 1);
        <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">col</span> = (s[i] &amp; (~(1LL &lt;&lt; 6))) &gt;&gt; 1;
        t[i] = s_box[i][row][col];
    }
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 7; i &gt;= 0; i -- ) {
        r = (r &lt;&lt; 4) + t[i];
    }
    <span style="color: #268bd2; font-weight: bold;">return</span> r;
}

<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #d75fd7; font-weight: bold;">P</span>(<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">r</span>) {
    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">t</span>;
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 32; i ++ ) {
        exbit(t, i, r, p_box[i] - 1, 32);
    }
    <span style="color: #268bd2; font-weight: bold;">return</span> t;
}

<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #d75fd7; font-weight: bold;">T_iteration</span>(<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">itm</span>, <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">subkey</span>) {
    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">l</span> = itm &gt;&gt; 32;
    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">r</span> = itm - (l &lt;&lt; 32);
    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">last_r</span> = r;

    r = Expand(r);    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">Expand</span>
    r = r ^ subkey;   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">xor</span>
    r = S(r);         <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">S</span>
    r = P(r);         <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">P</span>

    r = l ^ r;
    l = last_r;

    itm = (l &lt;&lt; 32) | r;

    <span style="color: #268bd2; font-weight: bold;">return</span> itm;
}

<span style="color: #008787; background-color: #262626;">/*</span><span style="color: #008787; background-color: #262626;">final permutation</span><span style="color: #008787; background-color: #262626;">*/</span>
<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #d75fd7; font-weight: bold;">final_permutation</span>(<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">itm</span>) {
    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">cipher</span>;
    <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 64; i ++ ) {
        exbit(cipher, i, itm, IP_reverse[i] - 1, 64);
    }
    <span style="color: #268bd2; font-weight: bold;">return</span> cipher;
}

<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #d75fd7; font-weight: bold;">DES</span>(<span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">plain</span>, <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">key</span>, <span style="color: #268bd2; font-weight: bold;">const</span> <span style="color: #df005f; font-weight: bold;">char</span>* <span style="color: #8787d7;">method</span>) {
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">plain = reverse(plain, 64);</span>
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">key = reverse(key, 64);</span>
    <span style="color: #268bd2; font-weight: bold;">if</span> (strcmp(method, <span style="color: #2aa198;">"encrypt"</span>) == 0) {
        <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">ipm</span> = initial_permutation(plain);   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#21021;&#22987;&#32622;&#25442; ip message</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">puts("initial permutation: ");</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">output_binary(ipm);</span>

        <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">subkey</span>[16];
        keygen(subkey, key);   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#33719;&#21462; 16 &#20010;&#23376;&#23494;&#38053;</span>

        <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">itm</span> = ipm;   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">itreation message</span>
        <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 16; i ++ ) {    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">16 &#36718;&#36845;&#20195;</span>
            itm = T_iteration(itm, subkey[i]);
        }

        <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">cipher</span> = final_permutation(itm);
        <span style="color: #268bd2; font-weight: bold;">return</span> cipher;
    } <span style="color: #268bd2; font-weight: bold;">else</span> <span style="color: #268bd2; font-weight: bold;">if</span> (strcmp(method, <span style="color: #2aa198;">"decrypt"</span>) == 0) {
        <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">ipm</span> = initial_permutation(plain);   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#21021;&#22987;&#32622;&#25442; ip message</span>

        <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">subkey</span>[16];
        keygen(subkey, key);   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#33719;&#21462; 16 &#20010;&#23376;&#23494;&#38053;</span>

        <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">itm</span> = ipm;   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">itreation message</span>
        <span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">i</span> = 0; i &lt; 16; i ++ ) {    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">16 &#36718;&#36845;&#20195;</span>
            itm = T_iteration(itm, subkey[15 - i]);
        }

        <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">cipher</span> = final_permutation(itm);
        <span style="color: #268bd2; font-weight: bold;">return</span> cipher;
    } <span style="color: #268bd2; font-weight: bold;">else</span> {
        puts(<span style="color: #2aa198;">"wrong method!"</span>);
        <span style="color: #268bd2; font-weight: bold;">return</span> 0;
    }
}

<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">freopen("out.txt", "w", stdout);</span>

    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">output_binary(0x11aabbccddeeff01);</span>
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">output_hex(0x11aabbccddeeff01);</span>

    printf(<span style="color: #2aa198;">"&#26126;&#25991;&#65306;"</span>);
    printf(<span style="color: #2aa198;">"0x11aabbccddeeff01"</span>);

    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">cipher</span> = DES(0x11aabbccddeeff01, 0xcafababedeadbeaf, <span style="color: #2aa198;">"encrypt"</span>); <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">0x2973a7e54ec730a3</span>
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">output_binary(cipher);</span>
    printf(<span style="color: #2aa198;">"&#23494;&#25991;&#65306;"</span>);
    output_hex(cipher);

    <span style="color: #df005f; font-weight: bold;">ll</span> <span style="color: #8787d7;">text</span>   = reverse(DES(cipher, 0xcafababedeadbeaf, <span style="color: #2aa198;">"decrypt"</span>), 64); <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">0x635C3BB517813826</span>
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">output_binary(text);</span>
    printf(<span style="color: #2aa198;">"&#26126;&#25991;&#65306;"</span>);
    output_hex(text);

    <span style="color: #268bd2; font-weight: bold;">return</span> 0;
}
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: L.M.haoran</p>
<p class="date">Created: 2022-06-10 Fri 22:11</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
