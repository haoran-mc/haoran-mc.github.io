<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-12-05 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>基本理论</title>
<meta name="author" content="L.M.haoran &lt;haoran.mc@outlook.com&gt;" />
<meta name="description" content="Copyright © 2021, L.M.haoran, all rights reserved." />
<meta name="generator" content="Org Mode" />
<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
           <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
           <script type="module" src="static/js/main.js" defer></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">基本理论</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orga2b22d2">项目的三个分区</a>
<ul>
<li><a href="#org4e6beab">工作流程</a></li>
</ul>
</li>
<li><a href="#org4225b5d">文件的四种状态</a>
<ul>
<li><a href="#orgf238577">文件的四种状态</a></li>
<li><a href="#orgc9be331">查看文件状态</a></li>
</ul>
</li>
<li><a href="#orga503e1b">.git文件夹内容</a>
<ul>
<li><a href="#org6d26f97">object(Object Database)[文件夹]</a></li>
<li><a href="#org150c9fd">hooks[文件夹]</a>
<ul>
<li><a href="#org1827e50">提交过程(客户端)</a></li>
<li><a href="#org3783571">其他(客户端)</a></li>
<li><a href="#org2e3c9df">接收过程(客户端)</a></li>
</ul>
</li>
<li><a href="#org9365c51">refs[文件夹]</a></li>
<li><a href="#org7261567">logs[文件夹]</a></li>
<li><a href="#org3ba0f78">info[文件夹]</a></li>
<li><a href="#orge3d50ca">FETCH_HEAD[文件]</a></li>
<li><a href="#org27e7073">description[文件]</a></li>
<li><a href="#org1a80031">config[文件]</a></li>
<li><a href="#org54c009b">index[文件]</a></li>
<li><a href="#org1d722ed">HEAD[文件]</a></li>
<li><a href="#org6c2e3d1">ORIG_HEAD[文件]</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orga2b22d2" class="outline-2">
<h2 id="orga2b22d2">项目的三个分区</h2>
<div class="outline-text-2" id="text-orga2b22d2">
<p>
Git本地有三个工作区域：工作目录（Working Directory）、暂存区（Stage/Index）、资源库（Repository或Git Directory）。如果在加上远程的git仓库（Remote Directory）就可以分为四个工作区域。文件在这四个区域之间的转换关系如下:<br>
</p>

<dl class="org-dl">
<dt>Workspace</dt><dd>工作区，就是你平时存放项目代码的地方；<br></dd>
<dt>Index / Stage</dt><dd>暂存区，用于临时存放你的改动，事实上它只是一个文件，保存即将提交到文件列表信息；<br></dd>
<dt>Repository</dt><dd>仓库区（或本地仓库），就是安全存放数据的位置，这里面有你提交到所有版本的数据。其中 HEAD 指向最新放入仓库的版本；<br></dd>
<dt>Remote</dt><dd>远程仓库，托管代码的服务器，可以简单的认为是你项目组中的一台电脑用于远程数据交换；<br></dd>
</dl>

<p>
本地的三个区域确切的说应该是 git 仓库中 HEAD 指向的版本:<br>
</p>

<dl class="org-dl">
<dt>Directory</dt><dd>使用Git管理的一个目录，也就是一个仓库，包含我们的工作空间和Git的管理空间；<br></dd>
<dt>WorkSpace</dt><dd>需要通过Git进行版本控制的目录和文件，这些目录和文件组成了工作空间；<br></dd>
<dt>.git</dt><dd>存放Git管理信息的目录，初始化仓库的时候自动创建；<br></dd>
<dt>Index/Stage</dt><dd>暂存区，或者叫待提交更新区，在提交进入repo之前，我们可以把所有的更新放在暂存区；<br></dd>
<dt>Local Repo</dt><dd>本地仓库，一个存放在本地的版本库；HEAD会只是当前的开发分支（branch）；<br></dd>
<dt>Stash</dt><dd>隐藏，是一个工作状态保存栈，用于保存/恢复WorkSpace中的临时状态；<br></dd>
</dl>
</div>
<div id="outline-container-org4e6beab" class="outline-3">
<h3 id="org4e6beab">工作流程</h3>
<div class="outline-text-3" id="text-org4e6beab">
<p>
git 的工作流程一般是这样的：<br>
</p>

<ol class="org-ol">
<li>在工作目录中添加、修改文件；<br></li>
<li>将需要进行版本管理的文件放入暂存区域；<br></li>
<li>将暂存区域的文件提交到 git 仓库。<br></li>
</ol>

<p>
因此，git 管理的文件有三种状态：已修改（modified），已暂存（staged），已提交（committed）<br>
</p>
</div>
</div>
</div>
<div id="outline-container-org4225b5d" class="outline-2">
<h2 id="org4225b5d">文件的四种状态</h2>
<div class="outline-text-2" id="text-org4225b5d">
</div>
<div id="outline-container-orgf238577" class="outline-3">
<h3 id="orgf238577">文件的四种状态</h3>
<div class="outline-text-3" id="text-orgf238577">
<p>
版本控制就是对文件的版本控制，要对文件进行修改、提交等操作，首先要知道文件当前在什么状态，不然可能会提交了现在还不想提交的文件，或者要提交的文件没提交上<br>
</p>

<p>
文件的状态主要为 <b>未追踪</b> (Untracked)和 <b>已追踪</b> (Tracked)，已追踪状态包括 Unmodified、Modified、Staged<br>
</p>

<dl class="org-dl">
<dt>Untracked</dt><dd>未跟踪, 此文件在文件夹中, 但并没有加入到 git 库, 不参与版本控制. 通过 <b>git add</b> 状态变为 <b>Staged</b><br></dd>
<dt>Staged</dt><dd>暂存状态. 执行 <b>git commit</b> 则将修改同步到库中, 这时库中的文件和本地文件又变为一致, 文件为 <b>Unmodify</b> 状态. 执行 <b>git reset HEAD filename</b> 取消暂存, 文件状态为 <b>Modified</b><br></dd>
<dt>Unmodify</dt><dd>文件已经入库, 未修改, 即版本库中的文件快照内容与文件夹中完全一致. 这种类型的文件有两种去处, 如果它被修改, 而变为 <b>Modified</b>  如果使用 <b>git rm</b> 移出版本库, 则成为 <b>Untracked</b> 文件<br></dd>
<dt>Modified</dt><dd>文件已修改, 仅仅是修改, 并没有进行其他的操作. 这个文件也有两个去处, 通过 <b>git add</b> 可进入暂存 <b>staged</b> 状态, 使用 <b>git checkout</b> 则丢弃修改过, 返回到 <b>unmodify</b> 状态, 这个 <b>git checkout</b> 即从库中取出文件, 覆盖当前修改!<br></dd>
</dl>

<img src="./images/git文件的四种状态.png" width="650px" />

<img src="./images/git的文件状态转移.jpeg" width="650px" />

<img src="./images/git常用命令.png" width="650px" />

<dl class="org-dl">
<dt>Staged -&gt; Untracked</dt><dd>git clean -n &lt;filename&gt;<br></dd>
<dt>Staged -&gt; Unmodify</dt><dd><code>git commit -m &lt;commit message&gt;</code> or <code>git reset HEAD &lt;filename&gt;</code><br></dd>
<dt>Modified -&gt; Unmodify</dt><dd><code>git add &lt;filename&gt;</code> or <code>git checkout &lt;filename&gt;</code><br></dd>
<dt>Unmodify -&gt; Untracked</dt><dd>git rm &lt;filename&gt;<br></dd>
<dt>Untracked -&gt; Staged</dt><dd>git add &lt;filename&gt;<br></dd>
</dl>
</div>
</div>
<div id="outline-container-orgc9be331" class="outline-3">
<h3 id="orgc9be331">查看文件状态</h3>
<div class="outline-text-3" id="text-orgc9be331">
<p>
上面说文件有 4 种状态，通过如下命令可以查看到文件的状态:<br>
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #767676; font-style: italic;"># </span><span style="color: #767676; font-style: italic;">&#26597;&#30475;&#25351;&#23450;&#25991;&#20214;&#29366;&#24577;</span>
git status [filename]

<span style="color: #767676; font-style: italic;"># </span><span style="color: #767676; font-style: italic;">&#26597;&#30475;&#25152;&#26377;&#25991;&#20214;&#29366;&#24577;</span>
git status
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orga503e1b" class="outline-2">
<h2 id="orga503e1b">.git文件夹内容</h2>
<div class="outline-text-2" id="text-orga503e1b">
<img src="./images/git文件夹.png" />
</div>
<div id="outline-container-org6d26f97" class="outline-3">
<h3 id="org6d26f97">object(Object Database)[文件夹]</h3>
<div class="outline-text-3" id="text-org6d26f97">
<p>
存放所有的 git 对象，详细原理参见：<a href="https://git-scm.com/book/zh/v2/Git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86-Git-%E5%AF%B9%E8%B1%A1">Git内部原理-Git对象</a><br>
</p>
</div>
</div>

<div id="outline-container-org150c9fd" class="outline-3">
<h3 id="org150c9fd">hooks[文件夹]</h3>
<div class="outline-text-3" id="text-org150c9fd">
<p>
存放一些钩子(hooks)脚本，init后会自动生成一些示例钩子，以.sample结尾<br>
</p>
</div>
<div id="outline-container-org1827e50" class="outline-4">
<h4 id="org1827e50">提交过程(客户端)</h4>
<div class="outline-text-4" id="text-org1827e50">
<dl class="org-dl">
<dt>pre-commit</dt><dd>在提交前自动运行，如果钩子以非零值推出，Git将放弃本次提交，可以用no&#x2013;verify绕过该过程；<br></dd>
<dt>prepare-commit-msg</dt><dd>运行在启动提交信息编辑器之前，在创建默认消息之后，使你可以编辑提交者所看到的默认信息<br></dd>
<dt>commit-msg</dt><dd>钩子接收一个参数，此参数即上文提到的，存有当前提交信息的临时文件的路径。 如果该钩子脚本以非零值退出，Git 将放弃提交，因此，可以用来在提交通过前验证项目状态或提交信息;<br></dd>
<dt>post-commit</dt><dd>在整个提交过程完成后运行，一般用于通知。<br></dd>
</dl>
</div>
</div>
<div id="outline-container-org3783571" class="outline-4">
<h4 id="org3783571">其他(客户端)</h4>
<div class="outline-text-4" id="text-org3783571">
<dl class="org-dl">
<dt>pre-rebase</dt><dd>调用在git rebase操作之前，返回非零值可以中止rebase操作；<br></dd>
<dt>post-rewrite</dt><dd>会被可能造成替换提交记录的命令调用；<br></dd>
<dt>post-checkout</dt><dd>在git checkout之后调用。你可以根据你的项目环境用它调整你的工作目录。其中包括放入大的二进制文件、自动生成文档或进行其他类似这样的操作<br></dd>
<dt>post-merge</dt><dd>在git merge之后调用， 你可以用它恢复 Git 无法跟踪的工作区数据，比如权限数据。 这个钩子也可以用来验证某些在 Git 控制之外的文件是否存在，这样你就能在工作区改变时，把这些文件复制进来；<br></dd>
<dt>pre-push</dt><dd>在git push运行期间，更新了远程引用但尚未传送对象时调用。你可以在推送开始之前，用它验证对引用的更新操作(一个非零的退出码将终止推送过程)。<br></dd>
</dl>
</div>
</div>
<div id="outline-container-org2e3c9df" class="outline-4">
<h4 id="org2e3c9df">接收过程(客户端)</h4>
<div class="outline-text-4" id="text-org2e3c9df">
<dl class="org-dl">
<dt>pre-receivew</dt><dd>在处理客户端的推送操作时，最先被调用，如果以非零值推出，所有推送内容不会被接受；<br></dd>
<dt>update</dt><dd>与楼上类似，但是假设客户端同时推送多个分支，服务器端pre-receive主机运行一次，但是update会在每个被推送的分支都运行一次，如果update以非零值推出，只有失败的那个应用会被拒绝，其他会被更新；<br></dd>
<dt>post-receive</dt><dd>在接收完成后被调用，可以用来更新其他系统服务或者通知用户<br></dd>
</dl>
</div>
</div>
</div>
<div id="outline-container-org9365c51" class="outline-3">
<h3 id="org9365c51">refs[文件夹]</h3>
<div class="outline-text-3" id="text-org9365c51">
<ul class="org-ul">
<li>heads文件夹包含本地分支，remote文件夹为远程分支，tags文件夹包含了tag<br></li>
<li>保存当前最新一次提交的hash值<br></li>
</ul>
</div>
</div>
<div id="outline-container-org7261567" class="outline-3">
<h3 id="org7261567">logs[文件夹]</h3>
<div class="outline-text-3" id="text-org7261567">
<p>
保存所有更新的引用记录，文件存放方式类似于refs文件夹：<br>
格式：上一次提交的hash值    |   当前提交的hash值   |  提交者名称 | 提交者邮箱 | 时间戳 时区 | 提交信息<br>
</p>
</div>
</div>
<div id="outline-container-org3ba0f78" class="outline-3">
<h3 id="org3ba0f78">info[文件夹]</h3>
<div class="outline-text-3" id="text-org3ba0f78">
<p>
包含一个exclude文件，存放一些信息<br>
</p>
</div>
</div>
<div id="outline-container-orge3d50ca" class="outline-3">
<h3 id="orge3d50ca">FETCH_HEAD[文件]</h3>
<div class="outline-text-3" id="text-orge3d50ca">
<p>
版本链接，指向目前从远端仓库取下来分支的末端版本<br>
</p>
</div>
</div>
<div id="outline-container-org27e7073" class="outline-3">
<h3 id="org27e7073">description[文件]</h3>
<div class="outline-text-3" id="text-org27e7073">
<p>
仓库的描述信息，一般提供给Git托管仓库系统使用<br>
</p>
</div>
</div>
<div id="outline-container-org1a80031" class="outline-3">
<h3 id="org1a80031">config[文件]</h3>
<div class="outline-text-3" id="text-org1a80031">
<p>
提供一些Git仓库的配置文件<br>
</p>
</div>
</div>
<div id="outline-container-org54c009b" class="outline-3">
<h3 id="org54c009b">index[文件]</h3>
<div class="outline-text-3" id="text-org54c009b">
<p>
暂存区，二进制文件<br>
</p>
</div>
</div>
<div id="outline-container-org1d722ed" class="outline-3">
<h3 id="org1d722ed">HEAD[文件]</h3>
<div class="outline-text-3" id="text-org1d722ed">
<p>
映射到ref引用（在refs文件夹中），能够找到下一次commit的前一次的hash值，即当前指针指向的位置<br>
</p>
</div>
</div>
<div id="outline-container-org6c2e3d1" class="outline-3">
<h3 id="org6c2e3d1">ORIG_HEAD[文件]</h3>
<div class="outline-text-3" id="text-org6c2e3d1">
<p>
HEAD指针的前一个状态，为hash值<br>
</p>
</div>
</div>
</div>
</div>
</body>
</html>
