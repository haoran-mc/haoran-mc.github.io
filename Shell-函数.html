<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2023-02-01 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SHELL-函数</title>
<meta name="author" content="Haoran Liu" />
<meta name="description" content="Copyright © 2023, Haoran Liu, all rights reserved." />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="static/css/org.css"/>
</head>
<body>
<div id="content" class="content">
<h1 class="title">SHELL-函数</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org443f7ac">基本的脚本函数</a>
<ul>
<li><a href="#org2e45530">创建与使用</a></li>
<li><a href="#org6e52d56">返回值</a></li>
<li><a href="#org7ccd3a2">局部变量</a></li>
</ul>
</li>
<li><a href="#orgf2b47d0">函数中的数组变量</a>
<ul>
<li><a href="#orgbef9766">向函数传递数组参数</a></li>
<li><a href="#orgb8b2923">返回数组</a></li>
</ul>
</li>
<li><a href="#org1ab175b">函数递归</a></li>
<li><a href="#orge3bd71a">创建库</a></li>
<li><a href="#orgf84b263">在命令行上创建函数</a></li>
</ul>
</div>
</div>


<div id="outline-container-org443f7ac" class="outline-2">
<h2 id="org443f7ac">基本的脚本函数</h2>
<div class="outline-text-2" id="text-org443f7ac">
</div>
<div id="outline-container-org2e45530" class="outline-3">
<h3 id="org2e45530">创建与使用</h3>
<div class="outline-text-3" id="text-org2e45530">
<div class="org-src-container">
<pre class="src src-shell">[ <span style="color: #9d0006;">function</span> ] funname [()]
{
  action;

  [return int;]
}
</pre>
</div>

<p>
要在脚本中使用函数，只需要像其他 shell 命令一样，在行中指定函数名就行了。<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #a89984;">#</span><span style="color: #a89984;">!/bin/</span><span style="color: #9d0006;">bash</span>

<span style="color: #9d0006;">function</span> <span style="color: #b57614;">printit</span>() {
  <span style="color: #af3a03;">echo</span> <span style="color: #79740e;">"Your choice is ${1}"</span> <span style="color: #a89984;"># </span><span style="color: #a89984;">&#36825;&#20010; $1 &#24517;&#39035;&#35201;&#21442;&#32771;&#19979;&#38754;&#25351;&#20196;&#30340;&#19979;&#36798;</span>
}

<span style="color: #af3a03;">echo</span> <span style="color: #79740e;">"This program will print your selection !"</span>

<span style="color: #9d0006;">case</span> ${<span style="color: #076678;">1</span>} <span style="color: #9d0006;">in</span>
  <span style="color: #79740e;">"one"</span>)
    <span style="color: #a89984;"># </span><span style="color: #a89984;">&#35831;&#27880;&#24847;&#65292; printit &#25351;&#20196;&#21518;&#38754;&#36824;&#26377;&#25509;&#21442;&#25968;&#65281;</span>
    printit 1
    ;;
  <span style="color: #79740e;">"two"</span>)
    printit 2
    ;;
  <span style="color: #79740e;">"three"</span>)
    printit 3
    ;;
  *)
    <span style="color: #af3a03;">echo</span> <span style="color: #79740e;">"Usage ${0} {one|two|three}"</span>
    ;;
<span style="color: #9d0006;">esac</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org6e52d56" class="outline-3">
<h3 id="org6e52d56">返回值</h3>
<div class="outline-text-3" id="text-org6e52d56">
<p>
函数的退出状态码是函数中最后一条命令返回的退出状态码，在函数执行后，可以用标准变量 <code>$?</code> 来确定函数的退出状态码。<br>
</p>

<p>
使用 <code>return</code> 命令可以退出函数并返回特定的退出状态码，不过需要记住：<br>
</p>

<ul class="org-ul">
<li>函数一结束就要取返回值<br></li>
<li>退出状态码必须是 0~250<br></li>
</ul>

<p>
如果要返回较大的整数值或者字符串的话，可以将命令的输出保存到变量中。<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #a89984;">#</span><span style="color: #a89984;">!/bin/</span><span style="color: #9d0006;">bash</span>

<span style="color: #9d0006;">function</span> <span style="color: #b57614;">db1</span> {
  <span style="color: #af3a03;">read</span> -p <span style="color: #79740e;">"Enter a value: "</span> value
  <span style="color: #af3a03;">echo</span> $[ $<span style="color: #076678;">value</span> * 2 ]
}

<span style="color: #076678;">result</span>=$(db1)
</pre>
</div>
</div>
</div>
<div id="outline-container-org7ccd3a2" class="outline-3">
<h3 id="org7ccd3a2">局部变量</h3>
<div class="outline-text-3" id="text-org7ccd3a2">
<p>
无需在函数中使用全局变量，函数内部使用的任何变量都可以被声明成局部变量。只要在变量声明前加上 <code>local</code> 关键字就可以了。<br>
</p>
</div>
</div>
</div>
<div id="outline-container-orgf2b47d0" class="outline-2">
<h2 id="orgf2b47d0">函数中的数组变量</h2>
<div class="outline-text-2" id="text-orgf2b47d0">
</div>
<div id="outline-container-orgbef9766" class="outline-3">
<h3 id="orgbef9766">向函数传递数组参数</h3>
<div class="outline-text-3" id="text-orgbef9766">
<ul class="org-ul">
<li><code>func1 $arr</code> 只会传递第一个值<br></li>
<li><code>func1 ${arr[@]}</code> 传递数组中的所有值<br></li>
</ul>
</div>
</div>
<div id="outline-container-orgb8b2923" class="outline-3">
<h3 id="orgb8b2923">返回数组</h3>
<div class="outline-text-3" id="text-orgb8b2923">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #a89984;">#</span><span style="color: #a89984;">!/bin/</span><span style="color: #9d0006;">bash</span>

<span style="color: #9d0006;">function</span> <span style="color: #b57614;">func1</span> {
  <span style="color: #af3a03;">echo</span> ${<span style="color: #076678;">arr</span>[*]}
}

<span style="color: #076678;">arr</span>=(0 1 2 3 4 5)
<span style="color: #076678;">res</span>=($(func1 $<span style="color: #076678;">arr</span>[*]))
<span style="color: #af3a03;">echo</span> ${<span style="color: #076678;">res</span>[*]}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org1ab175b" class="outline-2">
<h2 id="org1ab175b">函数递归</h2>
<div class="outline-text-2" id="text-org1ab175b">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #a89984;">#</span><span style="color: #a89984;">!/bin/</span><span style="color: #9d0006;">bash</span>

<span style="color: #9d0006;">function</span> <span style="color: #b57614;">factorial</span> {
  <span style="color: #9d0006;">if</span> [ $<span style="color: #076678;">1</span> -eq 1 ]
  <span style="color: #9d0006;">then</span>
    <span style="color: #af3a03;">echo</span> 1
  <span style="color: #9d0006;">else</span>
    <span style="color: #af3a03;">local</span> <span style="color: #076678;">temp</span>=$[ $<span style="color: #076678;">1</span> -1 ]
    <span style="color: #af3a03;">local</span> <span style="color: #076678;">result</span>=<span style="color: #076678; font-weight: bold;">`factorial $temp`</span>
    <span style="color: #af3a03;">echo</span> $[ $<span style="color: #076678;">result</span> * $<span style="color: #076678;">1</span> ]
  <span style="color: #9d0006;">fi</span>
}

<span style="color: #af3a03;">read</span> -p <span style="color: #79740e;">"Please input a value: "</span> value
<span style="color: #076678;">result</span>=<span style="color: #076678; font-weight: bold;">`factorial $value`</span>
<span style="color: #af3a03;">echo</span> <span style="color: #79740e;">"The factorial of $value is: $result"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orge3bd71a" class="outline-2">
<h2 id="orge3bd71a">创建库</h2>
<div class="outline-text-2" id="text-orge3bd71a">
<p>
使用 source 命令可以在 shell 脚本中运行库文件脚本。<br>
</p>

<p>
source 命令有个快捷的别名，称作点操作符（dot operator）。<br>
</p>
</div>
</div>
<div id="outline-container-orgf84b263" class="outline-2">
<h2 id="orgf84b263">在命令行上创建函数</h2>
<div class="outline-text-2" id="text-orgf84b263">
<ol class="org-ol">
<li>单行写完<br></li>
<li>每个命令后面加分号<br></li>
<li>多行方式定义，每写完一行就回车<br></li>
</ol>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2023-01-28 00:01 Sat</p>
<p class="author">Author: Haoran Liu</p>
<p class="date">Created: 2023-02-01</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
