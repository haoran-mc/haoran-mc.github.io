<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-02-10 Thu 01:56 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>返回值</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran">
<meta name="description" content="Copyright © 2022, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="content">
<h1 class="title">返回值</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org9500a3b">"裸" 返回</a></li>
<li><a href="#org17e733d">忽略返回值</a></li>
<li><a href="#orgd46ed84">多返回值可直接作为其他函数调用实参。</a></li>
<li><a href="#org3fcb4fd">命名返回参数可被局部变量遮蔽</a></li>
<li><a href="#orgc50a489">命名返回参数与 defer</a></li>
</ul>
</div>
</div>

<div id="outline-container-org9500a3b" class="outline-2">
<h2 id="org9500a3b">"裸" 返回</h2>
<div class="outline-text-2" id="text-org9500a3b">
<p>
"_" 标识符，用来忽略函数的某个返回值<br>
</p>

<p>
Go 的返回值可以被命名，并且就像在函数体开头声明的变量那样使用。<br>
</p>

<p>
返回值的名称应当具有一定的意义，可以作为文档使用。<br>
</p>

<p>
没有参数的 return 语句返回各个返回变量的当前值。这种用法被称作“裸”返回。<br>
</p>

<p>
直接返回语句仅应当用在像下面这样的短函数中。在长的函数中它们会影响代码的可读性。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">package</span> main

<span style="color: #268bd2; font-weight: bold;">import</span> (
    <span style="color: #2aa198;">"fmt"</span>
)

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">add</span>(<span style="color: #8787d7;">a</span>, <span style="color: #8787d7;">b</span> <span style="color: #df005f; font-weight: bold;">int</span>) (<span style="color: #8787d7;">c</span> <span style="color: #df005f; font-weight: bold;">int</span>) {
    c = a + b
    <span style="color: #268bd2; font-weight: bold;">return</span>
}

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">calc</span>(<span style="color: #8787d7;">a</span>, <span style="color: #8787d7;">b</span> <span style="color: #df005f; font-weight: bold;">int</span>) (<span style="color: #8787d7;">sum</span> <span style="color: #df005f; font-weight: bold;">int</span>, <span style="color: #8787d7;">avg</span> <span style="color: #df005f; font-weight: bold;">int</span>) {
    sum = a + b   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">sum &#21487;&#20197;&#30452;&#25509;&#20351;&#29992;&#65292;&#19981;&#38656;&#35201;&#22768;&#26126;</span>
    avg = (a + b) / <span style="color: #d75fd7;">2</span>

    <span style="color: #268bd2; font-weight: bold;">return</span>
}

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #268bd2; font-weight: bold;">var</span> <span style="color: #8787d7;">a</span>, <span style="color: #8787d7;">b</span> <span style="color: #df005f; font-weight: bold;">int</span> = <span style="color: #d75fd7;">1</span>, <span style="color: #d75fd7;">2</span>
    <span style="color: #8787d7;">c</span> := <span style="color: #d75fd7; font-weight: bold;">add</span>(a, b)
    <span style="color: #8787d7;">sum</span>, <span style="color: #8787d7;">avg</span> := <span style="color: #d75fd7; font-weight: bold;">calc</span>(a, b)
    fmt.<span style="color: #d75fd7; font-weight: bold;">Println</span>(a, b, c, sum, avg)
}
</pre>
</div>

<p>
输出结果：<br>
</p>

<pre class="example" id="orgaa8cf45">
1 2 3 3 1
</pre>
</div>
</div>
<div id="outline-container-org17e733d" class="outline-2">
<h2 id="org17e733d">忽略返回值</h2>
<div class="outline-text-2" id="text-org17e733d">
<p>
Golang返回值不能用容器对象接收多返回值。只能用多个变量，或 "_" 忽略。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">package</span> main

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">test</span>() (<span style="color: #df005f; font-weight: bold;">int</span>, <span style="color: #df005f; font-weight: bold;">int</span>) {
    <span style="color: #268bd2; font-weight: bold;">return</span> <span style="color: #d75fd7;">1</span>, <span style="color: #d75fd7;">2</span>
}

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">s := make([]int, 2)</span>
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">s = test()   // Error: multiple-value test() in single-value context</span>

    <span style="color: #8787d7;">x</span>, <span style="color: #8787d7;">_</span> := <span style="color: #d75fd7; font-weight: bold;">test</span>()
    <span style="color: #268bd2;">println</span>(x)
}
</pre>
</div>

<p>
输出结果：<br>
</p>

<pre class="example" id="orgd45c2f2">
1
</pre>
</div>
</div>
<div id="outline-container-orgd46ed84" class="outline-2">
<h2 id="orgd46ed84">多返回值可直接作为其他函数调用实参。</h2>
<div class="outline-text-2" id="text-orgd46ed84">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">package</span> main

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">test</span>() (<span style="color: #df005f; font-weight: bold;">int</span>, <span style="color: #df005f; font-weight: bold;">int</span>) {
    <span style="color: #268bd2; font-weight: bold;">return</span> <span style="color: #d75fd7;">1</span>, <span style="color: #d75fd7;">2</span>
}

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">add</span>(<span style="color: #8787d7;">x</span>, <span style="color: #8787d7;">y</span> <span style="color: #df005f; font-weight: bold;">int</span>) <span style="color: #df005f; font-weight: bold;">int</span> {
    <span style="color: #268bd2; font-weight: bold;">return</span> x + y
}

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">sum</span>(<span style="color: #8787d7;">n</span> ...<span style="color: #df005f; font-weight: bold;">int</span>) <span style="color: #df005f; font-weight: bold;">int</span> {
    <span style="color: #268bd2; font-weight: bold;">var</span> <span style="color: #8787d7;">x</span> <span style="color: #df005f; font-weight: bold;">int</span>
    <span style="color: #268bd2; font-weight: bold;">for</span> <span style="color: #8787d7;">_</span>, <span style="color: #8787d7;">i</span> := <span style="color: #268bd2; font-weight: bold;">range</span> n {
        x += i
    }

    <span style="color: #268bd2; font-weight: bold;">return</span> x
}

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #268bd2;">println</span>(<span style="color: #d75fd7; font-weight: bold;">add</span>(<span style="color: #d75fd7; font-weight: bold;">test</span>()))
    <span style="color: #268bd2;">println</span>(<span style="color: #d75fd7; font-weight: bold;">sum</span>(<span style="color: #d75fd7; font-weight: bold;">test</span>()))
}
</pre>
</div>

<p>
输出结果：<br>
</p>

<pre class="example" id="org500cd4e">
3
3
</pre>
</div>
</div>
<div id="outline-container-org3fcb4fd" class="outline-2">
<h2 id="org3fcb4fd">命名返回参数可被局部变量遮蔽</h2>
<div class="outline-text-2" id="text-org3fcb4fd">
<p>
命名返回参数可看做与形参类似的局部变量，最后由 return 隐式返回。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">package</span> main

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">add</span>(<span style="color: #8787d7;">x</span>, <span style="color: #8787d7;">y</span> <span style="color: #df005f; font-weight: bold;">int</span>) (<span style="color: #8787d7;">z</span> <span style="color: #df005f; font-weight: bold;">int</span>) {
    z = x + y
    <span style="color: #268bd2; font-weight: bold;">return</span>
}

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #268bd2;">println</span>(<span style="color: #d75fd7; font-weight: bold;">add</span>(<span style="color: #d75fd7;">1</span>, <span style="color: #d75fd7;">2</span>))
}
</pre>
</div>

<p>
输出结果：<br>
</p>

<pre class="example" id="org43df193">
3
</pre>

<p>
命名返回参数可被同名局部变量遮蔽，此时需要显式返回。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">add</span>(<span style="color: #8787d7;">x</span>, <span style="color: #8787d7;">y</span> <span style="color: #df005f; font-weight: bold;">int</span>) (<span style="color: #8787d7;">z</span> <span style="color: #df005f; font-weight: bold;">int</span>) {
    { <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#19981;&#33021;&#22312;&#19968;&#20010;&#32423;&#21035;&#65292;&#24341;&#21457; "z redeclared in this block" &#38169;&#35823;&#12290;</span>
        <span style="color: #268bd2; font-weight: bold;">var</span> <span style="color: #8787d7;">z</span> = x + y
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">return   // Error: z is shadowed during return</span>
        <span style="color: #268bd2; font-weight: bold;">return</span> z <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#24517;&#39035;&#26174;&#24335;&#36820;&#22238;&#12290;</span>
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc50a489" class="outline-2">
<h2 id="orgc50a489">命名返回参数与 defer</h2>
<div class="outline-text-2" id="text-orgc50a489">
<p>
命名返回参数允许 defer 延迟调用通过闭包读取和修改。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">package</span> main

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">add</span>(<span style="color: #8787d7;">x</span>, <span style="color: #8787d7;">y</span> <span style="color: #df005f; font-weight: bold;">int</span>) (<span style="color: #8787d7;">z</span> <span style="color: #df005f; font-weight: bold;">int</span>) {
    <span style="color: #268bd2; font-weight: bold;">defer</span> <span style="color: #268bd2; font-weight: bold;">func</span>() {
        z += <span style="color: #d75fd7;">100</span>
    }()

    z = x + y
    <span style="color: #268bd2; font-weight: bold;">return</span>
}

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #268bd2;">println</span>(<span style="color: #d75fd7; font-weight: bold;">add</span>(<span style="color: #d75fd7;">1</span>, <span style="color: #d75fd7;">2</span>)) 
}
</pre>
</div>

<p>
输出结果：<br>
</p>

<pre class="example" id="org51a6212">
103
</pre>

<p>
显式 return 返回前，会先修改命名返回参数。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">package</span> main

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">add</span>(<span style="color: #8787d7;">x</span>, <span style="color: #8787d7;">y</span> <span style="color: #df005f; font-weight: bold;">int</span>) (<span style="color: #8787d7;">z</span> <span style="color: #df005f; font-weight: bold;">int</span>) {
    <span style="color: #268bd2; font-weight: bold;">defer</span> <span style="color: #268bd2; font-weight: bold;">func</span>() {
        <span style="color: #268bd2;">println</span>(z) <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#36755;&#20986;: 203</span>
    }()

    z = x + y
    <span style="color: #268bd2; font-weight: bold;">return</span> z + <span style="color: #d75fd7;">200</span> <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#25191;&#34892;&#39034;&#24207;: (z = z + 200) -&gt; (call defer) -&gt; (return)</span>
}

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #268bd2;">println</span>(<span style="color: #d75fd7; font-weight: bold;">add</span>(<span style="color: #d75fd7;">1</span>, <span style="color: #d75fd7;">2</span>)) <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#36755;&#20986;: 203</span>
}
</pre>
</div>

<p>
输出结果：<br>
</p>

<pre class="example" id="orgd6b5618">
203
203
</pre>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2022-02-09 23:02 Wed</p>
<p class="author">Author: L.M.haoran</p>
<p class="date">Created: 2022-02-10 Thu 01:56</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
