<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2023-02-09 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SHELL-初识SED</title>
<meta name="author" content="Haoran Liu" />
<meta name="description" content="Copyright © 2023, Haoran Liu, all rights reserved." />
<meta name="generator" content="Org Mode" />
<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
           <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
           <script type="module" src="static/js/main.js" defer></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">SHELL-初识SED</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org698d7c4">参数解析</a>
<ul>
<li><a href="#orgfbc83e3">使用多命令（-e 参数）</a></li>
<li><a href="#org97014ba">sed编辑器脚本（-f 参数）</a></li>
<li><a href="#org456e007">直接修改文件（-i 参数）</a></li>
</ul>
</li>
<li><a href="#orgd594e90">使用地址</a>
<ul>
<li><a href="#orgfebe494">1. 数字方式的行寻址</a></li>
<li><a href="#orgd7dd02d">2. 使用文本模式过滤器</a></li>
<li><a href="#orgd744797">3. 命令组合</a></li>
</ul>
</li>
<li><a href="#orgdafbfbe">数据的查找并替换（Vim） - s</a>
<ul>
<li><a href="#org61c27a6">替换标记</a></li>
<li><a href="#orga7c981c">分隔字符</a></li>
</ul>
</li>
<li><a href="#orgad075f2">删除 - d</a></li>
<li><a href="#org14a231d">插入 - i 和附加文本 - a</a></li>
<li><a href="#org0357fcf">替换 - c</a></li>
<li><a href="#org80b850b">转换 - y</a></li>
<li><a href="#org872f838">打印 -n, p, =, l</a>
<ul>
<li><a href="#org99c3418">打印 sed 编辑器输出中的一行 - p</a></li>
<li><a href="#org731835f">打印匹配的行 - p</a></li>
<li><a href="#org2b3dd4f">打印某些行 -n, p</a></li>
<li><a href="#org35ddd62">与修改命令一起使用</a></li>
<li><a href="#orgad2e731">打印行号 - =</a></li>
<li><a href="#orgd9fbbb5">列出行 - l</a></li>
</ul>
</li>
<li><a href="#org9e5a0f9">使用 sed 处理文件</a>
<ul>
<li><a href="#orgc958b98">写入文件 - w</a></li>
<li><a href="#org395a49b">从文件中读数据 - r</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
sed 是一个管道命令，可以分析标准输入。而且 sed 还可以将数据进行替换、删除、新增、选取特定行等功能。<br>
</p>

<pre class="example" id="org7d2e9b3">
sed [-nefr] [操作]

-n: 使用安静（silent）模式，在一般 sed 的用法中，所有来自 stdin 的数据一般都会被列到屏幕上，但如果加上 -n 参数之后，则只有经过 sed 特殊处理的那一行（或操作）才会被列出来；
-e: 直接在命令行模式上进行 sed 操作编辑；
-f: 直接将 sed 的操作写在一个文件内，-f filename 则可以执行 filename 内的 sed 操作；
-r: sed 的操作使用的是扩展型正则表达式的语法，默认是基础正则表达式语法；
-i: 直接修改读取的文件内容，而不是由屏幕输出；

操作说明：[n1 [,n2]] function

n1, n2: 不见得会存在，一般代表【选择进行操作的行数】，举例来说，如果我的操作是需要在 10 到 20 行之间进行的，则【10, 20 [操作行为]】

function 有下面这些东西
a: 新增，a 的后面可以接字符，而这些字符会在新的一行出现（当前的下一行）；
c: 替换，c 的后面可以接字符，这些字符可以替换 n1, n2 之间的行；
d: 删除，因为是删除，所以 d 后面通常不接任何东西；
i: 插入，i 的后面可以接字符，而这些字符会在新的一行会先（当前的上一行）；
p: 打印，亦即将某个选择的数据打印出来，通常 p 会与参数 sed -n 一起执行；
s: 替换，可以直接进行替换工作，通常这个 s 的操作可以搭配正则表达式，例如 1, 20s/old/new/g；
</pre>
<div id="outline-container-org698d7c4" class="outline-2">
<h2 id="org698d7c4">参数解析</h2>
<div class="outline-text-2" id="text-org698d7c4">
</div>
<div id="outline-container-orgfbc83e3" class="outline-3">
<h3 id="orgfbc83e3">使用多命令（-e 参数）</h3>
<div class="outline-text-3" id="text-orgfbc83e3">
<p>
要在 sed 命令行上执行多个命令时，只要用 -e 选项就行了：<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">sed -e <span style="color: #b8bb26;">'s/brown/green/; s/dog/cat/'</span> data.txt
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">$ sed -e <span style="color: #b8bb26;">'</span>
<span style="color: #b8bb26;">&gt; s/brown/green/</span>
<span style="color: #b8bb26;">&gt; s/fox/elephant/</span>
<span style="color: #b8bb26;">&gt; s/dog/cat'</span> data.txt
</pre>
</div>
</div>
</div>
<div id="outline-container-org97014ba" class="outline-3">
<h3 id="org97014ba">sed编辑器脚本（-f 参数）</h3>
<div class="outline-text-3" id="text-org97014ba">
<div class="org-src-container">
<pre class="src src-shell">$ cat script.sed
s/brown/green
s/fox/elephant/
s/dog/cat
$
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">sed -f script.sed data.txt
</pre>
</div>
</div>
</div>
<div id="outline-container-org456e007" class="outline-3">
<h3 id="org456e007">直接修改文件（-i 参数）</h3>
<div class="outline-text-3" id="text-org456e007">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #928374;"># </span><span style="color: #928374;">&#33539;&#20363;&#20845;&#65306;&#21033;&#29992; sed &#23558; regular_express.txt &#20869;&#27599;&#19968;&#34892;&#32467;&#23614;&#33509;&#20026; . &#21017;&#25442;&#25104; !</span>
$ sed -i <span style="color: #b8bb26;">'s/\.$/\!/g'</span> regular_express.txt

<span style="color: #928374;"># </span><span style="color: #928374;">&#33539;&#20363;&#19971;&#65306;&#21033;&#29992; sed &#30452;&#25509;&#22312; regular_express.txt &#26368;&#21518;&#19968;&#34892;&#21152;&#20837;&#12304;# This is a test&#12305;</span>
$ sed -i <span style="color: #b8bb26;">'$a # This is a test'</span> regular_express.txt
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd594e90" class="outline-2">
<h2 id="orgd594e90">使用地址</h2>
<div class="outline-text-2" id="text-orgd594e90">
<p>
想将命令作用于特定行或某些行，则必须用行寻址（line addressing）。<br>
</p>
</div>
<div id="outline-container-orgfebe494" class="outline-3">
<h3 id="orgfebe494">1. 数字方式的行寻址</h3>
<div class="outline-text-3" id="text-orgfebe494">
<div class="org-src-container">
<pre class="src src-shell">sed <span style="color: #b8bb26;">'2s/dog/cat/'</span> data.txt    <span style="color: #928374;"># </span><span style="color: #928374;">&#21482;&#26367;&#25442;&#31532;&#20108;&#34892;</span>
sed <span style="color: #b8bb26;">'2,3s/dog/cat/'</span> data.txt  <span style="color: #928374;"># </span><span style="color: #928374;">&#26367;&#25442;&#31532;&#20108;&#34892;&#21040;&#31532;&#19977;&#34892;</span>
sed <span style="color: #b8bb26;">'2,$s/dog/cat/'</span> data.txt  <span style="color: #928374;"># </span><span style="color: #928374;">&#26367;&#25442;&#31532;&#20108;&#34892;&#21040;&#26368;&#21518;&#19968;&#34892;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd7dd02d" class="outline-3">
<h3 id="orgd7dd02d">2. 使用文本模式过滤器</h3>
<div class="outline-text-3" id="text-orgd7dd02d">
<p>
<code>/pattern/command</code><br>
</p>

<p>
sed 编辑器会将该命令作用到包含指定文本模式的行上。<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">sed <span style="color: #b8bb26;">'/haoran/s/bash/csh/'</span> /etc/passwd
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd744797" class="outline-3">
<h3 id="orgd744797">3. 命令组合</h3>
<div class="outline-text-3" id="text-orgd744797">
<div class="org-src-container">
<pre class="src src-shell">sed <span style="color: #b8bb26;">'3,${</span>
<span style="color: #b8bb26;">s/brown/green/</span>
<span style="color: #b8bb26;">s/lazy/active/</span>
<span style="color: #b8bb26;">}'</span> data.txt
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgdafbfbe" class="outline-2">
<h2 id="orgdafbfbe">数据的查找并替换（Vim） - s</h2>
<div class="outline-text-2" id="text-orgdafbfbe">
<p>
sed 的查找与替换的功能与 vim 相当的类似。<br>
</p>

<div class="org-src-container">
<pre class="src src-bash">sed <span style="color: #b8bb26;">'s/&#35201;&#34987;&#26367;&#25442;&#30340;&#23383;&#31526;/&#26032;&#30340;&#23383;&#31526;/g'</span>
</pre>
</div>
</div>
<div id="outline-container-org61c27a6" class="outline-3">
<h3 id="org61c27a6">替换标记</h3>
<div class="outline-text-3" id="text-org61c27a6">
<p>
最后的 <code>g</code> 是替换标记，替换标记有 4 种：<br>
</p>

<ol class="org-ol">
<li>数字，表明替换第几处模式匹配的地方；<br></li>
<li>g，表明新文本将会替换所有匹配的文本；<br></li>
<li>p，表明原先行的内容要打印出来；<br></li>
<li>w file，将替换的结果写到文件中；<br></li>
</ol>

<p>
不加替换标记，默认只替换每行中出现的第一处。<br>
</p>
</div>
</div>
<div id="outline-container-orga7c981c" class="outline-3">
<h3 id="orga7c981c">分隔字符</h3>
<div class="outline-text-3" id="text-orga7c981c">
<div class="org-src-container">
<pre class="src src-shell">sed <span style="color: #b8bb26;">'s/\/bin\/bash/\/bin\/csh/'</span> /etc/passwd
</pre>
</div>

<p>
使用正斜线作为字符串分隔符，必须用反斜线来转义，这通常会带来一些困惑和错误。<br>
</p>

<p>
sed 编辑器允许选择其他字符来作为替换命令中的字符串分隔符：<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">sed <span style="color: #b8bb26;">'s!/bin/bash!/bin/csh!'</span> /etc/passwd
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgad075f2" class="outline-2">
<h2 id="orgad075f2">删除 - d</h2>
<div class="outline-text-2" id="text-orgad075f2">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #928374;"># </span><span style="color: #928374;">&#33539;&#20363;&#19968;&#65306;&#23558; /etc/passwd &#30340;&#20869;&#23481;&#21015;&#20986;&#24182;&#19988;&#25171;&#21360;&#34892;&#21495;&#65292;&#21516;&#26102;&#23558;&#31532; 2~5 &#34892;&#21024;&#38500;</span>
$ nl /etc/passwd | sed <span style="color: #b8bb26;">'2,5d'</span>

<span style="color: #928374;"># </span><span style="color: #928374;">&#20165;&#21024;&#38500;&#31532; 2 &#34892;</span>
$ nl /etc/passwd | sed <span style="color: #b8bb26;">'2d'</span>

<span style="color: #928374;"># </span><span style="color: #928374;">&#21024;&#38500;&#31532; 3 &#21040;&#26368;&#21518;&#19968;&#34892;</span>
$ nl /etc/passwd | sed <span style="color: #b8bb26;">'3,$d'</span>

$ sed <span style="color: #b8bb26;">'/number 1/d'</span> data.txt
This is line number 2.
This is line number 3.
</pre>
</div>
</div>
</div>
<div id="outline-container-org14a231d" class="outline-2">
<h2 id="org14a231d">插入 - i 和附加文本 - a</h2>
<div class="outline-text-2" id="text-org14a231d">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #fe8019;">echo</span> <span style="color: #b8bb26;">"Test Line 2"</span> | sed <span style="color: #b8bb26;">'i\</span>
<span style="color: #b8bb26;">Test Line 1'</span>

<span style="color: #fe8019;">echo</span> <span style="color: #b8bb26;">"Test Line 1"</span> | sed <span style="color: #b8bb26;">'a\</span>
<span style="color: #b8bb26;">Test Line 2'</span>

sed <span style="color: #b8bb26;">'3i\</span>
<span style="color: #b8bb26;">This is an inserted line.'</span> data.txt

sed <span style="color: #b8bb26;">'3a\</span>
<span style="color: #b8bb26;">This is an appended line.'</span> data.txt
</pre>
</div>
</div>
</div>
<div id="outline-container-org0357fcf" class="outline-2">
<h2 id="org0357fcf">替换 - c</h2>
<div class="outline-text-2" id="text-org0357fcf">
<div class="org-src-container">
<pre class="src src-bash">sed <span style="color: #b8bb26;">'3c\</span>
<span style="color: #b8bb26;">This is a changed line of text.'</span> data.txt

sed <span style="color: #b8bb26;">'/number 3/c\</span>
<span style="color: #b8bb26;">This is a changed line of text.'</span> data.txt

sed <span style="color: #b8bb26;">'2,3c\</span>
<span style="color: #b8bb26;">This is a changed line of text.'</span> data.txt
</pre>
</div>
</div>
</div>
<div id="outline-container-org80b850b" class="outline-2">
<h2 id="org80b850b">转换 - y</h2>
<div class="outline-text-2" id="text-org80b850b">
<p>
转换（transform）命令（y）是唯一可以处理单个字符的 sed 编辑器命令。<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">$ sed <span style="color: #b8bb26;">'y/123/789/'</span> data.txt
This is line number 7.
This is line number 8.
This is line number 9.
This is line number 4.
This is line number 5.
</pre>
</div>

<p>
转换命令会对 inchars 和 outcharts 值进行一对一的映射，如果 inchars 和 outchars 的长度不同，则 sed 编辑器会产生一条错误信息。<br>
</p>
</div>
</div>
<div id="outline-container-org872f838" class="outline-2">
<h2 id="org872f838">打印 -n, p, =, l</h2>
<div class="outline-text-2" id="text-org872f838">
</div>
<div id="outline-container-org99c3418" class="outline-3">
<h3 id="org99c3418">打印 sed 编辑器输出中的一行 - p</h3>
<div class="outline-text-3" id="text-org99c3418">
<div class="org-src-container">
<pre class="src src-shell">$ echo <span style="color: #b8bb26;">"this is a test"</span> | sed <span style="color: #b8bb26;">'p'</span>
this is a test
this is a test
</pre>
</div>
</div>
</div>
<div id="outline-container-org731835f" class="outline-3">
<h3 id="org731835f">打印匹配的行 - p</h3>
<div class="outline-text-3" id="text-org731835f">
<div class="org-src-container">
<pre class="src src-shell">$ sed -n <span style="color: #b8bb26;">'/number 3/p'</span> data.txt
This is line number 3.
</pre>
</div>
</div>
</div>
<div id="outline-container-org2b3dd4f" class="outline-3">
<h3 id="org2b3dd4f">打印某些行 -n, p</h3>
<div class="outline-text-3" id="text-org2b3dd4f">
<p>
以前我们想列出第 11-20 行，需要通过【head -n 20 | tail -n 10】之类的方法，sed 则可以简单的直接取出你想要的那几行。<br>
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #928374;"># </span><span style="color: #928374;">&#33539;&#20363;&#20116;&#65306;&#20165;&#21015;&#20986; /etc/passwd &#25991;&#20214;&#20869;&#30340;&#31532; 5-7 &#34892;</span>
$ nl /etc/paswd | sed -n <span style="color: #b8bb26;">'5,7p'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org35ddd62" class="outline-3">
<h3 id="org35ddd62">与修改命令一起使用</h3>
<div class="outline-text-3" id="text-org35ddd62">
<div class="org-src-container">
<pre class="src src-shell">sed -n <span style="color: #b8bb26;">'/3/{</span>
<span style="color: #b8bb26;">p</span>
<span style="color: #b8bb26;">s/line/test/p</span>
<span style="color: #b8bb26;">}'</span> data.txt
</pre>
</div>

<p>
sed 编辑器会查找包含数字 3 的行，然后执行两条命令。首先，脚本用 p 命令来打印出原始行；然后它用 s 命令替换文本，并用 p 标记打印出替换结果。输出同时显示了原来的行文本和新的行文本。<br>
</p>
</div>
</div>
<div id="outline-container-orgad2e731" class="outline-3">
<h3 id="orgad2e731">打印行号 - =</h3>
<div class="outline-text-3" id="text-orgad2e731">
<div class="org-src-container">
<pre class="src src-shell">$ sed <span style="color: #b8bb26;">'='</span> data.txt
1
This is line number 1.
2
This is line number 2.
3
This is line number 3.
4
This is line number 4.
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">$ sed -n <span style="color: #b8bb26;">'/number 3/{</span>
<span style="color: #b8bb26;">=</span>
<span style="color: #b8bb26;">p</span>
<span style="color: #b8bb26;">}'</span> data.txt
This is line numebr 3.
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd9fbbb5" class="outline-3">
<h3 id="orgd9fbbb5">列出行 - l</h3>
<div class="outline-text-3" id="text-orgd9fbbb5">
<p>
列出命令可以打印数据流中的文本和不可打印的 ASCII 字符。<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">sed -n <span style="color: #b8bb26;">'l'</span> data.txt
This line contains an escape character. \a$
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org9e5a0f9" class="outline-2">
<h2 id="org9e5a0f9">使用 sed 处理文件</h2>
<div class="outline-text-2" id="text-org9e5a0f9">
</div>
<div id="outline-container-orgc958b98" class="outline-3">
<h3 id="orgc958b98">写入文件 - w</h3>
<div class="outline-text-3" id="text-orgc958b98">
<div class="org-src-container">
<pre class="src src-bash">$ sed <span style="color: #b8bb26;">'1,2w test.txt'</span> data.txt
This is line number 1.
This is line number 2.
This is line number 3.
This is line number 4.

$ cat test.txt
This is line number 1.
This is line number 2.

$ sed <span style="color: #b8bb26;">'/number 2/w test.txt'</span> data.txt
</pre>
</div>

<p>
如果不想让行显示到 STDOUT 上，可以使用 sed 命令的 -n 参数。<br>
</p>
</div>
</div>
<div id="outline-container-org395a49b" class="outline-3">
<h3 id="org395a49b">从文件中读数据 - r</h3>
<div class="outline-text-3" id="text-org395a49b">
<p>
读取命令允许你将一个独立文件中的数据插入到数据流中。<br>
</p>

<div class="org-src-container">
<pre class="src src-bash">$ cat add.txt
This is an added line.
This is the second added line.

$ sed <span style="color: #b8bb26;">'3r add.txt'</span> data.txt
This is line number 1.
This is line number 2.
This is line number 3.
This is an added line.
This is the second added line.
This is line number 4.

<span style="color: #928374;"># </span><span style="color: #928374;">&#25991;&#20214;&#26411;&#23614;&#25554;&#20837;</span>
$ sed <span style="color: #b8bb26;">'$r add.txt'</span> data.txt
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">$ cat notice.std
Would the following people:
LIST
please report to the ship<span style="color: #b8bb26;">\'</span>s captain.

$ sed <span style="color: #b8bb26;">'/LIST/{</span>
<span style="color: #b8bb26;">r name.txt</span>
<span style="color: #b8bb26;">d</span>
<span style="color: #b8bb26;">}'</span> notice.std
Would the following people:
Blum, R       Browncoat
McGuiness, A  Alliance
Bresnahan, C  Browncoat
Harken, C     Alliance
please report to the ship<span style="color: #b8bb26;">\'</span>s captain.
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2023-02-09 16:02 Thu</p>
<p class="author">Author: Haoran Liu</p>
<p class="date">Created: 2023-02-09</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
