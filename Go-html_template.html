<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-04-13 Wed 11:44 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>html/template</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran">
<meta name="description" content="Copyright © 2022, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="static/MathJax/cdn.bootcdn.net/ajax/libs/mathjax/3.1.2/es5/tex-mml-chtml.min.js"></script>
</head>
<body>
<div id="content">
<h1 class="title">html/template</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgce32b91">Introduction</a></li>
<li><a href="#org0e0a6b9">Contexts</a></li>
<li><a href="#org5af0365">Errors</a></li>
<li><a href="#orgced6a90">A fuller picture</a></li>
<li><a href="#org5948061">Contexts</a></li>
<li><a href="#orgf1a02f0">Typed Strings</a></li>
<li><a href="#org76372fb">Security Model</a></li>
<li><a href="#orgd0d4f77">type ErrorCode</a></li>
<li><a href="#org4e3e818">type Error</a>
<ul>
<li><a href="#org79581aa">func (*Error) Error</a></li>
</ul>
</li>
<li><a href="#org565cf0b">func HTMLEscape</a></li>
<li><a href="#org7d094c8">func HTMLEscapeString</a></li>
<li><a href="#org5825850">func HTMLEscaper</a></li>
<li><a href="#org89e6b31">func JSEscape</a></li>
<li><a href="#org3fb8699">func JSEscapeString</a></li>
<li><a href="#org01375e4">func JSEscaper</a></li>
<li><a href="#orgeb82457">func URLQueryEscaper</a></li>
<li><a href="#org86c3e98">type FuncMap</a></li>
<li><a href="#org678c579">type HTML</a></li>
<li><a href="#org84e0639">type HTMLAttr</a></li>
<li><a href="#orgc73f369">type JS</a></li>
<li><a href="#org2584003">type JSStr</a></li>
<li><a href="#org7b7e7d0">type URL</a></li>
<li><a href="#org720b68f">type CSS</a></li>
<li><a href="#org986ec79">type Template</a>
<ul>
<li><a href="#org836b87b">func Must</a></li>
<li><a href="#org3a41690">func New</a></li>
<li><a href="#orga52c502">func ParseFiles</a></li>
<li><a href="#org8533716">func ParseGlob</a></li>
<li><a href="#org2a6cdd7">func (*Template) Name</a></li>
<li><a href="#org28439b2">func (*Template) Delims</a></li>
<li><a href="#org159dc94">func (*Template) Funcs</a></li>
<li><a href="#org1ac6027">func (*Template) Clone</a></li>
<li><a href="#org1b0ec53">func (*Template) Lookup</a></li>
<li><a href="#orgc8dd37f">func (*Template) Templates</a></li>
<li><a href="#orgeba1350">func (*Template) New</a></li>
<li><a href="#org7d0f888">func (*Template) AddParseTree</a></li>
<li><a href="#org436f4b9">func (*Template) Parse</a></li>
<li><a href="#org914791d">func (*Template) ParseFiles</a></li>
<li><a href="#orgfed5e96">func (*Template) ParseGlob</a></li>
<li><a href="#org0d87d10">func (*Template) Execute</a></li>
<li><a href="#org1a5a412">func (*Template) ExecuteTemplate</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgce32b91" class="outline-2">
<h2 id="orgce32b91">Introduction</h2>
<div class="outline-text-2" id="text-orgce32b91">
<p>
template包（html/template）实现了数据驱动的模板，用于生成可对抗代码注入的安全HTML输出。本包提供了和text/template包相同的接口，无论何时当输出是HTML的时候都应使用本包。<br>
</p>

<p>
此处的文档关注本包的安全特性。至于如何使用模板，请参照text/template包。<br>
</p>

<p>
本包是对text/template包的包装，两个包提供的模板API几无差别，可以安全的随意替换两包。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #8787d7;">tmpl</span>, <span style="color: #8787d7;">err</span> := template.<span style="color: #d75fd7; font-weight: bold;">New</span>(<span style="color: #2aa198;">"name"</span>).<span style="color: #d75fd7; font-weight: bold;">Parse</span>(...)
<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#30465;&#30053;&#38169;&#35823;&#26816;&#27979;</span>
err = tmpl.<span style="color: #d75fd7; font-weight: bold;">Execute</span>(out, data)
</pre>
</div>

<p>
如果成功创建了tmpl，tmpl现在是注入安全的了。否则err将返回ErrorCode里定义的某个错误。即使成功生成了模板，执行时仍可能导致ErrorCode里定义的错误。<br>
</p>

<p>
HTML模板将数据视为明文文本，必须经过编码以便安全的嵌入HTML文档。转义操作会参考上下文，因此action可以出现在JavaScript、CSS、URI上下文环境里。<br>
</p>

<p>
本包使用的安全模型假设模板的作者是可信任的，但用于执行的数据不可信。更多细节参见下面。<br>
</p>

<p>
示例：<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #2aa198;">"text/template"</span>
<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">...</span>
<span style="color: #8787d7;">t</span>, <span style="color: #8787d7;">err</span> := template.<span style="color: #d75fd7; font-weight: bold;">New</span>(<span style="color: #2aa198;">"foo"</span>).<span style="color: #d75fd7; font-weight: bold;">Parse</span>(<span style="color: #2aa198;">`{{define "T"}}Hello, {{.}}!{{end}}`</span>)
err = t.<span style="color: #d75fd7; font-weight: bold;">ExecuteTemplate</span>(out, <span style="color: #2aa198;">"T"</span>, <span style="color: #2aa198;">"&lt;script&gt;alert('you have been pwned')&lt;/script&gt;"</span>)
</pre>
</div>

<p>
生成：<br>
</p>

<div class="org-src-container">
<pre class="src src-go">Hello, &lt;script&gt;<span style="color: #d75fd7; font-weight: bold;">alert</span>(<span style="color: #2aa198;">'you have been pwned'</span>)&lt;/script&gt;!
</pre>
</div>

<p>
但在html/template包里会根据上下文自动转义：<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #2aa198;">"html/template"</span>
<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">...</span>
<span style="color: #8787d7;">t</span>, <span style="color: #8787d7;">err</span> := template.<span style="color: #d75fd7; font-weight: bold;">New</span>(<span style="color: #2aa198;">"foo"</span>).<span style="color: #d75fd7; font-weight: bold;">Parse</span>(<span style="color: #2aa198;">`{{define "T"}}Hello, {{.}}!{{end}}`</span>)
err = t.<span style="color: #d75fd7; font-weight: bold;">ExecuteTemplate</span>(out, <span style="color: #2aa198;">"T"</span>, <span style="color: #2aa198;">"&lt;script&gt;alert('you have been pwned')&lt;/script&gt;"</span>)
</pre>
</div>

<p>
生成安全的转义后HTML输出：<br>
</p>

<pre class="example">
Hello, &amp;lt;script&amp;gt;alert(&amp;#39;you have been pwned&amp;#39;)&amp;lt;/script&amp;gt;!
</pre>
</div>
</div>
<div id="outline-container-org0e0a6b9" class="outline-2">
<h2 id="org0e0a6b9">Contexts</h2>
<div class="outline-text-2" id="text-org0e0a6b9">
<p>
本包可以理解HTML、CSS、JavaScript和URI。它会给每一个简单的action pipeline都添加处理函数，如下例：<br>
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #d75fd7; font-weight: bold;">a</span> <span style="color: #8787d7;">href</span>=<span style="color: #2aa198;">"/search?q={{.}}"</span>&gt;{{.}}&lt;/<span style="color: #d75fd7; font-weight: bold;">a</span>&gt;
</pre>
</div>

<p>
在解析时每个{{.}}都会在必要时重写添加转义函数，此例中会修改为：<br>
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #d75fd7; font-weight: bold;">a</span> <span style="color: #8787d7;">href</span>=<span style="color: #2aa198;">"/search?q={{. | urlquery}}"</span>&gt;{{. | html}}&lt;/<span style="color: #d75fd7; font-weight: bold;">a</span>&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-org5af0365" class="outline-2">
<h2 id="org5af0365">Errors</h2>
<div class="outline-text-2" id="text-org5af0365">
<p>
细节请参见ErrorCode类型的文档。<br>
</p>
</div>
</div>
<div id="outline-container-orgced6a90" class="outline-2">
<h2 id="orgced6a90">A fuller picture</h2>
<div class="outline-text-2" id="text-orgced6a90">
<p>
本包剩余部分的注释第一次阅读时可以跳过；这些部分包括理解转码文本和错误信息的必要细节。多数使用者无需理解这些细节。<br>
</p>
</div>
</div>
<div id="outline-container-org5948061" class="outline-2">
<h2 id="org5948061">Contexts</h2>
<div class="outline-text-2" id="text-org5948061">
<p>
假设{{.}}是`O'Reilly: How are &lt;i&gt;you&lt;/i&gt;?`，下表展示了{{.}}用于左侧模板时的输出：<br>
</p>

<pre class="example">
Context                          {{.}} After
{{.}}                            O'Reilly: How are &amp;lt;i&amp;gt;you&amp;lt;/i&amp;gt;?
&lt;a title='{{.}}'&gt;                O&amp;#39;Reilly: How are you?
&lt;a href="/{{.}}"&gt;                O&amp;#39;Reilly: How are %3ci%3eyou%3c/i%3e?
&lt;a href="?q={{.}}"&gt;              O&amp;#39;Reilly%3a%20How%20are%3ci%3e...%3f
&lt;a onx='f("{{.}}")'&gt;             O\x27Reilly: How are \x3ci\x3eyou...?
&lt;a onx='f({{.}})'&gt;               "O\x27Reilly: How are \x3ci\x3eyou...?"
&lt;a onx='pattern = /{{.}}/;'&gt;     O\x27Reilly: How are \x3ci\x3eyou...\x3f
</pre>

<p>
如果用在不安全的上下文里，值就可能被过滤掉：<br>
</p>

<pre class="example">
Context                          {{.}} After
&lt;a href="{{.}}"&gt;                 #ZgotmplZ
</pre>

<p>
因为"O'Reilly:"不是一个可以接受的协议名，如"http:"。<br>
</p>

<p>
如果{{.}}是一个无害的词汇，如`left`，那么它就可以出现在更多地方。<br>
</p>

<pre class="example">
Context                              {{.}} After
{{.}}                                left
&lt;a title='{{.}}'&gt;                    left
&lt;a href='{{.}}'&gt;                     left
&lt;a href='/{{.}}'&gt;                    left
&lt;a href='?dir={{.}}'&gt;                left
&lt;a style="border-{{.}}: 4px"&gt;        left
&lt;a style="align: {{.}}"&gt;             left
&lt;a style="background: '{{.}}'&gt;       left
&lt;a style="background: url('{{.}}')&gt;  left
&lt;style&gt;p.{{.}} {color:red}&lt;/style&gt;   left
</pre>

<p>
如果{{.}}是非字符串类型的值，可以用于JavaScript上下文环境里：<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">struct</span>{A,B <span style="color: #df005f; font-weight: bold;">string</span>}{ <span style="color: #2aa198;">"foo"</span>, <span style="color: #2aa198;">"bar"</span> }
</pre>
</div>

<p>
将该值应用在在转义后的模板里：<br>
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #d75fd7; font-weight: bold;">script</span>&gt;var pair = {{.}};&lt;/<span style="color: #d75fd7; font-weight: bold;">script</span>&gt;
</pre>
</div>

<p>
模板输出为：<br>
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #d75fd7; font-weight: bold;">script</span>&gt;var pair = {"A": "foo", "B": "bar"};&lt;/<span style="color: #d75fd7; font-weight: bold;">script</span>&gt;
</pre>
</div>

<p>
请参见json包来理解非字符串内容是如何序列化并嵌入JavaScript里的。<br>
</p>
</div>
</div>
<div id="outline-container-orgf1a02f0" class="outline-2">
<h2 id="orgf1a02f0">Typed Strings</h2>
<div class="outline-text-2" id="text-orgf1a02f0">
<p>
本包默认所有的pipeline都生成明文字符串，它会在必要时添加转义pipeline阶段以安全并正确的将明文字符串嵌入输出的文本里。<br>
</p>

<p>
当用于执行的数据不是明文字符串时，你可以通过显式改变数据的类型以避免其被错误的转义。<br>
</p>

<p>
类型HTML、JS、URL和其他content.go里定义的类型可以保持不被转义的安全内容。<br>
</p>

<p>
模板：<br>
</p>

<pre class="example">
Hello, {{.}}!
</pre>

<p>
可以采用如下调用：<br>
</p>

<div class="org-src-container">
<pre class="src src-go">tmpl.<span style="color: #d75fd7; font-weight: bold;">Execute</span>(out, <span style="color: #d75fd7; font-weight: bold;">HTML</span>(<span style="color: #2aa198;">`&lt;b&gt;World&lt;/b&gt;`</span>))
</pre>
</div>

<p>
来输出：<br>
</p>

<pre class="example">
Hello, &lt;b&gt;World&lt;/b&gt;!
</pre>

<p>
而不是：<br>
</p>

<pre class="example">
Hello, &amp;lt;b&amp;gt;World&amp;lt;b&amp;gt;!
</pre>

<p>
如果{{.}}是一个内建类型字符串就会产生该输出。<br>
</p>
</div>
</div>
<div id="outline-container-org76372fb" class="outline-2">
<h2 id="org76372fb">Security Model</h2>
<div class="outline-text-2" id="text-org76372fb">
<p>
本包里安全的定义参加如下网页：<br>
</p>

<p>
<a href="http://js-quasis-libraries-and-repl.googlecode.com/svn/trunk/safetemplate.html#problem_definition">http://js-quasis-libraries-and-repl.googlecode.com/svn/trunk/safetemplate.html#problem_definition</a><br>
</p>

<p>
本包假设模板作者可信而执行数据不可信，目标是在保证安全性的前提下保证效率：<br>
</p>

<p>
结构保留特性：“……当模板作者用安全的模板语言写了一个HTML标签时，不管数据的值为何浏览器都会将输出的相应部分解释为标签，该情况在其他结构里也成立，如属性边界以及JS和CSS边界。”<br>
</p>

<p>
代码影响特性：“……只有模板作者指定的代码能作为注入模板输出到页面的结果执行，所有模板作者指定的代码都应如此。”<br>
</p>

<p>
最少惊讶特性：“一个熟悉HTML、CSS、JS的开发者（或代码阅读者），应可以正确的推断出{{.}}会如何转义。”<br>
</p>
</div>
</div>
<div id="outline-container-orgd0d4f77" class="outline-2">
<h2 id="orgd0d4f77">type ErrorCode</h2>
<div class="outline-text-2" id="text-orgd0d4f77">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">ErrorCode</span> <span style="color: #df005f; font-weight: bold;">int</span>
</pre>
</div>

<p>
ErrorCode是代表错误种类的错误码。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">const</span> (
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">OK&#34920;&#31034;&#27809;&#26377;&#20986;&#38169;</span>
        <span style="color: #d75fd7;">OK</span>  <span style="color: #df005f; font-weight: bold;">ErrorCode</span> = <span style="color: #d75fd7;">iota</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#24403;&#19978;&#19979;&#25991;&#29615;&#22659;&#26377;&#27495;&#20041;&#26102;&#23548;&#33268;ErrAmbigContext&#65306;</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#20030;&#20363;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&lt;a href="{{if .C}}/path/{{else}}/search?q={{end}}{{.X}}"&amp;rt;</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#35828;&#26126;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">{{.X}}&#30340;URL&#19978;&#19979;&#25991;&#29615;&#22659;&#26377;&#27495;&#20041;&#65292;&#22240;&#20026;&#26681;&#25454;{{.C}}&#30340;&#20540;&#65292;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#23427;&#21487;&#20197;&#26159;URL&#30340;&#21518;&#32512;&#65292;&#25110;&#32773;&#26159;&#26597;&#35810;&#30340;&#21442;&#25968;&#12290;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#23558;{{.X}}&#31227;&#21160;&#21040;&#22914;&#19979;&#24773;&#20917;&#21487;&#20197;&#28040;&#38500;&#27495;&#20041;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&lt;a href="{{if .C}}/path/{{.X}}{{else}}/search?q={{.X}}{{end}}"&amp;rt;</span>
        <span style="color: #d75fd7;">ErrAmbigContext</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#26399;&#26395;&#31354;&#30333;&#12289;&#23646;&#24615;&#21517;&#12289;&#26631;&#31614;&#32467;&#26463;&#26631;&#24535;&#32780;&#27809;&#26377;&#26102;&#65292;&#26631;&#31614;&#21517;&#25110;&#26080;&#24341;&#21495;&#26631;&#31614;&#20540;&#21253;&#21547;&#38750;&#27861;&#23383;&#31526;&#26102;&#65292;</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#20250;&#23548;&#33268;ErrBadHTML&#65307;&#20030;&#20363;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&lt;a href = /search?q=foo&amp;rt;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&lt;href=foo&amp;rt;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&lt;form na&lt;e=...&amp;rt;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&lt;option selected&lt;</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#35752;&#35770;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#19968;&#33324;&#26159;&#22240;&#20026;HTML&#20803;&#32032;&#36755;&#20837;&#20102;&#38169;&#35823;&#30340;&#26631;&#31614;&#21517;&#12289;&#23646;&#24615;&#21517;&#25110;&#32773;&#26410;&#29992;&#24341;&#21495;&#30340;&#23646;&#24615;&#20540;&#65292;&#23548;&#33268;&#35299;&#26512;&#22833;&#36133;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#23558;&#25152;&#26377;&#30340;&#23646;&#24615;&#37117;&#29992;&#24341;&#21495;&#25324;&#36215;&#26469;&#26159;&#26368;&#22909;&#30340;&#31574;&#30053;</span>
        <span style="color: #d75fd7;">ErrBadHTML</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">{{if}}&#31561;&#20998;&#25903;&#19981;&#22312;&#30456;&#21516;&#19978;&#19979;&#25991;&#24320;&#22987;&#21644;&#32467;&#26463;&#26102;&#65292;&#23548;&#33268;ErrBranchEnd</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#31034;&#20363;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">{{if .C}}&lt;a href="{{end}}{{.X}}</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#35752;&#35770;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">html/template&#21253;&#20250;&#38745;&#24577;&#30340;&#26816;&#39564;{{if}}&#12289;{{range}}&#25110;{{with}}&#30340;&#27599;&#19968;&#20010;&#20998;&#25903;&#65292;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#20197;&#23545;&#21518;&#32493;&#30340;pipeline&#36827;&#34892;&#36716;&#20041;&#12290;&#35813;&#20363;&#20986;&#29616;&#20102;&#27495;&#20041;&#65292;{{.X}}&#21487;&#33021;&#26159;HTML&#25991;&#26412;&#33410;&#28857;&#65292;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#25110;&#32773;&#26159;HTML&#23646;&#24615;&#20540;&#30340;URL&#30340;&#21069;&#32512;&#65292;{{.X}}&#30340;&#19978;&#19979;&#25991;&#29615;&#22659;&#21487;&#20197;&#30830;&#23450;&#22914;&#20309;&#36716;&#20041;&#65292;&#20294;&#35813;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#19978;&#19979;&#25991;&#29615;&#22659;&#21364;&#26159;&#30001;&#36816;&#34892;&#26102;{{.C}}&#30340;&#20540;&#20915;&#23450;&#30340;&#65292;&#19981;&#33021;&#22312;&#32534;&#35793;&#26399;&#33719;&#30693;&#12290;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#36825;&#31181;&#38382;&#39064;&#19968;&#33324;&#26159;&#22240;&#20026;&#32570;&#23569;&#24341;&#21495;&#25110;&#32773;&#35282;&#25324;&#21495;&#24341;&#36215;&#30340;&#65292;&#21478;&#19968;&#20123;&#21017;&#21487;&#20197;&#36890;&#36807;&#37325;&#26500;&#23558;&#20004;&#20010;&#19978;&#19979;&#25991;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#25918;&#36827;if&#12289;range&#12289;with&#30340;&#19981;&#21516;&#20998;&#25903;&#37324;&#26469;&#36991;&#20813;&#65292;&#22914;&#26524;&#38382;&#39064;&#20986;&#29616;&#22312;&#21442;&#25968;&#38271;&#24230;&#19968;&#23450;&#38750;0&#30340;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">{{range}}&#30340;&#20998;&#25903;&#37324;&#65292;&#21487;&#20197;&#36890;&#36807;&#28155;&#21152;&#26080;&#25928;{{else}}&#20998;&#25903;&#35299;&#20915;&#12290;</span>
        <span style="color: #d75fd7;">ErrBranchEnd</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#22914;&#26524;&#20197;&#38750;&#25991;&#26412;&#19978;&#19979;&#25991;&#32467;&#26463;&#65292;&#21017;&#23548;&#33268;ErrEndContext</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#31034;&#20363;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&lt;div</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&lt;div title="no close quote&amp;rt;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&lt;script&gt;f()</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#35752;&#35770;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#25191;&#34892;&#27169;&#26495;&#24517;&#39035;&#29983;&#25104;HTML&#30340;&#19968;&#20010;&#25991;&#26723;&#29255;&#27573;&#65292;&#20197;&#26410;&#38381;&#21512;&#26631;&#31614;&#32467;&#26463;&#30340;&#27169;&#26495;&#37117;&#20250;&#24341;&#21457;&#26412;&#38169;&#35823;&#12290;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#19981;&#29992;&#22312;HTML&#19978;&#19979;&#25991;&#25110;&#32773;&#29983;&#25104;&#19981;&#23436;&#25972;&#29255;&#27573;&#30340;&#27169;&#26495;&#19981;&#24212;&#30452;&#25509;&#25191;&#34892;&#12290;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">{{define "main"}} &lt;script&amp;rt;{{template "helper"}}&lt;/script&gt; {{end}}</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">{{define "helper"}} document.write(' &lt;div title=" ') {{end}}</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#27169;&#26495;"helper"&#19981;&#33021;&#29983;&#25104;&#21512;&#27861;&#30340;&#25991;&#26723;&#29255;&#27573;&#65292;&#25152;&#20197;&#19981;&#30452;&#25509;&#25191;&#34892;&#65292;&#29992;js&#29983;&#25104;&#12290;</span>
        <span style="color: #d75fd7;">ErrEndContext</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#35843;&#29992;&#19981;&#23384;&#22312;&#30340;&#27169;&#26495;&#26102;&#23548;&#33268;ErrNoSuchTemplate</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#31034;&#20363;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">{{define "main"}}&lt;div {{template "attrs"}}&amp;rt;{{end}}</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">{{define "attrs"}}href="{{.URL}}"{{end}}</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#35752;&#35770;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">html/template&#21253;&#30053;&#36807;&#27169;&#26495;&#35843;&#29992;&#35745;&#31639;&#19978;&#19979;&#25991;&#29615;&#22659;&#12290;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#27492;&#20363;&#20013;&#65292;&#24403;&#34987;"main"&#27169;&#26495;&#35843;&#29992;&#26102;&#65292;"attrs"&#27169;&#26495;&#30340;{{.URL}}&#24517;&#39035;&#35270;&#20026;&#19968;&#20010;URL&#65307;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#20294;&#22914;&#26524;&#35299;&#26512;"main"&#26102;&#65292;"attrs"&#36824;&#26410;&#34987;&#23450;&#20041;&#65292;&#23601;&#20250;&#23548;&#33268;&#26412;&#38169;&#35823;</span>
        <span style="color: #d75fd7;">ErrNoSuchTemplate</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#19981;&#33021;&#35745;&#31639;&#36755;&#20986;&#20301;&#32622;&#30340;&#19978;&#19979;&#25991;&#29615;&#22659;&#26102;&#65292;&#23548;&#33268;ErrOutputContext</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#31034;&#20363;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">{{define "t"}}{{if .T}}{{template "t" .T}}{{end}}{{.H}}",{{end}}</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#35752;&#35770;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#19968;&#20010;&#36882;&#24402;&#30340;&#27169;&#26495;&#65292;&#20854;&#36215;&#22987;&#21644;&#32467;&#26463;&#30340;&#19978;&#19979;&#25991;&#29615;&#22659;&#19981;&#21516;&#26102;&#65307;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#19981;&#33021;&#35745;&#31639;&#20986;&#21487;&#20449;&#30340;&#36755;&#20986;&#20301;&#32622;&#19978;&#19979;&#25991;&#29615;&#22659;&#26102;&#65292;&#23601;&#21487;&#33021;&#23548;&#33268;&#26412;&#38169;&#35823;&#12290;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#26816;&#26597;&#21508;&#20010;&#21629;&#21517;&#27169;&#26495;&#26159;&#21542;&#26377;&#38169;&#35823;&#65307;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#22914;&#26524;&#27169;&#26495;&#19981;&#24212;&#22312;&#21629;&#21517;&#30340;&#36215;&#22987;&#19978;&#19979;&#25991;&#29615;&#22659;&#35843;&#29992;&#65292;&#26816;&#26597;&#22312;&#19981;&#26399;&#26395;&#19978;&#19979;&#25991;&#29615;&#22659;&#20013;&#23545;&#35813;&#27169;&#26495;&#30340;&#35843;&#29992;&#65307;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#25110;&#32773;&#23558;&#36882;&#24402;&#27169;&#26495;&#37325;&#26500;&#20026;&#38750;&#36882;&#24402;&#27169;&#26495;&#65307;</span>
        <span style="color: #d75fd7;">ErrOutputContext</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#23578;&#26410;&#25903;&#25345;JS&#27491;&#21017;&#34920;&#36798;&#24335;&#25554;&#20837;&#23383;&#31526;&#38598;</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#31034;&#20363;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//     </span><span style="color: #008787; background-color: #262626;">&lt;script&gt;var pattern = /foo[{{.Chars}}]/&lt;/script&amp;rt;</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#35752;&#35770;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">html/template&#19981;&#25903;&#25345;&#21521;JS&#27491;&#21017;&#34920;&#36798;&#24335;&#37324;&#25554;&#20837;&#23383;&#38754;&#20540;&#23383;&#31526;&#38598;</span>
        <span style="color: #d75fd7;">ErrPartialCharset</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#37096;&#20998;&#36716;&#20041;&#24207;&#21015;&#23578;&#26410;&#25903;&#25345;</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#31034;&#20363;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&lt;script&gt;alert("\{{.X}}")&lt;/script&amp;rt;</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#35752;&#35770;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">html/template&#21253;&#19981;&#25903;&#25345;&#32039;&#36319;&#22312;&#21453;&#26012;&#26464;&#21518;&#38754;&#30340;action</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#36825;&#19968;&#33324;&#26159;&#38169;&#35823;&#30340;&#65292;&#26377;&#26356;&#22909;&#30340;&#35299;&#20915;&#26041;&#27861;&#65292;&#20363;&#22914;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//     </span><span style="color: #008787; background-color: #262626;">&lt;script&gt;alert("{{.X}}")&lt;/script&amp;rt;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#21487;&#20197;&#24037;&#20316;&#65292;&#22914;&#26524;{{.X}}&#26159;&#37096;&#20998;&#36716;&#20041;&#24207;&#21015;&#65292;&#22914;"xA0"&#65292;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#21487;&#20197;&#23558;&#25972;&#20010;&#24207;&#21015;&#26631;&#35760;&#20026;&#23433;&#20840;&#25991;&#26412;&#65306;JSStr(`\xA0`)</span>
        <span style="color: #d75fd7;">ErrPartialEscape</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">range&#24490;&#29615;&#30340;&#37325;&#20837;&#21475;&#20986;&#38169;&#65292;&#23548;&#33268;ErrRangeLoopReentry</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#31034;&#20363;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&lt;script&gt;var x = [{{range .}}'{{.}},{{end}}]&lt;/script&amp;rt;</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#35752;&#35770;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#22914;&#26524;range&#30340;&#36845;&#20195;&#37096;&#20998;&#23548;&#33268;&#20854;&#32467;&#26463;&#20110;&#19978;&#19968;&#27425;&#24490;&#29615;&#30340;&#21478;&#19968;&#19978;&#19979;&#25991;&#65292;&#23558;&#19981;&#20250;&#26377;&#21807;&#19968;&#30340;&#19978;&#19979;&#25991;&#29615;&#22659;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#27492;&#20363;&#20013;&#65292;&#32570;&#23569;&#19968;&#20010;&#24341;&#21495;&#65292;&#22240;&#27492;&#26080;&#27861;&#30830;&#23450;{{.}}&#26159;&#23384;&#22312;&#20110;&#19968;&#20010;JS&#23383;&#31526;&#20018;&#37324;&#65292;&#36824;&#26159;&#19968;&#20010;JS&#20540;&#25991;&#26412;&#37324;&#12290;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#31532;&#20108;&#27425;&#36845;&#20195;&#29983;&#25104;&#31867;&#20284;&#19979;&#38754;&#30340;&#36755;&#20986;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//     </span><span style="color: #008787; background-color: #262626;">&lt;script&gt;var x = ['firstValue,'secondValue]&lt;/script&amp;rt;</span>
        <span style="color: #d75fd7;">ErrRangeLoopReentry</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#26012;&#26464;&#21487;&#20197;&#24320;&#22987;&#19968;&#20010;&#38500;&#27861;&#25110;&#32773;&#27491;&#21017;&#34920;&#36798;&#24335;</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#31034;&#20363;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&lt;script&amp;rt;</span>
        <span style="color: #008787; background-color: #262626;">//     </span><span style="color: #008787; background-color: #262626;">{{if .C}}var x = 1{{end}}</span>
        <span style="color: #008787; background-color: #262626;">//     </span><span style="color: #008787; background-color: #262626;">/-{{.N}}/i.test(x) ? doThis : doThat();</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&lt;/script&amp;rt;</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#35752;&#35770;&#65306;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#19978;&#20363;&#21487;&#20197;&#29983;&#25104;`var x = 1/-2/i.test(s)...`&#65292;&#20854;&#20013;&#31532;&#19968;&#20010;&#26012;&#26464;&#20316;&#20026;&#38500;&#21495;&#65307;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#25110;&#32773;&#23427;&#20063;&#21487;&#20197;&#29983;&#25104;`/-2/i.test(s)`&#65292;&#20854;&#20013;&#31532;&#19968;&#20010;&#26012;&#26464;&#29983;&#25104;&#19968;&#20010;&#27491;&#21017;&#34920;&#36798;&#24335;&#23383;&#38754;&#20540;</span>
        <span style="color: #008787; background-color: #262626;">//   </span><span style="color: #008787; background-color: #262626;">&#26816;&#26597;&#20998;&#25903;&#20013;&#26159;&#21542;&#32570;&#23569;&#20998;&#21495;&#65292;&#25110;&#32773;&#20351;&#29992;&#25324;&#21495;&#26469;&#26126;&#30830;&#20320;&#30340;&#24847;&#22270;</span>
        <span style="color: #d75fd7;">ErrSlashAmbig</span>
)
</pre>
</div>

<p>
我们为转义模板时的所有错误都定义了错误码，但经过转义修正的模板仍可能在运行时出错：<br>
</p>

<p>
输出"ZgotmplZ"的例子：<br>
</p>

<pre class="example">
&lt;img src="{{.X}}"&gt;
其中{{.X}}执行结果为`javascript:...`
</pre>

<p>
讨论：<br>
</p>

<pre class="example">
"ZgotmplZ"是一个特殊值，表示运行时在CSS或URL上下文环境生成的不安全内容。本例的输出为：
	&lt;img src="#ZgotmplZ"&gt;
如果数据来源可信，请转换内容类型来避免被滤除：URL(`javascript:...`)
</pre>
</div>
</div>
<div id="outline-container-org4e3e818" class="outline-2">
<h2 id="org4e3e818">type Error</h2>
<div class="outline-text-2" id="text-org4e3e818">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">Error</span> <span style="color: #268bd2; font-weight: bold;">struct</span> {
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">ErrorCode&#25551;&#36848;&#38169;&#35823;&#30340;&#31181;&#31867;</span>
        ErrorCode <span style="color: #df005f; font-weight: bold;">ErrorCode</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">Name&#26159;&#21457;&#29983;&#38169;&#35823;&#30340;&#27169;&#26495;&#30340;&#21517;&#23383;</span>
        Name <span style="color: #df005f; font-weight: bold;">string</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">Line&#26159;&#38169;&#35823;&#20301;&#32622;&#22312;&#27169;&#26495;&#21407;&#25991;&#20013;&#30340;&#34892;&#21495;&#25110;&#32773;0</span>
        Line <span style="color: #df005f; font-weight: bold;">int</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">Description&#26159;&#20379;&#35843;&#35797;&#32773;&#38405;&#35835;&#30340;&#38169;&#35823;&#25551;&#36848;</span>
        Description <span style="color: #df005f; font-weight: bold;">string</span>
}
</pre>
</div>

<p>
Error描述在模板转义时出现的错误。<br>
</p>
</div>
<div id="outline-container-org79581aa" class="outline-3">
<h3 id="org79581aa">func (*Error) Error</h3>
<div class="outline-text-3" id="text-org79581aa">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> (<span style="color: #8787d7;">e</span> *<span style="color: #df005f; font-weight: bold;">Error</span>) <span style="color: #d75fd7; font-weight: bold;">Error</span>() <span style="color: #df005f; font-weight: bold;">string</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org565cf0b" class="outline-2">
<h2 id="org565cf0b">func HTMLEscape</h2>
<div class="outline-text-2" id="text-org565cf0b">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">HTMLEscape</span>(<span style="color: #8787d7;">w</span> <span style="color: #df005f; font-weight: bold;">io.Writer</span>, <span style="color: #8787d7;">b</span> []<span style="color: #df005f; font-weight: bold;">byte</span>)
</pre>
</div>

<p>
函数向w中写入b的HTML转义等价表示。<br>
</p>
</div>
</div>
<div id="outline-container-org7d094c8" class="outline-2">
<h2 id="org7d094c8">func HTMLEscapeString</h2>
<div class="outline-text-2" id="text-org7d094c8">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">HTMLEscapeString</span>(<span style="color: #8787d7;">s</span> <span style="color: #df005f; font-weight: bold;">string</span>) <span style="color: #df005f; font-weight: bold;">string</span>
</pre>
</div>

<p>
返回s的HTML转义等价表示字符串。<br>
</p>
</div>
</div>
<div id="outline-container-org5825850" class="outline-2">
<h2 id="org5825850">func HTMLEscaper</h2>
<div class="outline-text-2" id="text-org5825850">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">HTMLEscaper</span>(<span style="color: #8787d7;">args</span> ...<span style="color: #268bd2; font-weight: bold;">interface</span>{}) <span style="color: #df005f; font-weight: bold;">string</span>
</pre>
</div>

<p>
函数返回其所有参数文本表示的HTML转义等价表示字符串。<br>
</p>
</div>
</div>
<div id="outline-container-org89e6b31" class="outline-2">
<h2 id="org89e6b31">func JSEscape</h2>
<div class="outline-text-2" id="text-org89e6b31">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">JSEscape</span>(<span style="color: #8787d7;">w</span> <span style="color: #df005f; font-weight: bold;">io.Writer</span>, <span style="color: #8787d7;">b</span> []<span style="color: #df005f; font-weight: bold;">byte</span>)
</pre>
</div>

<p>
函数向w中写入b的JavaScript转义等价表示。<br>
</p>
</div>
</div>
<div id="outline-container-org3fb8699" class="outline-2">
<h2 id="org3fb8699">func JSEscapeString</h2>
<div class="outline-text-2" id="text-org3fb8699">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">JSEscapeString</span>(<span style="color: #8787d7;">s</span> <span style="color: #df005f; font-weight: bold;">string</span>) <span style="color: #df005f; font-weight: bold;">string</span>
</pre>
</div>

<p>
返回s的JavaScript转义等价表示字符串。<br>
</p>
</div>
</div>
<div id="outline-container-org01375e4" class="outline-2">
<h2 id="org01375e4">func JSEscaper</h2>
<div class="outline-text-2" id="text-org01375e4">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">JSEscaper</span>(<span style="color: #8787d7;">args</span> ...<span style="color: #268bd2; font-weight: bold;">interface</span>{}) <span style="color: #df005f; font-weight: bold;">string</span>
</pre>
</div>

<p>
函数返回其所有参数文本表示的JavaScript转义等价表示字符串。<br>
</p>
</div>
</div>
<div id="outline-container-orgeb82457" class="outline-2">
<h2 id="orgeb82457">func URLQueryEscaper</h2>
<div class="outline-text-2" id="text-orgeb82457">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">URLQueryEscaper</span>(<span style="color: #8787d7;">args</span> ...<span style="color: #268bd2; font-weight: bold;">interface</span>{}) <span style="color: #df005f; font-weight: bold;">string</span>
</pre>
</div>

<p>
函数返回其所有参数文本表示的可以嵌入URL查询的转义等价表示字符串。<br>
</p>
</div>
</div>
<div id="outline-container-org86c3e98" class="outline-2">
<h2 id="org86c3e98">type FuncMap</h2>
<div class="outline-text-2" id="text-org86c3e98">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">FuncMap</span> <span style="color: #268bd2; font-weight: bold;">map</span>[<span style="color: #df005f; font-weight: bold;">string</span>]<span style="color: #268bd2; font-weight: bold;">interface</span>{}
</pre>
</div>

<p>
FuncMap类型定义了函数名字符串到函数的映射，每个函数都必须有1到2个返回值，如果有2个则后一个必须是error接口类型；如果有2个返回值的方法返回的error非nil，模板执行会中断并返回给调用者该错误。该类型拷贝自text/template包的同名类型，因此不需要导入该包以使用该类型。<br>
</p>
</div>
</div>
<div id="outline-container-org678c579" class="outline-2">
<h2 id="org678c579">type HTML</h2>
<div class="outline-text-2" id="text-org678c579">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">HTML</span> <span style="color: #df005f; font-weight: bold;">string</span>
</pre>
</div>

<p>
HTML用于封装一个已知安全的HTML文档片段。它不应被第三方使用，也不能用于含有未闭合的标签或注释的HTML文本。该类型适用于封装一个效果良好的HTML生成器生成的HTML文本或者本包模板的输出的文本。<br>
</p>
</div>
</div>
<div id="outline-container-org84e0639" class="outline-2">
<h2 id="org84e0639">type HTMLAttr</h2>
<div class="outline-text-2" id="text-org84e0639">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">HTMLAttr</span> <span style="color: #df005f; font-weight: bold;">string</span>
</pre>
</div>

<p>
HTMLAttr用来封装一个来源可信的HTML属性，如` dir="ltr"`。<br>
</p>
</div>
</div>
<div id="outline-container-orgc73f369" class="outline-2">
<h2 id="orgc73f369">type JS</h2>
<div class="outline-text-2" id="text-orgc73f369">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">JS</span> <span style="color: #df005f; font-weight: bold;">string</span>
</pre>
</div>

<p>
JS用于封装一个已知安全的EcmaScript5表达式，如`(x + y * z())`。模板作者有责任确保封装的字符串不会破坏原有的语义，也不能包含有歧义的声明或表达式，如"{ foo: bar() }\n['foo']()"，这一句既是合法的表达式也是语义完全不同的合法程序。<br>
</p>
</div>
</div>
<div id="outline-container-org2584003" class="outline-2">
<h2 id="org2584003">type JSStr</h2>
<div class="outline-text-2" id="text-org2584003">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">JSStr</span> <span style="color: #df005f; font-weight: bold;">string</span>
</pre>
</div>

<p>
JSStr用于封装一个打算嵌入JavaScript表达式中的字符序列，该字符串必须匹配一系列StringCharacters：<br>
</p>

<pre class="example">
StringCharacter :: 除了`\`和行终止符的SourceCharacter | EscapeSequence
</pre>

<p>
注意不允许换行，JSStr("foo\\nbar")是可以的，但JSStr("foo\\\nbar")不可以。<br>
</p>
</div>
</div>
<div id="outline-container-org7b7e7d0" class="outline-2">
<h2 id="org7b7e7d0">type URL</h2>
<div class="outline-text-2" id="text-org7b7e7d0">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">URL</span> <span style="color: #df005f; font-weight: bold;">string</span>
</pre>
</div>

<p>
URL用来封装一个已知安全的URL或URL子字符串（参见RFC 3986）<br>
</p>

<p>
形如`javascript:checkThatFormNotEditedBeforeLeavingPage()`的来源可信的URL应写进页面里，但一般动态的`javascript:` URL排除在外（不写进页面），因为它们是频繁使用的注入向量。<br>
</p>
</div>
</div>
<div id="outline-container-org720b68f" class="outline-2">
<h2 id="org720b68f">type CSS</h2>
<div class="outline-text-2" id="text-org720b68f">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">CSS</span> <span style="color: #df005f; font-weight: bold;">string</span>
</pre>
</div>

<p>
CSS用于包装匹配如下任一条的已知安全的内容：<br>
</p>

<pre class="example">
1. CSS3样式表，如`p { color: purple }`
2. CSS3规则，如`a[href=~"https:"].foo#bar`
3. CSS3声明，如`color: red; margin: 2px`
4. CSS3规则，如`rgba(0, 0, 255, 127)`
</pre>

<p>
参见：<a href="http://www.w3.org/TR/css3-syntax/#parsing">http://www.w3.org/TR/css3-syntax/#parsing</a> <br>
</p>

<p>
以及：<a href="https://web.archive.org/web/20090211114933/http://w3.org/TR/css3-syntax#style">https://web.archive.org/web/20090211114933/http://w3.org/TR/css3-syntax#style</a><br>
</p>
</div>
</div>
<div id="outline-container-org986ec79" class="outline-2">
<h2 id="org986ec79">type Template</h2>
<div class="outline-text-2" id="text-org986ec79">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">Template</span> <span style="color: #268bd2; font-weight: bold;">struct</span> {
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#24213;&#23618;&#30340;&#27169;&#26495;&#35299;&#26512;&#26641;&#65292;&#20250;&#26356;&#26032;&#20026;HTML&#23433;&#20840;&#30340;</span>
        Tree *<span style="color: #df005f; font-weight: bold;">parse.Tree</span>
        <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#20869;&#21547;&#38544;&#34255;&#25110;&#38750;&#23548;&#20986;&#23383;&#27573;</span>
}
</pre>
</div>

<p>
Template类型是text/template包的Template类型的特化版本，用于生成安全的HTML文本片段。<br>
</p>
</div>
<div id="outline-container-org836b87b" class="outline-3">
<h3 id="org836b87b">func Must</h3>
<div class="outline-text-3" id="text-org836b87b">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">Must</span>(<span style="color: #8787d7;">t</span> *<span style="color: #df005f; font-weight: bold;">Template</span>, <span style="color: #8787d7;">err</span> <span style="color: #df005f; font-weight: bold;">error</span>) *<span style="color: #df005f; font-weight: bold;">Template</span>
</pre>
</div>

<p>
Must函数用于包装返回(*Template, error)的函数/方法调用，它会在err非nil时panic，一般用于变量初始化：<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">var</span> <span style="color: #8787d7;">t</span> = template.<span style="color: #d75fd7; font-weight: bold;">Must</span>(template.<span style="color: #d75fd7; font-weight: bold;">New</span>(<span style="color: #2aa198;">"name"</span>).<span style="color: #d75fd7; font-weight: bold;">Parse</span>(<span style="color: #2aa198;">"html"</span>))
</pre>
</div>
</div>
</div>
<div id="outline-container-org3a41690" class="outline-3">
<h3 id="org3a41690">func New</h3>
<div class="outline-text-3" id="text-org3a41690">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">New</span>(<span style="color: #8787d7;">name</span> <span style="color: #df005f; font-weight: bold;">string</span>) *<span style="color: #df005f; font-weight: bold;">Template</span>
</pre>
</div>

<p>
创建一个名为name的模板。<br>
</p>
</div>
</div>
<div id="outline-container-orga52c502" class="outline-3">
<h3 id="orga52c502">func ParseFiles</h3>
<div class="outline-text-3" id="text-orga52c502">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">ParseFiles</span>(<span style="color: #8787d7;">filenames</span> ...<span style="color: #df005f; font-weight: bold;">string</span>) (*<span style="color: #df005f; font-weight: bold;">Template</span>, <span style="color: #df005f; font-weight: bold;">error</span>)
</pre>
</div>

<p>
ParseFiles函数创建一个模板并解析filenames指定的文件里的模板定义。返回的模板的名字是第一个文件的文件名（不含扩展名），内容为解析后的第一个文件的内容。至少要提供一个文件。如果发生错误，会停止解析并返回nil。<br>
</p>
</div>
</div>
<div id="outline-container-org8533716" class="outline-3">
<h3 id="org8533716">func ParseGlob</h3>
<div class="outline-text-3" id="text-org8533716">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">ParseGlob</span>(<span style="color: #8787d7;">pattern</span> <span style="color: #df005f; font-weight: bold;">string</span>) (*<span style="color: #df005f; font-weight: bold;">Template</span>, <span style="color: #df005f; font-weight: bold;">error</span>)
</pre>
</div>

<p>
ParseGlob创建一个模板并解析匹配pattern的文件（参见glob规则）里的模板定义。返回的模板的名字是第一个匹配的文件的文件名（不含扩展名），内容为解析后的第一个文件的内容。至少要存在一个匹配的文件。如果发生错误，会停止解析并返回nil。ParseGlob等价于使用匹配pattern的文件的列表为参数调用ParseFiles。<br>
</p>
</div>
</div>
<div id="outline-container-org2a6cdd7" class="outline-3">
<h3 id="org2a6cdd7">func (*Template) Name</h3>
<div class="outline-text-3" id="text-org2a6cdd7">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> (<span style="color: #8787d7;">t</span> *<span style="color: #df005f; font-weight: bold;">Template</span>) <span style="color: #d75fd7; font-weight: bold;">Name</span>() <span style="color: #df005f; font-weight: bold;">string</span>
</pre>
</div>

<p>
返回模板t的名字。<br>
</p>
</div>
</div>
<div id="outline-container-org28439b2" class="outline-3">
<h3 id="org28439b2">func (*Template) Delims</h3>
<div class="outline-text-3" id="text-org28439b2">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> (<span style="color: #8787d7;">t</span> *<span style="color: #df005f; font-weight: bold;">Template</span>) <span style="color: #d75fd7; font-weight: bold;">Delims</span>(<span style="color: #8787d7;">left</span>, <span style="color: #8787d7;">right</span> <span style="color: #df005f; font-weight: bold;">string</span>) *<span style="color: #df005f; font-weight: bold;">Template</span>
</pre>
</div>

<p>
Delims方法用于设置action的分界字符串，应用于之后的Parse、ParseFiles、ParseGlob方法。嵌套模板定义会继承这种分界符设置。空字符串分界符表示相应的默认分界符：{{或}}。返回值就是t，以便进行链式调用。<br>
</p>
</div>
</div>
<div id="outline-container-org159dc94" class="outline-3">
<h3 id="org159dc94">func (*Template) Funcs</h3>
<div class="outline-text-3" id="text-org159dc94">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> (<span style="color: #8787d7;">t</span> *<span style="color: #df005f; font-weight: bold;">Template</span>) <span style="color: #d75fd7; font-weight: bold;">Funcs</span>(<span style="color: #8787d7;">funcMap</span> <span style="color: #df005f; font-weight: bold;">FuncMap</span>) *<span style="color: #df005f; font-weight: bold;">Template</span>
</pre>
</div>

<p>
Funcs方法向模板t的函数字典里加入参数funcMap内的键值对。如果funcMap某个键值对的值不是函数类型或者返回值不符合要求会panic。但是，可以对t函数列表的成员进行重写。方法返回t以便进行链式调用。<br>
</p>
</div>
</div>
<div id="outline-container-org1ac6027" class="outline-3">
<h3 id="org1ac6027">func (*Template) Clone</h3>
<div class="outline-text-3" id="text-org1ac6027">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> (<span style="color: #8787d7;">t</span> *<span style="color: #df005f; font-weight: bold;">Template</span>) <span style="color: #d75fd7; font-weight: bold;">Clone</span>() (*<span style="color: #df005f; font-weight: bold;">Template</span>, <span style="color: #df005f; font-weight: bold;">error</span>)
</pre>
</div>

<p>
Clone方法返回模板的一个副本，包括所有相关联的模板。模板的底层表示树并未拷贝，而是拷贝了命名空间，因此拷贝调用Parse方法不会修改原模板的命名空间。Clone方法用于准备模板的公用部分，向拷贝中加入其他关联模板后再进行使用。<br>
</p>

<p>
如果t已经执行过了，会返回错误。<br>
</p>
</div>
</div>
<div id="outline-container-org1b0ec53" class="outline-3">
<h3 id="org1b0ec53">func (*Template) Lookup</h3>
<div class="outline-text-3" id="text-org1b0ec53">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> (<span style="color: #8787d7;">t</span> *<span style="color: #df005f; font-weight: bold;">Template</span>) <span style="color: #d75fd7; font-weight: bold;">Lookup</span>(<span style="color: #8787d7;">name</span> <span style="color: #df005f; font-weight: bold;">string</span>) *<span style="color: #df005f; font-weight: bold;">Template</span>
</pre>
</div>

<p>
Lookup方法返回与t关联的名为name的模板，如果没有这个模板会返回nil。<br>
</p>
</div>
</div>
<div id="outline-container-orgc8dd37f" class="outline-3">
<h3 id="orgc8dd37f">func (*Template) Templates</h3>
<div class="outline-text-3" id="text-orgc8dd37f">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> (<span style="color: #8787d7;">t</span> *<span style="color: #df005f; font-weight: bold;">Template</span>) <span style="color: #d75fd7; font-weight: bold;">Templates</span>() []*<span style="color: #df005f; font-weight: bold;">Template</span>
</pre>
</div>

<p>
Templates方法返回与t相关联的模板的切片，包括t自己。<br>
</p>
</div>
</div>
<div id="outline-container-orgeba1350" class="outline-3">
<h3 id="orgeba1350">func (*Template) New</h3>
<div class="outline-text-3" id="text-orgeba1350">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> (<span style="color: #8787d7;">t</span> *<span style="color: #df005f; font-weight: bold;">Template</span>) <span style="color: #d75fd7; font-weight: bold;">New</span>(<span style="color: #8787d7;">name</span> <span style="color: #df005f; font-weight: bold;">string</span>) *<span style="color: #df005f; font-weight: bold;">Template</span>
</pre>
</div>

<p>
New方法创建一个和t关联的名字为name的模板并返回它。这种可以传递的关联允许一个模板使用template action调用另一个模板。<br>
</p>
</div>
</div>
<div id="outline-container-org7d0f888" class="outline-3">
<h3 id="org7d0f888">func (*Template) AddParseTree</h3>
<div class="outline-text-3" id="text-org7d0f888">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> (<span style="color: #8787d7;">t</span> *<span style="color: #df005f; font-weight: bold;">Template</span>) <span style="color: #d75fd7; font-weight: bold;">AddParseTree</span>(<span style="color: #8787d7;">name</span> <span style="color: #df005f; font-weight: bold;">string</span>, <span style="color: #8787d7;">tree</span> *<span style="color: #df005f; font-weight: bold;">parse.Tree</span>) (*<span style="color: #df005f; font-weight: bold;">Template</span>, <span style="color: #df005f; font-weight: bold;">error</span>)
</pre>
</div>

<p>
AddParseTree方法使用name和tree创建一个模板并使它和t相关联。<br>
</p>

<p>
如果t已经执行过了，会返回错误。<br>
</p>
</div>
</div>
<div id="outline-container-org436f4b9" class="outline-3">
<h3 id="org436f4b9">func (*Template) Parse</h3>
<div class="outline-text-3" id="text-org436f4b9">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> (<span style="color: #8787d7;">t</span> *<span style="color: #df005f; font-weight: bold;">Template</span>) <span style="color: #d75fd7; font-weight: bold;">Parse</span>(<span style="color: #8787d7;">src</span> <span style="color: #df005f; font-weight: bold;">string</span>) (*<span style="color: #df005f; font-weight: bold;">Template</span>, <span style="color: #df005f; font-weight: bold;">error</span>)
</pre>
</div>

<p>
Parse方法将字符串text解析为模板。嵌套定义的模板会关联到最顶层的t。Parse可以多次调用，但只有第一次调用可以包含空格、注释和模板定义之外的文本。如果后面的调用在解析后仍剩余文本会引发错误、返回nil且丢弃剩余文本；如果解析得到的模板已有相关联的同名模板，会覆盖掉原模板。<br>
</p>
</div>
</div>
<div id="outline-container-org914791d" class="outline-3">
<h3 id="org914791d">func (*Template) ParseFiles</h3>
<div class="outline-text-3" id="text-org914791d">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> (<span style="color: #8787d7;">t</span> *<span style="color: #df005f; font-weight: bold;">Template</span>) <span style="color: #d75fd7; font-weight: bold;">ParseFiles</span>(<span style="color: #8787d7;">filenames</span> ...<span style="color: #df005f; font-weight: bold;">string</span>) (*<span style="color: #df005f; font-weight: bold;">Template</span>, <span style="color: #df005f; font-weight: bold;">error</span>)
</pre>
</div>

<p>
ParseGlob方法解析filenames指定的文件里的模板定义并将解析结果与t关联。如果发生错误，会停止解析并返回nil，否则返回(t, nil)。至少要提供一个文件。<br>
</p>
</div>
</div>
<div id="outline-container-orgfed5e96" class="outline-3">
<h3 id="orgfed5e96">func (*Template) ParseGlob</h3>
<div class="outline-text-3" id="text-orgfed5e96">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> (<span style="color: #8787d7;">t</span> *<span style="color: #df005f; font-weight: bold;">Template</span>) <span style="color: #d75fd7; font-weight: bold;">ParseGlob</span>(<span style="color: #8787d7;">pattern</span> <span style="color: #df005f; font-weight: bold;">string</span>) (*<span style="color: #df005f; font-weight: bold;">Template</span>, <span style="color: #df005f; font-weight: bold;">error</span>)
</pre>
</div>

<p>
ParseFiles方法解析匹配pattern的文件里的模板定义并将解析结果与t关联。如果发生错误，会停止解析并返回nil，否则返回(t, nil)。至少要存在一个匹配的文件。<br>
</p>
</div>
</div>
<div id="outline-container-org0d87d10" class="outline-3">
<h3 id="org0d87d10">func (*Template) Execute</h3>
<div class="outline-text-3" id="text-org0d87d10">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> (<span style="color: #8787d7;">t</span> *<span style="color: #df005f; font-weight: bold;">Template</span>) <span style="color: #d75fd7; font-weight: bold;">Execute</span>(<span style="color: #8787d7;">wr</span> <span style="color: #df005f; font-weight: bold;">io.Writer</span>, <span style="color: #8787d7;">data</span> <span style="color: #268bd2; font-weight: bold;">interface</span>{}) <span style="color: #df005f; font-weight: bold;">error</span>
</pre>
</div>

<p>
Execute方法将解析好的模板应用到data上，并将输出写入wr。如果执行时出现错误，会停止执行，但有可能已经写入wr部分数据。模板可以安全的并发执行。<br>
</p>
</div>
</div>
<div id="outline-container-org1a5a412" class="outline-3">
<h3 id="org1a5a412">func (*Template) ExecuteTemplate</h3>
<div class="outline-text-3" id="text-org1a5a412">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> (<span style="color: #8787d7;">t</span> *<span style="color: #df005f; font-weight: bold;">Template</span>) <span style="color: #d75fd7; font-weight: bold;">ExecuteTemplate</span>(<span style="color: #8787d7;">wr</span> <span style="color: #df005f; font-weight: bold;">io.Writer</span>, <span style="color: #8787d7;">name</span> <span style="color: #df005f; font-weight: bold;">string</span>, <span style="color: #8787d7;">data</span> <span style="color: #268bd2; font-weight: bold;">interface</span>{}) <span style="color: #df005f; font-weight: bold;">error</span>
</pre>
</div>

<p>
ExecuteTemplate方法类似Execute，但是使用名为name的t关联的模板产生输出。<br>
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2022-04-13 11:04 Wed</p>
<p class="author">Author: L.M.haoran</p>
<p class="date">Created: 2022-04-13 Wed 11:44</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
