<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-05-29 Sun 14:22 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>用Go实现一个Web框架</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran">
<meta name="description" content="Copyright © 2022, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="content">
<h1 class="title">用Go实现一个Web框架</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org7be20bb">设计一个框架</a></li>
<li><a href="#orgd609ce0">Gee 框架</a></li>
<li><a href="#org4e1e7ee">目录</a></li>
</ul>
</div>
</div>
<style>
h2 {
		font-size: medium;
		color: #222222;
		font-weight: 600;
}

h2:before {
		content: '';
}

#table-of-contents {
		display: none;
}
</style>

<div id="outline-container-org7be20bb" class="outline-2">
<h2 id="org7be20bb">设计一个框架</h2>
<div class="outline-text-2" id="text-org7be20bb">
<p>
大部分时候，我们需要实现一个Web应用，第一反应是应该使用哪个框架。不同的框架设计理念和提供的功能有很大的差别。比如 Python 语言的 <code>django</code> 和 <code>flask</code> ，前者大而全，后者小而美。Go语言/Golang也是这样，新框架层出不穷，比如 <code>Beego</code> ， <code>Gin</code> ， <code>Iris</code> 等。那为什么不直接使用标准库，而必须使用框架呢？在设计一个框架之前，我们需要回答框架核心为我们解决了什么问题。只有理解了这一点，才能想明白我们需要在框架中实现什么功能。<br>
</p>

<p>
我们先看看标准库 <code>net/http</code> 如何处理一个请求。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    http.<span style="color: #d75fd7; font-weight: bold;">HandleFunc</span>(<span style="color: #2aa198;">"/"</span>, handler)
    http.<span style="color: #d75fd7; font-weight: bold;">HandleFunc</span>(<span style="color: #2aa198;">"/count"</span>, counter)
    log.<span style="color: #d75fd7; font-weight: bold;">Fatal</span>(http.<span style="color: #d75fd7; font-weight: bold;">ListenAndServe</span>(<span style="color: #2aa198;">"localhost:8000"</span>, <span style="color: #d75fd7;">nil</span>))
}

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">handler</span>(<span style="color: #8787d7;">w</span> <span style="color: #df005f; font-weight: bold;">http.ResponseWriter</span>, <span style="color: #8787d7;">r</span> *<span style="color: #df005f; font-weight: bold;">http.Request</span>) {
    fmt.<span style="color: #d75fd7; font-weight: bold;">Fprintf</span>(w, <span style="color: #2aa198;">"URL.Path = %q\n"</span>, r.URL.Path)
}
</pre>
</div>

<p>
<code>net/http</code> 提供了基础的 Web 功能，即监听端口，映射静态路由，解析 HTTP 报文。一些 Web 开发中简单的需求并不支持，需要手工实现。<br>
</p>

<ul class="org-ul">
<li>动态路由：例如 <code>hello/:name</code> ， <code>hello/*</code> 这类规则。<br></li>
<li>鉴权：没有分组/统一鉴权的能力，需要在每个路由映射的 handler 中实现。<br></li>
<li>模板：没有统一简化的 HTML 机制。<br></li>
<li>&#x2026;<br></li>
</ul>

<p>
当我们离开框架，使用基础库时，需要频繁手工处理的地方，就是框架的价值所在。但并不是每一个频繁处理的地方都适合在框架中完成。Python 有一个很著名的 Web 框架，名叫 <code>bottle</code> ，整个框架由 <code>bottle.py</code> 一个文件构成，共 4400 行，可以说是一个微框架。那么理解这个微框架提供的特性，可以帮助我们理解框架的核心能力。<br>
</p>

<ul class="org-ul">
<li>路由（Routing）：将请求映射到函数，支持动态路由，例如 <code>/hello/:name</code> 。<br></li>
<li>模板（Templates）：使用内置模板引擎提供模板渲染机制。<br></li>
<li>工具集（Utilites）：提供对 cookies，headers 等处理机制。<br></li>
<li>插件（Plugin）： <code>bottle</code> 本身功能有限，但提供了插件机制，可以选择安装到全局，也可以仅针对某几个路由生效。<br></li>
<li>&#x2026;<br></li>
</ul>
</div>
</div>
<div id="outline-container-orgd609ce0" class="outline-2">
<h2 id="orgd609ce0">Gee 框架</h2>
<div class="outline-text-2" id="text-orgd609ce0">
<p>
本教程来源：<a href="https://geektutu.com/post/gee.html">7天实现Gee框架</a> <br>
</p>

<p>
这个教程将使用 Go 语言实现一个简单的 Web 框架，起名叫做 <code>Gee</code> ，我第一次接触 Go 语言的 Web 框架是 <code>Gin</code> ， <code>Gin</code> 的代码总共是 14K，其中测试代码 9K，也就是说实际代码量只有 5K。 <code>Gin</code> 也是我非常喜欢的一个框架，与 Python 中的 <code>Flask</code> 很像，小而美。<br>
</p>

<p>
这个教程的很多设计包括源码，参考了 <code>Gin</code> ，大家可以看到很多 <code>Gin</code> 的影子。<br>
</p>

<p>
时间关系，同时为了尽可能地简洁明了，这个框架中的很多部分实现的功能都很简单，但是尽可能地体现一个框架核心的设计原则。例如 <code>Router</code> 的设计，虽然支持的动态路由规则有限，但为了性能考虑匹配算法是用 <code>Trie</code> 树实现的， <code>Router</code> 最重要的指标之一便是性能。<br>
</p>
</div>
</div>
<div id="outline-container-org4e1e7ee" class="outline-2">
<h2 id="org4e1e7ee">目录</h2>
<div class="outline-text-2" id="text-org4e1e7ee">
<ul class="org-ul">
<li>第一天：<a href="Go-实现一个Web框架-前置知识.html">前置知识（http.Handler 接口）</a><br></li>
<li>第二天：<a href="Go-实现一个Web框架-上下文设计.html">上下文设计（Context）</a><br></li>
<li>第三天：<a href="Go-实现一个Web框架-Trie树路由.html">Trie树路由（Router）</a><br></li>
<li>第四天：<a href="Go-实现一个Web框架-分组控制.html">分组控制（Group）</a><br></li>
<li>第五天：<a href="Go-实现一个Web框架-中间件.html">中间件（Middleware）</a><br></li>
<li>第六天：<a href="Go-实现一个Web框架-HTML模板.html">HTML模板（Template）</a><br></li>
<li>第七天：<a href="Go-实现一个Web框架-错误恢复.html">错误恢复（Panic Recover）</a><br></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: L.M.haoran</p>
<p class="date">Created: 2022-05-29 Sun 14:22</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
