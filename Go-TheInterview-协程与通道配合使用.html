<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-02-12 Sat 01:19 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>协程与通道配合使用</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran">
<meta name="description" content="Copyright © 2022, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="content">
<h1 class="title">协程与通道配合使用</h1>
<p>
写代码实现两个 goroutine，其中一个产生随机数并写入到 go channel 中，另外一个从 channel 中读取数字并打印到标准输出。最终输出五个随机数。<br>
</p>

<p>
<b>解析</b><br>
</p>

<p>
这是一道很简单的 golang 基础题目，实现方法也有很多种，一般想答让面试官满意的答案还是有几点注意的地方。<br>
</p>

<ol class="org-ol">
<li><code>goroutine</code> 在 golang 中式非阻塞的<br></li>
<li><code>channel</code> 无缓冲情况下，读写都是阻塞的，且可以用 <code>for</code> 循环来读取数据，当管道关闭后， <code>for</code> 退出。<br></li>
<li>golang 中有专用的 <code>select case</code> 语法从管道读取数据。<br></li>
</ol>

<p>
示例代码如下：<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #8787d7;">out</span> := <span style="color: #268bd2;">make</span>(<span style="color: #268bd2; font-weight: bold;">chan</span> <span style="color: #df005f; font-weight: bold;">int</span>)
    <span style="color: #8787d7;">wg</span> := <span style="color: #df005f; font-weight: bold;">sync.WaitGroup</span>{}
    wg.<span style="color: #d75fd7; font-weight: bold;">Add</span>(<span style="color: #d75fd7;">2</span>)
    <span style="color: #268bd2; font-weight: bold;">go</span> <span style="color: #268bd2; font-weight: bold;">func</span>() {
        <span style="color: #268bd2; font-weight: bold;">defer</span> wg.<span style="color: #d75fd7; font-weight: bold;">Done</span>()
        <span style="color: #268bd2; font-weight: bold;">for</span> <span style="color: #8787d7;">i</span> := <span style="color: #d75fd7;">0</span>; i &lt; <span style="color: #d75fd7;">5</span>; i++ {
            out &lt;- rand.<span style="color: #d75fd7; font-weight: bold;">Intn</span>(<span style="color: #d75fd7;">5</span>)
        }
        <span style="color: #268bd2;">close</span>(out)
    }()
    <span style="color: #268bd2; font-weight: bold;">go</span> <span style="color: #268bd2; font-weight: bold;">func</span>() {
        <span style="color: #268bd2; font-weight: bold;">defer</span> wg.<span style="color: #d75fd7; font-weight: bold;">Done</span>()
        <span style="color: #268bd2; font-weight: bold;">for</span> <span style="color: #8787d7;">i</span> := <span style="color: #268bd2; font-weight: bold;">range</span> out {
            fmt.<span style="color: #d75fd7; font-weight: bold;">Println</span>(i)
        }
    }()
    wg.<span style="color: #d75fd7; font-weight: bold;">Wait</span>()
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #8787d7;">ch</span> := <span style="color: #268bd2;">make</span>(<span style="color: #268bd2; font-weight: bold;">chan</span> <span style="color: #df005f; font-weight: bold;">int</span>, <span style="color: #d75fd7;">1</span>)
    <span style="color: #268bd2; font-weight: bold;">for</span> <span style="color: #8787d7;">i</span> := <span style="color: #d75fd7;">0</span>; i &lt; <span style="color: #d75fd7;">5</span>; i ++ {
        <span style="color: #268bd2; font-weight: bold;">select</span> {
        <span style="color: #268bd2; font-weight: bold;">case</span> ch &lt;- <span style="color: #d75fd7;">0</span>:
        <span style="color: #268bd2; font-weight: bold;">case</span> ch &lt;- <span style="color: #d75fd7;">1</span>:
        <span style="color: #268bd2; font-weight: bold;">case</span> ch &lt;- <span style="color: #d75fd7;">2</span>:
        <span style="color: #268bd2; font-weight: bold;">case</span> ch &lt;- <span style="color: #d75fd7;">3</span>:
        <span style="color: #268bd2; font-weight: bold;">case</span> ch &lt;- <span style="color: #d75fd7;">4</span>:
        }
        <span style="color: #8787d7;">out</span> := &lt;- ch
        fmt.<span style="color: #d75fd7; font-weight: bold;">Println</span>(out)
    }
}
</pre>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2022-02-12 00:02 Sat</p>
<p class="author">Author: L.M.haoran</p>
<p class="date">Created: 2022-02-12 Sat 01:19</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
