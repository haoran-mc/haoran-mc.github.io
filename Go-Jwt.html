<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-05-09 Mon 16:32 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>GO-JWT</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran">
<meta name="description" content="Copyright © 2021, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="content">
<h1 class="title">GO-JWT</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgb1a3272">资料</a></li>
<li><a href="#org3b78b9d">token 登录流程</a></li>
<li><a href="#org28f2007">简单使用</a></li>
<li><a href="#org11b9bdc">使用 struct</a>
<ul>
<li><a href="#org359a5b7">生成一个 jwt 的详细过程</a>
<ul>
<li><a href="#orge4761d7">1. 生成一个带参的 jwt</a>
<ul>
<li><a href="#org5b6bfe1">NewWithClaims 函数的实现</a></li>
<li><a href="#orga01f291">Claims 接口</a></li>
</ul>
</li>
<li><a href="#org47e5b38">2. 如何依赖一个结构体实现接口</a></li>
<li><a href="#orgd2d3958">3. 选择使用加密方式</a></li>
<li><a href="#org35a2a15">4. 加密生成的 token</a></li>
</ul>
</li>
<li><a href="#org70f00ee">解析一个 jwt 的详细过程</a>
<ul>
<li><a href="#orgcd76665">1. 前端返回一个 token 字符串，我们来解析它</a></li>
<li><a href="#org933d3c6">2. 使用解析的 token</a></li>
</ul>
</li>
<li><a href="#org82d6d2b">全部代码</a></li>
</ul>
</li>
<li><a href="#org773d94a">使用 map</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgb1a3272" class="outline-2">
<h2 id="orgb1a3272">资料</h2>
<div class="outline-text-2" id="text-orgb1a3272">
<ul class="org-ul">
<li><a href="https://pkg.go.dev/github.com/dgrijalva/jwt-go?utm_source=godoc">官网</a> <br></li>
</ul>
</div>
</div>
<div id="outline-container-org3b78b9d" class="outline-2">
<h2 id="org3b78b9d">token 登录流程</h2>
<div class="outline-text-2" id="text-org3b78b9d">
<img src="./images/Token的登录流程.png"/>
</div>
</div>
<div id="outline-container-org28f2007" class="outline-2">
<h2 id="org28f2007">简单使用</h2>
<div class="outline-text-2" id="text-org28f2007">
<p>
我们从官网的例子学起，下面就是官网提供的例子。<br>
</p>

<img src="./images/go-jwt-example.png" />

<p>
看到三个 New 了吗？这三个方法都能生成 Token；同样的，三个 Parse 的方法能够解析 Token。<br>
</p>

<p>
选择 <code>NewWithClaims(CustomClaimsType)</code> （这是一个带参的生成 token 的方法，我们当然是选择带参的了），点击 <code>NewWithClaims(CustomClaimsType)</code> 后位置跳转，跳到的位置有如下这段代码。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #8787d7;">mySigningKey</span> := []<span style="color: #d75fd7; font-weight: bold;">byte</span>(<span style="color: #2aa198;">"AllYourBase"</span>)

<span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">MyCustomClaims</span> <span style="color: #268bd2; font-weight: bold;">struct</span> {
    Foo <span style="color: #df005f; font-weight: bold;">string</span> <span style="color: #2aa198;">`json:"foo"`</span>
    jwt.StandardClaims
}

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">Create the Claims</span>
<span style="color: #8787d7;">claims</span> := <span style="color: #df005f; font-weight: bold;">MyCustomClaims</span>{
    <span style="color: #2aa198;">"bar"</span>,
    <span style="color: #df005f; font-weight: bold;">jwt.StandardClaims</span>{
        <span style="color: #d75fd7;">ExpiresAt</span>: 15000,
        <span style="color: #d75fd7;">Issuer</span>:    <span style="color: #2aa198;">"test"</span>,
    },
}

<span style="color: #8787d7;">token</span> := jwt.<span style="color: #d75fd7; font-weight: bold;">NewWithClaims</span>(jwt.SigningMethodHS256, claims)
<span style="color: #8787d7;">ss</span>, <span style="color: #8787d7;">err</span> := token.<span style="color: #d75fd7; font-weight: bold;">SignedString</span>(mySigningKey)
fmt.<span style="color: #d75fd7; font-weight: bold;">Printf</span>(<span style="color: #2aa198;">"%v %v"</span>, ss, err)
</pre>
</div>

<p>
很显然这是一段不完整的代码，我们把代码补全：<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">package</span> main

<span style="color: #268bd2; font-weight: bold;">import</span> (
    <span style="color: #2aa198;">"fmt"</span>
    <span style="color: #2aa198;">"github.com/dgrijalva/jwt-go"</span>
)

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #8787d7;">mySigningKey</span> := []<span style="color: #d75fd7; font-weight: bold;">byte</span>(<span style="color: #2aa198;">"AllYourBase"</span>)

    <span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">MyCustomClaims</span> <span style="color: #268bd2; font-weight: bold;">struct</span> {
        Foo <span style="color: #df005f; font-weight: bold;">string</span> <span style="color: #2aa198;">`json:"foo"`</span>
        jwt.StandardClaims
    }

    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">Create the Claims</span>
    <span style="color: #8787d7;">claims</span> := <span style="color: #df005f; font-weight: bold;">MyCustomClaims</span>{
        <span style="color: #2aa198;">"bar"</span>,
        <span style="color: #df005f; font-weight: bold;">jwt.StandardClaims</span>{
            <span style="color: #d75fd7;">ExpiresAt</span>: 15000,
            <span style="color: #d75fd7;">Issuer</span>:    <span style="color: #2aa198;">"test"</span>,
        },
    }

    <span style="color: #8787d7;">token</span> := jwt.<span style="color: #d75fd7; font-weight: bold;">NewWithClaims</span>(jwt.SigningMethodHS256, claims)
    <span style="color: #8787d7;">ss</span>, <span style="color: #8787d7;">err</span> := token.<span style="color: #d75fd7; font-weight: bold;">SignedString</span>(mySigningKey)
    fmt.<span style="color: #d75fd7; font-weight: bold;">Printf</span>(<span style="color: #2aa198;">"%v %v"</span>, ss, err)
}
</pre>
</div>

<p>
先来运行一下，输出：<br>
</p>

<pre class="example">
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIiLCJleHAiOjE1MDAwLCJpc3MiOiJ0ZXN0In0.HE7fK0xOQwFEr4WDgRWj4teRPZ6i3GLwD5YCm6Pwu_c &lt;nil&gt;
</pre>

<p>
第一段也就是我们得到的 token，这段代码的运行过程是怎样的呢？下面有生成的详细过程。<br>
</p>

<p>
生成一个 token 可以使用 struct，也可以使用 map，先介绍使用 struct 来生成一个 token：<br>
</p>
</div>
</div>
<div id="outline-container-org11b9bdc" class="outline-2">
<h2 id="org11b9bdc">使用 struct</h2>
<div class="outline-text-2" id="text-org11b9bdc">
</div>
<div id="outline-container-org359a5b7" class="outline-3">
<h3 id="org359a5b7">生成一个 jwt 的详细过程</h3>
<div class="outline-text-3" id="text-org359a5b7">
</div>
<div id="outline-container-orge4761d7" class="outline-4">
<h4 id="orge4761d7">1. 生成一个带参的 jwt</h4>
<div class="outline-text-4" id="text-orge4761d7">
<p>
生成一个带惨的 jwt 需要使用下面这个方法：<br>
</p>

<div class="org-src-container">
<pre class="src src-go">jwt.<span style="color: #d75fd7; font-weight: bold;">NewWithClaims</span>()
</pre>
</div>
</div>
<div id="outline-container-org5b6bfe1" class="outline-5">
<h5 id="org5b6bfe1">NewWithClaims 函数的实现</h5>
<div class="outline-text-5" id="text-org5b6bfe1">
<p>
查看 NewWithClaims 的实现：<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">NewWithClaims</span>(<span style="color: #8787d7;">method</span> <span style="color: #df005f; font-weight: bold;">SigningMethod</span>, <span style="color: #8787d7;">claims</span> <span style="color: #df005f; font-weight: bold;">Claims</span>) *<span style="color: #df005f; font-weight: bold;">Token</span> {
    <span style="color: #268bd2; font-weight: bold;">return</span> &amp;<span style="color: #df005f; font-weight: bold;">Token</span>{
        <span style="color: #d75fd7;">Header</span>: <span style="color: #268bd2; font-weight: bold;">map</span>[<span style="color: #df005f; font-weight: bold;">string</span>]<span style="color: #268bd2; font-weight: bold;">interface</span>{}{
            <span style="color: #2aa198;">"typ"</span>: <span style="color: #2aa198;">"JWT"</span>,
            <span style="color: #2aa198;">"alg"</span>: method.<span style="color: #d75fd7; font-weight: bold;">Alg</span>(),
        },
        <span style="color: #d75fd7;">Claims</span>: claims,
        <span style="color: #d75fd7;">Method</span>: method,
    }
}
</pre>
</div>

<p>
返回值就是 Token。<br>
</p>

<p>
第一个参数是加密方法，第二个参数是一个实现 Claims 接口的东西，Claims 接口是什么？<br>
</p>
</div>
</div>
<div id="outline-container-orga01f291" class="outline-5">
<h5 id="orga01f291">Claims 接口</h5>
<div class="outline-text-5" id="text-orga01f291">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">Claims</span> <span style="color: #268bd2; font-weight: bold;">interface</span> {
    <span style="color: #d75fd7; font-weight: bold;">Valid</span>() <span style="color: #df005f; font-weight: bold;">error</span>
}
</pre>
</div>

<p>
实现它的有：<br>
</p>

<ol class="org-ol">
<li><p>
map<br>
</p>
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">MapClaims</span> <span style="color: #268bd2; font-weight: bold;">map</span>[<span style="color: #df005f; font-weight: bold;">string</span>]<span style="color: #268bd2; font-weight: bold;">interface</span>{}
</pre>
</div></li>

<li><p>
struct<br>
</p>
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">StandardClaims</span> <span style="color: #268bd2; font-weight: bold;">struct</span> {
    Audience  <span style="color: #df005f; font-weight: bold;">string</span> <span style="color: #2aa198;">`json:"aud,omitempty"`</span>
    ExpiresAt <span style="color: #df005f; font-weight: bold;">int64</span>  <span style="color: #2aa198;">`json:"exp,omitempty"`</span>
    Id        <span style="color: #df005f; font-weight: bold;">string</span> <span style="color: #2aa198;">`json:"jti,omitempty"`</span>
    IssuedAt  <span style="color: #df005f; font-weight: bold;">int64</span>  <span style="color: #2aa198;">`json:"iat,omitempty"`</span>
    Issuer    <span style="color: #df005f; font-weight: bold;">string</span> <span style="color: #2aa198;">`json:"iss,omitempty"`</span>
    NotBefore <span style="color: #df005f; font-weight: bold;">int64</span>  <span style="color: #2aa198;">`json:"nbf,omitempty"`</span>
    Subject   <span style="color: #df005f; font-weight: bold;">string</span> <span style="color: #2aa198;">`json:"sub,omitempty"`</span>
}
</pre>
</div></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org47e5b38" class="outline-4">
<h4 id="org47e5b38">2. 如何依赖一个结构体实现接口</h4>
<div class="outline-text-4" id="text-org47e5b38">
<ol class="org-ol">
<li><p>
定义一个结构体<br>
</p>
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">MyClaims</span> <span style="color: #268bd2; font-weight: bold;">struct</span> {
    Username <span style="color: #df005f; font-weight: bold;">string</span> <span style="color: #2aa198;">`json:"username"`</span>
    jwt.StandardClaims   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#36825;&#23601;&#23454;&#29616;&#20102;&#25509;&#21475;&#65292;&#19978;&#38754;&#23601;&#26159;&#25105;&#20204;&#33258;&#24049;&#30340;&#19996;&#35199;</span>
}
</pre>
</div></li>

<li><p>
定义一个 MyClaims 结构体变量<br>
</p>
<div class="org-src-container">
<pre class="src src-go"><span style="color: #8787d7;">c</span> := MyClaims {
    <span style="color: #d75fd7;">Username</span>: <span style="color: #2aa198;">"ogmc"</span>,
        <span style="color: #d75fd7;">StandardClaims</span>: jwt.StandardClaims {
        <span style="color: #d75fd7;">NotBefore</span>: time.<span style="color: #d75fd7; font-weight: bold;">Now</span>().<span style="color: #d75fd7; font-weight: bold;">Unix</span>() - 60,   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#29983;&#25928;&#26102;&#38388;</span>
            <span style="color: #d75fd7;">ExpiresAt</span>: time.<span style="color: #d75fd7; font-weight: bold;">Now</span>().<span style="color: #d75fd7; font-weight: bold;">Unix</span>() + 60 * 60 * 2,   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#22833;&#25928;&#26102;&#38388;   </span>
            <span style="color: #d75fd7;">Issuer</span>: <span style="color: #2aa198;">"ogmc"</span>,   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#31614;&#21457;&#20154;</span>
        }
}
</pre>
</div></li>

<li><p>
使用我们定义的结构体<br>
</p>
<div class="org-src-container">
<pre class="src src-go">jwt.<span style="color: #d75fd7; font-weight: bold;">NewWithClaims</span>(, c)
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-orgd2d3958" class="outline-4">
<h4 id="orgd2d3958">3. 选择使用加密方式</h4>
<div class="outline-text-4" id="text-orgd2d3958">
<p>
加密方式有多种，这里选择 HS256 的加密方式。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #8787d7;">t</span> := jwt.<span style="color: #d75fd7; font-weight: bold;">NewWithClaims</span>(jwt.SigningMethodHS256, c)   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#36820;&#22238;&#20540;&#26159; t</span>
<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">fmt.Println(t)</span>
<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#35201;&#21152;&#23494; t &#21518;&#20877;&#32473;&#21069;&#31471;&#20351;&#29992;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org35a2a15" class="outline-4">
<h4 id="org35a2a15">4. 加密生成的 token</h4>
<div class="outline-text-4" id="text-org35a2a15">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #8787d7;">mySigningKey</span> := []<span style="color: #d75fd7; font-weight: bold;">byte</span>(<span style="color: #2aa198;">"AllYourBase"</span>)   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#38543;&#20415;&#30340;&#19968;&#20010;&#23383;&#31526;&#20018;</span>
<span style="color: #8787d7;">str</span>, <span style="color: #8787d7;">err</span> := t.<span style="color: #d75fd7; font-weight: bold;">SignedString</span>(mySigningKey)   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#36820;&#22238;&#21152;&#23494;&#21518;&#30340;&#23383;&#31526;&#20018;&#21644; err</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org70f00ee" class="outline-3">
<h3 id="org70f00ee">解析一个 jwt 的详细过程</h3>
<div class="outline-text-3" id="text-org70f00ee">
<p>
在官网中的例子中选择 ParseWithClaims(CustomClaimsType)。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #8787d7;">tokenString</span> := <span style="color: #2aa198;">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIiLCJleHAiOjE1MDAwLCJpc3MiOiJ0ZXN0In0.HE7fK0xOQwFEr4WDgRWj4teRPZ6i3GLwD5YCm6Pwu_c"</span>

<span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">MyCustomClaims</span> <span style="color: #268bd2; font-weight: bold;">struct</span> {
    Foo <span style="color: #df005f; font-weight: bold;">string</span> <span style="color: #2aa198;">`json:"foo"`</span>
    jwt.StandardClaims
}

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">sample token is expired.  override time so it parses as valid</span>
<span style="color: #d75fd7; font-weight: bold;">at</span>(time.<span style="color: #d75fd7; font-weight: bold;">Unix</span>(0, 0), <span style="color: #268bd2; font-weight: bold;">func</span>() {
    <span style="color: #8787d7;">token</span>, <span style="color: #8787d7;">err</span> := jwt.<span style="color: #d75fd7; font-weight: bold;">ParseWithClaims</span>(tokenString, &amp;<span style="color: #df005f; font-weight: bold;">MyCustomClaims</span>{}, <span style="color: #268bd2; font-weight: bold;">func</span>(<span style="color: #8787d7;">token</span> *<span style="color: #df005f; font-weight: bold;">jwt.Token</span>) (<span style="color: #268bd2; font-weight: bold;">interface</span>{}, <span style="color: #df005f; font-weight: bold;">error</span>) {
        <span style="color: #268bd2; font-weight: bold;">return</span> []<span style="color: #d75fd7; font-weight: bold;">byte</span>(<span style="color: #2aa198;">"AllYourBase"</span>), <span style="color: #d75fd7;">nil</span>
    })

    <span style="color: #268bd2; font-weight: bold;">if</span> <span style="color: #8787d7;">claims</span>, <span style="color: #8787d7;">ok</span> := token.Claims.(*<span style="color: #df005f; font-weight: bold;">MyCustomClaims</span>); ok &amp;&amp; token.Valid {
        fmt.<span style="color: #d75fd7; font-weight: bold;">Printf</span>(<span style="color: #2aa198;">"%v %v"</span>, claims.Foo, claims.StandardClaims.ExpiresAt)
    } <span style="color: #268bd2; font-weight: bold;">else</span> {
        fmt.<span style="color: #d75fd7; font-weight: bold;">Println</span>(err)
    }
})
</pre>
</div>

<p>
上面是官网给出的解密的一个例子。<br>
</p>
</div>
<div id="outline-container-orgcd76665" class="outline-4">
<h4 id="orgcd76665">1. 前端返回一个 token 字符串，我们来解析它</h4>
<div class="outline-text-4" id="text-orgcd76665">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #8787d7;">token</span>, <span style="color: #8787d7;">err</span> := jwt.<span style="color: #d75fd7; font-weight: bold;">ParseWithClaims</span>(str, &amp;<span style="color: #df005f; font-weight: bold;">MyClaims</span>{}, <span style="color: #268bd2; font-weight: bold;">func</span>(<span style="color: #8787d7;">token</span> *<span style="color: #df005f; font-weight: bold;">jwt.Token</span>) (<span style="color: #268bd2; font-weight: bold;">interface</span>{}, <span style="color: #df005f; font-weight: bold;">error</span>) {
    <span style="color: #268bd2; font-weight: bold;">return</span> mySigningKey, <span style="color: #d75fd7;">nil</span>
})   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#21442;&#25968;&#20998;&#21035;&#26159;&#65306;&#21152;&#23494;&#30340; token &#23383;&#31526;&#20018;&#65292;&#35299;&#26512;&#30340;&#27169;&#26495;&#65292;&#19968;&#20010;&#20989;&#25968; func</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org933d3c6" class="outline-4">
<h4 id="org933d3c6">2. 使用解析的 token</h4>
<div class="outline-text-4" id="text-org933d3c6">
<div class="org-src-container">
<pre class="src src-go">fmt.<span style="color: #d75fd7; font-weight: bold;">Println</span>(token.Claims.(*<span style="color: #df005f; font-weight: bold;">MyClaims</span>).Username)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org82d6d2b" class="outline-3">
<h3 id="org82d6d2b">全部代码</h3>
<div class="outline-text-3" id="text-org82d6d2b">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">package</span> main

<span style="color: #268bd2; font-weight: bold;">import</span> (
    <span style="color: #2aa198;">"fmt"</span>
    <span style="color: #2aa198;">"github.com/dgrijalva/jwt-go"</span>
    <span style="color: #2aa198;">"time"</span>
)

<span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">MyClaims</span> <span style="color: #268bd2; font-weight: bold;">struct</span> {
    Username <span style="color: #df005f; font-weight: bold;">string</span> <span style="color: #2aa198;">`json:"username"`</span>
    jwt.StandardClaims
}

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #8787d7;">mySigningKey</span> := []<span style="color: #d75fd7; font-weight: bold;">byte</span>(<span style="color: #2aa198;">"AllYourBase"</span>)   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#38543;&#20415;&#30340;&#23383;&#31526;&#20018;</span>
    <span style="color: #8787d7;">c</span> := MyClaims {
        <span style="color: #d75fd7;">Username</span>: <span style="color: #2aa198;">"ogmc"</span>,
            <span style="color: #d75fd7;">StandardClaims</span>: <span style="color: #df005f; font-weight: bold;">jwt.StandardClaims</span>{
                <span style="color: #d75fd7;">NotBefore</span>: time.<span style="color: #d75fd7; font-weight: bold;">Now</span>().<span style="color: #d75fd7; font-weight: bold;">Unix</span>() - 60,   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#29983;&#25928;&#26102;&#38388;</span>
                <span style="color: #d75fd7;">ExpiresAt</span>: time.<span style="color: #d75fd7; font-weight: bold;">Now</span>().<span style="color: #d75fd7; font-weight: bold;">Unix</span>() + 5,    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#22833;&#25928;&#26102;&#38388;</span>
                <span style="color: #d75fd7;">Issuer</span>: <span style="color: #2aa198;">"ogmc"</span>,   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#31614;&#21457;&#20154;</span>
            },
        }
    <span style="color: #8787d7;">token1</span> := jwt.<span style="color: #d75fd7; font-weight: bold;">NewWithClaims</span>(jwt.SigningMethodHS256, c)
    <span style="color: #8787d7;">str1</span>, <span style="color: #8787d7;">err1</span> := token1.<span style="color: #d75fd7; font-weight: bold;">SignedString</span>(mySigningKey)
    <span style="color: #268bd2; font-weight: bold;">if</span> err1 != <span style="color: #d75fd7;">nil</span> {
        fmt.<span style="color: #d75fd7; font-weight: bold;">Printf</span>(<span style="color: #2aa198;">"%s"</span>, err1)
    }
    fmt.<span style="color: #d75fd7; font-weight: bold;">Println</span>(str1)

    <span style="color: #8787d7;">token2</span>, <span style="color: #8787d7;">err2</span> := jwt.<span style="color: #d75fd7; font-weight: bold;">ParseWithClaims</span>(str1, &amp;<span style="color: #df005f; font-weight: bold;">MyClaims</span>{}, <span style="color: #268bd2; font-weight: bold;">func</span>(<span style="color: #8787d7;">token</span> *<span style="color: #df005f; font-weight: bold;">jwt.Token</span>) (<span style="color: #268bd2; font-weight: bold;">interface</span>{}, <span style="color: #df005f; font-weight: bold;">error</span>) {
        <span style="color: #268bd2; font-weight: bold;">return</span> mySigningKey, <span style="color: #d75fd7;">nil</span>
    })
    <span style="color: #268bd2; font-weight: bold;">if</span> err2 != <span style="color: #d75fd7;">nil</span> {
        fmt.<span style="color: #d75fd7; font-weight: bold;">Printf</span>(<span style="color: #2aa198;">"%s"</span>, err2)
        <span style="color: #268bd2; font-weight: bold;">return</span>
    }
    fmt.<span style="color: #d75fd7; font-weight: bold;">Println</span>(token.Claims.(*<span style="color: #df005f; font-weight: bold;">MyClaims</span>).Username)
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org773d94a" class="outline-2">
<h2 id="org773d94a">使用 map</h2>
<div class="outline-text-2" id="text-org773d94a">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #268bd2; font-weight: bold;">package</span> main

<span style="color: #268bd2; font-weight: bold;">import</span> (
    <span style="color: #2aa198;">"fmt"</span>
    <span style="color: #2aa198;">"github.com/dgrijalva/jwt-go"</span>
    <span style="color: #2aa198;">"time"</span>
)

<span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">MyClaims</span> <span style="color: #268bd2; font-weight: bold;">struct</span> {
    Username <span style="color: #df005f; font-weight: bold;">string</span> <span style="color: #2aa198;">`json:"username"`</span>
    jwt.StandardClaims
}

<span style="color: #268bd2; font-weight: bold;">func</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    <span style="color: #8787d7;">mySigningKey</span> := []<span style="color: #d75fd7; font-weight: bold;">byte</span>(<span style="color: #2aa198;">"AllYourBase"</span>)   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#38543;&#20415;&#30340;&#23383;&#31526;&#20018;</span>

    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">jwt.StandardClaims{}   // map &#20013;&#30340; key &#22312;&#36825;&#37324;&#33021;&#30475;&#21040;</span>
    <span style="color: #8787d7;">token1</span> := jwt.<span style="color: #d75fd7; font-weight: bold;">NewWithClaims</span>(jwt.SigningMethodHS256, <span style="color: #df005f; font-weight: bold;">jwt.MapClaims</span>{
        <span style="color: #2aa198;">"exp"</span>: time.<span style="color: #d75fd7; font-weight: bold;">Now</span>().<span style="color: #d75fd7; font-weight: bold;">Unix</span>() + 5,
        <span style="color: #2aa198;">"nbf"</span>: time.<span style="color: #d75fd7; font-weight: bold;">Now</span>().<span style="color: #d75fd7; font-weight: bold;">Unix</span>() - 5,
        <span style="color: #2aa198;">"iss"</span>: <span style="color: #2aa198;">"ogmc"</span>,
        <span style="color: #2aa198;">"username"</span>: <span style="color: #2aa198;">"ogmc"</span>,
    })
    <span style="color: #8787d7;">str1</span>, <span style="color: #8787d7;">err1</span> := token1.<span style="color: #d75fd7; font-weight: bold;">SignedString</span>(mySigningKey)
    <span style="color: #268bd2; font-weight: bold;">if</span> err1 != <span style="color: #d75fd7;">nil</span> {
        fmt.<span style="color: #d75fd7; font-weight: bold;">Printf</span>(<span style="color: #2aa198;">"%s"</span>, err1)
    }
    fmt.<span style="color: #d75fd7; font-weight: bold;">Println</span>(str1)

    <span style="color: #8787d7;">token2</span>, <span style="color: #8787d7;">err2</span> := jwt.<span style="color: #d75fd7; font-weight: bold;">ParseWithClaims</span>(str1, &amp;<span style="color: #df005f; font-weight: bold;">jwt.MapClaims</span>{}, <span style="color: #268bd2; font-weight: bold;">func</span>(<span style="color: #8787d7;">token</span> *<span style="color: #df005f; font-weight: bold;">jwt.Token</span>) (<span style="color: #268bd2; font-weight: bold;">interface</span>{}, <span style="color: #df005f; font-weight: bold;">error</span>) {
        <span style="color: #268bd2; font-weight: bold;">return</span> mySigningKey, <span style="color: #d75fd7;">nil</span>
    })
    <span style="color: #268bd2; font-weight: bold;">if</span> err2 != <span style="color: #d75fd7;">nil</span> {
        fmt.<span style="color: #d75fd7; font-weight: bold;">Printf</span>(<span style="color: #2aa198;">"%s"</span>, err2)
        <span style="color: #268bd2; font-weight: bold;">return</span>
    }
    fmt.<span style="color: #d75fd7; font-weight: bold;">Println</span>(token.Claims.(*<span style="color: #df005f; font-weight: bold;">jwt.MapClaims</span>))
}
</pre>
</div>
</div>
</div>
</div>
</body>
</html>
