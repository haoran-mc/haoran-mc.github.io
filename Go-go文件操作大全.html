<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2023-01-31 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>go文件操作大全</title>
<meta name="author" content="Haoran Liu" />
<meta name="description" content="Copyright © 2023, Haoran Liu, all rights reserved." />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="static/css/org.css"/>
</head>
<body>
<div id="content" class="content">
<h1 class="title">go文件操作大全</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orga4f416b">1. 介绍</a>
<ul>
<li><a href="#org7eb96c6">1.1 万物皆文件</a></li>
</ul>
</li>
<li><a href="#org15c9e4a">2. 基本操作</a>
<ul>
<li><a href="#org892b6b1">2.1 创建空文件</a></li>
<li><a href="#org058f755">2.2 Truncate 文件</a></li>
<li><a href="#org5e335db">2.3 得到文件信息</a></li>
<li><a href="#org7de4d3b">2.4 重命名和移动</a></li>
<li><a href="#org6a7c87a">2.5 删除文件</a></li>
<li><a href="#org88038ac">2.6 打开和关闭文件</a></li>
<li><a href="#orgb447a21">2.7 检查文件是否存在</a></li>
<li><a href="#orgc29ee66">2.8 检查读写权限</a></li>
<li><a href="#orgbff68a0">2.9 改变权限、拥有者、时间戳</a></li>
<li><a href="#org676dc63">2.10 硬链接和软链接</a></li>
</ul>
</li>
<li><a href="#org7136236">3. 读写</a>
<ul>
<li><a href="#org1d723b6">3.1 复制文件</a></li>
<li><a href="#org4ce836a">3.2 跳转到文件指定位置（Seek）</a></li>
<li><a href="#orgfaad3d2">3.3 写文件</a></li>
<li><a href="#orge39ae31">3.4 快写文件</a></li>
<li><a href="#org8c0c6f2">3.5 使用缓存写</a></li>
<li><a href="#orgafee33b">3.6 读取最多 N 个字节</a></li>
<li><a href="#orgcf8fd3d">3.7 读取正好 N 个字节</a></li>
<li><a href="#org57ec136">3.8 读取至少 N 个字节</a></li>
<li><a href="#orgdfb3441">3.9 读取全部字节</a></li>
<li><a href="#orgbe07c17">3.10 快读到内存，读文件到内存</a></li>
<li><a href="#org601a362">3.11 使用缓存读</a></li>
<li><a href="#org9a4bf0a">3.12 使用 scanner</a></li>
</ul>
</li>
<li><a href="#org0837793">4. 压缩</a>
<ul>
<li><a href="#org77bcc1e">4.1 打包（zip）文件</a></li>
<li><a href="#orgf3c550b">4.2 抽取（unzip）文件</a></li>
<li><a href="#orgb2af056">4.3 压缩文件</a></li>
<li><a href="#orge72b3c6">4.4 解压缩文件</a></li>
</ul>
</li>
<li><a href="#orgc3fe15a">5. 其他</a>
<ul>
<li><a href="#orgb23e0bd">5.1 临时文件和目录</a></li>
<li><a href="#orgc134b5d">5.2 通过 HTTP 下载文件</a></li>
<li><a href="#org0fd851e">5.3 哈希和摘要</a></li>
</ul>
</li>
<li><a href="#orgca37124">6. 参考</a></li>
</ul>
</div>
</div>
<p>
Go 官方库的文件操作分散在多个包中，比如 <code>os</code> 、 <code>ioutil</code> 包。<br>
</p>

<div id="outline-container-orga4f416b" class="outline-2">
<h2 id="orga4f416b">1. 介绍</h2>
<div class="outline-text-2" id="text-orga4f416b">
</div>
<div id="outline-container-org7eb96c6" class="outline-3">
<h3 id="org7eb96c6">1.1 万物皆文件</h3>
<div class="outline-text-3" id="text-org7eb96c6">
<p>
UNIX 的一个基础设计就是"万物皆文件"（everything is a file）。我们不必知道一个文件到底映射成什么，操作系统的设备驱动抽象成文件。操作系统为设备提供了文件格式的接口。<br>
</p>

<p>
Go语言中的reader和writer接口也类似。我们只需简单的读写字节，不必知道reader的数据来自哪里，也不必知道writer将数据发送到哪里。<br>
</p>

<p>
你可以在/dev下查看可用的设备，有些可能需要较高的权限才能访问。<br>
</p>
</div>
</div>
</div>
<div id="outline-container-org15c9e4a" class="outline-2">
<h2 id="org15c9e4a">2. 基本操作</h2>
<div class="outline-text-2" id="text-org15c9e4a">
</div>
<div id="outline-container-org892b6b1" class="outline-3">
<h3 id="org892b6b1">2.1 创建空文件</h3>
<div class="outline-text-3" id="text-org892b6b1">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">var</span> (
    <span style="color: #df85ff;">newFile</span> *<span style="color: #ffd400;">os.File</span>
    <span style="color: #df85ff;">err</span>     <span style="color: #ffd400;">error</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    newFile, err = os.<span style="color: #42c6ff;">Create</span>(<span style="color: #7984D1;">"test.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    log.<span style="color: #42c6ff;">Println</span>(newFile)
    newFile.<span style="color: #42c6ff;">Close</span>()
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #df85ff;">file</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">OpenFile</span>(<span style="color: #7984D1;">"test.txt"</span>, os.O_RDONLY|os.O_CREATE, 0666)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    file.<span style="color: #42c6ff;">Close</span>()
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org058f755" class="outline-3">
<h3 id="org058f755">2.2 Truncate 文件</h3>
<div class="outline-text-3" id="text-org058f755">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#35009;&#21098;&#19968;&#20010;&#25991;&#20214;&#21040;100&#20010;&#23383;&#33410;&#12290;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#22914;&#26524;&#25991;&#20214;&#26412;&#26469;&#23601;&#23569;&#20110;100&#20010;&#23383;&#33410;&#65292;&#21017;&#25991;&#20214;&#20013;&#21407;&#22987;&#20869;&#23481;&#24471;&#20197;&#20445;&#30041;&#65292;&#21097;&#20313;&#30340;&#23383;&#33410;&#20197;null&#23383;&#33410;&#22635;&#20805;&#12290;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#22914;&#26524;&#25991;&#20214;&#26412;&#26469;&#36229;&#36807;100&#20010;&#23383;&#33410;&#65292;&#21017;&#36229;&#36807;&#30340;&#23383;&#33410;&#20250;&#34987;&#25243;&#24323;&#12290;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#36825;&#26679;&#25105;&#20204;&#24635;&#26159;&#24471;&#21040;&#31934;&#30830;&#30340;100&#20010;&#23383;&#33410;&#30340;&#25991;&#20214;&#12290;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20256;&#20837;0&#21017;&#20250;&#28165;&#31354;&#25991;&#20214;&#12290;</span>

    <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Truncate</span>(<span style="color: #7984D1;">"test.txt"</span>, 100)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org5e335db" class="outline-3">
<h3 id="org5e335db">2.3 得到文件信息</h3>
<div class="outline-text-3" id="text-org5e335db">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"fmt"</span>
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">var</span> (
    <span style="color: #df85ff;">fileInfo</span> <span style="color: #ffd400;">os.FileInfo</span>
    <span style="color: #df85ff;">err</span>      <span style="color: #ffd400;">error</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#22914;&#26524;&#25991;&#20214;&#19981;&#23384;&#22312;&#65292;&#21017;&#36820;&#22238;&#38169;&#35823;</span>
    fileInfo, err = os.<span style="color: #42c6ff;">Stat</span>(<span style="color: #7984D1;">"test.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }

    fmt.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"File name:"</span>, fileInfo.<span style="color: #42c6ff;">Name</span>())
    fmt.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"Size in bytes:"</span>, fileInfo.<span style="color: #42c6ff;">Size</span>())
    fmt.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"Permissions:"</span>, fileInfo.<span style="color: #42c6ff;">Mode</span>())
    fmt.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"Last modified:"</span>, fileInfo.<span style="color: #42c6ff;">ModTime</span>())
    fmt.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"Is Directory:"</span>, fileInfo.<span style="color: #42c6ff;">IsDir</span>())
    fmt.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"System interface type: %T\n"</span>, fileInfo.<span style="color: #42c6ff;">Sys</span>())
    fmt.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"System info: %+v\n\n"</span>, fileInfo.<span style="color: #42c6ff;">Sys</span>())
}
</pre>
</div>

<pre class="example" id="org0e37ce3">
File name: test.txt
Size in bytes: 100
Permissions: -rw-r--r--
Last modified: 2023-01-03 11:06:45.165638664 +0800 CST
Is Directory: false
System interface type: *syscall.Stat_t
System info: &amp;{Dev:16777234 Mode:33188 Nlink:1 Ino:43139345 Uid:501 Gid:20 Rdev:0 Pad_cgo_0:[0 0 0 0] Atimespec:{Sec:1672715215 Nsec:575296675} Mtimespec:{Sec:1672715205 Nsec:165638664} Ctimespec:{Sec:1672715205 Nsec:165638664} Birthtimespec:{Sec:1672715168 Nsec:351182182} Size:100 Blocks:0 Blksize:4096 Flags:0 Gen:0 Lspare:0 Qspare:[0 0]}
</pre>
</div>
</div>
<div id="outline-container-org7de4d3b" class="outline-3">
<h3 id="org7de4d3b">2.4 重命名和移动</h3>
<div class="outline-text-3" id="text-org7de4d3b">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #df85ff;">originalPath</span> := <span style="color: #7984D1;">"test.txt"</span>
    <span style="color: #df85ff;">newPath</span> := <span style="color: #7984D1;">"test2.txt"</span>
    <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Rename</span>(originalPath, newPath)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org6a7c87a" class="outline-3">
<h3 id="org6a7c87a">2.5 删除文件</h3>
<div class="outline-text-3" id="text-org6a7c87a">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Remove</span>(<span style="color: #7984D1;">"test2.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org88038ac" class="outline-3">
<h3 id="org88038ac">2.6 打开和关闭文件</h3>
<div class="outline-text-3" id="text-org88038ac">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#31616;&#21333;&#22320;&#20197;&#21482;&#35835;&#30340;&#26041;&#24335;&#25171;&#24320;&#65292;&#19979;&#38754;&#30340;&#20363;&#23376;&#20250;&#20171;&#32461;&#35835;&#20889;&#30340;&#20363;&#23376;&#12290;</span>
    <span style="color: #df85ff;">file</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Open</span>(<span style="color: #7984D1;">"test.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    file.<span style="color: #42c6ff;">Close</span>()

    <span style="color: #546A90;">// </span><span style="color: #546A90;">OpenFile &#25552;&#20379;&#26356;&#22810;&#30340;&#36873;&#39033;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#26368;&#21518;&#19968;&#20010;&#21442;&#25968;&#26159;&#26435;&#38480;&#27169;&#24335; permission mode</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#31532;&#20108;&#20010;&#26159;&#25171;&#24320;&#26102;&#30340;&#23646;&#24615;</span>
    file, err = os.<span style="color: #42c6ff;">OpenFile</span>(<span style="color: #7984D1;">"test.txt"</span>, os.O_APPEND, 0666)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    file.<span style="color: #42c6ff;">Close</span>()

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#19979;&#38754;&#30340;&#23646;&#24615;&#21487;&#20197;&#21333;&#29420;&#20351;&#29992;&#65292;&#20063;&#21487;&#20197;&#32452;&#21512;&#20351;&#29992;&#12290;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#32452;&#21512;&#20351;&#29992;&#26102;&#21487;&#20197;&#20351;&#29992; OR &#25805;&#20316;&#35774;&#32622; OpenFile &#30340;&#31532;&#20108;&#20010;&#21442;&#25968;&#65292;&#20363;&#22914;&#65306;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">os.O_CREATE|os.O_APPEND</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#25110;&#32773; os.O_CREATE|os.O_TRUNC|os.O_WRONLY</span>

    <span style="color: #546A90;">// </span><span style="color: #546A90;">os.O_RDONLY // &#21482;&#35835;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">os.O_WRONLY // &#21482;&#20889;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">os.O_RDWR   // &#35835;&#20889;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">os.O_APPEND // &#24448;&#25991;&#20214;&#20013;&#28155;&#24314;&#65288;Append&#65289;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">os.O_CREATE // &#22914;&#26524;&#25991;&#20214;&#19981;&#23384;&#22312;&#21017;&#20808;&#21019;&#24314;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">os.O_TRUNC  // &#25991;&#20214;&#25171;&#24320;&#26102;&#35009;&#21098;&#25991;&#20214;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">os.O_EXCL   // &#21644;O_CREATE&#19968;&#36215;&#20351;&#29992;&#65292;&#25991;&#20214;&#19981;&#33021;&#23384;&#22312;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">os.O_SYNC   // &#20197;&#21516;&#27493;I/O&#30340;&#26041;&#24335;&#25171;&#24320;</span>
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb447a21" class="outline-3">
<h3 id="orgb447a21">2.7 检查文件是否存在</h3>
<div class="outline-text-3" id="text-orgb447a21">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#25991;&#20214;&#19981;&#23384;&#22312;&#21017;&#36820;&#22238; error</span>
    <span style="color: #df85ff;">fileInfo</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Stat</span>(<span style="color: #7984D1;">"test.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        <span style="color: #ff2afc; font-weight: bold;">if</span> os.<span style="color: #42c6ff;">IsNotExist</span>(err) {
            log.<span style="color: #42c6ff;">Fatal</span>(<span style="color: #7984D1;">"File does no exist."</span>)
        }
    }
    log.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"File does exist. File information:"</span>)
    log.<span style="color: #42c6ff;">Println</span>(fileInfo)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc29ee66" class="outline-3">
<h3 id="orgc29ee66">2.8 检查读写权限</h3>
<div class="outline-text-3" id="text-orgc29ee66">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#36825;&#20010;&#20363;&#23376;&#27979;&#35797;&#20889;&#26435;&#38480;&#65292;&#22914;&#26524;&#27809;&#26377;&#20889;&#26435;&#38480;&#21017;&#36820;&#22238; error&#12290;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#27880;&#24847;&#25991;&#20214;&#19981;&#23384;&#22312;&#20063;&#20250;&#36820;&#22238; error&#65292;&#38656;&#35201;&#26816;&#26597; error &#30340;&#20449;&#24687;&#26469;&#33719;&#21462;&#26159;&#21738;&#20010;&#38169;&#35823;&#23548;&#33268;&#30340;&#12290;</span>
    <span style="color: #df85ff;">file</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">OpenFile</span>(<span style="color: #7984D1;">"test.txt"</span>, os.O_WRONLY, 0666)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        <span style="color: #ff2afc; font-weight: bold;">if</span> os.<span style="color: #42c6ff;">IsPermission</span>(err) {
            log.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"Error: Write permission denied."</span>)
        } <span style="color: #ff2afc; font-weight: bold;">else</span> <span style="color: #ff2afc; font-weight: bold;">if</span> os.<span style="color: #42c6ff;">IsNotExist</span>(err) {
            log.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"Error: File is not exist."</span>)
        }
    }
    file.<span style="color: #42c6ff;">Close</span>()

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#27979;&#35797;&#35835;&#26435;&#38480;</span>
    file, err = os.<span style="color: #42c6ff;">OpenFile</span>(<span style="color: #7984D1;">"test.txt"</span>, os.O_RDONLY, 0666)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        <span style="color: #ff2afc; font-weight: bold;">if</span> os.<span style="color: #42c6ff;">IsPermission</span>(err) {
            log.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"Error: Read permission denied."</span>)
        } <span style="color: #ff2afc; font-weight: bold;">else</span> <span style="color: #ff2afc; font-weight: bold;">if</span> os.<span style="color: #42c6ff;">IsNotExist</span>(err) {
            log.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"Error: File is not exist."</span>)
        }
    }
    file.<span style="color: #42c6ff;">Close</span>()
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbff68a0" class="outline-3">
<h3 id="orgbff68a0">2.9 改变权限、拥有者、时间戳</h3>
<div class="outline-text-3" id="text-orgbff68a0">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
    <span style="color: #7984D1;">"time"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20351;&#29992; Linux &#39118;&#26684;&#25913;&#21464;&#25991;&#20214;&#26435;&#38480;</span>
    <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Chmod</span>(<span style="color: #7984D1;">"test.txt"</span>, 0777)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Println</span>(err)
    }

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#25913;&#21464;&#25991;&#20214;&#25152;&#26377;&#32773;</span>
    err = os.<span style="color: #42c6ff;">Chown</span>(<span style="color: #7984D1;">"test.txt"</span>, os.<span style="color: #42c6ff;">Geteuid</span>(), os.<span style="color: #42c6ff;">Getegid</span>())
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Println</span>(err)
    }

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#25913;&#21464;&#26102;&#38388;&#25139;</span>
    <span style="color: #df85ff;">twoDaysFromNow</span> := time.<span style="color: #42c6ff;">Now</span>().<span style="color: #42c6ff;">Add</span>(48 * time.Hour)
    <span style="color: #df85ff;">lastAccessTime</span> := twoDaysFromNow
    <span style="color: #df85ff;">lastModifyTime</span> := twoDaysFromNow
    err = os.<span style="color: #42c6ff;">Chtimes</span>(<span style="color: #7984D1;">"test.txt"</span>, lastAccessTime, lastModifyTime)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Println</span>(err)
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org676dc63" class="outline-3">
<h3 id="org676dc63">2.10 硬链接和软链接</h3>
<div class="outline-text-3" id="text-org676dc63">
<p>
一个普通的文件是一个指向硬盘的 inode 的地方。<br>
</p>

<p>
硬链接创建一个新的指针指向同一个地方。只有所有的链接被删除后文件才会被删除。硬链接只在相同的文件系统中才工作。你可以认为一个硬链接是一个正常的链接。<br>
</p>

<p>
symbolic link，又叫软连接，和硬链接有点不一样，它不直接指向硬盘中的相同的地方，而是通过名字引用其它文件。他们可以指向不同的文件系统中的不同文件。并不是所有的操作系统都支持软链接。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main
<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"os"</span>
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"fmt"</span>
)
<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#21019;&#24314;&#19968;&#20010;&#30828;&#38142;&#25509;&#12290;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#21019;&#24314;&#21518;&#21516;&#19968;&#20010;&#25991;&#20214;&#20869;&#23481;&#20250;&#26377;&#20004;&#20010;&#25991;&#20214;&#21517;&#65292;&#25913;&#21464;&#19968;&#20010;&#25991;&#20214;&#30340;&#20869;&#23481;&#20250;&#24433;&#21709;&#21478;&#19968;&#20010;&#12290;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#21024;&#38500;&#21644;&#37325;&#21629;&#21517;&#19981;&#20250;&#24433;&#21709;&#21478;&#19968;&#20010;&#12290;</span>
    <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Link</span>(<span style="color: #7984D1;">"original.txt"</span>, <span style="color: #7984D1;">"original_also.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }

    fmt.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"creating sym"</span>)
    <span style="color: #546A90;">// </span><span style="color: #546A90;">Create a symlink</span>
    err = os.<span style="color: #42c6ff;">Symlink</span>(<span style="color: #7984D1;">"original.txt"</span>, <span style="color: #7984D1;">"original_sym.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }

    <span style="color: #546A90;">// </span><span style="color: #546A90;">Lstat &#36820;&#22238;&#19968;&#20010;&#25991;&#20214;&#30340;&#20449;&#24687;&#65292;&#20294;&#26159;&#24403;&#25991;&#20214;&#26159;&#19968;&#20010;&#36719;&#38142;&#25509;&#26102;&#65292;&#23427;&#36820;&#22238;&#36719;&#38142;&#25509;&#30340;&#20449;&#24687;&#65292;&#32780;&#19981;&#26159;&#24341;&#29992;&#30340;&#25991;&#20214;&#30340;&#20449;&#24687;&#12290;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">Symlink &#22312; Windows &#20013;&#19981;&#24037;&#20316;&#12290;</span>
    <span style="color: #df85ff;">fileInfo</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Lstat</span>(<span style="color: #7984D1;">"original_sym.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    fmt.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Link info: %+v"</span>, fileInfo)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#25913;&#21464;&#36719;&#38142;&#25509;&#30340;&#25317;&#26377;&#32773;&#19981;&#20250;&#24433;&#21709;&#21407;&#22987;&#25991;&#20214;&#12290;</span>
    err = os.<span style="color: #42c6ff;">Lchown</span>(<span style="color: #7984D1;">"original_sym.txt"</span>, os.<span style="color: #42c6ff;">Getuid</span>(), os.<span style="color: #42c6ff;">Getgid</span>())
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org7136236" class="outline-2">
<h2 id="org7136236">3. 读写</h2>
<div class="outline-text-2" id="text-org7136236">
</div>
<div id="outline-container-org1d723b6" class="outline-3">
<h3 id="org1d723b6">3.1 复制文件</h3>
<div class="outline-text-3" id="text-org1d723b6">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"io"</span>
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#25171;&#24320;&#21407;&#22987;&#25991;&#20214;</span>
    <span style="color: #df85ff;">originalFile</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Open</span>(<span style="color: #7984D1;">"test.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    <span style="color: #ff2afc; font-weight: bold;">defer</span> originalFile.<span style="color: #42c6ff;">Close</span>()

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#21019;&#24314;&#26032;&#30340;&#25991;&#20214;&#20316;&#20026;&#30446;&#26631;&#25991;&#20214;</span>
    <span style="color: #df85ff;">newFile</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Create</span>(<span style="color: #7984D1;">"test_copy.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    <span style="color: #ff2afc; font-weight: bold;">defer</span> newFile.<span style="color: #42c6ff;">Close</span>()

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20174;&#28304;&#20013;&#22797;&#21046;&#23383;&#33410;&#21040;&#30446;&#26631;&#25991;&#20214;</span>
    <span style="color: #df85ff;">bytesWritten</span>, <span style="color: #df85ff;">err</span> := io.<span style="color: #42c6ff;">Copy</span>(newFile, originalFile)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    log.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Copied %d bytes"</span>, bytesWritten)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#23558;&#25991;&#20214;&#20869;&#23481; flush &#21040;&#30828;&#30424;&#20013;</span>
    err = newFile.<span style="color: #42c6ff;">Sync</span>()
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org4ce836a" class="outline-3">
<h3 id="org4ce836a">3.2 跳转到文件指定位置（Seek）</h3>
<div class="outline-text-3" id="text-org4ce836a">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"fmt"</span>
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #df85ff;">file</span>, <span style="color: #df85ff;">_</span> := os.<span style="color: #42c6ff;">Open</span>(<span style="color: #7984D1;">"test.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">defer</span> file.<span style="color: #42c6ff;">Close</span>()

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20559;&#31163;&#20301;&#32622;&#65292;&#21487;&#20197;&#26159;&#27491;&#25968;&#20063;&#21487;&#20197;&#26159;&#36127;&#25968;</span>
    <span style="color: #ff2afc; font-weight: bold;">var</span> <span style="color: #df85ff;">offset</span> <span style="color: #ffd400;">int64</span> = 5

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#29992;&#26469;&#35745;&#31639; offset &#30340;&#21021;&#22987;&#20301;&#32622;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">0 = &#25991;&#20214;&#24320;&#22987;&#20301;&#32622;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">1 = &#24403;&#21069;&#20301;&#32622;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">2 = &#25991;&#20214;&#32467;&#23614;&#22788;</span>
    <span style="color: #ff2afc; font-weight: bold;">var</span> <span style="color: #df85ff;">whence</span> <span style="color: #ffd400;">int</span> = 0
    <span style="color: #df85ff;">newPosition</span>, <span style="color: #df85ff;">err</span> := file.<span style="color: #42c6ff;">Seek</span>(offset, whence) <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20559;&#31227;&#37327;&#65292;&#31227;&#21160;&#24320;&#22987;&#20301;&#32622;</span>
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    fmt.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"Just moved to 5:"</span>, newPosition)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20174;&#24403;&#21069;&#20301;&#32622;&#22238;&#36864;&#20004;&#20010;&#23383;&#33410;</span>
    newPosition, err = file.<span style="color: #42c6ff;">Seek</span>(-2, 1)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    fmt.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"Just moved back two:"</span>, newPosition)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20351;&#29992;&#19979;&#38754;&#30340;&#25216;&#24039;&#24471;&#21040;&#24403;&#21069;&#30340;&#20301;&#32622;</span>
    <span style="color: #df85ff;">currentPosition</span>, <span style="color: #df85ff;">err</span> := file.<span style="color: #42c6ff;">Seek</span>(0, 1)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    fmt.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"Current position:"</span>, currentPosition)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#36716;&#21040;&#25991;&#20214;&#24320;&#22987;&#22788;</span>
    newPosition, err = file.<span style="color: #42c6ff;">Seek</span>(0, 0)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }

    fmt.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"Position after seeking 0, 0:"</span>, newPosition)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfaad3d2" class="outline-3">
<h3 id="orgfaad3d2">3.3 写文件</h3>
<div class="outline-text-3" id="text-orgfaad3d2">
<p>
可以使用 <code>os</code> 包写入一个打开的文件。<br>
</p>

<p>
因为 go 可执行包是静态链接的可执行文件，你 import 的每一个包都会增加你的可执行文件的大小。其他的包如 <code>io</code> 、 <code>ioutil</code> 、 <code>bufio</code> 提供了一些方法， <span class="underline">但是它们不是必须的</span> 。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"fmt"</span>
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#21487;&#20889;&#20837;&#26041;&#24335;&#25171;&#24320;&#25991;&#20214;</span>
    <span style="color: #df85ff;">file</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">OpenFile</span>(
        <span style="color: #7984D1;">"test.txt"</span>,
        os.O_WRONLY|os.O_TRUNC|os.O_CREATE,
        0666,
    )
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    <span style="color: #ff2afc; font-weight: bold;">defer</span> file.<span style="color: #42c6ff;">Close</span>()

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20889;&#23383;&#33410;&#21040;&#25991;&#20214;&#20013;</span>
    <span style="color: #df85ff;">byteSlice</span> := []<span style="color: #42c6ff;">byte</span>(<span style="color: #7984D1;">"Bytes!\n"</span>)
    <span style="color: #df85ff;">bytesWritten</span>, <span style="color: #df85ff;">err</span> := file.<span style="color: #42c6ff;">Write</span>(byteSlice)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    fmt.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Wrote %d bytes.\n"</span>, bytesWritten)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orge39ae31" class="outline-3">
<h3 id="orge39ae31">3.4 快写文件</h3>
<div class="outline-text-3" id="text-orge39ae31">
<p>
<code>ioutil</code> 包有一个非常有用的方法 <code>WriteFile()</code> 可以处理创建/打开文件、写字节 slice 和关闭文件一系列的操作。如果你需要简洁快速地写字节 slice 到文件中，你可以使用它。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"io/ioutil"</span>
    <span style="color: #7984D1;">"log"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #df85ff;">err</span> := ioutil.<span style="color: #42c6ff;">WriteFile</span>(<span style="color: #7984D1;">"test.txt"</span>, []<span style="color: #42c6ff;">byte</span>(<span style="color: #7984D1;">"Hi\n"</span>), 0666)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
}
</pre>
</div>

<p>
但是现在 ioutil 这个包已经被舍弃了：<br>
</p>

<p>
<a href="Go-wiki.html#orgc6eeb14">io/ioutil has been deprecated</a><br>
</p>
</div>
</div>
<div id="outline-container-org8c0c6f2" class="outline-3">
<h3 id="org8c0c6f2">3.5 使用缓存写</h3>
<div class="outline-text-3" id="text-org8c0c6f2">
<p>
<code>bufio</code> 包提供了带缓存功能的 writer，所以你可以在写字节到硬盘前使用内存缓存。当你处理很多的数据很有用，因为它可以节省操作硬盘I/O的时间。在其它一些情况下它也很有用，比如你每次写一个字节，把它们攒在内存缓存中，然后一次写入到硬盘中，减少硬盘的磨损以及提升性能。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"bufio"</span>
    <span style="color: #7984D1;">"fmt"</span>
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#25171;&#24320;&#25991;&#20214;&#65292;&#21482;&#20889;</span>
    <span style="color: #df85ff;">file</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">OpenFile</span>(<span style="color: #7984D1;">"test.txt"</span>, os.O_WRONLY, 0666)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    <span style="color: #ff2afc; font-weight: bold;">defer</span> file.<span style="color: #42c6ff;">Close</span>()

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20026;&#36825;&#20010;&#25991;&#20214;&#21019;&#24314; buffered writter</span>
    <span style="color: #df85ff;">bufferedWriter</span> := bufio.<span style="color: #42c6ff;">NewWriter</span>(file)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20889;&#23383;&#33410;&#21040; buffer</span>
    <span style="color: #df85ff;">bytesWritten</span>, <span style="color: #df85ff;">err</span> := bufferedWriter.<span style="color: #42c6ff;">Write</span>(
        []<span style="color: #ffd400;">byte</span>{65, 66, 67},
    )
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    fmt.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"bytes writtern: %d\n"</span>, bytesWritten)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20889;&#23383;&#31526;&#20018;&#21040; buffer</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20063;&#21487;&#20197;&#20351;&#29992; WriteRune() &#21644; WriteByte()</span>
    bytesWritten, err = bufferedWriter.<span style="color: #42c6ff;">WriteString</span>(
        <span style="color: #7984D1;">"Buffered string\n"</span>,
    )
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    log.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Bytes written: %d\n"</span>, bytesWritten)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#26816;&#26597;&#32531;&#23384;&#20013;&#30340;&#23383;&#33410;&#25968;</span>
    <span style="color: #df85ff;">unflushedBufferSize</span> := bufferedWriter.<span style="color: #42c6ff;">Buffered</span>()
    log.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Bytes buffered: %d\n"</span>, unflushedBufferSize)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#36824;&#26377;&#22810;&#23569;&#23383;&#33410;&#21487;&#29992;&#65288;&#26410;&#20351;&#29992;&#30340;&#32531;&#23384;&#22823;&#23567;&#65289;</span>
    <span style="color: #df85ff;">bytesAvailable</span> := bufferedWriter.<span style="color: #42c6ff;">Available</span>()
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    log.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Available buffer: %d\n"</span>, bytesAvailable)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20889;&#20869;&#23384; buffer &#21040;&#30828;&#30424;</span>
    bufferedWriter.<span style="color: #42c6ff;">Flush</span>()

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20002;&#24323;&#36824;&#27809;&#26377; flush &#30340;&#32531;&#23384;&#30340;&#20869;&#23481;&#65292;&#28165;&#38500;&#38169;&#35823;&#24182;&#25226;&#23427;&#30340;&#36755;&#20986;&#20256;&#32473;&#21442;&#25968;&#20013;&#30340; writer</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#24403;&#20320;&#24819;&#23558;&#32531;&#23384;&#20256;&#32473;&#21478;&#22806;&#19968;&#20010; writer &#26102;&#26377;&#29992;</span>
    bufferedWriter.<span style="color: #42c6ff;">Reset</span>(bufferedWriter)

    bytesAvailable = bufferedWriter.<span style="color: #42c6ff;">Available</span>()
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    log.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Available buffer: %d\n"</span>, bytesAvailable)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#37325;&#26032;&#35774;&#32622;&#32531;&#23384;&#30340;&#22823;&#23567;&#12290;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#31532;&#19968;&#20010;&#21442;&#25968;&#26159;&#32531;&#23384;&#24212;&#35813;&#36755;&#20986;&#21040;&#21738;&#37324;&#65292;&#36825;&#20010;&#20363;&#23376;&#20013;&#25105;&#20204;&#20351;&#29992;&#30456;&#21516;&#30340;writer&#12290;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#22914;&#26524;&#25105;&#20204;&#35774;&#32622;&#30340;&#26032;&#30340;&#22823;&#23567;&#23567;&#20110;&#31532;&#19968;&#20010;&#21442;&#25968;writer&#30340;&#32531;&#23384;&#22823;&#23567;&#65292; &#27604;&#22914;10&#65292;&#25105;&#20204;&#19981;&#20250;&#24471;&#21040;&#19968;&#20010;10&#23383;&#33410;&#22823;&#23567;&#30340;&#32531;&#23384;&#65292;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#32780;&#26159;writer&#30340;&#21407;&#22987;&#22823;&#23567;&#30340;&#32531;&#23384;&#65292;&#40664;&#35748;&#26159;4096&#12290;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#23427;&#30340;&#21151;&#33021;&#20027;&#35201;&#36824;&#26159;&#20026;&#20102;&#25193;&#23481;&#12290;</span>
    bufferedWriter = bufio.<span style="color: #42c6ff;">NewWriterSize</span>(
        bufferedWriter,
        8000,
    )

    <span style="color: #546A90;">// </span><span style="color: #546A90;">resize&#21518;&#26816;&#26597;&#32531;&#23384;&#30340;&#22823;&#23567;</span>
    bytesAvailable = bufferedWriter.<span style="color: #42c6ff;">Available</span>()
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    log.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Available buffer: %d\n"</span>, bytesAvailable)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgafee33b" class="outline-3">
<h3 id="orgafee33b">3.6 读取最多 N 个字节</h3>
<div class="outline-text-3" id="text-orgafee33b">
<p>
<code>os.File</code> 提供了文件操作的基本功能，而 <code>io</code> 、 <code>ioutil</code> 、 <code>bufio</code> 提供了额外的辅助函数。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#25171;&#24320;&#25991;&#20214;&#65292;&#21482;&#35835;</span>
    <span style="color: #df85ff;">file</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Open</span>(<span style="color: #7984D1;">"test.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    <span style="color: #ff2afc; font-weight: bold;">defer</span> file.<span style="color: #42c6ff;">Close</span>()

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20174;&#25991;&#20214;&#20013;&#35835;&#21462; len(b) &#23383;&#33410;&#30340;&#25991;&#20214;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#36820;&#22238; 0 &#23383;&#33410;&#24847;&#21619;&#30528;&#35835;&#21462;&#21040;&#25991;&#20214;&#23614;&#20102;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#35835;&#21462;&#21040;&#25991;&#20214;&#20250;&#36820;&#22238; io.EOF &#30340; error</span>
    <span style="color: #df85ff;">byteSlice</span> := <span style="color: #1ea8fc;">make</span>([]<span style="color: #ffd400;">byte</span>, 16)
    <span style="color: #df85ff;">bytesRead</span>, <span style="color: #df85ff;">err</span> := file.<span style="color: #42c6ff;">Read</span>(byteSlice)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    log.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Number of bytes read: %d\n"</span>, bytesRead)
    log.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Data read: %s\n"</span>, byteSlice)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcf8fd3d" class="outline-3">
<h3 id="orgcf8fd3d">3.7 读取正好 N 个字节</h3>
<div class="outline-text-3" id="text-orgcf8fd3d">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"io"</span>
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #546A90;">// </span><span style="color: #546A90;">Open file for reading</span>
    <span style="color: #df85ff;">file</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Open</span>(<span style="color: #7984D1;">"test.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }

    <span style="color: #546A90;">// </span><span style="color: #546A90;">file.Read()&#21487;&#20197;&#35835;&#21462;&#19968;&#20010;&#23567;&#25991;&#20214;&#21040;&#22823;&#30340;byte slice&#20013;&#65292;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20294;&#26159;io.ReadFull()&#22312;&#25991;&#20214;&#30340;&#23383;&#33410;&#25968;&#23567;&#20110;byte slice&#23383;&#33410;&#25968;&#30340;&#26102;&#20505;&#20250;&#36820;&#22238;&#38169;&#35823;</span>
    <span style="color: #df85ff;">byteSlice</span> := <span style="color: #1ea8fc;">make</span>([]<span style="color: #ffd400;">byte</span>, 200)
    <span style="color: #df85ff;">numBytesRead</span>, <span style="color: #df85ff;">err</span> := io.<span style="color: #42c6ff;">ReadFull</span>(file, byteSlice)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    log.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Number of bytes read: %d\n"</span>, numBytesRead)
    log.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Data read: %s\n"</span>, byteSlice)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org57ec136" class="outline-3">
<h3 id="org57ec136">3.8 读取至少 N 个字节</h3>
<div class="outline-text-3" id="text-org57ec136">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"io"</span>
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#25171;&#24320;&#25991;&#20214;&#65292;&#21482;&#35835;</span>
    <span style="color: #df85ff;">file</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Open</span>(<span style="color: #7984D1;">"test.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }

    <span style="color: #df85ff;">byteSlice</span> := <span style="color: #1ea8fc;">make</span>([]<span style="color: #ffd400;">byte</span>, 512)
    <span style="color: #df85ff;">minBytes</span> := 8
    <span style="color: #546A90;">// </span><span style="color: #546A90;">io.ReadAtLeast()&#22312;&#19981;&#33021;&#24471;&#21040;&#26368;&#23567;&#30340;&#23383;&#33410;&#30340;&#26102;&#20505;&#20250;&#36820;&#22238;&#38169;&#35823;&#65292;&#20294;&#20250;&#25226;&#24050;&#35835;&#30340;&#25991;&#20214;&#20445;&#30041;</span>
    <span style="color: #df85ff;">numBytesRead</span>, <span style="color: #df85ff;">err</span> := io.<span style="color: #42c6ff;">ReadAtLeast</span>(file, byteSlice, minBytes)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    log.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Number of bytes read: %d\n"</span>, numBytesRead)
    log.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Data read: %s\n"</span>, byteSlice)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdfb3441" class="outline-3">
<h3 id="orgdfb3441">3.9 读取全部字节</h3>
<div class="outline-text-3" id="text-orgdfb3441">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"fmt"</span>
    <span style="color: #7984D1;">"io"</span>
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #df85ff;">file</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Open</span>(<span style="color: #7984D1;">"test.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }

    <span style="color: #546A90;">// </span><span style="color: #546A90;">os.File.Read(), io.ReadFull() &#21644;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">io.ReadAtLeast() &#22312;&#35835;&#21462;&#20043;&#21069;&#37117;&#38656;&#35201;&#19968;&#20010;&#22266;&#23450;&#22823;&#23567;&#30340; byte slice&#12290;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20294; io.ReadAll() &#20250;&#35835;&#21462; reader&#65288;&#36825;&#20010;&#20363;&#23376;&#20013;&#26159;file&#65289;&#30340;&#27599;&#19968;&#20010;&#23383;&#33410;&#65292;&#28982;&#21518;&#25226;&#23383;&#33410; slice &#36820;&#22238;&#12290;</span>
    <span style="color: #df85ff;">data</span>, <span style="color: #df85ff;">err</span> := io.<span style="color: #42c6ff;">ReadAll</span>(file)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }

    fmt.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Data as hex: %x\n"</span>, data)
    fmt.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Data as string: %s\n"</span>, data)
    fmt.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"Number of bytes read:"</span>, <span style="color: #1ea8fc;">len</span>(data))
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbe07c17" class="outline-3">
<h3 id="orgbe07c17">3.10 快读到内存，读文件到内存</h3>
<div class="outline-text-3" id="text-orgbe07c17">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#35835;&#21462;&#25991;&#20214;&#21040; byte slice &#20013;</span>
    <span style="color: #df85ff;">data</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">ReadFile</span>(<span style="color: #7984D1;">"test.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }

    log.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Data read: %s\n"</span>, data)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org601a362" class="outline-3">
<h3 id="org601a362">3.11 使用缓存读</h3>
<div class="outline-text-3" id="text-org601a362">
<p>
有缓存写也有缓存读。<br>
</p>

<p>
缓存 reader 会把一些内容缓存在内存中，它会提供比 os.File 和 io.Reader 更多的函数，缺省的缓存大小是 4096，最小缓存是 16。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"bufio"</span>
    <span style="color: #7984D1;">"fmt"</span>
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#25171;&#24320;&#25991;&#20214;&#65292;&#21019;&#24314; buffered reader</span>
    <span style="color: #df85ff;">file</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Open</span>(<span style="color: #7984D1;">"test.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    <span style="color: #df85ff;">bufferedReader</span> := bufio.<span style="color: #42c6ff;">NewReader</span>(file)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#24471;&#21040;&#23383;&#33410;&#65292;&#24403;&#21069;&#25351;&#38024;&#19981;&#21464;</span>
    <span style="color: #df85ff;">byteSlice</span> := <span style="color: #1ea8fc;">make</span>([]<span style="color: #ffd400;">byte</span>, 5)
    byteSlice, err = bufferedReader.<span style="color: #42c6ff;">Peek</span>(5)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    fmt.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Peeked at 5 bytes: %s\n"</span>, byteSlice)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#35835;&#21462;&#65292;&#25351;&#38024;&#21516;&#26102;&#31227;&#21160;</span>
    <span style="color: #df85ff;">numBytesRead</span>, <span style="color: #df85ff;">err</span> := bufferedReader.<span style="color: #42c6ff;">Read</span>(byteSlice)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    fmt.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Read %d bytes: %s\n"</span>, numBytesRead, byteSlice)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#35835;&#21462;&#19968;&#20010;&#23383;&#33410;, &#22914;&#26524;&#35835;&#21462;&#19981;&#25104;&#21151;&#20250;&#36820;&#22238; Error</span>
    <span style="color: #df85ff;">myByte</span>, <span style="color: #df85ff;">err</span> := bufferedReader.<span style="color: #42c6ff;">ReadByte</span>()
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    fmt.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Read 1 byte: %c\n"</span>, myByte)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#35835;&#21462;&#21040;&#20998;&#38548;&#31526;&#65292;&#21253;&#21547;&#20998;&#38548;&#31526;&#65292;&#36820;&#22238; byte slice</span>
    <span style="color: #df85ff;">dataBytes</span>, <span style="color: #df85ff;">err</span> := bufferedReader.<span style="color: #42c6ff;">ReadBytes</span>(<span style="color: #7984D1;">'\n'</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    fmt.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Read bytes: %s\n"</span>, dataBytes)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#35835;&#21462;&#21040;&#20998;&#38548;&#31526;&#65292;&#21253;&#21547;&#20998;&#38548;&#31526;&#65292;&#36820;&#22238;&#23383;&#31526;&#20018;</span>
    <span style="color: #df85ff;">dataString</span>, <span style="color: #df85ff;">err</span> := bufferedReader.<span style="color: #42c6ff;">ReadString</span>(<span style="color: #7984D1;">'\n'</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    fmt.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Read string: %s\n"</span>, dataString)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#36825;&#20010;&#20363;&#23376;&#35835;&#21462;&#20102;&#24456;&#22810;&#34892;&#65292;&#25152;&#20197; test.txt &#24212;&#35813;&#21253;&#21547;&#22810;&#34892;&#25991;&#26412;&#25165;&#19981;&#33267;&#20110;&#20986;&#38169;</span>
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org9a4bf0a" class="outline-3">
<h3 id="org9a4bf0a">3.12 使用 scanner</h3>
<div class="outline-text-3" id="text-org9a4bf0a">
<p>
Scanner 是 bufio 包下的类型，在处理文件中以分隔符分隔的文本时很有用。<br>
</p>

<p>
通常我们使用换行符作为分隔符将文件内容分成多行。在 CSV 文件中，逗号一般作为分隔符。<br>
</p>

<p>
os.File 文件可以被包装成 bufio.Scanner，它就像一个缓存 reader。<br>
</p>

<p>
我们会调用 Scan() 方法去读取下一个分隔符，使用 Text() 或者 Bytes() 获取读取的数据。<br>
</p>

<p>
分隔符可以不是一个简单的字节或者字符，有一个特殊的方法可以实现分隔符的功能，以及将指针移动多少，返回什么数据。<br>
</p>

<p>
如果没有定制的 SplitFunc 提供，缺省的 ScanLines 会使用 newline 字符作为分隔符，其它的分隔函数还包括 ScanRunes 和 ScanWords，皆在 bufio 包中。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #546A90;">// </span><span style="color: #546A90;">To define your own split function, match this fingerprint</span>
<span style="color: #ff2afc; font-weight: bold;">type</span> <span style="color: #ffd400;">SplitFunc</span> <span style="color: #ff2afc; font-weight: bold;">func</span>(<span style="color: #df85ff;">data</span> []<span style="color: #ffd400;">byte</span>, <span style="color: #df85ff;">atEOF</span> <span style="color: #ffd400;">bool</span>) (<span style="color: #df85ff;">advance</span> <span style="color: #ffd400;">int</span>, <span style="color: #df85ff;">token</span> []<span style="color: #ffd400;">byte</span>, <span style="color: #df85ff;">err</span> <span style="color: #ffd400;">error</span>)
<span style="color: #546A90;">// </span><span style="color: #546A90;">Returning (0, nil, nil) will tell the scanner</span>
<span style="color: #546A90;">// </span><span style="color: #546A90;">to scan again, but with a bigger buffer because</span>
<span style="color: #546A90;">// </span><span style="color: #546A90;">it wasn't enough data to reach the delimiter</span>
</pre>
</div>

<p>
下面的例子中，为一个文件创建了 bufio.Scanner，并按照单词逐个读取：<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"bufio"</span>
    <span style="color: #7984D1;">"fmt"</span>
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #df85ff;">file</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Open</span>(<span style="color: #7984D1;">"test.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    <span style="color: #df85ff;">scanner</span> := bufio.<span style="color: #42c6ff;">NewScanner</span>(file)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#32570;&#30465;&#30340;&#20998;&#38548;&#20989;&#25968;&#26159; bufio.ScanLines&#65292;&#25105;&#20204;&#36825;&#37324;&#20351;&#29992; ScanWords&#12290;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20063;&#21487;&#20197;&#23450;&#21046;&#19968;&#20010; SplitFunc &#31867;&#22411;&#30340;&#20998;&#38548;&#20989;&#25968;</span>
    scanner.<span style="color: #42c6ff;">Split</span>(bufio.ScanWords)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">scan &#19979;&#19968;&#20010; token.</span>
    <span style="color: #df85ff;">success</span> := scanner.<span style="color: #42c6ff;">Scan</span>()
    <span style="color: #ff2afc; font-weight: bold;">if</span> success == <span style="color: #df85ff; font-weight: bold;">false</span> {
        <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20986;&#29616;&#38169;&#35823;&#25110;&#32773; EOF &#26159;&#36820;&#22238; Error</span>
        err = scanner.<span style="color: #42c6ff;">Err</span>()
        <span style="color: #ff2afc; font-weight: bold;">if</span> err == <span style="color: #df85ff; font-weight: bold;">nil</span> {
            log.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"Scan completed and reached EOF"</span>)
        } <span style="color: #ff2afc; font-weight: bold;">else</span> {
            log.<span style="color: #42c6ff;">Fatal</span>(err)
        }
    }

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#24471;&#21040;&#25968;&#25454; Bytes() &#25110;&#32773; Text()</span>
    fmt.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"First word found:"</span>, scanner.<span style="color: #42c6ff;">Text</span>())

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20877;&#27425;&#35843;&#29992; scanner.Scan() &#21457;&#29616;&#19979;&#19968;&#20010; token</span>
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org0837793" class="outline-2">
<h2 id="org0837793">4. 压缩</h2>
<div class="outline-text-2" id="text-org0837793">
</div>
<div id="outline-container-org77bcc1e" class="outline-3">
<h3 id="org77bcc1e">4.1 打包（zip）文件</h3>
<div class="outline-text-3" id="text-org77bcc1e">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #546A90;">// </span><span style="color: #546A90;">This example uses zip but standard library</span>
<span style="color: #546A90;">// </span><span style="color: #546A90;">also supports tar archives</span>
<span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"archive/zip"</span>
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#21019;&#24314;&#19968;&#20010;&#25171;&#21253;&#25991;&#20214;</span>
    <span style="color: #df85ff;">outFile</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Create</span>(<span style="color: #7984D1;">"test.zip"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    <span style="color: #ff2afc; font-weight: bold;">defer</span> outFile.<span style="color: #42c6ff;">Close</span>()

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#21019;&#24314; zip writer</span>
    <span style="color: #df85ff;">zipWriter</span> := zip.<span style="color: #42c6ff;">NewWriter</span>(outFile)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#24448;&#25171;&#21253;&#25991;&#20214;&#20013;&#20889;&#25991;&#20214;&#12290;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#36825;&#37324;&#25105;&#20204;&#20351;&#29992;&#30828;&#32534;&#30721;&#30340;&#20869;&#23481;&#65292;&#20320;&#21487;&#20197;&#36941;&#21382;&#19968;&#20010;&#25991;&#20214;&#22841;&#65292;&#25226;&#25991;&#20214;&#22841;&#19979;&#30340;&#25991;&#20214;&#20197;&#21450;&#23427;&#20204;&#30340;&#20869;&#23481;&#20889;&#20837;&#21040;&#36825;&#20010;&#25171;&#21253;&#25991;&#20214;&#20013;&#12290;</span>
    <span style="color: #ff2afc; font-weight: bold;">var</span> <span style="color: #df85ff;">filesToArchive</span> = []<span style="color: #ff2afc; font-weight: bold;">struct</span> {
        Name, Body <span style="color: #ffd400;">string</span>
    }{
        {<span style="color: #7984D1;">"test1.txt"</span>, <span style="color: #7984D1;">"String contents of file"</span>},
        {<span style="color: #7984D1;">"test2.txt"</span>, <span style="color: #7984D1;">"\x61\x62\x63\n"</span>},
    }

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#19979;&#38754;&#23558;&#35201;&#25171;&#21253;&#30340;&#20869;&#23481;&#20889;&#20837;&#21040;&#25171;&#21253;&#25991;&#20214;&#20013;&#65292;&#20381;&#27425;&#20889;&#20837;&#12290;</span>
    <span style="color: #ff2afc; font-weight: bold;">for</span> <span style="color: #df85ff;">_</span>, <span style="color: #df85ff;">file</span> := <span style="color: #ff2afc; font-weight: bold;">range</span> filesToArchive {
        <span style="color: #df85ff;">fileWriter</span>, <span style="color: #df85ff;">err</span> := zipWriter.<span style="color: #42c6ff;">Create</span>(file.Name)
        <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
            log.<span style="color: #42c6ff;">Fatal</span>(err)
        }
        _, err = fileWriter.<span style="color: #42c6ff;">Write</span>([]<span style="color: #42c6ff;">byte</span>(file.Body))
        <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
            log.<span style="color: #42c6ff;">Fatal</span>(err)
        }
    }

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#28165;&#29702;</span>
    err = zipWriter.<span style="color: #42c6ff;">Close</span>()
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf3c550b" class="outline-3">
<h3 id="orgf3c550b">4.2 抽取（unzip）文件</h3>
<div class="outline-text-3" id="text-orgf3c550b">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #546A90;">// </span><span style="color: #546A90;">This example uses zip but standard library</span>
<span style="color: #546A90;">// </span><span style="color: #546A90;">also supports tar archives</span>
<span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"archive/zip"</span>
    <span style="color: #7984D1;">"io"</span>
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
    <span style="color: #7984D1;">"path/filepath"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #df85ff;">zipReader</span>, <span style="color: #df85ff;">err</span> := zip.<span style="color: #42c6ff;">OpenReader</span>(<span style="color: #7984D1;">"test.zip"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    <span style="color: #ff2afc; font-weight: bold;">defer</span> zipReader.<span style="color: #42c6ff;">Close</span>()

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#36941;&#21382;&#25171;&#21253;&#25991;&#20214;&#20013;&#30340;&#27599;&#19968;&#25991;&#20214;/&#25991;&#20214;&#22841;</span>
    <span style="color: #ff2afc; font-weight: bold;">for</span> <span style="color: #df85ff;">_</span>, <span style="color: #df85ff;">file</span> := <span style="color: #ff2afc; font-weight: bold;">range</span> zipReader.Reader.File {
        <span style="color: #546A90;">// </span><span style="color: #546A90;">&#25171;&#21253;&#25991;&#20214;&#20013;&#30340;&#25991;&#20214;&#23601;&#20687;&#26222;&#36890;&#30340;&#19968;&#20010;&#25991;&#20214;&#23545;&#35937;&#19968;&#26679;</span>
        <span style="color: #df85ff;">zippedFile</span>, <span style="color: #df85ff;">err</span> := file.<span style="color: #42c6ff;">Open</span>()
        <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
            log.<span style="color: #42c6ff;">Fatal</span>(err)
        }
        <span style="color: #ff2afc; font-weight: bold;">defer</span> zippedFile.<span style="color: #42c6ff;">Close</span>()

        <span style="color: #546A90;">// </span><span style="color: #546A90;">&#25351;&#23450;&#25277;&#21462;&#30340;&#25991;&#20214;&#21517;&#12290;</span>
        <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20320;&#21487;&#20197;&#25351;&#23450;&#20840;&#36335;&#24452;&#21517;&#25110;&#32773;&#19968;&#20010;&#21069;&#32512;&#65292;&#36825;&#26679;&#21487;&#20197;&#25226;&#23427;&#20204;&#25918;&#22312;&#19981;&#21516;&#30340;&#25991;&#20214;&#22841;&#20013;&#12290;</span>
        <span style="color: #546A90;">// </span><span style="color: #546A90;">&#25105;&#20204;&#36825;&#20010;&#20363;&#23376;&#20351;&#29992;&#25171;&#21253;&#25991;&#20214;&#20013;&#30456;&#21516;&#30340;&#25991;&#20214;&#21517;&#12290;</span>
        <span style="color: #df85ff;">targetDir</span> := <span style="color: #7984D1;">"./"</span>
        <span style="color: #df85ff;">extractedFilePath</span> := filepath.<span style="color: #42c6ff;">Join</span>(
            targetDir,
            file.Name,
        )

        <span style="color: #546A90;">// </span><span style="color: #546A90;">&#25277;&#21462;&#39033;&#30446;&#25110;&#32773;&#21019;&#24314;&#25991;&#20214;&#22841;</span>
        <span style="color: #ff2afc; font-weight: bold;">if</span> file.<span style="color: #42c6ff;">FileInfo</span>().<span style="color: #42c6ff;">IsDir</span>() {
            <span style="color: #546A90;">// </span><span style="color: #546A90;">&#21019;&#24314;&#25991;&#20214;&#22841;&#24182;&#35774;&#32622;&#21516;&#26679;&#30340;&#26435;&#38480;</span>
            log.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"Creating directory:"</span>, extractedFilePath)
            os.<span style="color: #42c6ff;">MkdirAll</span>(extractedFilePath, file.<span style="color: #42c6ff;">Mode</span>())
        } <span style="color: #ff2afc; font-weight: bold;">else</span> {
            <span style="color: #546A90;">//</span><span style="color: #546A90;">&#25277;&#21462;&#27491;&#24120;&#30340;&#25991;&#20214;</span>
            log.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"Extracting file:"</span>, file.Name)

            <span style="color: #df85ff;">outputFile</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">OpenFile</span>(
                extractedFilePath,
                os.O_WRONLY|os.O_CREATE|os.O_TRUNC,
                file.<span style="color: #42c6ff;">Mode</span>(),
            )
            <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
                log.<span style="color: #42c6ff;">Fatal</span>(err)
            }
            <span style="color: #ff2afc; font-weight: bold;">defer</span> outputFile.<span style="color: #42c6ff;">Close</span>()

            <span style="color: #546A90;">// </span><span style="color: #546A90;">&#36890;&#36807;io.Copy&#31616;&#27905;&#22320;&#22797;&#21046;&#25991;&#20214;&#20869;&#23481;</span>
            _, err = io.<span style="color: #42c6ff;">Copy</span>(outputFile, zippedFile)
            <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
                log.<span style="color: #42c6ff;">Fatal</span>(err)
            }
        }
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb2af056" class="outline-3">
<h3 id="orgb2af056">4.3 压缩文件</h3>
<div class="outline-text-3" id="text-orgb2af056">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #546A90;">// </span><span style="color: #546A90;">&#36825;&#20010;&#20363;&#23376;&#20013;&#20351;&#29992;gzip&#21387;&#32553;&#26684;&#24335;&#65292;&#26631;&#20934;&#24211;&#36824;&#25903;&#25345;zlib, bz2, flate, lzw</span>
<span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"compress/gzip"</span>
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #df85ff;">outputFile</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Create</span>(<span style="color: #7984D1;">"test.txt.gz"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    <span style="color: #df85ff;">gzipWriter</span> := gzip.<span style="color: #42c6ff;">NewWriter</span>(outputFile)
    <span style="color: #ff2afc; font-weight: bold;">defer</span> gzipWriter.<span style="color: #42c6ff;">Close</span>()

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#24403;&#25105;&#20204;&#20889;&#22914;&#21040; gizp writer &#25968;&#25454;&#26102;&#65292;&#23427;&#20250;&#20381;&#27425;&#21387;&#32553;&#25968;&#25454;&#24182;&#20889;&#20837;&#21040;&#24213;&#23618;&#30340;&#25991;&#20214;&#20013;&#12290;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#25105;&#20204;&#19981;&#24517;&#20851;&#24515;&#23427;&#26159;&#22914;&#20309;&#21387;&#32553;&#30340;&#65292;&#36824;&#26159;&#20687;&#26222;&#36890;&#30340; writer &#19968;&#26679;&#25805;&#20316;&#21363;&#21487;&#12290;</span>
    _, err = gzipWriter.<span style="color: #42c6ff;">Write</span>([]<span style="color: #42c6ff;">byte</span>(<span style="color: #7984D1;">"Gophers rule!\n"</span>))
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }

    log.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"Compressed data written to file."</span>)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orge72b3c6" class="outline-3">
<h3 id="orge72b3c6">4.4 解压缩文件</h3>
<div class="outline-text-3" id="text-orge72b3c6">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #546A90;">// </span><span style="color: #546A90;">&#36825;&#20010;&#20363;&#23376;&#20013;&#20351;&#29992;gzip&#21387;&#32553;&#26684;&#24335;&#65292;&#26631;&#20934;&#24211;&#36824;&#25903;&#25345;zlib, bz2, flate, lzw</span>
<span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"compress/gzip"</span>
    <span style="color: #7984D1;">"io"</span>
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#25171;&#24320;&#19968;&#20010; gzip &#25991;&#20214;&#12290;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#25991;&#20214;&#26159;&#19968;&#20010; reader&#65292;&#20294;&#26159;&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;&#21508;&#31181;&#25968;&#25454;&#28304;&#65292;&#27604;&#22914; web &#26381;&#21153;&#22120;&#36820;&#22238;&#30340; gzipped &#20869;&#23481;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#23427;&#30340;&#20869;&#23481;&#19981;&#26159;&#19968;&#20010;&#25991;&#20214;&#65292;&#32780;&#26159;&#19968;&#20010;&#20869;&#23384;&#27969;</span>
    <span style="color: #df85ff;">gzipFile</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Open</span>(<span style="color: #7984D1;">"test.txt.gz"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }

    <span style="color: #df85ff;">gzipReader</span>, <span style="color: #df85ff;">err</span> := gzip.<span style="color: #42c6ff;">NewReader</span>(gzipFile)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    <span style="color: #ff2afc; font-weight: bold;">defer</span> gzipReader.<span style="color: #42c6ff;">Close</span>()

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#35299;&#21387;&#32553;&#21040;&#19968;&#20010; writer&#65292;&#23427;&#26159;&#19968;&#20010; file writer</span>
    <span style="color: #df85ff;">outfileWriter</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Create</span>(<span style="color: #7984D1;">"unzipped.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    <span style="color: #ff2afc; font-weight: bold;">defer</span> outfileWriter.<span style="color: #42c6ff;">Close</span>()

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#22797;&#21046;&#20869;&#23481;</span>
    _, err = io.<span style="color: #42c6ff;">Copy</span>(outfileWriter, gzipReader)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc3fe15a" class="outline-2">
<h2 id="orgc3fe15a">5. 其他</h2>
<div class="outline-text-2" id="text-orgc3fe15a">
</div>
<div id="outline-container-orgb23e0bd" class="outline-3">
<h3 id="orgb23e0bd">5.1 临时文件和目录</h3>
<div class="outline-text-3" id="text-orgb23e0bd">
<p>
<code>os</code> 提供了两个函数： <code>MkdirTemp()</code> 和 <code>CreateTemp()</code> 。<br>
</p>

<p>
使用完毕后，调用者负责删除这些临时文件和文件夹。<br>
</p>

<p>
有一点好处就是当你传递一个空字符串作为文件夹名的时候，它会在操作系统的临时文件夹中创建这些项目（/tmp on Linux）。<br>
</p>

<p>
<code>os.TempDir()</code> 返回当前操作系统的临时文件夹。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"fmt"</span>
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#22312;&#31995;&#32479;&#20020;&#26102;&#25991;&#20214;&#22841;&#20013;&#21019;&#24314;&#19968;&#20010;&#20020;&#26102;&#25991;&#20214;&#22841;</span>
    <span style="color: #df85ff;">tempDirPath</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">MkdirTemp</span>(<span style="color: #7984D1;">""</span>, <span style="color: #7984D1;">"myTempDir"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    fmt.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"Temp dir created:"</span>, tempDirPath)

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#22312;&#20020;&#26102;&#25991;&#20214;&#22841;&#20013;&#21019;&#24314;&#20020;&#26102;&#25991;&#20214;</span>
    <span style="color: #df85ff;">tempFile</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">CreateTemp</span>(tempDirPath, <span style="color: #7984D1;">"myTempFile.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    fmt.<span style="color: #42c6ff;">Println</span>(<span style="color: #7984D1;">"Temp file created:"</span>, tempFile.<span style="color: #42c6ff;">Name</span>())

    <span style="color: #546A90;">// </span><span style="color: #546A90;">... &#20570;&#19968;&#20123;&#25805;&#20316; ...</span>

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20851;&#38381;&#25991;&#20214;</span>
    err = tempFile.<span style="color: #42c6ff;">Close</span>()
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#21024;&#38500;&#25105;&#20204;&#21019;&#24314;&#30340;&#36164;&#28304;</span>
    err = os.<span style="color: #42c6ff;">Remove</span>(tempFile.<span style="color: #42c6ff;">Name</span>())
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }

    err = os.<span style="color: #42c6ff;">Remove</span>(tempDirPath)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc134b5d" class="outline-3">
<h3 id="orgc134b5d">5.2 通过 HTTP 下载文件</h3>
<div class="outline-text-3" id="text-orgc134b5d">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"io"</span>
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"net/http"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #df85ff;">newFile</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Create</span>(<span style="color: #7984D1;">"baidu.html"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    <span style="color: #ff2afc; font-weight: bold;">defer</span> newFile.<span style="color: #42c6ff;">Close</span>()

    <span style="color: #df85ff;">url</span> := <span style="color: #7984D1;">"http://www.baidu.com"</span>
    <span style="color: #df85ff;">response</span>, <span style="color: #df85ff;">err</span> := http.<span style="color: #42c6ff;">Get</span>(url)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(<span style="color: #7984D1;">"response err"</span>)
    }
    <span style="color: #ff2afc; font-weight: bold;">defer</span> response.Body.<span style="color: #42c6ff;">Close</span>()

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#23558;HTTP response Body&#20013;&#30340;&#20869;&#23481;&#20889;&#20837;&#21040;&#25991;&#20214;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">Body&#28385;&#36275;reader&#25509;&#21475;&#65292;&#22240;&#27492;&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;ioutil.Copy</span>
    <span style="color: #df85ff;">numBytesWritten</span>, <span style="color: #df85ff;">err</span> := io.<span style="color: #42c6ff;">Copy</span>(newFile, response.Body)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    log.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Downloaded %d byte file.\n"</span>, numBytesWritten)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org0fd851e" class="outline-3">
<h3 id="org0fd851e">5.3 哈希和摘要</h3>
<div class="outline-text-3" id="text-org0fd851e">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"crypto/md5"</span>
    <span style="color: #7984D1;">"crypto/sha1"</span>
    <span style="color: #7984D1;">"crypto/sha256"</span>
    <span style="color: #7984D1;">"crypto/sha512"</span>
    <span style="color: #7984D1;">"fmt"</span>
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#24471;&#21040;&#25991;&#20214;&#20869;&#23481;</span>
    <span style="color: #df85ff;">data</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">ReadFile</span>(<span style="color: #7984D1;">"test.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#35745;&#31639;Hash</span>
    fmt.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Md5: %x\n\n"</span>, md5.<span style="color: #42c6ff;">Sum</span>(data))
    fmt.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Sha1: %x\n\n"</span>, sha1.<span style="color: #42c6ff;">Sum</span>(data))
    fmt.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Sha256: %x\n\n"</span>, sha256.<span style="color: #42c6ff;">Sum256</span>(data))
    fmt.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Sha512: %x\n\n"</span>, sha512.<span style="color: #42c6ff;">Sum512</span>(data))
}
</pre>
</div>

<p>
上面的例子复制整个文件内容到内存中，传递给 hash 函数。<br>
</p>

<p>
另一个方式是创建一个 hash writer, 使用 <code>Write</code> 、 <code>WriteString</code> 、 <code>Copy</code> 将数据传给它。<br>
</p>

<p>
下面的例子使用 md5 hash，但你可以使用其它的 <code>Writer</code> 。<br>
</p>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff2afc; font-weight: bold;">package</span> main

<span style="color: #ff2afc; font-weight: bold;">import</span> (
    <span style="color: #7984D1;">"crypto/md5"</span>
    <span style="color: #7984D1;">"fmt"</span>
    <span style="color: #7984D1;">"io"</span>
    <span style="color: #7984D1;">"log"</span>
    <span style="color: #7984D1;">"os"</span>
)

<span style="color: #ff2afc; font-weight: bold;">func</span> <span style="color: #42c6ff;">main</span>() {
    <span style="color: #df85ff;">file</span>, <span style="color: #df85ff;">err</span> := os.<span style="color: #42c6ff;">Open</span>(<span style="color: #7984D1;">"test.txt"</span>)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }
    <span style="color: #ff2afc; font-weight: bold;">defer</span> file.<span style="color: #42c6ff;">Close</span>()

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#21019;&#24314;&#19968;&#20010;&#26032;&#30340; hasher&#65292;&#28385;&#36275; writer &#25509;&#21475;</span>
    <span style="color: #df85ff;">hasher</span> := md5.<span style="color: #42c6ff;">New</span>()
    _, err = io.<span style="color: #42c6ff;">Copy</span>(hasher, file)
    <span style="color: #ff2afc; font-weight: bold;">if</span> err != <span style="color: #df85ff; font-weight: bold;">nil</span> {
        log.<span style="color: #42c6ff;">Fatal</span>(err)
    }

    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#35745;&#31639; hash &#24182;&#25171;&#21360;&#32467;&#26524;&#12290;</span>
    <span style="color: #546A90;">// </span><span style="color: #546A90;">&#20256;&#36882; nil &#20316;&#20026;&#21442;&#25968;&#65292;&#22240;&#20026;&#25105;&#20204;&#19981;&#36890;&#21442;&#25968;&#20256;&#36882;&#25968;&#25454;&#65292;&#32780;&#26159;&#36890;&#36807; writer &#25509;&#21475;&#12290;</span>
    <span style="color: #df85ff;">sum</span> := hasher.<span style="color: #42c6ff;">Sum</span>(<span style="color: #df85ff; font-weight: bold;">nil</span>)
    fmt.<span style="color: #42c6ff;">Printf</span>(<span style="color: #7984D1;">"Md5 checksum: %x\n"</span>, sum)
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgca37124" class="outline-2">
<h2 id="orgca37124">6. 参考</h2>
<div class="outline-text-2" id="text-orgca37124">
<div class="reference">
<ul style="list-style: none;">
<li><a href="https://colobu.com/2016/10/12/go-file-operations/#%E8%AF%BB%E5%86%99" target="_blank">Go文件操作大全</a></li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2023-01-03 10:01 Tue</p>
<p class="author">Author: Haoran Liu</p>
<p class="date">Created: 2023-01-31</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
