<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2023-01-12 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DOCKER 常用命令</title>
<meta name="author" content="L.M.haoran &lt;haoran.mc@outlook.com&gt;" />
<meta name="description" content="Copyright © 2021, L.M.haoran, all rights reserved." />
<meta name="generator" content="Org Mode" />
<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
           <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
           <script type="module" src="static/js/main.js" defer></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">DOCKER 常用命令</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgdebf496">帮助命令</a></li>
<li><a href="#org27f3239">镜像命令</a>
<ul>
<li><a href="#org7c5964b">docker images 列出本地镜像</a></li>
<li><a href="#org8699375">docker search 搜索镜像</a></li>
<li><a href="#org5181db9">docker pull 下载镜像</a></li>
<li><a href="#org80dd546">docker rmi 删除镜像</a></li>
</ul>
</li>
<li><a href="#orgad1b1a6">容器命令</a>
<ul>
<li><a href="#org14216c7">docker run 新建容器并启动</a></li>
<li><a href="#org15b8779">docker ps 列出所有运行的容器</a></li>
<li><a href="#org20eb66e">退出容器的两种方法</a></li>
<li><a href="#orgd4717d3">容器的启动、重启、停止、杀死</a></li>
<li><a href="#org27492b9">docker rm 删除容器</a></li>
</ul>
</li>
<li><a href="#orgdcbd0b3">常用其他命令</a>
<ul>
<li><a href="#org4fb6243">docker logs 查看日志</a></li>
<li><a href="#orgfeb27ff">查看容器中运行的进程信息</a></li>
<li><a href="#orgb6c2cb5">docker inspect 查看容器/镜像的元数据</a></li>
<li><a href="#orgd065120">进入正在运行的容器：exec、attach</a></li>
<li><a href="#org8ebc610">docker cp 从容器内拷贝文件到主机上</a></li>
<li><a href="#orgb62087d">docker ps 只显示容器名称，显示列名</a></li>
</ul>
</li>
<li><a href="#org381dd45">可视化</a>
<ul>
<li><a href="#org3d77398">portainer</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgdebf496" class="outline-2">
<h2 id="orgdebf496">帮助命令</h2>
<div class="outline-text-2" id="text-orgdebf496">
<dl class="org-dl">
<dt>docker version</dt><dd>显示 Docker 版本信息；<br></dd>
<dt>docker info   </dt><dd>显示 Docker 系统信息，包括镜像和容器数；<br></dd>
<dt>docker &#x2013;help </dt><dd>帮助镜像命令；<br></dd>
</dl>
</div>
</div>
<div id="outline-container-org27f3239" class="outline-2">
<h2 id="org27f3239">镜像命令</h2>
<div class="outline-text-2" id="text-org27f3239">
</div>
<div id="outline-container-org7c5964b" class="outline-3">
<h3 id="org7c5964b">docker images 列出本地镜像</h3>
<div class="outline-text-3" id="text-org7c5964b">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">&#21015;&#20986;&#26412;&#22320;&#20027;&#26426;&#19978;&#30340;&#38236;&#20687;</span>
$ docker images
REPOSITORY  TAG     IMAGE      ID    CREATED      SIZE
hello-world latest bf756fb1ae65 4    months ago  13.3kB

<span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">-a: &#21015;&#20986;&#26412;&#22320;&#25152;&#26377;&#38236;&#20687;</span>
<span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">-q: &#21482;&#26174;&#31034;&#38236;&#20687;id</span>
<span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">--digests: &#26174;&#31034;&#38236;&#20687;&#30340;&#25688;&#35201;&#20449;&#24687;</span>
</pre>
</div>

<dl class="org-dl">
<dt>REPOSITORY </dt><dd>镜像的仓库源<br></dd>
<dt>TAG        </dt><dd>镜像的标签<br></dd>
<dt>IMAGE ID   </dt><dd>镜像的ID<br></dd>
<dt>CREATED    </dt><dd>镜像创建时间<br></dd>
<dt>SIZE       </dt><dd>镜像大小<br></dd>
</dl>

<p>
同一个仓库源可以有多个 <code>TAG</code> ，代表这个仓库源的不同版本，我们使用 <code>REPOSITORY:TAG</code> 定义不同的镜像，如果你不定义镜像的标签版本，docker 将默认使用 lastest 镜像。<br>
</p>
</div>
</div>
<div id="outline-container-org8699375" class="outline-3">
<h3 id="org8699375">docker search 搜索镜像</h3>
<div class="outline-text-3" id="text-org8699375">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">&#25628;&#32034; DockerHub &#20013;&#30340;&#38236;&#20687;</span>
$ docker search mysql
NAME      DESCRIPTION                                     STARS   OFFICIAL
mysql     MySQL is a widely used, open-source relation... 9484    [OK]

<span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">--filter=stars=50   : &#21015;&#20986;&#25910;&#34255;&#25968;&#19981;&#23567;&#20110;&#25351;&#23450;&#20540;&#30340;&#38236;&#20687;&#65292;&#36825;&#37324;=&#21608;&#22260;&#19981;&#33021;&#26377;&#31354;&#26684;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org5181db9" class="outline-3">
<h3 id="org5181db9">docker pull 下载镜像</h3>
<div class="outline-text-3" id="text-org5181db9">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">&#19979;&#36733;&#38236;&#20687;</span>
$ docker pull mysql
Using default tag: latest <span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">&#19981;&#20889; tag&#65292;&#40664;&#35748;&#26159;&#26368;&#26032;&#29256;&#26412;&#65288;latest&#65289;</span>
latest: Pulling from library/mysql
54fec2fa59d0: Already exists
bcc6c6145912: Already exists
951c3d959c9d: Already exists
05de4d0e206e: Already exists
319f0394ef42: Already exists
d9185034607b: Already exists
013a9c64dadc: Already exists
42f3f7d10903: Pull complete
c4a3851d9207: Pull complete  <span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">&#20998;&#23618;&#19979;&#36733;</span>
82a1cc65c182: Pull complete
a0a6b01efa55: Pull complete
bca5ce71f9ea: Pull complete
Digest:
sha256:61a2a33f4b8b4bc93b7b6b9e65e64044aaec594809f818aeffbff69a893d1944 <span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">&#31614;&#21517;</span>
Status: Downloaded newer image for mysql:latest
docker.io/library/mysql:latest <span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">&#30495;&#23454;&#20301;&#32622;</span>
</pre>
</div>

<p>
也可以指定版本下载：<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">$ docker pull mysql:5.7
....
</pre>
</div>
</div>
</div>
<div id="outline-container-org80dd546" class="outline-3">
<h3 id="org80dd546">docker rmi 删除镜像</h3>
<div class="outline-text-3" id="text-org80dd546">
<div class="org-src-container">
<pre class="src src-bash">docker rmi

docker rmi -f &#38236;&#20687;id    <span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">&#21024;&#38500;&#21333;&#20010;&#38236;&#20687;</span>
docker rmi -f &#38236;&#20687;&#21517;:tag &#38236;&#20687;&#21517;:tag  <span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">&#21024;&#38500;&#22810;&#20010;&#38236;&#20687;</span>
docker rmi -f $(docker images -qa)   <span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">&#21024;&#38500;&#20840;&#37096;&#38236;&#20687;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgad1b1a6" class="outline-2">
<h2 id="orgad1b1a6">容器命令</h2>
<div class="outline-text-2" id="text-orgad1b1a6">
<p>
说明：有镜像才能创建容器，这里使用 centos 的镜像来测试：<br>
</p>

<div class="org-src-container">
<pre class="src src-bash">docker pull centos
</pre>
</div>
</div>
<div id="outline-container-org14216c7" class="outline-3">
<h3 id="org14216c7">docker run 新建容器并启动</h3>
<div class="outline-text-3" id="text-org14216c7">
<pre class="example" id="org3effe60">
docker run [OPTIONS] IMAGE [COMMAND][ARG...]

--name="Name": 给容器指定一个名字，建议改一下名字，不然可能会与镜像弄混；
-d: 后台方式运行容器，并返回容器的 id；
-i: 以交互模式运行容器，通过和 -t 一起使用；
-t: 给容器重新分配一个终端，通常和 -i 一起使用；
-P: 随机端口映射（大写）；
-p: 指定端口映射（小结），一般可以有四种写法：

1. ip:hostPort:containerPort
2. ip::containerPort
3. hostPort:containerPort（常用）
4. containerPort
</pre>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">&#26597;&#30475;&#24403;&#21069;&#36816;&#34892;&#30340;&#38236;&#20687;</span>
$ docker images
REPOSITORY  TAG      IMAGE ID        CREATED         SIZE
centos      latest   470671670cac    3 months ago    237MB

<span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">&#20351;&#29992; centos &#36827;&#34892;&#29992;&#20132;&#20114;&#27169;&#24335;&#21551;&#21160;&#23481;&#22120;&#65292;&#22312;&#23481;&#22120;&#20869;&#25191;&#34892; /bin/bash &#21629;&#20196;</span>
$ docker run -it centos /bin/bash
$ ls    <span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">&#27880;&#24847;&#22320;&#22336;&#65292;&#24050;&#32463;&#20999;&#25442;&#21040;&#23481;&#22120;&#20869;&#37096;&#20102;</span>
bin etc lib lost+found mnt proc run srv tmp dev home lib64 media opt root sbin sys usr var

$ exit  <span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">&#20351;&#29992; exit &#36864;&#20986;&#23481;&#22120;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org15b8779" class="outline-3">
<h3 id="org15b8779">docker ps 列出所有运行的容器</h3>
<div class="outline-text-3" id="text-org15b8779">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">&#19981;&#21152;&#21442;&#25968;&#30340;&#35805;&#65292;&#23601;&#21482;&#26174;&#31034;&#27491;&#22312;&#36816;&#34892;&#30340;&#23481;&#22120;</span>
docker ps [OPTIONS]

-a: &#21015;&#20986;&#24403;&#21069;&#25152;&#26377;&#27491;&#22312;&#36816;&#34892;&#30340;&#23481;&#22120; + &#21382;&#21490;&#36816;&#34892;&#36807;&#30340;&#23481;&#22120;&#65307;
-l: &#26174;&#31034;&#26368;&#36817;&#21019;&#24314;&#30340;&#23481;&#22120;&#65307;
-n=?: &#26174;&#31034;&#26368;&#36817;n&#20010;&#21019;&#24314;&#30340;&#23481;&#22120;&#65307;
-q: &#38745;&#40664;&#27169;&#24335;&#65292;&#21482;&#26174;&#31034;&#23481;&#22120;&#32534;&#21495;&#65307;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">$ docker ps
CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES
93f4c8395c51   centos    <span style="color: #b5bd68;">"/bin/bash"</span>   10 seconds ago   Up 9 seconds              trusting_bohr
3a7035e82dd6   centos    <span style="color: #b5bd68;">"/bin/bash"</span>   15 minutes ago   Up 32 seconds             friendly_bouman
</pre>
</div>

<p>
你会发现虽然容器名都是 cantos，但是可以运行两个，这是因为区分容器是用 id 来区分的，可以有相同的名字，这就是为什么推荐每次创建容器的时候重命名（这还只是运行着的容器，没运行的容器还可能有 centos）。<br>
</p>
</div>
</div>
<div id="outline-container-org20eb66e" class="outline-3">
<h3 id="org20eb66e">退出容器的两种方法</h3>
<div class="outline-text-3" id="text-org20eb66e">
<dl class="org-dl">
<dt>exit</dt><dd>容器停止退出<br></dd>
<dt>ctrl + P + Q</dt><dd>容器不停止退出<br></dd>
</dl>
</div>
</div>
<div id="outline-container-orgd4717d3" class="outline-3">
<h3 id="orgd4717d3">容器的启动、重启、停止、杀死</h3>
<div class="outline-text-3" id="text-orgd4717d3">
<dl class="org-dl">
<dt>docker start (容器id or 容器名)</dt><dd>启动容器<br></dd>
<dt>docker restart (容器id or 容器名)</dt><dd>重启容器<br></dd>
<dt>docker stop (容器id or 容器名)</dt><dd>停止容器<br></dd>
<dt>docker kill (容器id or 容器名)</dt><dd>强制停止容器<br></dd>
</dl>
</div>
</div>
<div id="outline-container-org27492b9" class="outline-3">
<h3 id="org27492b9">docker rm 删除容器</h3>
<div class="outline-text-3" id="text-org27492b9">
<dl class="org-dl">
<dt>docker rm 容器id</dt><dd>删除指定容器，不能删除正在运行的容器，如果要强制删除，rm -f<br></dd>
<dt><code>docker rm -f $(docker ps -a -q)</code></dt><dd>删除所有容器<br></dd>
<dt><code>docker ps -a -q | xargs docker rm</code></dt><dd>删除所有容器<br></dd>
</dl>
</div>
</div>
</div>
<div id="outline-container-orgdcbd0b3" class="outline-2">
<h2 id="orgdcbd0b3">常用其他命令</h2>
<div class="outline-text-2" id="text-orgdcbd0b3">
</div>
<div id="outline-container-org4fb6243" class="outline-3">
<h3 id="org4fb6243">docker logs 查看日志</h3>
<div class="outline-text-3" id="text-org4fb6243">
<div class="org-src-container">
<pre class="src src-bash">docker logs -f -t --tail &#26085;&#24535;&#26465;&#25968; &#23481;&#22120;id

<span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">-t &#26174;&#31034;&#26102;&#38388;&#25139;</span>
<span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">-f &#25171;&#21360;&#26368;&#26032;&#30340;&#26085;&#24535;</span>
<span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">--tail &#25968;&#23383; &#26174;&#31034;&#22810;&#23569;&#26465;!</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">$ docker run -d centos /bin/sh -c <span style="color: #b5bd68;">"while true; do echo haoran; sleep 1; done"</span>

$ docker ps
CONTAINER ID         IMAGE
c8530dbbe3b4         centos

$ docker logs -tf --tail 10 c8530dbbe3b4
2020-05-11T08:46:40.656901941Z haoran
2020-05-11T08:46:41.658765018Z haoran
2020-05-11T08:46:42.661015375Z haoran
2020-05-11T08:46:43.662865628Z haoran
2020-05-11T08:46:44.664571547Z haoran
2020-05-11T08:46:45.666718583Z haoran
2020-05-11T08:46:46.668556725Z haoran
2020-05-11T08:46:47.670424699Z haoran
2020-05-11T08:46:48.672324512Z haoran
2020-05-11T08:46:49.674092766Z haoran
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfeb27ff" class="outline-3">
<h3 id="orgfeb27ff">查看容器中运行的进程信息</h3>
<div class="outline-text-3" id="text-orgfeb27ff">
<pre class="example" id="orgabbd0af">
docker top 容器id
</pre>

<div class="org-src-container">
<pre class="src src-shell">$ docker top c8530dbbe3b4
UID    PID    PPID  C  STIME  TTY  TIME      CMD
root  27437  27421  0  16:43  ?   00:00:00  /bin/sh -c ....
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb6c2cb5" class="outline-3">
<h3 id="orgb6c2cb5">docker inspect 查看容器/镜像的元数据</h3>
<div class="outline-text-3" id="text-orgb6c2cb5">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">&#21629;&#20196;</span>
docker inspect &#23481;&#22120;id

<span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">&#27979;&#35797;</span>
$ docker inspect c8530dbbe3b4
[
  {
    <span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">&#23436;&#25972;&#30340;id,&#26377;&#24847;&#24605;&#21834;,&#36825;&#37324;&#19978;&#38754;&#30340;&#23481;&#22120;id,&#23601;&#26159;&#25130;&#21462;&#30340;&#36825;&#20010;id&#21069;&#20960;&#20301;!</span>
    <span style="color: #b5bd68;">"Id"</span>: <span style="color: #b5bd68;">"c8530dbbe3b44a0c873f2566442df6543ed653c1319753e34b400efa05f77cf8"</span>,
    <span style="color: #b5bd68;">"Created"</span>: <span style="color: #b5bd68;">"2020-05-11T08:43:45.096892382Z"</span>,
    <span style="color: #b5bd68;">"Path"</span>: <span style="color: #b5bd68;">"/bin/sh"</span>,
    <span style="color: #b5bd68;">"Args"</span>: [
      <span style="color: #b5bd68;">"-c"</span>,
      <span style="color: #b5bd68;">"while true;do echo haoran;sleep 1;done"</span>
    ],
    <span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">&#29366;&#24577;</span>
    <span style="color: #b5bd68;">"State"</span>: {
      <span style="color: #b5bd68;">"Status"</span>: <span style="color: #b5bd68;">"running"</span>,
      <span style="color: #b5bd68;">"Running"</span>: true,
      <span style="color: #b5bd68;">"Paused"</span>: false,
      <span style="color: #b5bd68;">"Restarting"</span>: false,
      <span style="color: #b5bd68;">"OOMKilled"</span>: false,
      <span style="color: #b5bd68;">"Dead"</span>: false,24 <span style="color: #b5bd68;">"Pid"</span>: 27437,
      <span style="color: #b5bd68;">"ExitCode"</span>: 0,
      <span style="color: #b5bd68;">"Error"</span>: <span style="color: #b5bd68;">""</span>,
      <span style="color: #b5bd68;">"StartedAt"</span>: <span style="color: #b5bd68;">"2020-05-11T08:43:45.324474622Z"</span>,
      <span style="color: #b5bd68;">"FinishedAt"</span>: <span style="color: #b5bd68;">"0001-01-01T00:00:00Z"</span>
    },
    // ...........
  }
]
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd065120" class="outline-3">
<h3 id="orgd065120">进入正在运行的容器：exec、attach</h3>
<div class="outline-text-3" id="text-orgd065120">
<ul class="org-ul">
<li><p>
exec<br>
</p>

<pre class="example" id="orgd9190e4">
docker exec -it 容器id bashShell
</pre>

<div class="org-src-container">
<pre class="src src-shell">$ docker ps
CONTAINER ID   IMAGE    COMMAND                   CREATED         STATUS         PORTS      NAMES
c8530dbbe3b4   centos  <span style="color: #b5bd68;">"/bin/sh -c 'while t..."</span>   12 minutes ago  Up 12 minutes            happy_chaum

$ docker exec -it c8530dbbe3b4 /bin/bash

$ ps -ef
UID  PID PPID  C  STIME  TTY  TIME         CMD
root 1    0    0  08:43   ?   00:00:00     /bin/sh -c while true;<span style="color: #b294bb;">do</span>
</pre>
</div></li>

<li><p>
attach<br>
</p>

<pre class="example" id="orgbeab52c">
docker attach 容器id
</pre>

<div class="org-src-container">
<pre class="src src-shell">$ docker exec -it c8530dbbe3b4 /bin/bash
$ ps -ef
UID PID PPID C STIME TTY TIME CMD
root 1 0 0 08:43 ? 00:00:00 /bin/sh -c while true;<span style="color: #b294bb;">do</span>
</pre>
</div></li>
</ul>

<p>
<code>exec</code> 与 <code>attach</code> 的区别：<br>
</p>

<dl class="org-dl">
<dt>exec</dt><dd>是在容器中打开新的终端，并且可以启动新的进程<br></dd>
<dt>attach </dt><dd>直接进入容器启动命令的终端，不会启动新的进程<br></dd>
</dl>
</div>
</div>
<div id="outline-container-org8ebc610" class="outline-3">
<h3 id="org8ebc610">docker cp 从容器内拷贝文件到主机上</h3>
<div class="outline-text-3" id="text-org8ebc610">
<pre class="example" id="orgbcd4d13">
docker cp 容器id : 容器内路径 目的主机路径
</pre>

<div class="org-src-container">
<pre class="src src-shell">[root@c8530dbbe3b4 /]# cd /home
[root@c8530dbbe3b4 home]# touch f1
[root@c8530dbbe3b4 home]# ls9
f1
[root@c8530dbbe3b4 home]# exit
<span style="color: #b294bb;">exit</span>

<span style="color: #5a5b5a;"># </span><span style="color: #5a5b5a;">linux&#22797;&#21046;&#26597;&#30475;,&#26159;&#21542;&#22797;&#21046;&#25104;&#21151;</span>
[root@haoran ~]# docker cp c8530dbbe3b4:/home/f1 /home
[root@haoran ~]# cd /home
[root@haoran home]# ls
f1
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb62087d" class="outline-3">
<h3 id="orgb62087d">docker ps 只显示容器名称，显示列名</h3>
<div class="outline-text-3" id="text-orgb62087d">
<div class="org-src-container">
<pre class="src src-bash">docker ps -a --format <span style="color: #b5bd68;">"table {{.Names}}"</span> | grep -v <span style="color: #b5bd68;">"NAMES"</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org381dd45" class="outline-2">
<h2 id="org381dd45">可视化</h2>
<div class="outline-text-2" id="text-org381dd45">
</div>
<div id="outline-container-org3d77398" class="outline-3">
<h3 id="org3d77398">portainer</h3>
<div class="outline-text-3" id="text-org3d77398">
<div class="org-src-container">
<pre class="src src-shell">docker run -d -p 8088:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer
</pre>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
