<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2021-11-29 Mon 22:43 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MANACHER</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran">
<meta name="description" content="Copyright © 2021, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">MANACHER</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org295232c">介绍</a></li>
<li><a href="#orgb324e76">算法过程</a></li>
<li><a href="#orgea3ff58">代码</a></li>
</ul>
</div>
</div>

<div id="outline-container-org295232c" class="outline-2">
<h2 id="org295232c">介绍</h2>
<div class="outline-text-2" id="text-org295232c">
<p>
Manacher 算法可以线性的计算出一个字符串的最长回文串的长度。<br>
</p>
</div>
</div>
<div id="outline-container-orgb324e76" class="outline-2">
<h2 id="orgb324e76">算法过程</h2>
<div class="outline-text-2" id="text-orgb324e76">
<p>
Manacher 要求字符串的长度是奇数。所以我们在得到一个字符串后，先在这个字符串的每两个字符中间添加一个这个字符串中不会出现的字符，还要在整个串的前后添加这个字符，为了使边界好处理，我们再在整个串的前后各添加一个不是前面那个字符的在这个字符串中不会出现的字符，即：<br>
</p>

<img src="./images/Manacher01.png" />

<p>
Manacher 要求维护一个最右回文子串（并非最长回文子串）的中心位置 <code>mid</code> 与右边界位置 <code>max_right</code> ，以及一个 \(p\) 数组，\(p[i]\) 代表的是以位置 \(i\) 为中心的最长的回文串的半径。<br>
</p>

<p>
例如下面这个字符串的 \(p[8] = 6\)：<br>
</p>

<img src="./images/Manacher02.png" />

<p>
然后在遍历整个字符串的过程中用下标 \(i\) 来不停地更新这两个值：<br>
</p>

<p>
首先需要知道的是：在算法的整个过程中，一定有 \(i \geq mid、i \leq max\_right\)，因为我们会让 \(i\) 从串首遍历到串尾，如果以 \(i\) 为中心的最长的回文串右边界一旦大于等于 \(max\_right\)，就会更新 \(mid = i\)，\(max\_right\) 为以 \(i\) 为中心的最长回文串的右边界，显然整个遍历的过程有 \(mid \leq i \leq max\_right\)。<br>
</p>

<ol class="org-ol">
<li><p>
根据回文串的对称性，如果对称过来的 \(j = mid \times 2 - i\) 位置的回文串左边界大于维护的最右回文子串的左边界，即： \(j - p[j] > max\_left\)（代码中不会维护 \(max\_left\) 变量，这里使用它是为了更好地理解），一定有 \(p[i] = p[j]\)。<br>
</p>

<img src="./images/Manacher03.png" /></li>

<li><p>
如果有 \(j\) 位置的回文串左边界小于维护的最右回文子串的左边界，即：\(j - p[j] < max\_left\)，一定有 \(p[i] = max\_right - i + 1\)（因为对称串在最右回文子串外的部分一定不会与最右边界外的一部分串对称相等，否则我们维护的最右回文子串的右边界就能继续拓展，这与我们维护的是以 \(mid\) 为中心的长度最大的最右回文子串矛盾，所以一定有 \(p[i] = max\_right - i + 1\)）<br>
</p>

<img src="./images/Manacher04.png" /></li>

<li><p>
如果有 \(j\) 位置的回文串左边界等于维护的最右回文子串的左边界，即：\(j - p[j] = max\_left\)，这个时候不能确定 \(p[i]\) 的值，因为我们仅能通过最右回文知道 \(j\) 的左边界的前一个字符与右边界的后一个字符不相等；但不能确定以 \(i\) 为中心的回文串能否继续扩展。这个时候我们就需要朴素的将以 \(i\) 为中心的回文串向外拓展直到无法拓展，然后更新最右回文子串为以 \(i\) 为中心的最长回文串。<br>
</p>

<img src="./images/Manacher05.png" /></li>
</ol>
</div>
</div>
<div id="outline-container-orgea3ff58" class="outline-2">
<h2 id="orgea3ff58">代码</h2>
<div class="outline-text-2" id="text-orgea3ff58">
<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #009F9F;">#include</span> <span style="color: #FC9F4E;">&lt;cstdio&gt;</span>
<span style="color: #009F9F;">#include</span> <span style="color: #FC9F4E;">&lt;cstring&gt;</span>
<span style="color: #009F9F;">#include</span> <span style="color: #FC9F4E;">&lt;algorithm&gt;</span>
<span style="color: #BD93F9;">using</span> <span style="color: #BD93F9;">namespace</span> <span style="color: #009F9F;">std</span>;
<span style="color: #BD93F9;">const</span> <span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">maxn</span> = <span style="color: #009F9F;">2e5</span> + <span style="color: #009F9F;">5</span>;
<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">n</span>;
<span style="color: #AFAFAF;">char</span> <span style="color: #AFAFAF;">a</span>[maxn], <span style="color: #AFAFAF;">b</span>[maxn];   <span style="color: #7c7c7c; font-style: italic;">// </span><span style="color: #7c7c7c; font-style: italic;">a &#34920;&#31034;&#21407;&#20018;&#65292;b &#34920;&#31034;&#26032;&#20018;</span>
<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">p</span>[maxn];

<span style="color: #7c7c7c; font-style: italic;">// </span><span style="color: #7c7c7c; font-style: italic;">a = "abababc", b = "$#a#b#a#b#a#b#c#^";</span>
<span style="color: #AFAFAF;">void</span> <span style="color: #AFAFAF;">init</span>() {
    <span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">k</span> = <span style="color: #009F9F;">0</span>;
    b[k ++ ] = <span style="color: #FC9F4E;">'$'</span>; b[k ++ ] = <span style="color: #FC9F4E;">'#'</span>;
    <span style="color: #BD93F9;">for</span> (<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">i</span> = <span style="color: #009F9F;">0</span>; i &lt; n; ++ i)
        b[k ++ ] = a[i], b[k ++ ] = <span style="color: #FC9F4E;">'#'</span>;
    b[k ++ ] = <span style="color: #FC9F4E;">'^'</span>;
    n = k;
}

<span style="color: #AFAFAF;">void</span> <span style="color: #AFAFAF;">manacher</span>() {
    <span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">max_right</span> = <span style="color: #009F9F;">0</span>, <span style="color: #AFAFAF;">mid</span>;   <span style="color: #7c7c7c; font-style: italic;">// </span><span style="color: #7c7c7c; font-style: italic;">&#32500;&#25252;&#19968;&#20010;&#26368;&#21491;&#22238;&#25991;&#23376;&#20018;&#65288;&#24182;&#38750;&#26368;&#38271;&#22238;&#25991;&#23376;&#20018;&#65289;</span>
    <span style="color: #BD93F9;">for</span> (<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">i</span> = <span style="color: #009F9F;">1</span>; i &lt; n; ++ i) {
        <span style="color: #BD93F9;">if</span> (i &lt; max_right)    <span style="color: #7c7c7c; font-style: italic;">// </span><span style="color: #7c7c7c; font-style: italic;">1. &#22914;&#26524; i &lt; max_right&#65292;&#30452;&#25509;&#23545;&#31216;&#30475; j = mid * 2 - i &#30340;&#20301;&#32622;&#26368;&#38271;&#22238;&#25991;&#20018;&#21322;&#24452;</span>
            p[i] = min(p[mid * <span style="color: #009F9F;">2</span> - i], max_right - i);
        <span style="color: #BD93F9;">else</span>           <span style="color: #7c7c7c; font-style: italic;">// </span><span style="color: #7c7c7c; font-style: italic;">2. &#21542;&#21017;&#20250;&#26420;&#32032;&#25299;&#23485;</span>
            p[i] = <span style="color: #009F9F;">1</span>;
        <span style="color: #7c7c7c; font-style: italic;">/*</span>
<span style="color: #7c7c7c; font-style: italic;">         * &#26420;&#32032;&#25299;&#23485;&#65292;&#20294;&#26159;&#21482;&#26377; i &lt; max_right&#65292;&#19988; j = mid * 2 - i &#20301;&#32622;&#30340;&#22238;&#25991;&#20018;&#30340;&#24038;&#36793;&#30028;&#24688;&#22909;&#22312;&#32500;&#25252;&#30340;&#26368;&#21491;&#22238;&#25991;&#23376;&#20018;&#24038;&#36793;&#30028;&#22788;&#26102;</span>
<span style="color: #7c7c7c; font-style: italic;">         * &#25165;&#20250;&#30495;&#27491;&#30340;&#24320;&#22987;&#25299;&#23485;&#65292;&#21542;&#21017;&#36825;&#37324;&#21482;&#20250;&#36816;&#34892;&#19968;&#27425;</span>
<span style="color: #7c7c7c; font-style: italic;">         *            ml            mid             max_right</span>
<span style="color: #7c7c7c; font-style: italic;">         *            |              |              |</span>
<span style="color: #7c7c7c; font-style: italic;">         *            V              V              V</span>
<span style="color: #7c7c7c; font-style: italic;">         * |-----------------------------------------------|</span>
<span style="color: #7c7c7c; font-style: italic;">         *            +----j----+    |    +----i----+</span>
<span style="color: #7c7c7c; font-style: italic;">         */</span>
        <span style="color: #BD93F9;">while</span> (b[i - p[i]] == b[i + p[i]])
            p[i] ++ ;
        <span style="color: #BD93F9;">if</span> (i + p[i] &gt; max_right) {   <span style="color: #7c7c7c; font-style: italic;">// </span><span style="color: #7c7c7c; font-style: italic;">&#26356;&#26032; max_right &#19982; i &#30340;&#20540;</span>
            max_right = i + p[i];
            mid = i;
        }
    }
}

<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">main</span>() {
    scanf(<span style="color: #FC9F4E;">"%s"</span>, a);
    n = strlen(a);
    init();
    manacher();
    <span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">res</span> = <span style="color: #009F9F;">0</span>;
    <span style="color: #BD93F9;">for</span> (<span style="color: #AFAFAF;">int</span> <span style="color: #AFAFAF;">i</span> = <span style="color: #009F9F;">0</span>; i &lt; n; ++ i)
        res = max(res, p[i] - <span style="color: #009F9F;">1</span>);
    printf(<span style="color: #FC9F4E;">"%d\n"</span>, res);
    <span style="color: #BD93F9;">return</span> <span style="color: #009F9F;">0</span>;
}
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2021-11-06 17:11 Sat</p>
<p class="author">Author: L.M.haoran</p>
<p class="date">Created: 2021-11-29 Mon 22:43</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
