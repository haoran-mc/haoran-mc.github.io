<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-01-29 Sat 22:12 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MONGODB-基础语法</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran">
<meta name="description" content="Copyright © 2022, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="content">
<h1 class="title">MONGODB-基础语法</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgbf59e09">与库相关</a></li>
<li><a href="#orgb9a16b9">与集合相关</a></li>
<li><a href="#orgb1f9de0">与文档相关</a>
<ul>
<li><a href="#org2fd9297">插入文档</a>
<ul>
<li><a href="#orgbb8fb20">单条文档</a></li>
<li><a href="#orgba77532">多条文档</a></li>
<li><a href="#org8a879d2">脚本方式</a></li>
</ul>
</li>
<li><a href="#orgbc837e2">查询文档</a>
<ul>
<li><a href="#org0628da0">语法</a></li>
<li><a href="#org7d43841">对比语法</a></li>
<li><a href="#org22a6d76">AND</a></li>
<li><a href="#orgad45a55">OR</a></li>
<li><a href="#org3c03978">AND 与 OR 联合</a></li>
<li><a href="#orga3df916">数组中查询</a></li>
<li><a href="#orgf20f13b">模糊查询</a></li>
<li><a href="#org7e38e14">排序</a></li>
<li><a href="#org4836985">分页</a></li>
<li><a href="#orgec2e5f4">总条数</a></li>
<li><a href="#orgfe2360a">去重</a></li>
<li><a href="#org115dc45">指定返回字段</a></li>
</ul>
</li>
<li><a href="#org82703e7">删除文档</a></li>
<li><a href="#org16e9154">更新文档</a></li>
</ul>
</li>
<li><a href="#org3a14601">$type</a></li>
<li><a href="#orgcee09a5">索引</a>
<ul>
<li><a href="#org1f093a4">创建索引</a></li>
<li><a href="#orgdfc480f">查看索引</a></li>
<li><a href="#orgf901232">删除索引</a></li>
<li><a href="#org8799fc9">复合索引</a></li>
</ul>
</li>
<li><a href="#org7cd1939">聚合</a>
<ul>
<li><a href="#org58eef5e">管道</a></li>
</ul>
</li>
<li><a href="#org4e4e898">其他常用命令</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgbf59e09" class="outline-2">
<h2 id="orgbf59e09">与库相关</h2>
<div class="outline-text-2" id="text-orgbf59e09">
<dl class="org-dl">
<dt>show databases</dt><dd>查看所有库<br></dd>
<dt>show dbs</dt><dd>查看所有库<br></dd>
</dl>

<p>
初始时有三个库：<br>
</p>

<dl class="org-dl">
<dt>admin</dt><dd>从权限的角度看，这是 root 数据库，要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限。一些特定的服务端命令也只能从这个数据库运行，比如列出所有数据库或者关闭服务器。<br></dd>
<dt>local</dt><dd>这个数据永远不会被复制，可以用来存储限于本地单台服务器的任意集合。<br></dd>
<dt>config</dt><dd>当 Mongo 用于分片设置时，config 数据库内部使用，用于保存分片的相关信息。<br></dd>
</dl>

<hr>

<dl class="org-dl">
<dt>use databasename</dt><dd>使用，如果没有就创建名为 databasename 的库<br></dd>
</dl>

<p>
创建之后使用 show dbs; 命令发现没有我们刚创建的库，这是因为 MongoDB 只会显示有数据的库，新创建的库还没有数据，所以没有显示。<br>
</p>

<p>
默认时使用的是 <code>test</code> 库。<br>
</p>

<dl class="org-dl">
<dt>db</dt><dd>查看当前库<br></dd>
<dt>db.dropDatabase()</dt><dd>删除当前库<br></dd>
</dl>
</div>
</div>
<div id="outline-container-orgb9a16b9" class="outline-2">
<h2 id="orgb9a16b9">与集合相关</h2>
<div class="outline-text-2" id="text-orgb9a16b9">
<dl class="org-dl">
<dt>show collections | show tables</dt><dd>查看库中所有集合<br></dd>
<dt>db.create.Collection('集合名称', [options])</dt><dd>创建集合<br></dd>
</dl>

<p>
options 可选项：<br>
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">字段</th>
<th scope="col" class="org-left">类型</th>
<th scope="col" class="org-left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">capped</td>
<td class="org-left">布尔</td>
<td class="org-left">（可选）如果为 true，则创建固定集合。固定集合是指有着固定大小的集合，当达到最大值时，它会自动覆盖最早的文档。当该值为 true 时，也需要指定 size 参数。</td>
</tr>

<tr>
<td class="org-left">size</td>
<td class="org-left">数值</td>
<td class="org-left">（可选）为固定集合指定一个最大值，即字节数。如果 capped 为 true，也需要指定该字段。</td>
</tr>

<tr>
<td class="org-left">max</td>
<td class="org-left">数值</td>
<td class="org-left">（可选）指定固定集合中包含文档的最大数量</td>
</tr>
</tbody>
</table>

<p>
!注意：当集合不存在时，向集合中插入文档也会自动创建该集合。<br>
</p>

<dl class="org-dl">
<dt>db.createCollection('products', {max: 100, capped: true, size: 5000})</dt><dd>当字节数超过 5000 时自动覆盖，文档最大数量为 500。<br></dd>

<dt>db.集合名称.drop()</dt><dd>删除集合<br></dd>
</dl>
</div>
</div>
<div id="outline-container-orgb1f9de0" class="outline-2">
<h2 id="orgb1f9de0">与文档相关</h2>
<div class="outline-text-2" id="text-orgb1f9de0">
</div>
<div id="outline-container-org2fd9297" class="outline-3">
<h3 id="org2fd9297">插入文档</h3>
<div class="outline-text-3" id="text-org2fd9297">
</div>
<div id="outline-container-orgbb8fb20" class="outline-4">
<h4 id="orgbb8fb20">单条文档</h4>
<div class="outline-text-4" id="text-orgbb8fb20">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #d75fd7; font-weight: bold;">db.&#38598;&#21512;&#21517;&#31216;.insert</span>({<span style="color: #2aa198;">"name"</span>, <span style="color: #2aa198;">"haoran"</span>, <span style="color: #2aa198;">"age"</span>: <span style="color: #2aa198;">"21"</span>, <span style="color: #2aa198;">"birth"</span>: <span style="color: #2aa198;">"2022-01-28"</span>})
</pre>
</div>
</div>
</div>
<div id="outline-container-orgba77532" class="outline-4">
<h4 id="orgba77532">多条文档</h4>
<div class="outline-text-4" id="text-orgba77532">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #d75fd7; font-weight: bold;">db.&#38598;&#21512;&#21517;&#31216;.insertMany</span>(
    [ &lt;document <span style="color: #d75fd7;">1</span>&gt;, &lt;document <span style="color: #d75fd7;">2</span>&gt;, ...... ],
    {
        writeConcern: <span style="color: #d75fd7;">1,</span>
        ordered: true
    }
)

// &#30452;&#25509;&#20351;&#29992; insert &#20063;&#21487;&#20197;

<span style="color: #d75fd7; font-weight: bold;">db.&#38598;&#21512;&#21517;&#31216;.insert</span>([
                      { <span style="color: #2aa198;">"name"</span>: <span style="color: #2aa198;">"&#23567;&#26126;"</span>, <span style="color: #2aa198;">"age"</span>: <span style="color: #d75fd7;">2,</span> <span style="color: #2aa198;">"brith"</span>: <span style="color: #2aa198;">"2021-01-28"</span> },
                      { <span style="color: #2aa198;">"name"</span>: <span style="color: #2aa198;">"&#23567;&#32418;"</span>, <span style="color: #2aa198;">"age"</span>: <span style="color: #d75fd7;">1,</span> <span style="color: #2aa198;">"brith"</span>: <span style="color: #2aa198;">"2022-01-28"</span> }
                  ])
</pre>
</div>
</div>
</div>
<div id="outline-container-org8a879d2" class="outline-4">
<h4 id="org8a879d2">脚本方式</h4>
<div class="outline-text-4" id="text-org8a879d2">
<div class="org-src-container">
<pre class="src src-javascript"><span style="color: #268bd2; font-weight: bold;">for</span> (<span style="color: #268bd2; font-weight: bold;">let</span> <span style="color: #8787d7;">i</span> = <span style="color: #d75fd7;">0</span>; i &lt; <span style="color: #d75fd7;">100</span>; i ++ ) {
    db.users.insert({ <span style="color: #2aa198;">"_id"</span>: i, <span style="color: #2aa198;">"name"</span>: <span style="color: #2aa198;">"user"</span> + i, <span style="color: #2aa198;">"age"</span>: <span style="color: #d75fd7;">1_</span>})
} 
</pre>
</div>

<p>
!注意：在 MongoDB 中每个文档都会有一个 _id 作为唯一标识，默认会自动生成；也可手动生成。<br>
</p>
</div>
</div>
</div>
<div id="outline-container-orgbc837e2" class="outline-3">
<h3 id="orgbc837e2">查询文档</h3>
<div class="outline-text-3" id="text-orgbc837e2">
<p>
MongoDB 查询文档使用 find() 方法，find() 方法以非结构化的方式来显示文档。<br>
</p>

<dl class="org-dl">
<dt>db.users.find()</dt><dd>查询所有数据<br></dd>
</dl>
</div>
<div id="outline-container-org0628da0" class="outline-4">
<h4 id="org0628da0">语法</h4>
<div class="outline-text-4" id="text-org0628da0">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #d75fd7; font-weight: bold;">db.&#38598;&#21512;&#21517;&#31216;.find</span>(query, projection)
</pre>
</div>

<dl class="org-dl">
<dt>query</dt><dd>（可选）使用查询操作符指定查询条件<br></dd>
<dt>projection</dt><dd>（可选）使用投影操作符指定返回的键，查询时返回文档中所有键值，只需省略该参数即可（默认省略）<br></dd>
</dl>

<p>
如果需要以易读的方式来读取数据，可以使用 pretty() 方法：<br>
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #d75fd7; font-weight: bold;">db.&#38598;&#21512;&#21517;&#31216;.find</span>().pretty()
</pre>
</div>

<p>
pretty() 方法以格式化的方式来显示所有文档。<br>
</p>
</div>
</div>
<div id="outline-container-org7d43841" class="outline-4">
<h4 id="org7d43841">对比语法</h4>
<div class="outline-text-4" id="text-org7d43841">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">操作</th>
<th scope="col" class="org-left">格式</th>
<th scope="col" class="org-left">范例</th>
<th scope="col" class="org-left">RDBMS中的类似语句</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">等于</td>
<td class="org-left">{ &lt;key&gt;: &lt;value&gt; }</td>
<td class="org-left">db.col.find({ "name": "Luck" }).pretty()</td>
<td class="org-left">where name = 'Luck'</td>
</tr>

<tr>
<td class="org-left">小于</td>
<td class="org-left">{ &lt;key&gt;: {$lt: &lt;value&gt;} }</td>
<td class="org-left">db.col.find({ "age": {$lt: 25} }).pretty()</td>
<td class="org-left">where age &lt; 25</td>
</tr>

<tr>
<td class="org-left">小于或等于</td>
<td class="org-left">{ &lt;key&gt;: {$lte: &lt;value&gt;} }</td>
<td class="org-left">db.col.find({ "age": {$lte: 25} }).pretty()</td>
<td class="org-left">where age &lt;= 25</td>
</tr>

<tr>
<td class="org-left">大于</td>
<td class="org-left">{ &lt;key&gt;: {$gt: &lt;value&gt;} }</td>
<td class="org-left">db.col.find({ "age": {$gt: 25} }).pretty()</td>
<td class="org-left">where age &gt; 25</td>
</tr>

<tr>
<td class="org-left">小于或等于</td>
<td class="org-left">{ &lt;key&gt;: {$gte: &lt;value&gt;} }</td>
<td class="org-left">db.col.find({ "age": {$gte: 25} }).pretty()</td>
<td class="org-left">where age &gt;= 25</td>
</tr>

<tr>
<td class="org-left">不等于</td>
<td class="org-left">{ &lt;key&gt;: {$ne: &lt;value&gt;} }</td>
<td class="org-left">db.col.find({ "age": {$ne: 25} }).pretty()</td>
<td class="org-left">where age !== 25</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org22a6d76" class="outline-4">
<h4 id="org22a6d76">AND</h4>
<div class="outline-text-4" id="text-org22a6d76">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #d75fd7; font-weight: bold;">db.&#38598;&#21512;&#21517;&#31216;.find</span>({ key01: value01, key02: value02, ... }).pretty()
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">WHERE key01 = value01 AND key02 = value02</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgad45a55" class="outline-4">
<h4 id="orgad45a55">OR</h4>
<div class="outline-text-4" id="text-orgad45a55">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #d75fd7; font-weight: bold;">db.&#38598;&#21512;&#21517;&#31216;.find</span>(
    {
        $<span style="color: #8787d7;">or</span>: [
            { key01: value01 }, { key02: value02 }
        ]
    }
)
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">WHERE key01 = value01 OR key02 = value02</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org3c03978" class="outline-4">
<h4 id="org3c03978">AND 与 OR 联合</h4>
<div class="outline-text-4" id="text-org3c03978">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #d75fd7; font-weight: bold;">db.&#38598;&#21512;&#21517;&#31216;.find</span>({
                    <span style="color: #2aa198;">"age"</span>: { $<span style="color: #8787d7;">gt</span>: <span style="color: #d75fd7;">25</span> },
                    $<span style="color: #8787d7;">or</span>: [
                        { <span style="color: #2aa198;">"name"</span>: <span style="color: #2aa198;">"Lucy"</span> },
                        { <span style="color: #2aa198;">"name"</span>: <span style="color: #2aa198;">"MongoDB"</span> }
                    ]
                }).pretty()
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">WHERE age &gt; 25 AND (name = 'Lucy' OR name = 'MongoDB' )</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orga3df916" class="outline-4">
<h4 id="orga3df916">数组中查询</h4>
<div class="outline-text-4" id="text-orga3df916">
<div class="org-src-container">
<pre class="src src-bash">&gt; db.&#38598;&#21512;&#21517;&#31216;.find({ &#25968;&#32452;&#21517;: <span style="color: #2aa198;">"01"</span> })
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">MongoDB &#21407;&#29983;&#25903;&#25345;&#25968;&#32452;&#26597;&#35810;&#65292;&#23427;&#20250;&#25214;&#36825;&#20010;&#25968;&#32452;&#20013;&#26159;&#21542;&#21253;&#21547; "01"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">&gt; db.&#38598;&#21512;&#21517;&#31216;.find({ &#25968;&#32452;&#21517;: {$<span style="color: #8787d7;">size</span>: <span style="color: #d75fd7;">3</span>} })
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#26597;&#35810;&#25968;&#32452;&#38271;&#24230;&#20026; 3 &#30340;&#25991;&#26723;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf20f13b" class="outline-4">
<h4 id="orgf20f13b">模糊查询</h4>
<div class="outline-text-4" id="text-orgf20f13b">
<p>
MongoDB 中的模糊查询通过正则表达式实现。<br>
</p>

<div class="org-src-container">
<pre class="src src-bash">&gt; db.users.find({ name: /&#34013;/ })
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#23601;&#20250;&#26597;&#35810;&#21517;&#23383;&#20013;&#24102; "&#34013;" &#23383;&#30340;&#25991;&#26723;</span>
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">WHERE name LIKE '%&#34013;%'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org7e38e14" class="outline-4">
<h4 id="org7e38e14">排序</h4>
<div class="outline-text-4" id="text-org7e38e14">
<div class="org-src-container">
<pre class="src src-bash">&gt; db.&#38598;&#21512;&#21517;&#31216;.find().sort({name: <span style="color: #d75fd7;">1,</span> age: <span style="color: #d75fd7;">1</span>})
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">1: &#21319;&#24207;   -1: &#38477;&#24207;</span>
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">ORDER BY name, age</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org4836985" class="outline-4">
<h4 id="org4836985">分页</h4>
<div class="outline-text-4" id="text-org4836985">
<div class="org-src-container">
<pre class="src src-bash">&gt; db.&#38598;&#21512;&#21517;&#31216;.find().sort({&#26465;&#20214;}).skip(start).limit(rows)
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">LIMIT start, rows</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgec2e5f4" class="outline-4">
<h4 id="orgec2e5f4">总条数</h4>
<div class="outline-text-4" id="text-orgec2e5f4">
<div class="org-src-container">
<pre class="src src-bash">&gt; db.&#38598;&#21512;&#21517;&#31216;.count()
&gt; db.&#38598;&#21512;&#21517;&#31216;.find({<span style="color: #2aa198;">"name"</span>: <span style="color: #2aa198;">"Lucy"</span>}).count()
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">SELECT COUNT(*)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfe2360a" class="outline-4">
<h4 id="orgfe2360a">去重</h4>
<div class="outline-text-4" id="text-orgfe2360a">
<div class="org-src-container">
<pre class="src src-bash">&gt; db.distinct(<span style="color: #2aa198;">'&#23383;&#27573;'</span>)
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">SELECT DISTINCT name FROM ...</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org115dc45" class="outline-4">
<h4 id="org115dc45">指定返回字段</h4>
<div class="outline-text-4" id="text-org115dc45">
<div class="org-src-container">
<pre class="src src-bash">&gt; db.&#38598;&#21512;&#21517;&#31216;.find({&#26465;&#20214;}), {name: <span style="color: #d75fd7;">1,</span> age: <span style="color: #d75fd7;">1</span>}
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">1 &#36820;&#22238;   0 &#19981;&#36820;&#22238;</span>
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">1 &#19982; 0 &#19981;&#33021;&#21516;&#26102;&#20351;&#29992;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org82703e7" class="outline-3">
<h3 id="org82703e7">删除文档</h3>
<div class="outline-text-3" id="text-org82703e7">
<div class="org-src-container">
<pre class="src src-bash">db.&#38598;&#21512;&#21517;&#31216;.remove {
    &lt;query&gt;,
    {
        justOne: &lt;boolean&gt;,
        writeConcern: &lt;document&gt;
    }
}
</pre>
</div>

<p>
参数说明：<br>
</p>

<dl class="org-dl">
<dt>query</dt><dd>（可选）删除的文档的条件<br></dd>
<dt>justOne</dt><dd>（可选）如果设 true 或 1，则只删除一个文档，如果不设置该参数，或使用默认值 false，则删除所有匹配条件的文档。<br></dd>
<dt>writeConcern</dt><dd>（可选）抛出异常的级别<br></dd>
</dl>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #d75fd7; font-weight: bold;">db.users.remove</span>({})   // &#21024;&#38500;&#25152;&#26377;
<span style="color: #d75fd7; font-weight: bold;">db.users.remove</span>({ _id: <span style="color: #d75fd7;">1</span> })   // &#21024;&#38500; <span style="color: #8787d7;">_id</span> = <span style="color: #d75fd7;">1</span> &#30340;&#25991;&#26723;

<span style="color: #d75fd7; font-weight: bold;">db.users.remove</span>({ _id: <span style="color: #2aa198;">"61f3b0fe7206fc18cf9148cc"</span> })
<span style="color: #d75fd7; font-weight: bold;">db.users.remove</span>({ _id: ObjectId(<span style="color: #2aa198;">"61f3b0fe7206fc18cf9148cc"</span>) })

<span style="color: #d75fd7; font-weight: bold;">db.users.remove</span>({ age: <span style="color: #d75fd7;">21</span> })   // &#21024;&#38500;&#25152;&#26377;&#24180;&#40836;&#26159; <span style="color: #d75fd7;">21</span> &#30340;&#25991;&#26723;
</pre>
</div>
</div>
</div>
<div id="outline-container-org16e9154" class="outline-3">
<h3 id="org16e9154">更新文档</h3>
<div class="outline-text-3" id="text-org16e9154">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #d75fd7; font-weight: bold;">db.&#38598;&#21512;&#21517;&#31216;.update</span>(
    &lt;query&gt;,
    &lt;update&gt;
    {
        upsert: &lt;boolean&gt;,
        multi: &lt;boolean&gt;,
        writeConcern: &lt;document&gt;
    }
)
</pre>
</div>

<p>
参数说明：<br>
</p>

<dl class="org-dl">
<dt>query</dt><dd>update 的查询条件，类似 sql update 查询内 where 后面的<br></dd>
<dt>update</dt><dd>update 的对象和一些更新的操作符（如 $、$inc&#x2026;&#x2026;）等，也可理解为 sql update 查询内 set 后面的<br></dd>
<dt>upsert</dt><dd>（可选）这个参数的意思是，如果不存在 update 的记录，是否插入 objNew。true 为插入，默认 false 不插入。<br></dd>
<dt>multi</dt><dd>（可选）MongoDB 默认 false，只更新找到的第一条记录，如果这个参数为 true，就把按条件查出来多条记录全部更新。<br></dd>
<dt>writeConcern</dt><dd>（可选）抛出异常的级别。<br></dd>
</dl>

<div class="org-src-container">
<pre class="src src-bash">- db.&#38598;&#21512;&#21517;&#31216;.update({ <span style="color: #2aa198;">"name"</span>: <span style="color: #2aa198;">"zhangsan"</span> }, { name: <span style="color: #2aa198;">"xiaoming"</span>, birth: new date() })
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#23558;&#21517;&#23383;&#20026; zhangzan &#30340;&#25991;&#26723;&#26356;&#26032;&#20026; { name: "xiaoming", birth: new date() }&#65292;&#26410;&#25552;&#20379;&#30340;&#23383;&#27573;&#19981;&#20445;&#30041;</span>

- db.&#38598;&#21512;&#21517;&#31216;.update({ <span style="color: #2aa198;">"name"</span>: <span style="color: #2aa198;">"zhangsan"</span> }, { $<span style="color: #8787d7;">set</span>: { name: <span style="color: #2aa198;">"xiaoming"</span> } })
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#20445;&#30041;&#21407;&#26412;&#30340;&#25968;&#25454;&#65292;&#26356;&#26032;&#31526;&#21512;&#26465;&#20214;&#30340;&#31532;&#19968;&#26465;&#25968;&#25454;</span>

- db.&#38598;&#21512;&#21517;&#31216;.update({ name: <span style="color: #2aa198;">"xiaohei"</span> }, { $<span style="color: #8787d7;">set</span>: { name: <span style="color: #2aa198;">"xiaoming"</span> } }, { multi: true })
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#20445;&#30041;&#21407;&#26469;&#30340;&#25968;&#25454;&#65292;&#26356;&#26032;&#31526;&#21512;&#26465;&#20214;&#30340;&#25152;&#26377;&#25968;&#25454;</span>

- db.&#38598;&#21512;&#21517;&#31216;.update({ name: <span style="color: #2aa198;">"xiaohei"</span> }, { $<span style="color: #8787d7;">set</span>: { name: <span style="color: #2aa198;">"xiaoming"</span> } }, { multi: true, upsert: true })
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#20445;&#30041;&#21407;&#26469;&#30340;&#25968;&#25454;&#65292;&#26356;&#26032;&#31526;&#21512;&#26465;&#20214;&#30340;&#25152;&#26377;&#25968;&#25454;&#65292;&#27809;&#26377;&#31526;&#21512;&#26465;&#20214;&#26102;&#25554;&#20837;&#25968;&#25454;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org3a14601" class="outline-2">
<h2 id="org3a14601">$type</h2>
<div class="outline-text-2" id="text-org3a14601">
<p>
$type 操作符是基于 BSON 类型来检索集合中匹配的数据类型，并返回结果。<br>
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-right">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">类型</th>
<th scope="col" class="org-right">数字</th>
<th scope="col" class="org-left">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Double</td>
<td class="org-right">1</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">String</td>
<td class="org-right">2</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Object</td>
<td class="org-right">3</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Array</td>
<td class="org-right">4</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Binary data</td>
<td class="org-right">5</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Undefined</td>
<td class="org-right">6</td>
<td class="org-left">已废弃</td>
</tr>

<tr>
<td class="org-left">Object id</td>
<td class="org-right">7</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Boolean</td>
<td class="org-right">8</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Date</td>
<td class="org-right">9</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Null</td>
<td class="org-right">10</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Regular Expression</td>
<td class="org-right">11</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">JavaScript</td>
<td class="org-right">13</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Symbol</td>
<td class="org-right">14</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">JavaScript(with scope)</td>
<td class="org-right">15</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">32-bit integer</td>
<td class="org-right">16</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Timestamp</td>
<td class="org-right">17</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">64-bit integer</td>
<td class="org-right">18</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Min key</td>
<td class="org-right">255</td>
<td class="org-left">Query with -1</td>
</tr>

<tr>
<td class="org-left">Max key</td>
<td class="org-right">127</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-bash">&gt; db.col.insert({
                   title: <span style="color: #2aa198;">'PHP &#25945;&#31243;'</span>, 
                   description: <span style="color: #2aa198;">'PHP &#26159;&#19968;&#31181;&#21019;&#24314;&#21160;&#24577;&#20132;&#20114;&#24615;&#31449;&#28857;&#30340;&#24378;&#26377;&#21147;&#30340;&#26381;&#21153;&#22120;&#31471;&#33050;&#26412;&#35821;&#35328;&#12290;'</span>,
                   tags: [<span style="color: #2aa198;">'php'</span>],
                   likes: <span style="color: #d75fd7;">200</span>
               })
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">&gt; db.col.insert({
                   title: <span style="color: #2aa198;">'Java &#25945;&#31243;'</span>, 
                   description: <span style="color: #2aa198;">'Java &#26159;&#30001;Sun Microsystems&#20844;&#21496;&#20110;1995&#24180;5&#26376;&#25512;&#20986;&#30340;&#39640;&#32423;&#31243;&#24207;&#35774;&#35745;&#35821;&#35328;&#12290;'</span>,
                   tags: [<span style="color: #2aa198;">'java'</span>],
                   likes: <span style="color: #d75fd7;">150</span>
               })
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">&gt; db.col.insert({
                   title: <span style="color: #2aa198;">'MongoDB &#25945;&#31243;'</span>, 
                   description: <span style="color: #2aa198;">'MongoDB &#26159;&#19968;&#20010; Nosql &#25968;&#25454;&#24211;'</span>,
                   tags: [<span style="color: #2aa198;">'mongodb'</span>],
                   likes: <span style="color: #d75fd7;">100</span>
               })
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">&gt; db.col.find().pretty()
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">&gt; db.col.find({title: {$<span style="color: #8787d7;">type</span>: <span style="color: #d75fd7;">2</span>}}).pretty()
&gt; db.col.find({title: ($<span style="color: #8787d7;">type</span>: <span style="color: #2aa198;">'string'</span>)}).pretty()
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#26597;&#35810; title &#31867;&#22411;&#26159;&#23383;&#31526;&#20018;&#30340;&#25991;&#26723;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcee09a5" class="outline-2">
<h2 id="orgcee09a5">索引</h2>
<div class="outline-text-2" id="text-orgcee09a5">
</div>
<div id="outline-container-org1f093a4" class="outline-3">
<h3 id="org1f093a4">创建索引</h3>
<div class="outline-text-3" id="text-org1f093a4">
<div class="org-src-container">
<pre class="src src-bash">&gt; db.&#38598;&#21512;&#21517;&#31216;.createIndex(keys, options)
&gt; db.&#38598;&#21512;&#21517;&#31216;.createIndex({<span style="color: #2aa198;">"title"</span>: <span style="color: #d75fd7;">1,</span> <span style="color: #2aa198;">"description"</span>: -1})
</pre>
</div>

<p>
说明：语法中 key 值为你要创建的索引字段，1 表示升序；-1 表示降序。<br>
</p>

<p>
可选参数：<br>
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Parameter</th>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">background</td>
<td class="org-left">Boolean</td>
<td class="org-left">建索引的过程会阻塞其它数据库操作，background 可指定以后台方式创建索引，默认值是 false</td>
</tr>

<tr>
<td class="org-left">unique</td>
<td class="org-left">Boolean</td>
<td class="org-left">建立索引是否唯一，指定为 true 创建唯一索引，默认为 false</td>
</tr>

<tr>
<td class="org-left">name</td>
<td class="org-left">string</td>
<td class="org-left">索引的名称</td>
</tr>

<tr>
<td class="org-left">sparse</td>
<td class="org-left">Boolean</td>
<td class="org-left">对文档不存在的字段数据不启用索引。如果设置为 true，在索引字段中不会查询出不包含对应字段的文档，默认为 false</td>
</tr>

<tr>
<td class="org-left">exprieAfterSeconds</td>
<td class="org-left">integer</td>
<td class="org-left">指定一个以秒为单位的数值，设定集合的生存时间 TTL</td>
</tr>

<tr>
<td class="org-left">v</td>
<td class="org-left">index version</td>
<td class="org-left">索引的版本号，默认的索引版本取决于 MongoDB 创建索引时运行的版本</td>
</tr>

<tr>
<td class="org-left">weights</td>
<td class="org-left">document</td>
<td class="org-left">索引权重值，数值在 1 到 99999 之间，表示该索引相对于其他索引字段的得分权重</td>
</tr>

<tr>
<td class="org-left">default_language</td>
<td class="org-left">string</td>
<td class="org-left">对于文本索引，该参数决定了停用词及词干和词器的规则的列表，默认为英语</td>
</tr>

<tr>
<td class="org-left">language_override</td>
<td class="org-left">string</td>
<td class="org-left">对于文本索引，该参数指定了包含在文档中的字段名，语言覆盖默认的 language，默认值为 language</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orgdfc480f" class="outline-3">
<h3 id="orgdfc480f">查看索引</h3>
<div class="outline-text-3" id="text-orgdfc480f">
<div class="org-src-container">
<pre class="src src-bash">&gt; db.&#38598;&#21512;&#21517;&#31216;.getIndexes()
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#26597;&#30475;&#38598;&#21512;&#32034;&#24341;</span>

&gt; db.&#38598;&#21512;&#21517;&#31216;.totalIndexSize()
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#26597;&#30475;&#38598;&#21512;&#32034;&#24341;&#22823;&#23567;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf901232" class="outline-3">
<h3 id="orgf901232">删除索引</h3>
<div class="outline-text-3" id="text-orgf901232">
<div class="org-src-container">
<pre class="src src-bash">&gt; db.&#38598;&#21512;&#21517;&#31216;.dropIndexes()
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#21024;&#38500;&#38500;&#20102; _id_ &#32034;&#24341;&#20043;&#22806;&#30340;&#25152;&#26377;&#32034;&#24341;</span>

&gt; db.&#38598;&#21512;&#21517;&#31216;.dropIndexes(<span style="color: #2aa198;">"&#32034;&#24341;&#21517;&#31216;"</span>)
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#21024;&#38500;&#25351;&#23450;&#32034;&#24341;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org8799fc9" class="outline-3">
<h3 id="org8799fc9">复合索引</h3>
<div class="outline-text-3" id="text-org8799fc9">
<p>
由多个 key 进行维护的索引称为复合索引（左前缀原则）。<br>
</p>

<div class="org-src-container">
<pre class="src src-bash">&gt; db.users.createIndex({<span style="color: #2aa198;">"title"</span>: <span style="color: #d75fd7;">1,</span> <span style="color: #2aa198;">"description"</span>: -1})
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org7cd1939" class="outline-2">
<h2 id="org7cd1939">聚合</h2>
<div class="outline-text-2" id="text-org7cd1939">
<p>
MongoDB 中聚合（aggregate）主要用于处理数据（诸如统计平均值，求和等），并返回计算后的数据结构。<br>
</p>

<div class="org-src-container">
<pre class="src src-bash">{
    title: <span style="color: #2aa198;">'MongoDB Overview'</span>, 
    description: <span style="color: #2aa198;">'MongoDB is no sql database'</span>,
    by_user: <span style="color: #2aa198;">'run'</span>,
    tags: [<span style="color: #2aa198;">'mongodb'</span>, <span style="color: #2aa198;">'database'</span>, <span style="color: #2aa198;">'NoSQL'</span>],
    likes: <span style="color: #d75fd7;">100</span>
},
{
    title: <span style="color: #2aa198;">'NoSQL Overview'</span>, 
    description: <span style="color: #2aa198;">'No sql database is very fast'</span>,
    by_user: <span style="color: #2aa198;">'run'</span>,
    tags: [<span style="color: #2aa198;">'mongodb'</span>, <span style="color: #2aa198;">'database'</span>, <span style="color: #2aa198;">'NoSQL'</span>],
    likes: <span style="color: #d75fd7;">10</span>
},
{
    title: <span style="color: #2aa198;">'Neo4j Overview'</span>, 
    description: <span style="color: #2aa198;">'Neo4j is no sql database'</span>,
    by_user: <span style="color: #2aa198;">'Neo4j'</span>,
    tags: [<span style="color: #2aa198;">'neo4j'</span>, <span style="color: #2aa198;">'database'</span>, <span style="color: #2aa198;">'NoSQL'</span>],
    likes: <span style="color: #d75fd7;">750</span>
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">&gt; db.&#38598;&#21512;&#21517;&#31216;.aggregate([{$<span style="color: #8787d7;">group</span>: {_id: <span style="color: #2aa198;">"$by_user"</span>}}])
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#26681;&#25454; by_user &#20998;&#32452;</span>

&gt; db.&#38598;&#21512;&#21517;&#31216;.aggregate([{$<span style="color: #8787d7;">group</span>: {_id: <span style="color: #2aa198;">"$by_user"</span>, num_tutorial : {$<span style="color: #8787d7;">sum</span> : <span style="color: #d75fd7;">1</span>}}}])
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">&#26681;&#25454; by_user &#20998;&#32452;&#65292;&#24182;&#33719;&#21462;&#27599;&#32452;&#25968;&#37327;</span>
<span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">select by_user, count(*) from mycol group by by_user</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">表达式</th>
<th scope="col" class="org-left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">$sum</td>
<td class="org-left">计算总和</td>
</tr>

<tr>
<td class="org-left">$avg</td>
<td class="org-left">计算平均值</td>
</tr>

<tr>
<td class="org-left">$min</td>
<td class="org-left">获取集合中所有文档对应值得最小值</td>
</tr>

<tr>
<td class="org-left">$max</td>
<td class="org-left">获取集合中所有文档对应值得最大值</td>
</tr>

<tr>
<td class="org-left">$push</td>
<td class="org-left">将值加入一个数组中，不会判断是否有重复的值</td>
</tr>

<tr>
<td class="org-left">$addToSet</td>
<td class="org-left">将值加入一个数组中，会判断是否有重复的值，若相同的值在数组中已经存在了，则不加入</td>
</tr>

<tr>
<td class="org-left">$first</td>
<td class="org-left">根据资源文档的排序获取第一个文档数据</td>
</tr>

<tr>
<td class="org-left">$last</td>
<td class="org-left">根据资源文档的排序获取最后一个文档数据</td>
</tr>
</tbody>
</table>
</div>
<div id="outline-container-org58eef5e" class="outline-3">
<h3 id="org58eef5e">管道</h3>
</div>
</div>
<div id="outline-container-org4e4e898" class="outline-2">
<h2 id="org4e4e898">其他常用命令</h2>
<div class="outline-text-2" id="text-org4e4e898">
<dl class="org-dl">
<dt>cls</dt><dd>清屏<br></dd>
</dl>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2022-01-27 22:01 Thu</p>
<p class="author">Author: L.M.haoran</p>
<p class="date">Created: 2022-01-29 Sat 22:12</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
