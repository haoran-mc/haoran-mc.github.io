<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-06-13 Mon 17:35 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DSA</title>
<meta name="generator" content="Org mode">
<meta name="author" content="L.M.haoran">
<meta name="description" content="Copyright © 2022, L.M.haoran, all rights reserved."
>

                <link rel="stylesheet" href="static/css/org.css" type="text/css"  />
                <script type="module" src="static/js/main.js" defer></script>
                <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="static/MathJax/MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<div id="content">
<h1 class="title">DSA</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org5f21be0">什么是 DSA</a></li>
<li><a href="#org3341224">DSA 整体流程</a></li>
<li><a href="#org631bdaf">DSA 参数</a></li>
<li><a href="#org36754d5">DSA 算法实现过程</a>
<ul>
<li><a href="#orgf781028">DSA 签名过程</a></li>
<li><a href="#org02029c5">DSA 验证过程</a></li>
<li><a href="#org5969dd1">带入数据观察</a>
<ul>
<li><a href="#org8aec348">eg1:</a></li>
<li><a href="#orgb278ffc">eg2:</a></li>
</ul>
</li>
<li><a href="#org99c5431">注意的地方</a></li>
</ul>
</li>
<li><a href="#org3288dc1">DSA 算法正确性验证</a></li>
<li><a href="#org74594a6">DSA 算法安全性说明</a></li>
<li><a href="#org10825f8">具体实现过程，代码部分</a></li>
</ul>
</div>
</div>

<div id="outline-container-org5f21be0" class="outline-2">
<h2 id="org5f21be0">什么是 DSA</h2>
<div class="outline-text-2" id="text-org5f21be0">
<p>
DSA（Digital Signature Algorithm）是 Schnorr 和 ElGamal 签名算法的变种，被美国 NIST 作为 DSS（DigitalSignature Standard）数字签名的标准。<br>
</p>

<p>
DSA 是一种更高级的验证方式，它是一种公开密钥算法，不能用来加密数据，一般用于数字签名和认证。DSA 不单单只有公钥、私钥，还有数字签名。 <span class="underline">私钥加密生成数字签名，公钥验证数据及签名。</span> 在 DSA 数字签名和认证中，发送者使用自己的私钥对文件或消息进行签名，接受者收到消息后使用发送者的公钥来验证签名的真实性，包括数据的完整性以及数据发送者的身份。如果数据和签名不匹配则认为验证失败！数字签名的作用就是校验数据在传输过程中不被修改。<br>
</p>

<p>
DSA 数字签名可以理解为是单向加密的升级，不仅校验数据完整性，还校验发送者身份，同时还由于使用了非对称的密钥来保证密钥的安全，所以相比消息摘要算法更安全。<br>
</p>

<p>
DSA 只是一种算法，和 RSA 不同之处在于它不能用作加密和解密，也不能进行密钥交换，只用于签名，它比 RSA 要快很多<br>
</p>
</div>
</div>
<div id="outline-container-org3341224" class="outline-2">
<h2 id="org3341224">DSA 整体流程</h2>
</div>
<div id="outline-container-org631bdaf" class="outline-2">
<h2 id="org631bdaf">DSA 参数</h2>
<div class="outline-text-2" id="text-org631bdaf">
<dl class="org-dl">
<dt>\(p\)</dt><dd>一个素数，其值满足： \(2^{L-1} < p < 2^{L}\) 其中 \(512 \leq L \leq 1024\) 且 \(L\) 是 \(64\) 的倍数，\(p\) 的二进制表示的长度范围是 512 到 1024；<br></dd>
<dt>\(q\)</dt><dd>\(p - 1\) 的素因子，需要满足 \(2^{159} < q < 2^{160}\)，\(q\) 的二进制表示的长度是 \(160\)；<br></dd>
<dt>\(g\)</dt><dd>\(g = h^{(p-1)/q} mod p\)，其中 \(h\) 是一个整数，\(1 < h < p-1\) 且 \((h^{(p-1)/q} mod p) > 1\)；<br></dd>
<dt>\(x\)</dt><dd>私钥，\(x\) 为一个随机或伪随机生成的整数，其值满足 \(0 < x < q\)；<br></dd>
<dt>\(y\)</dt><dd>\((p, q, g, y)\) 是公钥，\(y = g^{x} mod p\)；<br></dd>
<dt>\(H(x)\)</dt><dd>One-Way Hash 函数，DSA 中选用 SHA(SEcure Hash Algorithm)；<br></dd>
</dl>
</div>
</div>
<div id="outline-container-org36754d5" class="outline-2">
<h2 id="org36754d5">DSA 算法实现过程</h2>
<div class="outline-text-2" id="text-org36754d5">
</div>
<div id="outline-container-orgf781028" class="outline-3">
<h3 id="orgf781028">DSA 签名过程</h3>
<div class="outline-text-3" id="text-orgf781028">
<ol class="org-ol">
<li>发送信息方随机选取 \(k, 0 < k < q\)，然后计算：<br></li>
<li>\(r = (g^{k} mod p) mod q\)；<br></li>
<li>\(s = (inv(k) \cdot (H(M)+xr)) mod q\)，这里 \(inv(k)\) 表示整数 \(k\) 关于某个模数的 <a href="Algorithm-数学-数论-乘法逆元.html">逆元</a>；<br></li>
<li>将数字签名 \((M, r, s)\) 发送给接收方；<br></li>
</ol>
</div>
</div>
<div id="outline-container-org02029c5" class="outline-3">
<h3 id="org02029c5">DSA 验证过程</h3>
<div class="outline-text-3" id="text-org02029c5">
<ol class="org-ol">
<li>接收方收到 \((M, r, s)\) 后，首先验证 \(0 < r < q, 0 < s < q\)，通过则计算：<br></li>
<li>\(w = inv(s) mod q\)；<br></li>
<li>\(u1 = (H(M) \cdot w) mod q\)；<br></li>
<li>\(u2 = (r \cdot w) mod q\)；<br></li>
<li>\(v = ((g^{u1} \cdot y^{u2}) mod p) mod q\)；<br></li>
<li>如果 \(v = r\)，则签名正确；<br></li>
</ol>
</div>
</div>
<div id="outline-container-org5969dd1" class="outline-3">
<h3 id="org5969dd1">带入数据观察</h3>
<div class="outline-text-3" id="text-org5969dd1">
</div>
<div id="outline-container-org8aec348" class="outline-4">
<h4 id="org8aec348">eg1:</h4>
<div class="outline-text-4" id="text-org8aec348">
<p>
这里的参数设置为较小的数，方便计算。<br>
</p>

<ol class="org-ol">
<li>获取参数<br>
<ul class="org-ul">
<li>\(p = 78 \times 101 + 1 = 7879\)<br></li>
<li>\(q = 101\)（保证 \(q\) 是 \(p-1\) 的素因子）<br></li>
<li>\(h = 3\)<br></li>
<li>\(g = h^{(p-1)/q} mod p = 3^{\frac{7879-1}{101}} \% 7879 = 170\)<br></li>
<li>\(x = 75\)，在 \((0, q)\) 中私钥随机选择<br></li>
<li>\(y = g^{x} mod p = 170^{75} \% 7879 = 4567\)<br></li>
</ul></li>
<li>签名，假设发送方要发送的消息是 \(M = 1234\)<br>
<ul class="org-ul">
<li>选择一个随机值 \(k, 0 < k < q\)：\(k = 50\)<br></li>
<li>\(r = (g^{k} mod p) mod q = (170^{50} \% 7879) \% 101 = 94\)<br></li>
<li>\(s = (inv(k) \cdot (H(M)+xr)) mod q = (99 \times (1234 + 75 \times 94)) \% 101 = 97\)<br></li>
<li>得到 \(M\) 的签名是 \((94, 97)\)<br></li>
</ul></li>
<li>验证，收到了 \(M, r, s\)<br>
<ul class="org-ul">
<li>首先验证 \(0 < r < q, 0 < s < q\)，通过了<br></li>
<li>\(w = (inv(s)) mod q = 25 \% 101 = 25\)<br></li>
<li>\(u_1 = (H(M) \cdot w) mod q = (1234 \times 25) \% 101 = 45\)<br></li>
<li>\(u_2 = (r \cdot w) mod q = (94 \times 25) \% 101 = 27\)<br></li>
<li>\(v = ((g^{u_1} \cdot y^{u_2}) mod p) mod q = ((170^{45} \times 4567^{27}) \% 7879) \% 101 = 94\)<br></li>
<li>\(v = r\)，因此，该签名是有效的！<br></li>
</ul></li>
</ol>

<blockquote>
<p>
通过这个例子能发现，接收者能够收到 \(M\) 也就是信息本身，所以 DSA 算法不能给信息加密，只能对信息签名！<br>
</p>
</blockquote>
</div>
</div>
<div id="outline-container-orgb278ffc" class="outline-4">
<h4 id="orgb278ffc">eg2:</h4>
<div class="outline-text-4" id="text-orgb278ffc">
<ol class="org-ol">
<li>获取参数<br>
<ul class="org-ul">
<li>\(p = 6 \times 11 + 1 = 67\)<br></li>
<li>\(q = 11\)<br></li>
<li>\(h = 3\)<br></li>
<li>\(g = h^{(p-1)/q} mod p = 3^{\frac{67-1}{11}} \% 67 = 59\)<br></li>
<li>\(x = 5\)，在 \((0, q)\) 中私钥随机选择<br></li>
<li>\(y = g^{x} mod p = 59^{5} \% 67 = 62\)<br></li>
<li>公钥\(KU\)：\(59, 67, 11, 62\)<br></li>
<li>私钥\(KR\)：\(59, 67, 11, 5\)<br></li>
</ul></li>
<li>签名，假设发送方发送的消息是 \(H(M) = 4\)<br>
<ul class="org-ul">
<li>选择一个随机值 \(k, 0 < k < q\)：\(k = 3\)<br></li>
<li>\(r = (g^{k} mod p) mod q = (59^{3} \% 67) \% 11 = 2\)<br></li>
<li>\(s = (inv(k) \cdot (H(M)+xr)) mod q = (4 \times (4 + 2 \times 5)) \% 11 = 1\)<br></li>
<li>得到 \(M\) 的签名是 \((2, 1)\)<br></li>
</ul></li>
<li>验证，收到了 \(M, r, s\)<br>
<ul class="org-ul">
<li>首先验证 \(0 < r < q, 0 < s < q\)，通过了<br></li>
<li>\(w = (inv(s)) mod q = 1 \% 11 = 1\)<br></li>
<li>\(u_1 = (H(M) \cdot w) mod q = (4 \times 1) \% 11 = 4\)<br></li>
<li>\(u_2 = (r \cdot w) mod q = (2 \times 1) \% 11 = 2\)<br></li>
<li>\(v = ((g^{u_1} \cdot y^{u_2}) mod p) mod q = ((59^{4} \times 62^{2}) \% 67) \% 11 = 2\)<br></li>
<li>\(v = r\)，因此，该签名是有效的！<br></li>
</ul></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org99c5431" class="outline-3">
<h3 id="org99c5431">注意的地方</h3>
<div class="outline-text-3" id="text-org99c5431">
<ul class="org-ul">
<li>k 在每次签名时都要重新生成，用于不要将同样的 k 用于进行其他的签名运算；<br></li>
<li>尽管 r 和 s 为 0 的概率相当小，但只要有任何一个为 0 ，必须重新生成 k，并重新计算 r 和 s；<br></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org3288dc1" class="outline-2">
<h2 id="org3288dc1">DSA 算法正确性验证</h2>
<div class="outline-text-2" id="text-org3288dc1">
<ul class="org-ul">
<li>签名生成时的 s 为：\(s \equiv inv(k) \cdot (H(M) + xr) mod q\)，两边同乘 \(inv(s), k\)：<br></li>
<li>\(k \equiv (inv(s) \cdot H(M)) mod q + (x \cdot inv(s) \cdot r) mod q\)，由签名验证时的 \(u_1, u_2\) 替换可得：<br></li>
<li>\(k \equiv u_1 mod q + (x \cdot u_2) mod q\)，两边同时做模 \(p\) 的指数运算可得：<br></li>
<li>\(g^{k} mod p \equiv g^{u_1 + x \cdot u_2} mod p\)；<br></li>
<li>\(\Rightarrow g^{k} mod p \equiv g^{u_1} y^{u_2} mod p\)，两边分别 \(mod q\) 得到：<br></li>
<li>\((g^{k} mod p) mod q \equiv (g^{u_1} y^{u_2} mod p) mod q\)，由签名过程中的 \(r\) 与验证过程中的 \(v\) 替换得：<br></li>
<li>\(r \equiv v mod q\)<br></li>
</ul>
</div>
</div>
<div id="outline-container-org74594a6" class="outline-2">
<h2 id="org74594a6">DSA 算法安全性说明</h2>
<div class="outline-text-2" id="text-org74594a6">
<p>
<b>DSA 加密算法的安全性：</b><br>
</p>

<p>
DSA 加密算法主要依赖于整数有限域离散对数难题，素数 \(p\) 必须足够大，且 \(p-1\) 至少包含一个大素数因子以抵抗 Pohlig&amp;Hellman 算法的攻击。<br>
</p>

<p>
DSA 加密算法的安全性主要依赖于 \(p\) 和 \(d\)，若选取不当则签名容易伪造，应保证 \(d\) 对于 \(p-1\) 的大素数因子不可约。<br>
</p>

<p>
<b>重要特点：两个素数公开</b><br>
</p>

<p>
DSA 是基于整数有限域离散对数难题的，其安全性与 RSA 相比差不多。DSA 的一个重要特点是两个素数公开，这样，当使用别人的 \(p\) 和 \(q\) 时，即使不知道私钥，也能确认它们是否是随机产生的，还是作了手脚。<br>
</p>
</div>
</div>
<div id="outline-container-org10825f8" class="outline-2">
<h2 id="org10825f8">具体实现过程，代码部分</h2>
<div class="outline-text-2" id="text-org10825f8">
<p>
整体代码在最下方。<br>
</p>

<ul class="org-ul">
<li><p>
预备函数<br>
</p>
<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#24555;&#36895;&#24130;&#65292;&#24555;&#36895;&#27714;&#24130;&#20989;&#25968;</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">binpow</span>(<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">base</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">expo</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">MOD</span>) {
    <span style="color: #df005f; font-weight: bold;">long</span> <span style="color: #df005f; font-weight: bold;">long</span> <span style="color: #8787d7;">res</span> = 1;
    <span style="color: #268bd2; font-weight: bold;">while</span> (expo) {
        <span style="color: #268bd2; font-weight: bold;">if</span> (expo &amp; 1)
            res = (1LL * res * base) % MOD;
        base = (1LL * base * base) % MOD;
        expo &gt;&gt;= 1;
    }
    <span style="color: #268bd2; font-weight: bold;">return</span> res;
}

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#25193;&#23637;&#27431;&#20960;&#37324;&#24471;&#31639;&#27861;&#65292;&#29992;&#26469;&#27714;&#36870;&#20803;</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">exgcd</span>(<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">a</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">b</span>, <span style="color: #df005f; font-weight: bold;">int</span> &amp;<span style="color: #8787d7;">x</span>, <span style="color: #df005f; font-weight: bold;">int</span> &amp;<span style="color: #8787d7;">y</span>) {
    <span style="color: #268bd2; font-weight: bold;">if</span> (<span style="color: #d75fd7;">!</span>b) {
        x = 1, y = 0;
        <span style="color: #268bd2; font-weight: bold;">return</span> a;
    }
    <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">d</span> = exgcd(b, a % b, y, x);
    y -= a / b * x;
    <span style="color: #268bd2; font-weight: bold;">return</span> d;
}

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#23558;&#21033;&#29992;&#25193;&#23637;&#27431;&#20960;&#37324;&#24471;&#31639;&#27861;&#27714;&#36870;&#20803;&#30340;&#27493;&#39588;&#23553;&#35013;&#36215;&#26469;</span>
<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#22312; mod MOD &#30340;&#24847;&#20041;&#19979;&#65292;a &#30340;&#36870;&#20803;</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">inv</span>(<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">a</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">MOD</span>) {
    <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">x</span>, <span style="color: #8787d7;">y</span>;
    <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">gcd</span> = exgcd(a, MOD, x, y);
    gcd += 1;
    <span style="color: #268bd2; font-weight: bold;">return</span> (x % MOD + MOD) % MOD;
}
</pre>
</div></li>
<li><p>
获取参数<br>
这里就简单的赋值了，如果想增加随机处理，可以在这里添加，公钥 \(y\) 与私钥 \(x\) 会在发送方代码部分赋值。<br>
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">p</span>, <span style="color: #8787d7;">q</span>, <span style="color: #8787d7;">h</span>, <span style="color: #8787d7;">g</span>, <span style="color: #8787d7;">y</span>;

<span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7; font-weight: bold;">init_param</span>() {
    p = 7879;
    q = 101;
    h = 3;
    g = binpow(h, (p-1)/q, p);
}
</pre>
</div></li>
<li><p>
发送方代码<br>
</p>
<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#21457;&#36865;&#26041;&#19982;&#25509;&#25910;&#26041;&#20043;&#38388;&#20256;&#36882;&#30340;&#20449;&#24687;&#26684;&#24335;</span>
<span style="color: #268bd2; font-weight: bold;">struct</span> <span style="color: #df005f; font-weight: bold;">Message</span> {
    <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">m</span>;   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#30495;&#27491;&#30340;&#20449;&#24687;&#65292;&#22914;&#26524;&#26159;&#23383;&#31526;&#20018;&#20449;&#24687;&#30340;&#35805;&#65292;&#21487;&#20197;&#36890;&#36807;&#21704;&#24076;&#31561;&#26041;&#24335;&#36716;&#25104;&#25972;&#22411;</span>
    <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">r</span>;   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#21457;&#36865;&#26041;&#20135;&#29983;&#30340;&#36741;&#21161;&#20540; r</span>
    <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">s</span>;   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#21457;&#36865;&#26041;&#20135;&#29983;&#30340;&#36741;&#21161;&#20540; s</span>
};

<span style="color: #268bd2; font-weight: bold;">class</span> <span style="color: #df005f; font-weight: bold;">Sender</span> {
<span style="color: #268bd2; font-weight: bold;">private</span>:
    <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">x</span>;   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#31169;&#38053;</span>
    <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">m</span>;   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#20449;&#24687;</span>
<span style="color: #268bd2; font-weight: bold;">public</span>:
    <span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7; font-weight: bold;">getInfo</span>();   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#33719;&#21462;&#20449;&#24687;</span>
    <span style="color: #df005f; font-weight: bold;">Message</span> <span style="color: #d75fd7; font-weight: bold;">send</span>();   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#21457;&#36865;&#20449;&#24687;</span>
};

<span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7;">Sender</span>::<span style="color: #d75fd7; font-weight: bold;">getInfo</span>() {
    puts(<span style="color: #2aa198;">"input the message you will send:"</span>);
    scanf(<span style="color: #2aa198;">"%d"</span>, &amp;<span style="color: #268bd2; font-weight: bold;">this</span>-&gt;m);
}

<span style="color: #df005f; font-weight: bold;">Message</span> <span style="color: #d75fd7;">Sender</span>::<span style="color: #d75fd7; font-weight: bold;">send</span>() {
    <span style="color: #df005f; font-weight: bold;">Message</span> <span style="color: #8787d7;">M</span>;
    M.m = <span style="color: #268bd2; font-weight: bold;">this</span>-&gt;m;

    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">srand((int)(time(NULL)));</span>
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">this-&gt;x = rand() % (q - 1) + 1;   // &#36873;&#25321;&#19968;&#20010;&#38543;&#26426;&#20540; x, 0 &lt; x &lt; q</span>
    <span style="color: #268bd2; font-weight: bold;">this</span>-&gt;x = 75;                   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#31169;&#38053; x</span>
    y = binpow(g, <span style="color: #268bd2; font-weight: bold;">this</span>-&gt;x, p);      <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#20844;&#38053; y</span>
    printf(<span style="color: #2aa198;">"\nx: %d\t\ty: %d\n"</span>, x, y);

    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">int k = rand() % (q - 1) + 1;   // &#36873;&#25321;&#19968;&#20010;&#38543;&#26426;&#20540; k, 0 &lt; k &lt; q</span>
    <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">k</span> = 50;

    M.r = binpow(g, k, p) % q;                       <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">r</span>
    M.s = (inv(k, q) * (M.m + <span style="color: #268bd2; font-weight: bold;">this</span>-&gt;x * M.r)) % q;   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">s</span>

    <span style="color: #268bd2; font-weight: bold;">return</span> M;
}
</pre>
</div></li>
<li><p>
接收方代码<br>
</p>
<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #268bd2; font-weight: bold;">class</span> <span style="color: #df005f; font-weight: bold;">Receiver</span> {
<span style="color: #268bd2; font-weight: bold;">public</span>:
    <span style="color: #df005f; font-weight: bold;">bool</span> <span style="color: #d75fd7; font-weight: bold;">receive</span>(<span style="color: #df005f; font-weight: bold;">Message</span> <span style="color: #8787d7;">M</span>);
};

<span style="color: #df005f; font-weight: bold;">bool</span> <span style="color: #d75fd7;">Receiver</span>::<span style="color: #d75fd7; font-weight: bold;">receive</span>(<span style="color: #df005f; font-weight: bold;">Message</span> <span style="color: #8787d7;">M</span>) {
    <span style="color: #268bd2; font-weight: bold;">if</span> ((0 &lt; M.r &amp;&amp; M.r &lt; q) &amp;&amp; (0 &lt; M.s &amp;&amp; M.s &lt; q)) {
        <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">w</span> = inv(M.s, q) % q;
        <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">u1</span> = (M.m * w) % q;
        <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">u2</span> = (M.r * w) % q;
        <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">v</span> = (binpow(g, u1, p) * binpow(y, u2, p) % p) % q;

        output(M, w, u1, u2, v);
        <span style="color: #268bd2; font-weight: bold;">return</span> v == M.r ? <span style="color: #d75fd7;">true</span> : <span style="color: #d75fd7;">false</span>;
    }
    <span style="color: #268bd2; font-weight: bold;">else</span> {
        <span style="color: #268bd2; font-weight: bold;">return</span> <span style="color: #d75fd7;">false</span>;
    }
}
</pre>
</div></li>
<li><p>
整体代码<br>
里面的数据是根据上面 eg1 固定了的，所以得到的结果始终不变。<br>
</p>

<ul class="org-ul">
<li>因为 \(p, q, g, y\) 这几个参数是公钥，所以设置为全局变量，所有人可见；<br></li>
<li>后面有输出 \(h\) 的代码部分（方便调试），所以也把 \(h\) 设置为全局变量了，其实可以设置为 <code>init_param()</code> 函数的局部变量，而且可以随机生成，只要满足上面签名过程所限定的范围就好了；<br></li>
<li>主函数初始化参数之后，请用户输入传递的参数，这里我们只能输入整型的传递信息，如果想输入字符串类型的传递信息，可以通过字符串哈希等其他方法将字符串转换成整型，由于这里重点模拟 DSA 算法过程，所以直接限定为只能输入整型；<br></li>
<li>创建发送方对象、接收方对象；<br></li>
<li>发送发对象随机化一个私钥，这里我们还是直接指定了私钥的值；<br></li>
<li>然后发送发对象调用自身方法 <code>send()</code> 将用户输入的信息通过参数签名，得到包装后的信息，包装后的信息我们用一个结构体表示 <code>Message</code> ；<br></li>
<li>接收方通过公钥验证签名；<br></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #d75fd7;">#include</span> <span style="color: #2aa198;">&lt;cstdio&gt;</span>
<span style="color: #d75fd7;">#include</span> <span style="color: #2aa198;">&lt;cstdlib&gt;</span>
<span style="color: #d75fd7;">#include</span> <span style="color: #2aa198;">&lt;ctime&gt;</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">p</span>, <span style="color: #8787d7;">q</span>, <span style="color: #8787d7;">h</span>, <span style="color: #8787d7;">g</span>, <span style="color: #8787d7;">y</span>;

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#24555;&#36895;&#24130;&#65292;&#24555;&#36895;&#27714;&#24130;&#20989;&#25968;</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">binpow</span>(<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">base</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">expo</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">MOD</span>) {
    <span style="color: #df005f; font-weight: bold;">long</span> <span style="color: #df005f; font-weight: bold;">long</span> <span style="color: #8787d7;">res</span> = 1;
    <span style="color: #268bd2; font-weight: bold;">while</span> (expo) {
        <span style="color: #268bd2; font-weight: bold;">if</span> (expo &amp; 1)
            res = (1LL * res * base) % MOD;
        base = (1LL * base * base) % MOD;
        expo &gt;&gt;= 1;
    }
    <span style="color: #268bd2; font-weight: bold;">return</span> res;
}

<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">exgcd</span>(<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">a</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">b</span>, <span style="color: #df005f; font-weight: bold;">int</span> &amp;<span style="color: #8787d7;">x</span>, <span style="color: #df005f; font-weight: bold;">int</span> &amp;<span style="color: #8787d7;">y</span>) {
    <span style="color: #268bd2; font-weight: bold;">if</span> (<span style="color: #d75fd7;">!</span>b) {
        x = 1, y = 0;
        <span style="color: #268bd2; font-weight: bold;">return</span> a;
    }
    <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">d</span> = exgcd(b, a % b, y, x);
    y -= a / b * x;
    <span style="color: #268bd2; font-weight: bold;">return</span> d;
}

<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#23558;&#21033;&#29992;&#25193;&#23637;&#27431;&#20960;&#37324;&#24471;&#31639;&#27861;&#27714;&#36870;&#20803;&#30340;&#27493;&#39588;&#23553;&#35013;&#36215;&#26469;</span>
<span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#22312; mod MOD &#30340;&#24847;&#20041;&#19979;&#65292;a &#30340;&#36870;&#20803;</span>
<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">inv</span>(<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">a</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">MOD</span>) {
    <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">x</span>, <span style="color: #8787d7;">y</span>;
    <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">gcd</span> = exgcd(a, MOD, x, y);
    gcd += 1;
    <span style="color: #268bd2; font-weight: bold;">return</span> (x % MOD + MOD) % MOD;
}

<span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7; font-weight: bold;">init_param</span>() {
    p = 7879;
    q = 101;
    h = 3;
    g = binpow(h, (p-1)/q, p);
}

<span style="color: #268bd2; font-weight: bold;">struct</span> <span style="color: #df005f; font-weight: bold;">Message</span> {
    <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">m</span>;
    <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">r</span>;
    <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">s</span>;
};

<span style="color: #268bd2; font-weight: bold;">class</span> <span style="color: #df005f; font-weight: bold;">Sender</span> {
<span style="color: #268bd2; font-weight: bold;">private</span>:
    <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">x</span>;   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#31169;&#38053;</span>
    <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">m</span>;   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#20449;&#24687;</span>
<span style="color: #268bd2; font-weight: bold;">public</span>:
    <span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7; font-weight: bold;">getInfo</span>();   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#33719;&#21462;&#20449;&#24687;</span>
    <span style="color: #df005f; font-weight: bold;">Message</span> <span style="color: #d75fd7; font-weight: bold;">send</span>();   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#23558;&#20449;&#24687;&#23553;&#35013;&#25104;&#19968;&#20010; Message&#65292;&#28982;&#21518;&#21457;&#36865;</span>
};

<span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7;">Sender</span>::<span style="color: #d75fd7; font-weight: bold;">getInfo</span>() {
    puts(<span style="color: #2aa198;">"input the message you will send:"</span>);
    scanf(<span style="color: #2aa198;">"%d"</span>, &amp;<span style="color: #268bd2; font-weight: bold;">this</span>-&gt;m);
}

<span style="color: #df005f; font-weight: bold;">Message</span> <span style="color: #d75fd7;">Sender</span>::<span style="color: #d75fd7; font-weight: bold;">send</span>() {
    <span style="color: #df005f; font-weight: bold;">Message</span> <span style="color: #8787d7;">M</span>;
    M.m = <span style="color: #268bd2; font-weight: bold;">this</span>-&gt;m;

    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">this-&gt;x = rand() % (q - 1) + 1;   // &#36873;&#25321;&#19968;&#20010;&#38543;&#26426;&#20540; x, 0 &lt; x &lt; q</span>
    <span style="color: #268bd2; font-weight: bold;">this</span>-&gt;x = 75;                   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#31169;&#38053; x</span>
    y = binpow(g, <span style="color: #268bd2; font-weight: bold;">this</span>-&gt;x, p);      <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#20844;&#38053; y</span>
    printf(<span style="color: #2aa198;">"\nx: %d\t\ty: %d\n"</span>, x, y);

    srand((<span style="color: #df005f; font-weight: bold;">int</span>)(time(<span style="color: #d75fd7;">NULL</span>)));
    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">int k = rand() % (q - 1) + 1;   // &#36873;&#25321;&#19968;&#20010;&#38543;&#26426;&#20540; k, 0 &lt; k &lt; q</span>
    <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">k</span> = 50;

    M.r = binpow(g, k, p) % q;                       <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">r</span>
    M.s = (inv(k, q) * (M.m + <span style="color: #268bd2; font-weight: bold;">this</span>-&gt;x * M.r)) % q;   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">s</span>

    <span style="color: #268bd2; font-weight: bold;">return</span> M;
}

<span style="color: #df005f; font-weight: bold;">void</span> <span style="color: #d75fd7; font-weight: bold;">output</span>(<span style="color: #df005f; font-weight: bold;">Message</span> <span style="color: #8787d7;">M</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">w</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">u1</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">u2</span>, <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">v</span>) {
    printf(<span style="color: #2aa198;">"p: %d\t\tq: %d\t\th: %d\t\tg: %d\n"</span>, p, q, h, g);
    printf(<span style="color: #2aa198;">"M: %d\t\tr: %d\t\ts: %d\n"</span>, M.m, M.r, M.s);
    printf(<span style="color: #2aa198;">"w: %d\t\tu1: %d\t\tu2: %d\t\tv: %d\n\n"</span>, w, u1, u2, v);
}

<span style="color: #268bd2; font-weight: bold;">class</span> <span style="color: #df005f; font-weight: bold;">Receiver</span> {
<span style="color: #268bd2; font-weight: bold;">public</span>:
    <span style="color: #df005f; font-weight: bold;">bool</span> <span style="color: #d75fd7; font-weight: bold;">receive</span>(<span style="color: #df005f; font-weight: bold;">Message</span> <span style="color: #8787d7;">M</span>);
};

<span style="color: #df005f; font-weight: bold;">bool</span> <span style="color: #d75fd7;">Receiver</span>::<span style="color: #d75fd7; font-weight: bold;">receive</span>(<span style="color: #df005f; font-weight: bold;">Message</span> <span style="color: #8787d7;">M</span>) {
    <span style="color: #268bd2; font-weight: bold;">if</span> ((0 &lt; M.r &amp;&amp; M.r &lt; q) &amp;&amp; (0 &lt; M.s &amp;&amp; M.s &lt; q)) {
        <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">w</span> = inv(M.s, q) % q;
        <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">u1</span> = (M.m * w) % q;
        <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">u2</span> = (M.r * w) % q;
        <span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #8787d7;">v</span> = (binpow(g, u1, p) * binpow(y, u2, p) % p) % q;

        output(M, w, u1, u2, v);
        <span style="color: #268bd2; font-weight: bold;">return</span> v == M.r ? <span style="color: #d75fd7;">true</span> : <span style="color: #d75fd7;">false</span>;
    }
    <span style="color: #268bd2; font-weight: bold;">else</span> {
        <span style="color: #268bd2; font-weight: bold;">return</span> <span style="color: #d75fd7;">false</span>;
    }
}

<span style="color: #df005f; font-weight: bold;">int</span> <span style="color: #d75fd7; font-weight: bold;">main</span>() {
    init_param();   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#33719;&#21462;&#24517;&#35201;&#21442;&#25968;</span>
    <span style="color: #df005f; font-weight: bold;">Sender</span> <span style="color: #8787d7;">sender</span>;       <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#21457;&#36865;&#23545;&#35937;</span>
    <span style="color: #df005f; font-weight: bold;">Receiver</span> <span style="color: #8787d7;">receiver</span>;   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#25509;&#25910;&#23545;&#35937;</span>

    sender.getInfo();    <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#21457;&#36865;&#20449;&#24687;</span>

    <span style="color: #df005f; font-weight: bold;">bool</span> <span style="color: #8787d7;">is_valid</span> = receiver.receive(sender.send());   <span style="color: #008787; background-color: #262626;">// </span><span style="color: #008787; background-color: #262626;">&#21457;&#36865;&#19982;&#39564;&#35777;</span>

    <span style="color: #268bd2; font-weight: bold;">if</span> (is_valid) {
        puts(<span style="color: #2aa198;">"Authentication is successful"</span>);
    }
    <span style="color: #268bd2; font-weight: bold;">else</span> {
        puts(<span style="color: #2aa198;">"Validation fails"</span>);
    }
    <span style="color: #268bd2; font-weight: bold;">return</span> 0;
}
</pre>
</div></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: L.M.haoran</p>
<p class="date">Created: 2022-06-13 Mon 17:35</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
